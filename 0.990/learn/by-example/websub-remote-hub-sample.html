

<!DOCTYPE html>
<html class="no-js">
<head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below." />

<meta name="author" content="WSO2, Inc.">

<meta name="keywords" content="ballerinalang, integration, microservices, programming language, cloud native, ballerina language" />

<link rel="shortcut icon" href="/img/favicon.ico">
<title>WebSub Remote Hub Sample</title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92163714-2"></script>
<!--FB-->
<meta property="og:type"               content="article" />
<meta property="og:title"              content="Ballerina - WebSub Remote Hub Sample" />
<meta property="og:description"        content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below." />
<meta property="og:image"              content="https://ballerina.io/img/ballerina-swan-lake-sm-banner.png
" />
<!--TWITTER-->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ballerinalang">
<meta name="twitter:creator" content="@ballerinalang">
<meta name="twitter:title" content="Ballerina">
<meta name="twitter:description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.">
<meta name="twitter:image" content="https://ballerina.io/img/ballerina-swan-lake-sm-banner.png">

<meta name="twitter:text:description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image:width" content="610">
<!--LINKED IN  -->
<meta property='og:title' content="Ballerina"/>
<meta property='og:image' content="https://ballerina.io/img/ballerina-swan-lake-sm-banner.png
"/>
<meta property='og:description' content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below."/>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-92163714-2');
</script>
<!-- Google Tag Manager -->
<script>
    (function(w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src =
            'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-PSL2TX4');
</script>
<!-- End Google Tag Manager -->

<!--copy to clipboard lib-->
<script src="/js/clipboard.js-2.0.0/clipboard.min.js"></script>

<script src="/js/latest-jquery.js"></script>
<script>
    var base_url = "";
</script>
<link rel="stylesheet" href="/css/latest-bootstrap.css">
<!-- Optional theme -->
<link rel="stylesheet" href="/css/latest-bootstrap-theme.css">
<!-- Latest compiled and minified JavaScript -->
<script src="/js/latest-bootstrap.js"></script>
<link rel="stylesheet" href="https://use.typekit.net/son4ymv.css">

<script type="text/javascript" src="/js/highlight.pack.js"></script>

<script src="/js/ballerina-common.js"></script>
<link rel=stylesheet href="/css/ballerina-io.css">
<link rel=stylesheet href="/css/ballerina-io-bbe.css">
<link rel="stylesheet" href="/css/bbe-page.css">
<script>
    // Current page data
    var mkdocs_page_name = '"Home"'.replace(/^"|"$/g, '');
    var mkdocs_page_input_path = '"index.md"'.replace(/^"|"$/g, '');
    var mkdocs_page_url = '"/"'.replace(/^"|"$/g, '');
    
    var releaseNoteFilename = 'RELEASE_NOTE.html';

    var nightly_download_url = 'https://product-dist.ballerina.io/nightly';
    var dev_download_url = 'https://product-dist.ballerina.io/dev';
    var base_download_url = 'https://dist.ballerina.io/downloads';
</script>

</head>
<body class="cBallerina-io">
<div class="row cBallerina-io-Nav" id="iMainNavigation">
    <div class="container">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <nav class="navbar">
                <div>
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">&#9776</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="cMobileLogo" href="/"><img src="/img/ballerina-logo.svg" alt="Ballerina"/></a>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav cTopNav">
                            <li class="active toctree-l1" id="learnli"><a class="cBioTopLink" href="/learn">Learn</a>
                            </li>
                            <li class="active toctree-l1" id="Eventsli"><a class="cBioTopLink" href="/learn/events">Events</a>
                            </li>
                            <li class="toctree-l1"><a class="cBioTopLink" href="https://central.ballerina.io/"
                                                      target="_blank">Central</a></li>
                            <li class="toctree-l1" id="openli"><a class="cBioTopLink" href="/community">Community</a>
                            </li>
                            <li class="toctree-l1" id="helpli"><a class="cBioTopLink" href="https://blog.ballerina.io">Blog</a>
                            </li>
                            <li class="cVersionItem">
                                <div class="cVersionContainer">
                                    <!-- <lable class="cVlable">Version</lable> -->
                                    <select name="versions" id="versions" class="select-css">
                                        <option value="1.2" data-value="latest">v1.2</option>
                                        <option value="1.1">v1.1</option>
                                        <option value="1.0">v1.0</option>
                                        <option value="0.991">v0.991</option>
                                    </select>
                                </div>
                            </li>
                            <li class="cSearchMenu"><form class="cSearch-form-inline"><input id="searchTxt" class="form-control-field" type="search" placeholder="Search" aria-label="Search"><a id="searchBtn" href="#" class="cSearchButton"><img src="/img/search.svg"/></a></form></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</div>

<div class="row cBallerina-io-Gray-row">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 cBallerina-io-Home-Middle-col">
                <div class="col-xs-12 col-sm-12" style="padding: 0;">
                    <div class="col-md-12 col-lg-10 cBallerina-io-breadcrumbs">
                        <nav class="breadcrumbs bootstrap hidden-sm-down"
  >
  <ul id="breadcrumb-list" class=" cBalleinaBreadcrumbs list-unstyled  wy-breadcrumbs" vocab="http://schema.org/"
    typeof="BreadcrumbList">


    
    <li><a href="/">Home</a></li>
    
    
    <li>/</li>
    <li><a
        href="/0.990/">0.990</a>
    </li>
    
    
    
    <li>/</li>
    <li><a
        href="/0.990/learn/">Learn</a>
    </li>
    
    
    
    <li>/</li>
    <li><a
        href="/0.990/learn/by-example/">By example</a>
    </li>
    
    
    
    <li>/</li> WebSub Remote Hub Sample
    
    

  </ul>
</nav>
<style type="text/css">
  .cBalleinaBreadcrumbs li {
    margin-right: 10px;
  }
</style>
                        <div class="cVersionContainer"></div>
                    </div>
                    <div class="col-md-12 col-lg-2 cBallerina-io-breadcrumbs">
                        <ul class="wy-breadcrumbs">
                            <!-- <li class="wy-breadcrumbs-aside">
                                <a class="icon icon-github" target="_blank" href="https://www.github.com/ballerina-platform/ballerina-platform.github.io/blob/master/0.990/learn/by-example/websub-remote-hub-sample.html">Edit on GitHub</a>
                            </li> -->
                        </ul>
                    </div>
                </div>
                <div class="cBlallerina-io-docs-content-container">
                    <div class="wy-nav-content">
                        <div class="rst-content">
                            <div role="main">
                                <div class="section">
                                    <div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Starting up the Ballerina Hub Service&quot;</span><span class="p">);</span>    <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">startHub</span><span class="p">(</span><span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9191</span><span class="p">),</span> <span class="nx">hubConfiguration</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nx">remotePublish</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="nx">enabled</span> <span class="p">:</span> <span class="kc">true</span>
                <span class="p">}});</span>
    <span class="nx">websub</span><span class="p">:</span><span class="nx">WebSubHub</span> <span class="nx">webSubHub</span> <span class="p">=</span> <span class="nx">result</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">HubStartedUpError</span> <span class="err">?</span>
                                               <span class="nx">result</span><span class="p">.</span><span class="nx">startedUpHub</span> <span class="p">:</span> <span class="nx">result</span><span class="p">;</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">);}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span>
<span class="nx">websub</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">websubHubClientEP</span> <span class="p">=</span>
                    <span class="nx">new</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Client</span><span class="p">(</span><span class="s">&quot;http://localhost:9191/websub/hub&quot;</span><span class="p">);</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">registrationResponse</span> <span class="p">=</span>
                <span class="nx">websubHubClientEP</span><span class="o">-&gt;</span><span class="nx">registerTopic</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">registrationResponse</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error occurred registering topic: &quot;</span> <span class="o">+</span>
                                <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">registrationResponse</span><span class="p">.</span><span class="nx">detail</span><span class="p">().</span><span class="kt">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Topic registration successful!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Publishing update to remote Hub&quot;</span><span class="p">);</span>
    <span class="k">var</span> <span class="nx">publishResponse</span> <span class="p">=</span>
        <span class="nx">websubHubClientEP</span><span class="o">-&gt;</span><span class="nx">publishUpdate</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">,</span>
                                <span class="p">{</span> <span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="s">&quot;publish&quot;</span><span class="p">,</span> <span class="s">&quot;mode&quot;</span><span class="p">:</span> <span class="s">&quot;remote-hub&quot;</span> <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">publishResponse</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error notifying hub: &quot;</span> <span class="o">+</span>
                                    <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">publishResponse</span><span class="p">.</span><span class="nx">detail</span><span class="p">().</span><span class="kt">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Update notification successful!&quot;</span><span class="p">);</span>
    <span class="p">}}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span>
<span class="nx">listener</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Listener</span> <span class="nx">websubEP</span> <span class="p">=</span> <span class="nx">new</span><span class="p">(</span><span class="mi">8181</span><span class="p">);</span>
<span class="nd">@websub:SubscriberServiceConfig {</span>
    <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/websub&quot;</span><span class="p">,</span>
    <span class="nx">subscribeOnStartUp</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">topic</span><span class="p">:</span> <span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">,</span>
    <span class="nx">hub</span><span class="p">:</span> <span class="s">&quot;http://localhost:9191/websub/hub&quot;</span><span class="p">,</span>
    <span class="nx">leaseSeconds</span><span class="p">:</span> <span class="mi">36000</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">:</span> <span class="s">&quot;Kslk30SNF2AChs2&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">websubSubscriber</span> <span class="nx">on</span> <span class="nx">websubEP</span> <span class="p">{</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onIntentVerification</span><span class="p">(</span><span class="nx">websub</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span>
                                   <span class="nx">websub</span><span class="p">:</span><span class="nx">IntentVerificationRequest</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">request</span><span class="p">.</span>
            <span class="nx">buildSubscriptionVerificationResponse</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">);</span>        <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">==</span> <span class="mi">202</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;Intent verified for subscription request&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printWarn</span><span class="p">(</span><span class="s">&quot;Intent verification denied for subscription request&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">untaint</span> <span class="nx">response</span><span class="p">);</span>        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error responding to intent verification request&quot;</span><span class="p">,</span>
                                                        <span class="nx">err</span> <span class="p">=</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onNotification</span><span class="p">(</span><span class="nx">websub</span><span class="p">:</span><span class="nx">Notification</span> <span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">notification</span><span class="p">.</span><span class="nx">getPayloadAsString</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;WebSub Notification Received: &quot;</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error retrieving payload as string&quot;</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>WebSub Remote Hub Sample</h2>
                            <p><p>Ballerina provides the capability to easily introduce publishers and subscribers that are WebSub compliant.
 Ballerina WebSub subscribers can specify the topic they wish to subscribe to and the hub they wish to subscribe at,
 to receive notifications. If specified, the subscription process can be initiated at startup. Signature
 validation is performed by default for subscribers that receive authenticated content. Ballerina WebSub Subscriber
 Services could thus be registered as webhooks to receive event notifications.</p>

<p>Ballerina also comes with an in-built WebSub Hub service that can be brought up by publishers that need to bring up
 a hub.</p>

<p>This example demonstrates a simple WebSub publisher and subscriber scenario, where a Ballerina WebSub Hub
 that is brought up remotely is used by a Ballerina WebSub publisher to publish updates to a topic. A Ballerina
 WebSub Subscriber subscribes at this remote hub to get the topic updates.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="websub-internal-hub-sample.html">
                                        <span>< PREVIOUS</span>
                                        <p>WebSub Internal Hub Sample</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="websub-hub-client-sample.html">
                                        <span>NEXT ></span>
                                        <p>WebSub Hub Client Sample</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="websub-remote-hub-sample">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-distribution/tree/master/examples/websub-remote-hub-sample/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/io;
import ballerina/http;
import ballerina/runtime;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Main program that brings up the Ballerina WebSub Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    io:println(&quot;Starting up the Ballerina Hub Service&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Start up the internal Ballerina Hub on port 9191, allowing remote publishers to register topics and publish
 updates for the topics.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    var result = websub:startHub(new http:Listener(9191), hubConfiguration = {
                remotePublish : {
                    enabled : true
                }});
    websub:WebSubHub webSubHub = result is websub:HubStartedUpError ?
                                               result.startedUpHub : result;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(10000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Wait for the subscriber to subscribe at this hub and for the publisher to publish the notifications.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># This sample requires the Hub Service to start via hub.bal prior to running the Publisher main program. The
# Subscriber Service needs to start after the publisher registers the topic at the hub.
# If the port is not specified, the hub service starts on the default port.
# To run this sample, navigate to the directory that contains the
# `.bal` file and issue the `ballerina run` command.
$ ballerina run hub.bal
Starting up the Ballerina Hub Service
[ballerina/http] started HTTPS/WSS endpoint 0.0.0.0:9191
[ballerina/websub] Default Ballerina WebSub Hub started up at http://localhost:9191/websub/hub
2018-04-26 22:20:43,096 INFO  [ballerina/websub] - Topic registration successful at Hub, for topic[http://websubpubtopic.com]
2018-04-26 22:20:45,960 INFO  [ballerina/websub] - Intent verification successful for mode: [subscribe], for callback URL: [http://localhost:8181/websub]
2018-04-26 22:20:53,377 INFO  [ballerina/websub] - Update notification done for Topic [http://websubpubtopic.com]
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                                    <div class="bal-separator">
                                        <!-- This table is a temporary table to add spacing between output and next bal file-->
                                        <table class="cTopBorder-table">
                                            <tbody><tr>
                                                <td class="cCodeTD"></td>
                                                <td class="cDescTD"></td>
                                            </tr>
                                        </tbody></table>
                                    </div>
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/io;
import ballerina/runtime;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Ballerina WebSub Publisher, which registers a topic at the hub and publishes updates to the hub for the topic.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>websub:Client websubHubClientEP =
                    new websub:Client(&quot;http://localhost:9191/websub/hub&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the remote WebSub Hub Endpoint to which registration and publish requests are sent.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    var registrationResponse =
                websubHubClientEP-&gt;registerTopic(&quot;http://websubpubtopic.com&quot;);
    if (registrationResponse is error) {
        io:println(&quot;Error occurred registering topic: &quot; +
                                &lt;string&gt;registrationResponse.detail().message);
    } else {
        io:println(&quot;Topic registration successful!&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Register a topic at the hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(5000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Make the publisher wait until the subscriber subscribes at the hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    io:println(&quot;Publishing update to remote Hub&quot;);
    var publishResponse =
        websubHubClientEP-&gt;publishUpdate(&quot;http://websubpubtopic.com&quot;,
                                { &quot;action&quot;: &quot;publish&quot;, &quot;mode&quot;: &quot;remote-hub&quot; });
    if (publishResponse is error) {
        io:println(&quot;Error notifying hub: &quot; +
                                    &lt;string&gt;publishResponse.detail().message);
    } else {
        io:println(&quot;Update notification successful!&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Publish updates to the remote hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run this sample, navigate to the directory that contains the
# `.bal` file and issue the `ballerina run` command.
$ ballerina run publisher.bal
Topic registration successful!
Publishing update to remote Hub
Update notification successful!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                                    <div class="bal-separator">
                                        <!-- This table is a temporary table to add spacing between output and next bal file-->
                                        <table class="cTopBorder-table">
                                            <tbody><tr>
                                                <td class="cCodeTD"></td>
                                                <td class="cDescTD"></td>
                                            </tr>
                                        </tbody></table>
                                    </div>
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/http;
import ballerina/log;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Ballerina WebSub Subscriber service, which subscribes to notifications at a Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>listener websub:Listener websubEP = new(8181);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The endpoint to which the subscriber service is bound.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>@websub:SubscriberServiceConfig {
    path: &quot;/websub&quot;,
    subscribeOnStartUp: true,
    topic: &quot;http://websubpubtopic.com&quot;,
    hub: &quot;http://localhost:9191/websub/hub&quot;,
    leaseSeconds: 36000,
    secret: &quot;Kslk30SNF2AChs2&quot;
}
service websubSubscriber on websubEP {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Annotations specifying the subscription parameters.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    resource function onIntentVerification(websub:Caller caller,
                                   websub:IntentVerificationRequest request) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Define the resource that accepts the intent verification requests.
 If the resource is not specified, intent verification happens automatically. It verifies if the topic specified in the intent verification request matches the topic specified as the annotation.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        http:Response response = request.
            buildSubscriptionVerificationResponse(&quot;http://websubpubtopic.com&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Build the response for the subscription intent verification request that was received.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        if (response.statusCode == 202) {
            log:printInfo(&quot;Intent verified for subscription request&quot;);
        } else {
            log:printWarn(&quot;Intent verification denied for subscription request&quot;);
        }
        var result = caller-&gt;respond(untaint response);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        if (result is error) {
            log:printError(&quot;Error responding to intent verification request&quot;,
                                                        err = result);
        }
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>    resource function onNotification(websub:Notification notification) {
        var payload = notification.getPayloadAsString();
        if (payload is string) {
            log:printInfo(&quot;WebSub Notification Received: &quot; + payload);
        } else {
            log:printError(&quot;Error retrieving payload as string&quot;, err = payload);
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Define the resource that accepts the content delivery requests.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file and use the `ballerina run` command.
$ ballerina run subscriber.bal
Initiating service(s) in &#39;subscriber.bal&#39;
[ballerina/http] started HTTP/WS endpoint 0.0.0.0:8181
2018-04-26 22:20:45,790 INFO  [ballerina/websub] - Subscription Request successful at Hub[http://localhost:9191/websub/hub], for Topic[http://websubpubtopic.com], with Callback [http://localhost:8181/websub]
2018-04-26 22:20:45,888 INFO  [] - Intent verified for subscription request
2018-04-26 22:20:53,456 INFO  [] - WebSub Notification Received: {&quot;action&quot;:&quot;publish&quot;, &quot;mode&quot;:&quot;remote-hub&quot;}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="iBallerinaFooter" class="row cBallerina-io-White-row">
    <div class="container">
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-left-col cBallerinaFooterLinks">
        <ul>
            <li><a class="cBioFooterLink" href="/downloads">Download</a></li>
            <li><a class="cBioFooterLink" href="https://github.com/ballerina-lang/ballerina/blob/master/LICENSE">Code License</a></li>
            <li><a class="cBioFooterLink" href="/license-of-site">Site License</a></li>
            <li><a class="cBioFooterLink" href="/terms-of-service">TERMS OF SERVICE</a></li>
            <li><a class="cBioFooterLink" href="/privacy-policy">PRIVACY POLICY</a></li>
            </ul>
        </div>
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-middle-col cBallerinaFooterSignUp">
        <div class="cSocialmedia">
            <ul>
                <li>
                    <a class="cBioFooterLink" href="https://github.com/ballerina-platform" target="_blank"><img src="/img/github.svg"/></a>
                    </li>
                <li><a class="cBioFooterLink" href="https://stackoverflow.com/questions/tagged/ballerina" target="_blank"><img src="/img/stackoverflow.svg"/></a></li>
                <li><a class="cBioFooterLink" href="https://twitter.com/ballerinalang" target="_blank"><img src="/img/twitter.svg"/></a></li>
                <li><a class="cBioFooterLink" href="/community/slack/"><img src="/img/slack.svg"/></a></li>
                </ul>
            <div class="pdframe"></div>
            </div>
        </div>
    <div class="col-xs-12 col-sm-10 col-md-6 col-lg-6 cBallerina-io-right-col">
        <p>In the creation of Ballerina, we were inspired by so many technologies. Thank you to all that have come before us (and forgive us if we missed one): Java, Go, C, C++, D, Rust, Haskell, Kotlin, Dart, TypeScript, JavaScript, Python, Perl, Flow, Swift, Elm, RelaxNG, NPM, Crates, Maven, Gradle, Kubernetes, Docker, Envoy, Markdown, GitHub and WSO2.</p></div>
    </div>
</div>

<script src="/js/theme.js"></script>

<script>
    $(document).ready(function() {
        var gitstar = '<iframe id="iGitStarIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=star&count=true&size=small" frameborder="0" scrolling="0"></iframe>';
        $('[data-button="iGitStarText"]').replaceWith(gitstar);

        var gitwatch = '<iframe id="iGitWatchIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=watch&count=true&size=lsmalle&v=2" frameborder="0" scrolling="0"></iframe>';
        $('[data-button="iGitWatchText"]').replaceWith(gitwatch);

    });
</script>

<style>
    .cGitButtonContainer {
        display: inline-block;
        width: 100%;
        margin-bottom: 0px;
    }

    #iGitStarText {
        height: 20px;
        float: left;
        padding: 0;
        margin: 0;
    }
    #iGitStarIframe , #iGitWatchIframe {
        height: 20px;
        width: 100px;
        float: left;
    }
</style>

</body>
</html>

