

<!DOCTYPE html>
<html class="no-js">
<head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below." />

<meta name="author" content="WSO2, Inc.">

<meta name="keywords" content="ballerinalang, integration, microservices, programming language, cloud native, ballerina language" />

<link rel="shortcut icon" href="/img/favicon.ico">
<title>XA Transactions</title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92163714-2"></script>
<!--FB-->
<meta property="og:type"               content="article" />
<meta property="og:title"              content="Ballerina - XA Transactions" />
<meta property="og:description"        content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below." />
<meta property="og:image"              content="/img/ballerina-sm-2.jpg" />
<!--TWITTER-->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ballerinalang">
<meta name="twitter:creator" content="@ballerinalang">
<meta name="twitter:title" content="Ballerina">
<meta name="twitter:description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.">
<meta name="twitter:image" content="/img/ballerina-sm-2.jpg">
<meta name="twitter:text:description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image:width" content="610">
<!--LINKED IN  -->
<meta property='og:title' content="Ballerina"/>
<meta property='og:image' content="/img/ballerina-sm-2.jpg"/>
<meta property='og:description' content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below."/>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-92163714-2');
</script>
<!-- Google Tag Manager -->
<script>
    (function(w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src =
            'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-PSL2TX4');
</script>
<!-- End Google Tag Manager -->

<!--copy to clipboard lib-->
<script src="/js/clipboard.js-2.0.0/clipboard.min.js"></script>

<script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    var base_url = "";
</script>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Optional theme -->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://use.typekit.net/son4ymv.css">

<script type="text/javascript" src="/js/highlight.pack.js"></script>

<script src="/js/ballerina-common.js"></script>
<link rel=stylesheet href="/css/ballerina-io.css">
<link rel=stylesheet href="/css/ballerina-io-bbe.css">
<link rel="stylesheet" href="/css/bbe-page.css">
<script>
    // Current page data
    var mkdocs_page_name = '"Home"'.replace(/^"|"$/g, '');
    var mkdocs_page_input_path = '"index.md"'.replace(/^"|"$/g, '');
    var mkdocs_page_url = '"/"'.replace(/^"|"$/g, '');
    
    var releaseNoteFilename = 'RELEASE_NOTE.html';

    var nightly_download_url = 'https://product-dist.ballerina.io/nightly';
    var dev_download_url = 'https://product-dist.ballerina.io/dev';
    var base_download_url = 'https://dist.ballerina.io/downloads';
</script>

</head>
<body class="cBallerina-io">
<div class="row cBallerina-io-Nav" id="iMainNavigation">
    <div class="container">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <nav class="navbar">
                <div>
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">&#9776</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="cMobileLogo" href="/"><img src="/img/ballerina-logo.svg" alt="Ballerina"/></a>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav cTopNav">
                            <li class="active toctree-l1" id="learnli"><a class="cBioTopLink" href="/learn">Learn</a>
                            </li>
                            <li class="active toctree-l1" id="Eventsli"><a class="cBioTopLink" href="/learn/events">Events</a>
                            </li>
                            <li class="toctree-l1"><a class="cBioTopLink" href="https://central.ballerina.io/"
                                                      target="_blank">Central</a></li>
                            <li class="toctree-l1" id="openli"><a class="cBioTopLink" href="/community">Community</a>
                            </li>
                            <li class="toctree-l1" id="helpli"><a class="cBioTopLink" href="https://blog.ballerina.io">Blog</a>
                            </li>
                            <li class="cVersionItem">
                                <div class="cVersionContainer">
                                    <!-- <lable class="cVlable">Version</lable> -->
                                    <select name="versions" id="versions" class="select-css">
                                        <option value="1.2" data-value="latest">v1.2</option>
                                        <option value="1.1">v1.1</option>
                                        <option value="1.0">v1.0</option>
                                        <option value="0.991">v0.991</option>
                                    </select>
                                </div>
                            </li>
                            <li class="cSearchMenu"><form class="cSearch-form-inline"><input id="searchTxt" class="form-control-field" type="search" placeholder="Search" aria-label="Search"><a id="searchBtn" href="#" class="cSearchButton"><img src="/img/search.svg"/></a></form></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</div>

<div class="row cBallerina-io-Gray-row">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 cBallerina-io-Home-Middle-col">
                <div class="col-xs-12 col-sm-12" style="padding: 0;">
                    <div class="col-md-12 col-lg-10 cBallerina-io-breadcrumbs">
                        <nav class="breadcrumbs bootstrap hidden-sm-down"
  >
  <ul id="breadcrumb-list" class=" cBalleinaBreadcrumbs list-unstyled  wy-breadcrumbs" vocab="http://schema.org/"
    typeof="BreadcrumbList">


    
    <li><a href="/">Home</a></li>
    
    
    <li>/</li>
    <li><a
        href="/1.0/">1.0</a>
    </li>
    
    
    
    <li>/</li>
    <li><a
        href="/1.0/learn/">Learn</a>
    </li>
    
    
    
    <li>/</li>
    <li><a
        href="/1.0/learn/by-example/">By example</a>
    </li>
    
    
    
    <li>/</li> XA Transactions
    
    

  </ul>
</nav>
<style type="text/css">
  .cBalleinaBreadcrumbs li {
    margin-right: 10px;
  }
</style>
                        <div class="cVersionContainer"></div>
                    </div>
                    <div class="col-md-12 col-lg-2 cBallerina-io-breadcrumbs">
                        <ul class="wy-breadcrumbs">
                            <!-- <li class="wy-breadcrumbs-aside">
                                <a class="icon icon-github" target="_blank" href="https://www.github.com/ballerina-platform/ballerina-platform.github.io/blob/master/1.0/learn/by-example/xa-transactions.html">Edit on GitHub</a>
                            </li> -->
                        </ul>
                    </div>
                </div>
                <div class="cBlallerina-io-docs-content-container">
                    <div class="wy-nav-content">
                        <div class="rst-content">
                            <div role="main">
                                <div class="section">
                                    <div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerinax</span><span class="o">/</span><span class="nx">java</span><span class="p">.</span><span class="nx">jdbc</span><span class="p">;</span>
<span class="nx">jdbc</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">testDB1</span> <span class="p">=</span> <span class="nx">new</span><span class="p">({</span>
    <span class="nx">url</span><span class="p">:</span> <span class="s">&quot;jdbc:h2:file:./xa-transactions/Testdb1&quot;</span><span class="p">,</span>
    <span class="nx">username</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
    <span class="nx">password</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
    <span class="nx">poolOptions</span><span class="p">:</span> <span class="p">{</span> <span class="nx">maximumPoolSize</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">isXA</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">});</span>
<span class="nx">jdbc</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">testDB2</span> <span class="p">=</span> <span class="nx">new</span><span class="p">({</span>
    <span class="nx">url</span><span class="p">:</span> <span class="s">&quot;jdbc:h2:file:./xa-transactions/Testdb2&quot;</span><span class="p">,</span>
    <span class="nx">username</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
    <span class="nx">password</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
    <span class="nx">poolOptions</span><span class="p">:</span> <span class="p">{</span> <span class="nx">maximumPoolSize</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">isXA</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">});</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">ret</span> <span class="p">=</span> <span class="nx">testDB1</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="s">&quot;CREATE TABLE CUSTOMER (ID INTEGER &quot;</span> <span class="o">+</span>
                    <span class="s">&quot;AUTO_INCREMENT, NAME VARCHAR(30))&quot;</span><span class="p">);</span>
    <span class="nx">handleUpdate</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="s">&quot;Create CUSTOMER table&quot;</span><span class="p">);</span>
    <span class="nx">ret</span> <span class="p">=</span> <span class="nx">testDB2</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="s">&quot;CREATE TABLE SALARY (ID INT, VALUE FLOAT)&quot;</span><span class="p">);</span>
    <span class="nx">handleUpdate</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="s">&quot;Create SALARY table&quot;</span><span class="p">);</span>
    <span class="nx">transaction</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">testDB1</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="s">&quot;INSERT INTO CUSTOMER(NAME) &quot;</span> <span class="o">+</span>
                                        <span class="s">&quot;VALUES (&#39;Anne&#39;)&quot;</span><span class="p">);</span>
        <span class="kt">int</span> <span class="nx">key</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">jdbc</span><span class="p">:</span><span class="nx">UpdateResult</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="nx">count</span> <span class="p">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">updatedRowCount</span><span class="p">;</span>
            <span class="nx">key</span> <span class="p">=</span> <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span><span class="nx">result</span><span class="p">.</span><span class="nx">generatedKeys</span><span class="p">[</span><span class="s">&quot;ID&quot;</span><span class="p">];</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Inserted row count: &quot;</span><span class="p">,</span> <span class="nx">count</span><span class="p">);</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Generated key: &quot;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Insert to student table failed: &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">reason</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="nx">ret</span> <span class="p">=</span> <span class="nx">testDB2</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="s">&quot;INSERT INTO SALARY (ID, VALUE) VALUES (?, ?)&quot;</span><span class="p">,</span>
                                    <span class="nx">key</span><span class="p">,</span> <span class="mi">2500</span><span class="p">);</span>
        <span class="nx">handleUpdate</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="s">&quot;Insert to SALARY table&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="nx">onretry</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Retrying transaction&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="nx">committed</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Transaction committed&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="nx">aborted</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Transaction aborted&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">ret</span> <span class="p">=</span> <span class="nx">testDB1</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="s">&quot;DROP TABLE CUSTOMER&quot;</span><span class="p">);</span>
    <span class="nx">handleUpdate</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="s">&quot;Drop Table CUSTOMER&quot;</span><span class="p">);</span>    <span class="nx">ret</span> <span class="p">=</span> <span class="nx">testDB2</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="s">&quot;DROP TABLE SALARY&quot;</span><span class="p">);</span>
    <span class="nx">handleUpdate</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="s">&quot;Drop Table SALARY&quot;</span><span class="p">);</span>
    <span class="nx">stopClient</span><span class="p">(</span><span class="nx">testDB1</span><span class="p">);</span>
    <span class="nx">stopClient</span><span class="p">(</span><span class="nx">testDB2</span><span class="p">);</span>
<span class="p">}</span><span class="kd">function</span> <span class="nx">onCommitFunction</span><span class="p">(</span><span class="kt">string</span> <span class="nx">transactionId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Transaction: &quot;</span><span class="p">,</span> <span class="nx">transactionId</span><span class="p">,</span> <span class="s">&quot; committed&quot;</span><span class="p">);</span>
<span class="p">}</span><span class="kd">function</span> <span class="nx">onAbortFunction</span><span class="p">(</span><span class="kt">string</span> <span class="nx">transactionId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Transaction: &quot;</span><span class="p">,</span> <span class="nx">transactionId</span><span class="p">,</span> <span class="s">&quot; aborted&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">handleUpdate</span><span class="p">(</span><span class="nx">jdbc</span><span class="p">:</span><span class="nx">UpdateResult</span><span class="p">|</span><span class="nx">error</span> <span class="nx">returned</span><span class="p">,</span> <span class="kt">string</span> <span class="kt">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">returned</span> <span class="nx">is</span> <span class="nx">jdbc</span><span class="p">:</span><span class="nx">UpdateResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="kt">message</span><span class="p">,</span> <span class="s">&quot; status: &quot;</span><span class="p">,</span> <span class="nx">returned</span><span class="p">.</span><span class="nx">updatedRowCount</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="kt">message</span><span class="p">,</span> <span class="s">&quot; failed: &quot;</span><span class="p">,</span> <span class="nx">returned</span><span class="p">.</span><span class="nx">reason</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span><span class="kd">function</span> <span class="nx">stopClient</span><span class="p">(</span><span class="nx">jdbc</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">stopRet</span> <span class="p">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">stopRet</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="nx">stopRet</span><span class="p">.</span><span class="nx">detail</span><span class="p">()[</span><span class="s">&quot;message&quot;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>XA Transactions</h2>
                            <p><p>Ballerina XA transactions are used when the transaction is happening over
 two or more databases. This example uses two H2 DBs (these
 are created when executing the example). Before running the example,
 change the DB connection properties as required.
 Ballerina transactions are at the experimental stage.
 Therefore, use  the &ndash;experimental flag to enable them.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="local-transactions-with-participants.html">
                                        <span>< PREVIOUS</span>
                                        <p>Local Transactions with participants</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="transactions-distributed.html">
                                        <span>NEXT ></span>
                                        <p>Distributed Transactions</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="xa-transactions">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-lang/ballerina/tree/master/examples/xa-transactions/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/io;
import ballerinax/java.jdbc;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>jdbc:Client testDB1 = new({
    url: &quot;jdbc:h2:file:./xa-transactions/Testdb1&quot;,
    username: &quot;test&quot;,
    password: &quot;test&quot;,
    poolOptions: { maximumPoolSize: 5, isXA: true }
});
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create san endpoint for the first database named <code>testDB1</code>. Since this endpoint
 participates in a distributed transaction, the <code>isXA</code> property should be true.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>jdbc:Client testDB2 = new({
    url: &quot;jdbc:h2:file:./xa-transactions/Testdb2&quot;,
    username: &quot;test&quot;,
    password: &quot;test&quot;,
    poolOptions: { maximumPoolSize: 5, isXA: true }
});
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates an endpoint for the second database named <code>testDB2</code>. Since this endpoint
 participates in a distributed transaction, the <code>isXA</code> property should be true.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    var ret = testDB1-&gt;update(&quot;CREATE TABLE CUSTOMER (ID INTEGER &quot; +
                    &quot;AUTO_INCREMENT, NAME VARCHAR(30))&quot;);
    handleUpdate(ret, &quot;Create CUSTOMER table&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates the table named CUSTOMER in the first database.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    ret = testDB2-&gt;update(&quot;CREATE TABLE SALARY (ID INT, VALUE FLOAT)&quot;);
    handleUpdate(ret, &quot;Create SALARY table&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates the table named SALARY in the second database.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    transaction {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Begins the transaction.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        var result = testDB1-&gt;update(&quot;INSERT INTO CUSTOMER(NAME) &quot; +
                                        &quot;VALUES (&#39;Anne&#39;)&quot;);
        int key = -1;
        if (result is jdbc:UpdateResult) {
            int count = result.updatedRowCount;
            key = &lt;int&gt;result.generatedKeys[&quot;ID&quot;];
            io:println(&quot;Inserted row count: &quot;, count);
            io:println(&quot;Generated key: &quot;, key);
        } else {
            io:println(&quot;Insert to student table failed: &quot;, result.reason());
        }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the first remote function to participate in the transaction. It inserts
 the customer name to the first DB and gets the generated key.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        ret = testDB2-&gt;update(&quot;INSERT INTO SALARY (ID, VALUE) VALUES (?, ?)&quot;,
                                    key, 2500);
        handleUpdate(ret, &quot;Insert to SALARY table&quot;);
    } onretry {
        io:println(&quot;Retrying transaction&quot;);
    } committed {
        io:println(&quot;Transaction committed&quot;);
    } aborted {
        io:println(&quot;Transaction aborted&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the second remote function to participate in the transaction. It inserts the
 salary info to the second DB along with the key generated in the first DB.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    ret = testDB1-&gt;update(&quot;DROP TABLE CUSTOMER&quot;);
    handleUpdate(ret, &quot;Drop Table CUSTOMER&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Drops the tables created for this sample.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    ret = testDB2-&gt;update(&quot;DROP TABLE SALARY&quot;);
    handleUpdate(ret, &quot;Drop Table SALARY&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    stopClient(testDB1);
    stopClient(testDB2);
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Stops the database clients.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>function onCommitFunction(string transactionId) {
    io:println(&quot;Transaction: &quot;, transactionId, &quot; committed&quot;);
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>function onAbortFunction(string transactionId) {
    io:println(&quot;Transaction: &quot;, transactionId, &quot; aborted&quot;);
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>function handleUpdate(jdbc:UpdateResult|error returned, string message) {
    if (returned is jdbc:UpdateResult) {
        io:println(message, &quot; status: &quot;, returned.updatedRowCount);
    } else {
        io:println(message, &quot; failed: &quot;, returned.reason());
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This function handles the return values of the <code>update()</code> remote function.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>function stopClient(jdbc:Client db) {
    var stopRet = db.stop();
    if (stopRet is error) {
        io:println(stopRet.detail()[&quot;message&quot;]);
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run this sample, navigate to the directory that contains the
# `.bal` file, and execute the `ballerina run` command.
$ ballerina run --experimental xa_transactions.bal
Create CUSTOMER table status: 0
Create SALARY table status: 0
2018-12-04 20:12:03,507 INFO  [ballerina/transactions] - Created transaction: aec7b091-cbac-4d61-8834-bed8e1a3c9ec
Inserted row count: 1
Generated key: 1
Insert to SALARY table status: 1
2018-12-04 20:12:03,541 INFO  [ballerina/transactions] - Running 2-phase commit for transaction: aec7b091-cbac-4d61-8834-bed8e1a3c9ec:$anon$.$1
Transaction committed
Drop Table CUSTOMER status: 0
Drop Table SALARY status: 0
[ballerina/http] started HTTP/WS listener 10.100.7.118:64331
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="iBallerinaFooter" class="row cBallerina-io-White-row">
    <div class="container">
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-left-col cBallerinaFooterLinks">
        <ul>
            <li><a class="cBioFooterLink" href="/downloads">Download</a></li>
            <li><a class="cBioFooterLink" href="https://github.com/ballerina-lang/ballerina/blob/master/LICENSE">Code License</a></li>
            <li><a class="cBioFooterLink" href="/license-of-site">Site License</a></li>
            <li><a class="cBioFooterLink" href="/terms-of-service">TERMS OF SERVICE</a></li>
            <li><a class="cBioFooterLink" href="/privacy-policy">PRIVACY POLICY</a></li>
            </ul>
        </div>
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-middle-col cBallerinaFooterSignUp">
        <div class="cSocialmedia">
            <ul>
                <li>
                    <a class="cBioFooterLink" href="https://github.com/ballerina-platform" target="_blank"><img src="/img/github.svg"/></a>
                    </li>
                <li><a class="cBioFooterLink" href="https://stackoverflow.com/questions/tagged/ballerina" target="_blank"><img src="/img/stackoverflow.svg"/></a></li>
                <li><a class="cBioFooterLink" href="https://twitter.com/ballerinalang" target="_blank"><img src="/img/twitter.svg"/></a></li>
                <li><a class="cBioFooterLink" href="/community/slack/"><img src="/img/slack.svg"/></a></li>
                </ul>
            <div class="pdframe"></div>
            </div>
        </div>
    <div class="col-xs-12 col-sm-10 col-md-6 col-lg-6 cBallerina-io-right-col">
        <p>In the creation of Ballerina, we were inspired by so many technologies. Thank you to all that have come before us (and forgive us if we missed one): Java, Go, C, C++, D, Rust, Haskell, Kotlin, Dart, TypeScript, JavaScript, Python, Perl, Flow, Swift, Elm, RelaxNG, NPM, Crates, Maven, Gradle, Kubernetes, Docker, Envoy, Markdown, GitHub and WSO2.</p></div>
    </div>
</div>

<script src="/js/theme.js"></script>

<script>
    $(document).ready(function() {
        var gitstar = '<iframe id="iGitStarIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=star&count=true&size=small" frameborder="0" scrolling="0"></iframe>';
        $('[data-button="iGitStarText"]').replaceWith(gitstar);

        var gitwatch = '<iframe id="iGitWatchIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=watch&count=true&size=lsmalle&v=2" frameborder="0" scrolling="0"></iframe>';
        $('[data-button="iGitWatchText"]').replaceWith(gitwatch);

    });
</script>

<style>
    .cGitButtonContainer {
        display: inline-block;
        width: 100%;
        margin-bottom: 0px;
    }

    #iGitStarText {
        height: 20px;
        float: left;
        padding: 0;
        margin: 0;
    }
    #iGitStarIframe , #iGitWatchIframe {
        height: 20px;
        width: 100px;
        float: left;
    }
</style>

</body>
</html>

