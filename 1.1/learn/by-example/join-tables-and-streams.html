

<!DOCTYPE html>
<html class="no-js">
<head>
    

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below." />

<meta name="author" content="WSO2, Inc.">

<meta name="keywords" content="ballerinalang, integration, microservices, programming language, cloud native, ballerina language" />

<link rel="shortcut icon" href="/img/favicon.ico">
<title>Join Tables and Streams</title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92163714-2"></script>
<!--FB-->
<meta property="og:type"               content="article" />
<meta property="og:title"              content="Ballerina - Join Tables and Streams" />
<meta property="og:description"        content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below." />
<meta property="og:image"              content="https://ballerina.io/img/ballerina-swan-lake-sm-banner.png
" />
<!--TWITTER-->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ballerinalang">
<meta name="twitter:creator" content="@ballerinalang">
<meta name="twitter:title" content="Ballerina">
<meta name="twitter:description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.">
<meta name="twitter:image" content="https://ballerina.io/img/ballerina-swan-lake-sm-banner.png">

<meta name="twitter:text:description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image:width" content="610">
<!--LINKED IN  -->
<meta property='og:title' content="Ballerina"/>
<meta property='og:image' content="https://ballerina.io/img/ballerina-swan-lake-sm-banner.png
"/>
<meta property='og:description' content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below."/>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-92163714-2');
</script>
<!-- Google Tag Manager -->
<script>
    (function(w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src =
            'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-PSL2TX4');
</script>
<!-- End Google Tag Manager -->

<!--copy to clipboard lib-->
<script src="/js/clipboard.js-2.0.0/clipboard.min.js"></script>

<script src="/js/latest-jquery.js"></script>
<script>
    var base_url = "";
</script>
<link rel="stylesheet" href="/css/latest-bootstrap.css">
<!-- Optional theme -->
<link rel="stylesheet" href="/css/latest-bootstrap-theme.css">
<!-- Latest compiled and minified JavaScript -->
<script src="/js/latest-bootstrap.js"></script>
<!-- <link rel="stylesheet" href="https://use.typekit.net/son4ymv.css"> -->

<!-- <script type="text/javascript" src="/js/highlight.pack.js"></script> -->

<link rel="stylesheet" href="/css/prism.css">

<script src="/js/ballerina-common.js"></script>
<link rel=stylesheet href="/css/ballerina-io.css">
<link rel=stylesheet href="/css/ballerina-io-bbe.css">
<link rel="stylesheet" href="/css/bbe-page.css">
<script>
    // Current page data
    var mkdocs_page_name = '"Home"'.replace(/^"|"$/g, '');
    var mkdocs_page_input_path = '"index.md"'.replace(/^"|"$/g, '');
    var mkdocs_page_url = '"/"'.replace(/^"|"$/g, '');
    
    var releaseNoteFilename = 'RELEASE_NOTE.html';

    var nightly_download_url = 'https://product-dist.ballerina.io/nightly';
    var dev_download_url = 'https://product-dist.ballerina.io/dev';
    var base_download_url = 'https://dist.ballerina.io/downloads';


    $(document).ready(function() {
    $("table").removeClass('table-striped');
    $(".ballerina").addClass('language-ballerina');
    $("pre").addClass('language-ballerina');
});
</script>

</head>
<body class="cBallerina-io">
    <header data-plugin-header="line-numbers"></header>
      <div class="cInfoBannerVersionHandling">
        This is the 1.1.0 documentation of Ballerina. Please refer the <a href="https://ballerina.io/learn/" class="cInfoBannerLink">latest  documentation</a> or download the <a href="https://ballerina.io/downloads/" class="cInfoBannerLink">latest release</a>.
    </div>
      <div class="row cBallerina-io-Nav" id="iMainNavigation">

    <div class="container">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <nav class="navbar">
                <div>
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">&#9776</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="cMobileLogo" href="/"><img src="/img/ballerina-logo.svg" alt="Ballerina"/></a>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav cTopNav">
                            <li class="active toctree-l1" id="learnli"><a class="cBioTopLink" href="/learn">Learn</a>
                            </li>
                            <li class="active toctree-l1" id="Eventsli"><a class="cBioTopLink" href="/learn/events">Events</a>
                            </li>
                            <li class="toctree-l1"><a class="cBioTopLink" href="https://central.ballerina.io/"
                                                      target="_blank">Central</a></li>
                            <li class="toctree-l1" id="openli"><a class="cBioTopLink" href="/community">Community</a>
                            </li>
                            <li class="toctree-l1" id="helpli"><a class="cBioTopLink" href="https://blog.ballerina.io">Blog</a>
                            </li>
                            <li class="cVersionItem">
                                <div class="cVersionContainer">
                                    <!-- <lable class="cVlable">Version</lable> -->
                                    <select name="versions" id="versions" class="select-css">
                                        <option value="swan-lake" data-value="latest">Swan Lake</option>
                                        <option value="1.2">v1.2</option>
                                        <option value="1.1">v1.1</option>
                                        <option value="1.0">v1.0</option>
                                   
                                    </select>
                                </div>
                            </li>
                            <li class="cSearchMenu"><form class="cSearch-form-inline"><input id="searchTxt" class="form-control-field" type="search" placeholder="Search" aria-label="Search"><a id="searchBtn" href="#" class="cSearchButton"><img src="/img/search.svg"/></a></form></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</div>

<div class="row cBallerina-io-Gray-row">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 cBallerina-io-Home-Middle-col">
                <div class="col-xs-12 col-sm-12" style="padding: 0;">
                    <div class="col-md-12 col-lg-10 cBallerina-io-breadcrumbs">
                        <nav class="breadcrumbs bootstrap hidden-sm-down"
  >
  <ul id="breadcrumb-list" class=" cBalleinaBreadcrumbs list-unstyled  wy-breadcrumbs" vocab="http://schema.org/"
    typeof="BreadcrumbList">


    
    <li><a href="/">Home</a></li>
    
    
    <li>/</li>
    <li><a
        href="/1.1/">1.1</a>
    </li>
    
    
    
    <li>/</li>
    <li><a
        href="/1.1/learn/">Learn</a>
    </li>
    
    
    
    <li>/</li>
    <li><a
        href="/1.1/learn/by-example/">By example</a>
    </li>
    
    
    
    <li>/</li> Join Tables and Streams
    
    

  </ul>
</nav>
<style type="text/css">
  .cBalleinaBreadcrumbs li {
    margin-right: 10px;
  }
</style>
                        <div class="cVersionContainer"></div>
                    </div>
                    <div class="col-md-12 col-lg-2 cBallerina-io-breadcrumbs">
                        <ul class="wy-breadcrumbs">
                            <!-- <li class="wy-breadcrumbs-aside">
                                <a class="icon icon-github" target="_blank" href="https://www.github.com/ballerina-platform/ballerina-platform.github.io/blob/master/1.1/learn/by-example/join-tables-and-streams.html">Edit on GitHub</a>
                            </li> -->
                        </ul>
                    </div>
                </div>
                <div class="cBlallerina-io-docs-content-container">
                    <div class="wy-nav-content">
                        <div class="rst-content">
                            <div role="main">
                                <div class="section">
                                    <div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>
<span class="nx">type</span> <span class="nx">Item</span> <span class="nx">record</span> <span class="p">{|</span>
    <span class="kt">string</span> <span class="nx">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="nx">price</span><span class="p">;</span>
    <span class="kt">int</span> <span class="nx">stockAmount</span><span class="p">;</span>
<span class="p">|};</span>
<span class="nx">type</span> <span class="nx">Order</span> <span class="nx">record</span> <span class="p">{|</span>
    <span class="kt">string</span> <span class="nx">itemName</span><span class="p">;</span>
    <span class="kt">int</span> <span class="nx">orderingAmount</span><span class="p">;</span>
<span class="p">|};</span>
<span class="nx">type</span> <span class="nx">OutOfStockAlert</span> <span class="nx">record</span> <span class="p">{|</span>
    <span class="kt">string</span> <span class="nx">itemName</span><span class="p">;</span>
    <span class="kt">int</span> <span class="nx">stockAmount</span><span class="p">;</span>
<span class="p">|};</span>
<span class="nx">stream</span><span class="p">&lt;</span><span class="nx">Order</span><span class="p">&gt;</span> <span class="nx">orderStream</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
<span class="nx">table</span><span class="p">&lt;</span><span class="nx">Item</span><span class="p">&gt;</span> <span class="nx">itemStockTable</span> <span class="p">=</span> <span class="nx">table</span> <span class="p">{</span>
    <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">price</span><span class="p">,</span> <span class="nx">stockAmount</span> <span class="p">},</span>
    <span class="p">[</span>
        <span class="p">{</span><span class="s">&quot;Book&quot;</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&quot;Pen&quot;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">};</span>
<span class="nx">stream</span><span class="p">&lt;</span><span class="nx">OutOfStockAlert</span><span class="p">&gt;</span> <span class="nx">oredrAlertStream</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span><span class="kd">function</span> <span class="nx">initOutOfStockAlert</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">forever</span> <span class="p">{</span>
        <span class="nx">from</span> <span class="nx">orderStream</span> <span class="nx">window</span> <span class="nx">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="nx">itemOrder</span>
        <span class="k">join</span> <span class="nx">queryItemTable</span><span class="p">(</span><span class="nx">itemOrder</span><span class="p">.</span><span class="nx">itemName</span><span class="p">,</span> <span class="nx">itemOrder</span><span class="p">.</span><span class="nx">orderingAmount</span><span class="p">)</span> <span class="k">as</span> <span class="nx">item</span>
        <span class="nx">select</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span> <span class="k">as</span> <span class="nx">itemName</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">stockAmount</span>
        <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">OutOfStockAlert</span><span class="p">[]</span> <span class="nx">alerts</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">foreach</span> <span class="k">var</span> <span class="nx">alert</span> <span class="nx">in</span> <span class="nx">alerts</span> <span class="p">{</span>
                <span class="nx">oredrAlertStream</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">alert</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">public</span> <span class="kd">function</span> <span class="nx">queryItemTable</span><span class="p">(</span><span class="kt">string</span> <span class="nx">itemName</span><span class="p">,</span> <span class="kt">int</span> <span class="nx">orderingAmount</span><span class="p">)</span>
        <span class="nx">returns</span> <span class="nx">table</span><span class="p">&lt;</span><span class="nx">Item</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="nx">table</span><span class="p">&lt;</span><span class="nx">Item</span><span class="p">&gt;</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">table</span> <span class="p">{</span>
        <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">price</span><span class="p">,</span> <span class="nx">stockAmount</span> <span class="p">},</span> <span class="p">[]</span>
    <span class="p">};</span>
    <span class="nx">foreach</span> <span class="k">var</span> <span class="nx">item</span> <span class="nx">in</span> <span class="nx">itemStockTable</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">itemName</span> <span class="o">&amp;&amp;</span> <span class="nx">orderingAmount</span> <span class="p">&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">stockAmount</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">ret</span> <span class="p">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">initOutOfStockAlert</span><span class="p">();</span>    <span class="nx">Order</span> <span class="nx">order1</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">itemName</span><span class="p">:</span> <span class="s">&quot;Pen&quot;</span><span class="p">,</span> <span class="nx">orderingAmount</span><span class="p">:</span> <span class="mi">5</span><span class="p">};</span>
    <span class="nx">Order</span> <span class="nx">order2</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">itemName</span><span class="p">:</span> <span class="s">&quot;Book&quot;</span><span class="p">,</span> <span class="nx">orderingAmount</span><span class="p">:</span> <span class="mi">2</span><span class="p">};</span>
    <span class="nx">oredrAlertStream</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">printOutOfStocksAlert</span><span class="p">);</span>    <span class="nx">orderStream</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">order1</span><span class="p">);</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="nx">orderStream</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">order2</span><span class="p">);</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span><span class="kd">function</span> <span class="nx">printOutOfStocksAlert</span><span class="p">(</span><span class="nx">OutOfStockAlert</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Alert! : &quot;</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">itemName</span><span class="p">,</span>
            <span class="s">&quot; stock is not enough to satisfy the order.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Join Tables and Streams</h2>
                            <p><p>Tables and streams can be joined using streaming query logic.
In this example, orders coming from the customers for a certain item are checked against the stock table to verify
whether there is enough stock to deliver the order. An alert is triggered if the stock is not sufficient.
Ballerina Streams is an experimental feature. Use the <code>--experimental</code> flag when compiling Ballerina files
that have streaming constructs.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="join-multiple-streams.html">
                                        <span>< PREVIOUS</span>
                                        <p>Join Multiple Streams</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="local-transactions.html">
                                        <span>NEXT ></span>
                                        <p>Local Transactions</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="join-tables-and-streams">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <!--<li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>-->
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-lang/tree/ballerina-1.1.x/examples/join-tables-and-streams/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/io;
import ballerina/runtime;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>type Item record {|
    string name;
    float price;
    int stockAmount;
|};
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the <code>record</code>, which holds item details in the stockTable.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>type Order record {|
    string itemName;
    int orderingAmount;
|};
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the <code>record</code>, which holds order events from the customer.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>type OutOfStockAlert record {|
    string itemName;
    int stockAmount;
|};
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the <code>record</code>, which holds alert events.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>stream&lt;Order&gt; orderStream = new;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the input <code>stream</code>, which uses <code>Order</code> as the constraint type.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>table&lt;Item&gt; itemStockTable = table {
    { name, price, stockAmount },
    [
        {&quot;Book&quot;, 100.0, 10},
        {&quot;Pen&quot;, 20.0, 4}
    ]
};
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the <code>table</code>, which holds the item stock data.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>stream&lt;OutOfStockAlert&gt; oredrAlertStream = new;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the output stream, which contains the events/alerts that are generated based on the streaming logic.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function initOutOfStockAlert() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    forever {
        from orderStream window length(1) as itemOrder
        join queryItemTable(itemOrder.itemName, itemOrder.orderingAmount) as item
        select item.name as itemName, item.stockAmount
        =&gt; (OutOfStockAlert[] alerts) {
            foreach var alert in alerts {
                oredrAlertStream.publish(alert);
            }
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Whenever an order event is published to the <code>orderStream</code>, it is matched against the <code>itemStockTable</code> through
the <code>queryItemTable</code> function. If there is a match, an alert event is published to the <code>orderAlertStream</code>.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>public function queryItemTable(string itemName, int orderingAmount)
        returns table&lt;Item&gt; {
    table&lt;Item&gt; result = table {
        { name, price, stockAmount }, []
    };
    foreach var item in itemStockTable {
        if (item.name == itemName &amp;&amp; orderingAmount &gt; item.stockAmount) {
            var ret = result.add(item);
        }
    }
    return result;
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The <code>queryItemTable</code> function returns a <code>table</code> of items whose stock is not enough to satisfy the order.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>public function main() {
    initOutOfStockAlert();
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    Order order1 = { itemName: &quot;Pen&quot;, orderingAmount: 5};
    Order order2 = { itemName: &quot;Book&quot;, orderingAmount: 2};
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    oredrAlertStream.subscribe(printOutOfStocksAlert);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Whenever the <code>orderAlertStream</code> stream receives an event from the streaming rules defined in the <code>forever</code>
 block, the <code>printOutOfStocksAlert</code> function is invoked.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    orderStream.publish(order1);
    runtime:sleep(500);
    orderStream.publish(order2);
    runtime:sleep(500);
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>function printOutOfStocksAlert(OutOfStockAlert a) {
    io:println(&quot;Alert! : &quot;, a.itemName,
            &quot; stock is not enough to satisfy the order.&quot;);
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run this sample, navigate to the directory that contains the
# `.bal` file, and execute the `ballerina run` command.
$ ballerina run --experimental join-tables-and-streams.bal
Alert! : Pen stock is not enough to satisfy the order.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="iBallerinaFooter" class="row cBallerina-io-White-row">
    <div class="container">
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-left-col cBallerinaFooterLinks">
        <ul>
            <li><a class="cBioFooterLink" href="/downloads">Download</a></li>
            <li><a class="cBioFooterLink" href="https://github.com/ballerina-lang/ballerina/blob/master/LICENSE">Code License</a></li>
            <li><a class="cBioFooterLink" href="/license-of-site">Site License</a></li>
            <li><a class="cBioFooterLink" href="/terms-of-service">TERMS OF SERVICE</a></li>
            <li><a class="cBioFooterLink" href="/privacy-policy">PRIVACY POLICY</a></li>
            </ul>
        </div>
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-middle-col cBallerinaFooterSignUp">
        <div class="cSocialmedia">
            <ul>
                <li>
                    <a class="cBioFooterLink" href="https://github.com/ballerina-platform" target="_blank"><img src="/img/github.svg"/></a>
                    </li>
                <li><a class="cBioFooterLink" href="https://stackoverflow.com/questions/tagged/ballerina" target="_blank"><img src="/img/stackoverflow.svg"/></a></li>
                <li><a class="cBioFooterLink" href="https://twitter.com/ballerinalang" target="_blank"><img src="/img/twitter.svg"/></a></li>
                <li><a class="cBioFooterLink" href="/community/slack/"><img src="/img/slack.svg"/></a></li>
                </ul>
            <div class="pdframe"></div>
            </div>
        </div>
    <div class="col-xs-12 col-sm-10 col-md-6 col-lg-6 cBallerina-io-right-col">
        <p>In the creation of Ballerina, we were inspired by so many technologies. Thank you to all that have come before us (and forgive us if we missed one): Java, Go, C, C++, D, Rust, Haskell, Kotlin, Dart, TypeScript, JavaScript, Python, Perl, Flow, Swift, Elm, RelaxNG, NPM, Crates, Maven, Gradle, Kubernetes, Docker, Envoy, Markdown, GitHub and WSO2.</p></div>
    </div>
</div>





<script src="/js/prism.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/components/prism-core.min.js"></script> -->
<script src="/js/prism-ballerina.js"></script>
<!-- 
<script>
    (function () {

if (typeof self === 'undefined' || !self.Prism || !self.document) {
    return;
}

/**
 * Plugin name which is used as a class name for <pre> which is activating the plugin
 * @type {String}
 */
var PLUGIN_NAME = 'line-numbers';

/**
 * Regular expression used for determining line breaks
 * @type {RegExp}
 */
var NEW_LINE_EXP = /\n(?!$)/g;

/**
 * Resizes line numbers spans according to height of line of code
 * @param {Element} element <pre> element
 */
var _resizeElement = function (element) {
    var codeStyles = getStyles(element);
    var whiteSpace = codeStyles['white-space'];

    if (whiteSpace === 'pre-wrap' || whiteSpace === 'pre-line') {
        var codeElement = element.querySelector('code');
        var lineNumbersWrapper = element.querySelector('.line-numbers-rows');
        if (!codeElement || !lineNumbersWrapper) {
            return;
        }
        var lineNumberSizer = element.querySelector('.line-numbers-sizer');
        var codeLines = codeElement.textContent.split(NEW_LINE_EXP);

        if (!lineNumberSizer) {
            lineNumberSizer = document.createElement('span');
            lineNumberSizer.className = 'line-numbers-sizer';

            codeElement.appendChild(lineNumberSizer);
        }

        lineNumberSizer.style.display = 'block';

        codeLines.forEach(function (line, lineNumber) {
            lineNumberSizer.textContent = line || '\n';
            var lineSize = lineNumberSizer.getBoundingClientRect().height;
            lineNumbersWrapper.children[lineNumber].style.height = lineSize + 'px';
        });

        lineNumberSizer.textContent = '';
        lineNumberSizer.style.display = 'none';
    }
};

/**
 * Returns style declarations for the element
 * @param {Element} element
 */
var getStyles = function (element) {
    if (!element) {
        return null;
    }

    return window.getComputedStyle ? getComputedStyle(element) : (element.currentStyle || null);
};

window.addEventListener('resize', function () {
    Array.prototype.forEach.call(document.querySelectorAll('pre.' + PLUGIN_NAME), _resizeElement);
});

Prism.hooks.add('complete', function (env) {
    if (!env.code) {
        return;
    }

    var code = env.element;
    var pre = code.parentNode;

    // works only for <code> wrapped inside <pre> (not inline)
    if (!pre || !/pre/i.test(pre.nodeName)) {
        return;
    }

    // Abort if line numbers already exists
    if (code.querySelector('.line-numbers-rows')) {
        return;
    }

    var addLineNumbers = false;
    var lineNumbersRegex = /(?:^|\s)line-numbers(?:\s|$)/;

    for (var element = code; element; element = element.parentNode) {
        if (lineNumbersRegex.test(element.className)) {
            addLineNumbers = true;
            break;
        }
    }

    // only add line numbers if <code> or one of its ancestors has the `line-numbers` class
    if (!addLineNumbers) {
        return;
    }

    // Remove the class 'line-numbers' from the <code>
    code.className = code.className.replace(lineNumbersRegex, ' ');
    // Add the class 'line-numbers' to the <pre>
    if (!lineNumbersRegex.test(pre.className)) {
        pre.className += ' line-numbers';
    }

    var match = env.code.match(NEW_LINE_EXP);
    var linesNum = match ? match.length + 1 : 1;
    var lineNumbersWrapper;

    var lines = new Array(linesNum + 1).join('<span></span>');

    lineNumbersWrapper = document.createElement('span');
    lineNumbersWrapper.setAttribute('aria-hidden', 'true');
    lineNumbersWrapper.className = 'line-numbers-rows';
    lineNumbersWrapper.innerHTML = lines;

    if (pre.hasAttribute('data-start')) {
        pre.style.counterReset = 'linenumber ' + (parseInt(pre.getAttribute('data-start'), 10) - 1);
    }

    env.element.appendChild(lineNumbersWrapper);

    _resizeElement(pre);

    Prism.hooks.run('line-numbers', env);
});

Prism.hooks.add('line-numbers', function (env) {
    env.plugins = env.plugins || {};
    env.plugins.lineNumbers = true;
});

/**
 * Global exports
 */
Prism.plugins.lineNumbers = {
    /**
     * Returns the node of the given line number in the given element.
     * @param {Element} element A `<pre>` element with line numbers.
     * @param {Number} number
     * @returns {Element | undefined}
     */
    getLine: function (element, number) {
        if (element.tagName !== 'PRE' || !element.classList.contains(PLUGIN_NAME)) {
            return;
        }

        var lineNumberRows = element.querySelector('.line-numbers-rows');
        var lineNumberStart = parseInt(element.getAttribute('data-start'), 10) || 1;
        var lineNumberEnd = lineNumberStart + (lineNumberRows.children.length - 1);

        if (number < lineNumberStart) {
            number = lineNumberStart;
        }
        if (number > lineNumberEnd) {
            number = lineNumberEnd;
        }

        var lineIndex = number - lineNumberStart;

        return lineNumberRows.children[lineIndex];
    },
    /**
     * Resizes the line numbers of the given element.
     *
     * This function will not add line numbers. It will only resize existing ones.
     * @param {Element} element A `<pre>` element with line numbers.
     * @returns {void}
     */
    resize: function (element) {
        _resizeElement(element);
    }
};

}());
</script> -->

<!-- 
<style>
    pre[class*="language-"].line-numbers {
	position: relative;
	padding-left: 3.8em;
	counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
	position: relative;
	white-space: inherit;
}

.line-numbers .line-numbers-rows {
	position: absolute;
	pointer-events: none;
	top: 0;
	font-size: 100%;
	left: -3.8em;
	width: 3em; /* works for line-numbers below 1000 lines */
	letter-spacing: -1px;
	border-right: 1px solid #999;

	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;

}

	.line-numbers-rows > span {
		display: block;
		counter-increment: linenumber;
	}

		.line-numbers-rows > span:before {
			content: counter(linenumber);
			color: #999;
			display: block;
			padding-right: 0.8em;
			text-align: right;
		}
</style> -->

<script src="/js/theme.js"></script>

<script>
    $(document).ready(function() {
        var gitstar = '<iframe id="iGitStarIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=star&count=true&size=small" frameborder="0" scrolling="0"></iframe>';
        $('[data-button="iGitStarText"]').replaceWith(gitstar);

        var gitwatch = '<iframe id="iGitWatchIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=watch&count=true&size=lsmalle&v=2" frameborder="0" scrolling="0"></iframe>';
        $('[data-button="iGitWatchText"]').replaceWith(gitwatch);

    });
</script>

<style>
    .cGitButtonContainer {
        display: inline-block;
        width: 100%;
        margin-bottom: 0px;
    }

    #iGitStarText {
        height: 20px;
        float: left;
        padding: 0;
        margin: 0;
    }
    #iGitStarIframe , #iGitWatchIframe {
        height: 20px;
        width: 100px;
        float: left;
    }
</style>

</body>
</html>

