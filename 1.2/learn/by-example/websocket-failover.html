---
layout: ballerina-example-page
title: Failover
description: 
keywords: 
permalink: /1.2/learn/by-example/websocket-failover
active: websocket-failover
redirect_from:
  - /v1-2/learn/by-example/websocket-failover
  - /v1-2/learn/by-example/websocket-failover.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>

<span class="nx">final</span> <span class="kt">string</span> <span class="nx">ASSOCIATED_CONNECTION</span> <span class="p">=</span> <span class="s">&quot;ASSOCIATED_CONNECTION&quot;</span><span class="p">;</span>

<span class="nd">@http:WebSocketServiceConfig {</span>
    <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/failover/ws&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">failoverProxyService</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9090</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// This resource gets invoked when a new client connects.</span>
    <span class="c1">// Since messages to the server are not read by the service until</span>
    <span class="c1">// the execution of the `onOpen` resource finishes,</span>
    <span class="c1">// operations, which should happen before reading messages should be done</span>
    <span class="c1">// in the `onOpen` resource.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onOpen</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Defines the webSocket failover client.</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">wsClientEp</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span>
        <span class="p">{</span>
            <span class="nx">callbackService</span><span class="p">:</span> <span class="nx">failoverClientService</span><span class="p">,</span>
            <span class="c1">// Defines a set of targets.</span>
            <span class="nx">targetUrls</span><span class="p">:</span> <span class="p">[</span> <span class="s">&quot;ws://localhost:9095/failover/ws&quot;</span><span class="p">,</span>
            <span class="s">&quot;ws://localhost:9096/failover/ws&quot;</span><span class="p">,</span> <span class="s">&quot;ws://localhost:9094/failover/ws&quot;</span><span class="p">],</span>
            <span class="c1">// Failover interval in milliseconds.</span>
            <span class="nx">failoverIntervalInMillis</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
            <span class="c1">// When creating the client endpoint, if the `readyOnConnect` flag is set to</span>
            <span class="c1">// `false` the client endpoint does not start reading frames automatically.</span>
            <span class="nx">readyOnConnect</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">});</span>

        <span class="c1">// Associate connections before starting to read messages.</span>
        <span class="nx">wsClientEp</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">ASSOCIATED_CONNECTION</span><span class="p">,</span> <span class="nx">caller</span><span class="p">);</span>
        <span class="nx">caller</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">ASSOCIATED_CONNECTION</span><span class="p">,</span> <span class="nx">wsClientEp</span><span class="p">);</span>

        <span class="c1">// Once the client is ready to receive frames the remote `ready` function</span>
        <span class="c1">// of the client needs to be called separately.</span>
        <span class="k">var</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">wsClientEp</span><span class="o">-&gt;</span><span class="nx">ready</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error calling ready on client&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// This resource gets invoked upon receiving a new text frame from a client.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onText</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">,</span> <span class="kt">string</span> <span class="nx">text</span><span class="p">,</span>
                             <span class="kt">boolean</span> <span class="nx">finalFrame</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">clientEp</span> <span class="p">=</span> <span class="nx">getAssociatedClientEndpoint</span><span class="p">(</span><span class="nx">caller</span><span class="p">);</span>
        <span class="k">var</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">clientEp</span><span class="o">-&gt;</span><span class="nx">pushText</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">finalFrame</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when sending text message&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// This resource gets invoked when an error occurs in the connection.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onError</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">error</span> <span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">clientEp</span> <span class="p">=</span> <span class="nx">getAssociatedClientEndpoint</span><span class="p">(</span><span class="nx">caller</span><span class="p">);</span>
        <span class="k">var</span> <span class="nx">e</span> <span class="p">=</span> <span class="nx">clientEp</span><span class="o">-&gt;</span><span class="nx">close</span><span class="p">(</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">1011</span><span class="p">,</span> <span class="nx">reason</span> <span class="p">=</span> <span class="s">&quot;Unexpected condition&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when closing the connection&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Unexpected error hence closing the connection&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// This resource gets invoked when a client connection is closed from the client side.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onClose</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">,</span> <span class="kt">int</span> <span class="nx">statusCode</span><span class="p">,</span>
                                 <span class="kt">string</span> <span class="nx">reason</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">clientEp</span> <span class="p">=</span> <span class="nx">getAssociatedClientEndpoint</span><span class="p">(</span><span class="nx">caller</span><span class="p">);</span>
        <span class="k">var</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">clientEp</span><span class="o">-&gt;</span><span class="nx">close</span><span class="p">(</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="nx">statusCode</span><span class="p">,</span> <span class="nx">reason</span> <span class="p">=</span> <span class="nx">reason</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when closing the connection&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Client service to receive frames from the remote server.</span>
<span class="kd">service</span> <span class="nx">failoverClientService</span> <span class="p">=</span> <span class="nd">@http:WebSocketServiceConfig {} service {</span>

    <span class="c1">// This resource gets invoked upon receiving a new text frame from the remote backend.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onText</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">caller</span><span class="p">,</span> <span class="kt">string</span> <span class="nx">text</span><span class="p">,</span>
                                <span class="kt">boolean</span> <span class="nx">finalFrame</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">serverEp</span> <span class="p">=</span> <span class="nx">getAssociatedServerEndpoint</span><span class="p">(</span><span class="nx">caller</span><span class="p">);</span>
        <span class="k">var</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">serverEp</span><span class="o">-&gt;</span><span class="nx">pushText</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">finalFrame</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when sending text message&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// This resource gets invoked when an error occurs in the connection.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onError</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">error</span> <span class="nx">err</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">serverEp</span> <span class="p">=</span> <span class="nx">getAssociatedServerEndpoint</span><span class="p">(</span><span class="nx">caller</span><span class="p">);</span>
        <span class="k">var</span> <span class="nx">e</span> <span class="p">=</span> <span class="nx">serverEp</span><span class="o">-&gt;</span><span class="nx">close</span><span class="p">(</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">1011</span><span class="p">,</span>
        <span class="nx">reason</span> <span class="p">=</span> <span class="s">&quot;Unexpected condition&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when closing the connection&quot;</span><span class="p">,</span>
            <span class="nx">err</span> <span class="p">=</span> <span class="nx">e</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Unexpected error hense closing the connection&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// This resource gets invoked when a client connection is closed by</span>
    <span class="c1">// the remote backend.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onClose</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">caller</span><span class="p">,</span> <span class="kt">int</span> <span class="nx">statusCode</span><span class="p">,</span>
                                 <span class="kt">string</span> <span class="nx">reason</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">serverEp</span> <span class="p">=</span> <span class="nx">getAssociatedServerEndpoint</span><span class="p">(</span><span class="nx">caller</span><span class="p">);</span>
        <span class="k">var</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">serverEp</span><span class="o">-&gt;</span><span class="nx">close</span><span class="p">(</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="nx">statusCode</span><span class="p">,</span> <span class="nx">reason</span> <span class="p">=</span> <span class="nx">reason</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when closing the connection&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Function to retrieve the associated client for a particular caller.</span>
<span class="kd">function</span> <span class="nx">getAssociatedClientEndpoint</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">ep</span><span class="p">)</span>
                <span class="nx">returns</span> <span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">wsClient</span> <span class="p">=</span> <span class="p">&lt;</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span><span class="p">&gt;</span><span class="nx">ep</span><span class="p">.</span>
    <span class="nx">getAttribute</span><span class="p">(</span><span class="nx">ASSOCIATED_CONNECTION</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">wsClient</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Function to retrieve the associated caller for a client.</span>
<span class="kd">function</span> <span class="nx">getAssociatedServerEndpoint</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketFailoverClient</span> <span class="nx">ep</span><span class="p">)</span>
                <span class="nx">returns</span> <span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">wsEndpoint</span> <span class="p">=&lt;</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span><span class="p">&gt;</span><span class="nx">ep</span><span class="p">.</span>
    <span class="nx">getAttribute</span><span class="p">(</span><span class="nx">ASSOCIATED_CONNECTION</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">wsEndpoint</span><span class="p">;</span>
<span class="p">}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>

<span class="nd">@http:WebSocketServiceConfig {</span>
    <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/failover/ws&quot;</span>
<span class="p">}</span>

<span class="c1">// Define the backend service with port 9094, which is called by the failover client.</span>
<span class="kd">service</span> <span class="nx">server</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9094</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// This resource gets invoked when a new client connects.</span>
    <span class="c1">// Since messages to the server are not read by the service until the execution of the `onOpen`</span>
    <span class="c1">// resource finishes, operations, which should happen before reading the messages should be done in</span>
    <span class="c1">// the `onOpen` resource.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onOpen</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;WebSocket client connects wih the server 9094. The Connection ID: &quot;</span>
        <span class="o">+</span> <span class="nx">caller</span><span class="p">.</span><span class="nx">getConnectionId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// This resource gets invoked when a server is receiving a text message from the client.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onText</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">,</span> <span class="kt">string</span> <span class="nx">text</span><span class="p">,</span> <span class="kt">boolean</span> <span class="nx">finalFrame</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">pushText</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">finalFrame</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when sending text message&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>

<span class="nd">@http:WebSocketServiceConfig {</span>
    <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/failover/ws&quot;</span>
<span class="p">}</span>

<span class="c1">// Define the backend service with port 9095, which is called by the failover.</span>
<span class="kd">service</span> <span class="nx">server</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9095</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// This resource gets invoked when a new client connects.</span>
    <span class="c1">// Since messages to the server are not read by the service until the execution of the `onOpen`</span>
    <span class="c1">// resource finishes, operations, which should happen before reading messages should be done in</span>
    <span class="c1">// the `onOpen` resource.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onOpen</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;WebSocket client connects wih the server 9095. The Connection ID: &quot;</span>
        <span class="o">+</span> <span class="nx">caller</span><span class="p">.</span><span class="nx">getConnectionId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// This resource gets invoked when a server is receiving a text message from the client.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onText</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketCaller</span> <span class="nx">caller</span><span class="p">,</span> <span class="kt">string</span> <span class="nx">text</span><span class="p">,</span> <span class="kt">boolean</span> <span class="nx">finalFrame</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">pushText</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">finalFrame</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">WebSocketError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred when sending text message&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Failover</h2>
                            <p><p>Ballerina users can configure multiple backends in a given failover config. If the client looses the connection by the server being shut down or by getting any IOExceptions, Ballerina automatically tries to connect with the remaining backends that are specified in the configuration. The trying happens only once for each of the backends.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="websocket-chat-application.html?is_ref_by_example=true">
                                        <span>< PREVIOUS</span>
                                        <p>Chat Application</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="websocket-retry.html?is_ref_by_example=true">
                                        <span>NEXT ></span>
                                        <p>Retry</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="websocket-failover">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <div class="cTopControlsContainer">
                        <div class="cTopControlsRow">
                            <div class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-lang/tree/ballerina-1.2.x/examples/websocket-failover/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                        
                                    </ul>
                                </div>
                            </div> 
                        </div>
                    </div>
              
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/log;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>final string ASSOCIATED_CONNECTION = &quot;ASSOCIATED_CONNECTION&quot;;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@http:WebSocketServiceConfig {
    path: &quot;/failover/ws&quot;
}
service failoverProxyService on new http:Listener(9090) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onOpen(http:WebSocketCaller caller) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when a new client connects.
 Since messages to the server are not read by the service until
 the execution of the <code>onOpen</code> resource finishes,
 operations, which should happen before reading messages should be done
 in the <code>onOpen</code> resource.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:WebSocketFailoverClient wsClientEp = new (
        {
            callbackService: failoverClientService,
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Defines the webSocket failover client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            targetUrls: [ &quot;ws://localhost:9095/failover/ws&quot;,
            &quot;ws://localhost:9096/failover/ws&quot;, &quot;ws://localhost:9094/failover/ws&quot;],
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Defines a set of targets.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            failoverIntervalInMillis: 2000,
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Failover interval in milliseconds.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            readyOnConnect: false
        });
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>When creating the client endpoint, if the <code>readyOnConnect</code> flag is set to
 <code>false</code> the client endpoint does not start reading frames automatically.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        wsClientEp.setAttribute(ASSOCIATED_CONNECTION, caller);
        caller.setAttribute(ASSOCIATED_CONNECTION, wsClientEp);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Associate connections before starting to read messages.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        var err = wsClientEp-&gt;ready();
        if (err is http:WebSocketError) {
            log:printError(&quot;Error calling ready on client&quot;, err);
        }
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Once the client is ready to receive frames the remote <code>ready</code> function
 of the client needs to be called separately.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onText(http:WebSocketCaller caller, string text,
                             boolean finalFrame) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked upon receiving a new text frame from a client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:WebSocketFailoverClient clientEp = getAssociatedClientEndpoint(caller);
        var err = clientEp-&gt;pushText(text, finalFrame);
        if (err is http:WebSocketError) {
            log:printError(&quot;Error occurred when sending text message&quot;, err);
        }
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onError(http:WebSocketCaller caller, error err) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when an error occurs in the connection.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:WebSocketFailoverClient clientEp = getAssociatedClientEndpoint(caller);
        var e = clientEp-&gt;close(statusCode = 1011, reason = &quot;Unexpected condition&quot;);
        if (e is http:WebSocketError) {
            log:printError(&quot;Error occurred when closing the connection&quot;, e);
        }
        log:printError(&quot;Unexpected error hence closing the connection&quot;, err);
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onClose(http:WebSocketCaller caller, int statusCode,
                                 string reason) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when a client connection is closed from the client side.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:WebSocketFailoverClient clientEp = getAssociatedClientEndpoint(caller);
        var err = clientEp-&gt;close(statusCode = statusCode, reason = reason);
        if (err is http:WebSocketError) {
            log:printError(&quot;Error occurred when closing the connection&quot;, err);
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service failoverClientService = @http:WebSocketServiceConfig {} service {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Client service to receive frames from the remote server.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onText(http:WebSocketFailoverClient caller, string text,
                                boolean finalFrame) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked upon receiving a new text frame from the remote backend.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:WebSocketCaller serverEp = getAssociatedServerEndpoint(caller);
        var err = serverEp-&gt;pushText(text, finalFrame);
        if (err is http:WebSocketError) {
            log:printError(&quot;Error occurred when sending text message&quot;, err);
        }
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onError(http:WebSocketFailoverClient caller, error err) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when an error occurs in the connection.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:WebSocketCaller serverEp = getAssociatedServerEndpoint(caller);
        var e = serverEp-&gt;close(statusCode = 1011,
        reason = &quot;Unexpected condition&quot;);
        if (e is http:WebSocketError) {
            log:printError(&quot;Error occurred when closing the connection&quot;,
            err = e);
        }
        log:printError(&quot;Unexpected error hense closing the connection&quot;, err);
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onClose(http:WebSocketFailoverClient caller, int statusCode,
                                 string reason) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when a client connection is closed by
 the remote backend.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:WebSocketCaller serverEp = getAssociatedServerEndpoint(caller);
        var err = serverEp-&gt;close(statusCode = statusCode, reason = reason);
        if (err is http:WebSocketError) {
            log:printError(&quot;Error occurred when closing the connection&quot;, err);
        }
    }
};
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function getAssociatedClientEndpoint(http:WebSocketCaller ep)
                returns (http:WebSocketFailoverClient) {
    http:WebSocketFailoverClient wsClient = &lt;http:WebSocketFailoverClient&gt;ep.
    getAttribute(ASSOCIATED_CONNECTION);
    return wsClient;
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Function to retrieve the associated client for a particular caller.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>function getAssociatedServerEndpoint(http:WebSocketFailoverClient ep)
                returns (http:WebSocketCaller) {
    http:WebSocketCaller wsEndpoint =&lt;http:WebSocketCaller&gt;ep.
    getAttribute(ASSOCIATED_CONNECTION);
    return wsEndpoint;
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Function to retrieve the associated caller for a client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the services, navigate to the directory that contains the
# `.bal` file and run the `ballerina run` command below.
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>ballerina run websocket_service_9095.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:9095
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>ballerina run websocket_service_9094.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:9094
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>ballerina run websocket_failover.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:9090
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Now, this service can be invoked by any WebSocket client using the following URL: &quot;ws://localhost:9090/failover/ws&quot;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To check the sample, you can use Chrome or the Firefox JavaScript console and run the following commands. &lt;br&gt;
var ws = new WebSocket(&quot;ws://localhost:9090/failover/ws&quot;);
ws.onmessage = function(frame) {console.log(frame.data)};
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Send messages.
ws.send(&quot;hello world&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To stop the running service, press Ctrl + C.
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Send messages.
ws.send(&quot;hello world&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Close the connection.
ws.close(1000, &quot;I want to go&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/log;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@http:WebSocketServiceConfig {
    path: &quot;/failover/ws&quot;
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service server on new http:Listener(9094) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Define the backend service with port 9094, which is called by the failover client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onOpen(http:WebSocketCaller caller) {
        log:printInfo(&quot;WebSocket client connects wih the server 9094. The Connection ID: &quot;
        + caller.getConnectionId());
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when a new client connects.
 Since messages to the server are not read by the service until the execution of the <code>onOpen</code>
 resource finishes, operations, which should happen before reading the messages should be done in
 the <code>onOpen</code> resource.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onText(http:WebSocketCaller caller, string text, boolean finalFrame) {
        var err = caller-&gt;pushText(text, finalFrame);
        if (err is http:WebSocketError) {
            log:printError(&quot;Error occurred when sending text message&quot;, err);
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when a server is receiving a text message from the client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file, and run the `ballerina run` command below.
ballerina run websocket_service_9094.bal
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>[ballerina/http] started HTTP/WS listener 0.0.0.0:9094
2019-11-20 14:05:09,596 INFO  [] - WebSocket client connects wih the server 9094. The Connection ID: 08d40cfffe258b13-00003526-00000001-c69a4c7eb8c373f5-76217d0a
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/log;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@http:WebSocketServiceConfig {
    path: &quot;/failover/ws&quot;
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service server on new http:Listener(9095) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Define the backend service with port 9095, which is called by the failover.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onOpen(http:WebSocketCaller caller) {
        log:printInfo(&quot;WebSocket client connects wih the server 9095. The Connection ID: &quot;
        + caller.getConnectionId());
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when a new client connects.
 Since messages to the server are not read by the service until the execution of the <code>onOpen</code>
 resource finishes, operations, which should happen before reading messages should be done in
 the <code>onOpen</code> resource.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onText(http:WebSocketCaller caller, string text, boolean finalFrame) {
        var err = caller-&gt;pushText(text, finalFrame);
        if (err is http:WebSocketError) {
            log:printError(&quot;Error occurred when sending text message&quot;, err);
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource gets invoked when a server is receiving a text message from the client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file, and run the `ballerina run` command below.
ballerina run websocket_service_9095.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:9095
2019-11-20 14:04:20,515 INFO  [] - WebSocket client connects wih the server 9095. The Connection ID: 08d40cfffe258b13-00003366-00000001-0cf944d788c2b464-774dc3ff
[ballerina/http] stopped HTTP/WS listener 0.0.0.0:9095
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    


                     
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                // hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
