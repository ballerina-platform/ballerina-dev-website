---
layout: ballerina-example-page
title: Service Integration Sample
description: 
keywords: 
permalink: /1.2/learn/by-example/websub-service-integration-sample
active: websub-service-integration-sample
redirect_from:
  - /v1-2/learn/by-example/websub-service-integration-sample
  - /v1-2/learn/by-example/websub-service-integration-sample.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="c1">// The order management HTTP service acting as a Ballerina WebSub Publisher brings up an internal Ballerina WebSub Hub</span>
<span class="c1">// at which it will publish updates.</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span>

<span class="nx">listener</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span> <span class="nx">httpListener</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="mi">9090</span><span class="p">);</span>

<span class="c1">// The topic against which the publisher will publish updates and the subscribers</span>
<span class="c1">// need to subscribe to, to receive notifications when an order is placed.</span>
<span class="nx">final</span> <span class="kt">string</span> <span class="nx">ORDER_TOPIC</span> <span class="p">=</span> <span class="s">&quot;http://localhost:9090/ordermgt/ordertopic&quot;</span><span class="p">;</span>

<span class="c1">// An in-memory `map` to which orders will be added.</span>
<span class="kt">map</span><span class="p">&lt;</span><span class="kt">json</span><span class="p">&gt;</span> <span class="nx">orderMap</span> <span class="p">=</span> <span class="p">{};</span>

<span class="c1">// Invokes the function that starts up a Ballerina WebSub Hub, registers the topic</span>
<span class="c1">// against which updates will be published, and maintains a reference to the</span>
<span class="c1">// returned hub object to publish updates.</span>
<span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span> <span class="nx">webSubHub</span> <span class="p">=</span> <span class="nx">startHubAndRegisterTopic</span><span class="p">();</span>

<span class="nd">@http:ServiceConfig {</span>
    <span class="nx">basePath</span><span class="p">:</span> <span class="s">&quot;/ordermgt&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">orderMgt</span> <span class="nx">on</span> <span class="nx">httpListener</span> <span class="p">{</span>

    <span class="c1">// This resource accepts the discovery requests.</span>
    <span class="c1">// Requests received at this resource would respond with a Link Header</span>
    <span class="c1">// indicating the topic to subscribe to and the hub(s) to subscribe at.</span>
    <span class="nd">@http:ResourceConfig {</span>
        <span class="nx">methods</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">],</span>
        <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/order&quot;</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">discoverPlaceOrder</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="c1">// Adds a link header indicating the hub and topic.</span>
        <span class="nx">websub</span><span class="p">:</span><span class="nx">addWebSubLinkHeader</span><span class="p">(</span><span class="nx">response</span><span class="p">,</span> <span class="p">[</span><span class="nx">webSubHub</span><span class="p">.</span><span class="nx">subscriptionUrl</span><span class="p">],</span> <span class="nx">ORDER_TOPIC</span><span class="p">);</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">202</span><span class="p">;</span>
        <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error responding on ordering&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// This resource accepts order placement requests.</span>
    <span class="nd">@http:ResourceConfig {</span>
        <span class="nx">methods</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;POST&quot;</span><span class="p">],</span>
        <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/order&quot;</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">placeOrder</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">orderReq</span> <span class="p">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">getJsonPayload</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">orderReq</span> <span class="nx">is</span> <span class="kt">json</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">string</span> <span class="nx">orderId</span> <span class="p">=</span> <span class="nx">orderReq</span><span class="p">.</span><span class="nx">Order</span><span class="p">.</span><span class="nx">ID</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
            <span class="nx">orderMap</span><span class="p">[</span><span class="nx">orderId</span><span class="p">]</span> <span class="p">=</span> <span class="p">&lt;</span><span class="err">@</span><span class="nx">untainted</span><span class="p">&gt;</span><span class="nx">orderReq</span><span class="p">;</span>

            <span class="c1">// Creates the response message indicating successful order creation.</span>
            <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">202</span><span class="p">;</span>
            <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error responding on ordering&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Publishes the update to the Hub to notify the subscribers.</span>
            <span class="kt">string</span> <span class="nx">orderCreatedNotification</span> <span class="p">=</span> <span class="s">&quot;New Order Added: &quot;</span> <span class="o">+</span> <span class="nx">orderId</span><span class="p">;</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="nx">orderCreatedNotification</span><span class="p">);</span>
            <span class="k">var</span> <span class="nx">updateResult</span> <span class="p">=</span> <span class="nx">webSubHub</span><span class="p">.</span><span class="nx">publishUpdate</span><span class="p">(</span><span class="nx">ORDER_TOPIC</span><span class="p">,</span>
                                                    <span class="nx">orderCreatedNotification</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">updateResult</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error publishing update&quot;</span><span class="p">,</span> <span class="nx">updateResult</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">error</span> <span class="nx">e</span> <span class="p">=</span> <span class="nx">orderReq</span><span class="p">;</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error retrieving payload&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
            <span class="nx">panic</span> <span class="nx">e</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="c1">// Starts up a Ballerina WebSub Hub on port 9191 and registers the topic against</span>
<span class="c1">// which updates will be published.</span>
<span class="kd">function</span> <span class="nx">startHubAndRegisterTopic</span><span class="p">()</span> <span class="nx">returns</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">hubStartUpResult</span> <span class="p">=</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">startHub</span><span class="p">(</span><span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9191</span><span class="p">),</span> <span class="s">&quot;/websub&quot;</span><span class="p">,</span> <span class="s">&quot;/hub&quot;</span><span class="p">);</span>

    <span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span><span class="err">?</span> <span class="nx">hubVar</span> <span class="p">=</span> <span class="p">();</span>
    <span class="k">if</span> <span class="nx">hubStartUpResult</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">HubStartupError</span> <span class="p">{</span>
        <span class="nx">panic</span> <span class="nx">hubStartUpResult</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">hubVar</span> <span class="p">=</span> <span class="nx">hubStartUpResult</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">HubStartedUpError</span>
                            <span class="err">?</span> <span class="nx">hubStartUpResult</span><span class="p">.</span><span class="nx">startedUpHub</span> <span class="p">:</span> <span class="nx">hubStartUpResult</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span> <span class="nx">internalHub</span> <span class="p">=</span> <span class="p">&lt;</span><span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span><span class="p">&gt;</span><span class="nx">hubVar</span><span class="p">;</span>
    <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">internalHub</span><span class="p">.</span><span class="nx">registerTopic</span><span class="p">(</span><span class="nx">ORDER_TOPIC</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error registering topic&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">internalHub</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// The Ballerina WebSub Subscriber service, which subscribes to notifications at the Hub.</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span>

<span class="c1">// The endpoint to which the subscriber service is bound.</span>
<span class="nx">listener</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Listener</span> <span class="nx">websubEP</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="mi">8181</span><span class="p">);</span>

<span class="c1">// Annotations specifying the subscription parameters for the order management service.</span>
<span class="c1">// A subscription request would be sent to the hub with the topic discovered at the</span>
<span class="c1">// resource URL specified.</span>
<span class="nd">@websub:SubscriberServiceConfig {</span>
    <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/ordereventsubscriber&quot;</span><span class="p">,</span>
    <span class="nx">subscribeOnStartUp</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">target</span><span class="p">:</span> <span class="s">&quot;http://localhost:9090/ordermgt/order&quot;</span><span class="p">,</span>
    <span class="nx">leaseSeconds</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">:</span> <span class="s">&quot;Kslk30SNF2AChs2&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">websubSubscriber</span> <span class="nx">on</span> <span class="nx">websubEP</span> <span class="p">{</span>
    <span class="c1">// Defines the resource, which accepts the content delivery requests.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onNotification</span><span class="p">(</span><span class="nx">websub</span><span class="p">:</span><span class="nx">Notification</span> <span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">notification</span><span class="p">.</span><span class="nx">getTextPayload</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;WebSub Notification Received: &quot;</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error retrieving payload as string&quot;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Service Integration Sample</h2>
                            <p><p>Ballerina provides the capability to easily introduce webhooks via its implementation of the WebSub recommendation.</p>

<p>Ballerina Services, which act as WebSub Publishers could start up a Ballerina WebSub Hub to which they would publish
 updates against topics on the occurrence of particular events.</p>

<p>Ballerina WebSub subscribers can subscribe at these hubs, by specifying the topics, to receive notifications on
 the occurrence of particular events.</p>

<p>Any of the Ballerina&rsquo;s WebSub components (Publisher, Hub, or Subscriber) could be used with non-Ballerina components, which
 are WebSub-compliant.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="websub-hub-client-sample.html?is_ref_by_example=true">
                                        <span>< PREVIOUS</span>
                                        <p>Hub Client Sample</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="directory-listener.html?is_ref_by_example=true">
                                        <span>NEXT ></span>
                                        <p>Directory Listener</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="websub-service-integration-sample">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <div class="cTopControlsContainer">
                        <div class="cTopControlsRow">
                            <div class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-lang/tree/ballerina-1.2.x/examples/websub-service-integration-sample/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                        
                                    </ul>
                                </div>
                            </div> 
                        </div>
                    </div>
              
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/log;
import ballerina/websub;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The order management HTTP service acting as a Ballerina WebSub Publisher brings up an internal Ballerina WebSub Hub
 at which it will publish updates.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>listener http:Listener httpListener = new (9090);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>final string ORDER_TOPIC = &quot;http://localhost:9090/ordermgt/ordertopic&quot;;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The topic against which the publisher will publish updates and the subscribers
 need to subscribe to, to receive notifications when an order is placed.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>map&lt;json&gt; orderMap = {};
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>An in-memory <code>map</code> to which orders will be added.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>websub:Hub webSubHub = startHubAndRegisterTopic();
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Invokes the function that starts up a Ballerina WebSub Hub, registers the topic
 against which updates will be published, and maintains a reference to the
 returned hub object to publish updates.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@http:ServiceConfig {
    basePath: &quot;/ordermgt&quot;
}
service orderMgt on httpListener {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    @http:ResourceConfig {
        methods: [&quot;GET&quot;, &quot;HEAD&quot;],
        path: &quot;/order&quot;
    }
    resource function discoverPlaceOrder(http:Caller caller, http:Request req) {
        http:Response response = new;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource accepts the discovery requests.
 Requests received at this resource would respond with a Link Header
 indicating the topic to subscribe to and the hub(s) to subscribe at.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        websub:addWebSubLinkHeader(response, [webSubHub.subscriptionUrl], ORDER_TOPIC);
        response.statusCode = 202;
        var result = caller-&gt;respond(response);
        if (result is error) {
            log:printError(&quot;Error responding on ordering&quot;, result);
        }
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Adds a link header indicating the hub and topic.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    @http:ResourceConfig {
        methods: [&quot;POST&quot;],
        path: &quot;/order&quot;
    }
    resource function placeOrder(http:Caller caller, http:Request req) {
        var orderReq = req.getJsonPayload();
        if (orderReq is json) {
            string orderId = orderReq.Order.ID.toString();
            orderMap[orderId] = &lt;@untainted&gt;orderReq;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource accepts order placement requests.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            http:Response response = new;
            response.statusCode = 202;
            var result = caller-&gt;respond(response);
            if (result is error) {
                log:printError(&quot;Error responding on ordering&quot;, result);
            }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates the response message indicating successful order creation.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            string orderCreatedNotification = &quot;New Order Added: &quot; + orderId;
            log:printInfo(orderCreatedNotification);
            var updateResult = webSubHub.publishUpdate(ORDER_TOPIC,
                                                    orderCreatedNotification);
            if (updateResult is error) {
                log:printError(&quot;Error publishing update&quot;, updateResult);
            }
        } else {
            error e = orderReq;
            log:printError(&quot;Error retrieving payload&quot;, e);
            panic e;
        }
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Publishes the update to the Hub to notify the subscribers.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function startHubAndRegisterTopic() returns websub:Hub {
    var hubStartUpResult = websub:startHub(new http:Listener(9191), &quot;/websub&quot;, &quot;/hub&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Starts up a Ballerina WebSub Hub on port 9191 and registers the topic against
 which updates will be published.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    websub:Hub? hubVar = ();
    if hubStartUpResult is websub:HubStartupError {
        panic hubStartUpResult;
    } else {
        hubVar = hubStartUpResult is websub:HubStartedUpError
                            ? hubStartUpResult.startedUpHub : hubStartUpResult;
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>    websub:Hub internalHub = &lt;websub:Hub&gt;hubVar;
    var result = internalHub.registerTopic(ORDER_TOPIC);
    if (result is error) {
        log:printError(&quot;Error registering topic&quot;, result);
    }
    return internalHub;
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># This sample requires starting up the Subscriber Service after the Publisher Service.
# To start the service, navigate to the directory that contains the
# `.bal` file, and use the `ballerina run` command.
ballerina run order_mgmt_service.bal
[ballerina/websub] Ballerina WebSub Hub started up.
[ballerina/websub] Publish URL: http://localhost:9191/websub/publish
[ballerina/websub] Subscription URL: http://localhost:9191/websub/hub
[ballerina/http] started HTTP/WS listener 0.0.0.0:9191
[ballerina/http] started HTTP/WS listener 0.0.0.0:9090
2019-11-01 14:15:05,814 INFO  [ballerina/websub] - Subscription request received for topic[http://localhost:9090/ordermgt/ordertopic] with callback[http://localhost:8181/ordereventsubscriber]
2019-11-01 14:15:05,858 INFO  [ballerina/websub] - Sending intent verification request to callback[http://localhost:8181/ordereventsubscriber] for topic[http://localhost:9090/ordermgt/ordertopic]
2019-11-01 14:15:06,037 INFO  [ballerina/websub] - Intent verification successful for mode: [subscribe], for callback URL: [http://localhost:8181/ordereventsubscriber]
2019-11-01 14:15:58,756 INFO  [] - New Order Added: 1001
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR hover-enable cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>curl -X POST -d &#39;{ &quot;Order&quot;: { &quot;ID&quot;: &quot;1001&quot;, &quot;Name&quot;: &quot;XYZ&quot; } }&#39; &quot;http://localhost:9090/ordermgt/order&quot; -H &quot;Content-Type:application/json&quot;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Invoke the service via the below &ldquo;curl&rdquo; command to place an order after starting up the subscriber service.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/log;
import ballerina/websub;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Ballerina WebSub Subscriber service, which subscribes to notifications at the Hub.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>listener websub:Listener websubEP = new (8181);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The endpoint to which the subscriber service is bound.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@websub:SubscriberServiceConfig {
    path: &quot;/ordereventsubscriber&quot;,
    subscribeOnStartUp: true,
    target: &quot;http://localhost:9090/ordermgt/order&quot;,
    leaseSeconds: 3600,
    secret: &quot;Kslk30SNF2AChs2&quot;
}
service websubSubscriber on websubEP {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Annotations specifying the subscription parameters for the order management service.
 A subscription request would be sent to the hub with the topic discovered at the
 resource URL specified.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function onNotification(websub:Notification notification) {
        var payload = notification.getTextPayload();
        if (payload is string) {
            log:printInfo(&quot;WebSub Notification Received: &quot; + payload);
        } else {
            log:printError(&quot;Error retrieving payload as string&quot;, payload);
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Defines the resource, which accepts the content delivery requests.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file, and use the `ballerina run` command.
ballerina run subscriber.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:8181
2019-11-01 14:15:05,823 INFO  [ballerina/websub] - Subscription Request successfully sent to Hub[http://localhost:9191/websub/hub], for Topic[http://localhost:9090/ordermgt/ordertopic], with Callback [http://localhost:8181/ordereventsubscriber]
ballerina: Intent Verification agreed - Mode [subscribe], Topic [http://localhost:9090/ordermgt/ordertopic], Lease Seconds [3600]
2019-11-01 14:15:58,892 INFO  [] - WebSub Notification Received: New Order Added: 1001
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    


                     
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                // hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
