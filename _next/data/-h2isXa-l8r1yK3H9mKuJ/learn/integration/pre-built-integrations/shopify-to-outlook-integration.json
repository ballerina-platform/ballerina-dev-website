{"pageProps":{"samples":{"code":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/log;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/time;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/microsoft.onedrive;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/microsoft.outlook.mail;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/shopify.admin </span><span style=\"color:#D73A49\">as</span><span style=\"color:#24292E\"> shopify;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> shopifyServiceUrl </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> xShopifyAccessToken </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> outlookAccessToken </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> oneDriveAccessToken </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> flyerFilePath </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> main</span><span style=\"color:#24292E\">() </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    shopify</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client shopify </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> ({xShopifyAccessToken</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> xShopifyAccessToken}, </span><span style=\"color:#E36209\">shopifyServiceUrl</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    mail</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client outlook </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> ({ auth</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> { token: outlookAccessToken }});</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    onedrive</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client onedrive </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> ({auth</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> { token: oneDriveAccessToken}});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> dateOriginTime </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> time</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">utcToString</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">time</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">utcAddSeconds</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">time</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">utcNow</span><span style=\"color:#24292E\">(), </span><span style=\"color:#D73A49\">-</span><span style=\"color:#005CC5\">300.0</span><span style=\"color:#24292E\">));</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> currentTime </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> time</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">utcToString</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">time</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">utcNow</span><span style=\"color:#24292E\">());</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#24292E\">    shopify</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">CustomerList customerList </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> shopify</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">getCustomers</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">createdAtMin</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> dateOriginTime, </span><span style=\"color:#E36209\">createdAtMax</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> currentTime);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    shopify</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Customer[] customers </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> customerList?.customers </span><span style=\"color:#D73A49\">?:</span><span style=\"color:#24292E\"> [];</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    mail</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Recipient[] recepients </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> [];</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    foreach </span><span style=\"color:#24292E\">shopify</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Customer customer </span><span style=\"color:#D73A49\">in</span><span style=\"color:#24292E\"> customers {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        recepients.</span><span style=\"color:#6F42C1\">push</span><span style=\"color:#24292E\">({</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            emailAddress</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                address</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> customer?.email </span><span style=\"color:#D73A49\">?:</span><span style=\"color:#032F62\"> \"\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                name</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> customer?.first_name </span><span style=\"color:#D73A49\">?:</span><span style=\"color:#032F62\"> \"\"</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        });</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#24292E\">    onedrive</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">File fileContents </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> onedrive</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">downloadFileByPath</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">flyerFilePath</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    byte</span><span style=\"color:#24292E\">[] byteContent </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> fileContents.content </span><span style=\"color:#D73A49\">?:</span><span style=\"color:#24292E\"> [];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    if</span><span style=\"color:#24292E\"> customers.</span><span style=\"color:#6F42C1\">length</span><span style=\"color:#24292E\">() </span><span style=\"color:#D73A49\">></span><span style=\"color:#005CC5\"> 0</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        mail</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">FileAttachment attachment </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            contentBytes</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> byteContent.</span><span style=\"color:#6F42C1\">toBase64</span><span style=\"color:#24292E\">(),</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            contentType</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"image/png\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            name</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"flyer.png\"</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        mail</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">MessageContent messageContent </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            message</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                subject</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"Welcome to Our Store\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                importance</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"normal\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                body</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                    \"contentType\"</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"HTML\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                    \"content\"</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> string </span><span style=\"color:#032F62\">`&#x3C;p> Hi There, &#x3C;br/></span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                        &#x3C;h2> Welcome to Our Store &#x3C;/h2> &#x3C;br/></span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                        &#x3C;strong> What happens next? &#x3C;strong> &#x3C;br/></span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                        Keep an eye on your inbox as we’ll be sending you the best tips for [product/service]. &#x3C;br/></span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                        Want to get more out of Our Store? &#x3C;br/> visit our store at Shopify &#x3C;/p>`</span><span style=\"color:#24292E\"> </span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                },</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                toRecipients</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> recepients,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                attachments</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> [attachment]</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            },</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            saveToSentItems</span><span style=\"color:#D73A49\">:</span><span style=\"color:#005CC5\"> true</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Response response </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> outlook</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">sendMessage</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">messageContent</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> response.statusCode </span><span style=\"color:#D73A49\">==</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">STATUS_ACCEPTED {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            log</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">printInfo</span><span style=\"color:#24292E\">(</span><span style=\"color:#005CC5\">string</span><span style=\"color:#032F62\"> `Welcome emails sent successfully!`</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        } </span><span style=\"color:#D73A49\">else</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            return</span><span style=\"color:#D73A49\"> error</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Failed to send the email from Outlook\"</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">statusCode</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> response.statusCode);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span></code></pre>"},"content":"\nimport ballerina/http;\nimport ballerina/log;\nimport ballerina/time;\nimport ballerinax/microsoft.onedrive;\nimport ballerinax/microsoft.outlook.mail;\nimport ballerinax/shopify.admin as shopify;\n\nconfigurable string shopifyServiceUrl = ?;\nconfigurable string xShopifyAccessToken = ?;\n\nconfigurable string outlookAccessToken = ?;\n\nconfigurable string oneDriveAccessToken = ?;\nconfigurable string flyerFilePath = ?;\n\npublic function main() returns error? {\n    shopify:Client shopify = check new ({xShopifyAccessToken: xShopifyAccessToken}, shopifyServiceUrl);\n    mail:Client outlook = check new ({ auth: { token: outlookAccessToken }});\n    onedrive:Client onedrive = check new ({auth: { token: oneDriveAccessToken}});\n\n    string dateOriginTime = time:utcToString(time:utcAddSeconds(time:utcNow(), -300.0));\n    string currentTime = time:utcToString(time:utcNow());\n\n    shopify:CustomerList customerList = check shopify->getCustomers(createdAtMin = dateOriginTime, createdAtMax = currentTime);\n    shopify:Customer[] customers = customerList?.customers ?: [];\n    mail:Recipient[] recepients = [];\n    foreach shopify:Customer customer in customers {\n        recepients.push({\n            emailAddress: {\n                address: customer?.email ?: \"\",\n                name: customer?.first_name ?: \"\"\n            }\n        });\n    }\n\n    onedrive:File fileContents = check onedrive->downloadFileByPath(flyerFilePath);\n    byte[] byteContent = fileContents.content ?: [];\n\n    if customers.length() > 0 {\n        mail:FileAttachment attachment = {\n            contentBytes: byteContent.toBase64(),\n            contentType: \"image/png\",\n            name: \"flyer.png\"\n        };\n        mail:MessageContent messageContent = {\n            message: {\n                subject: \"Welcome to Our Store\",\n                importance: \"normal\",\n                body: {\n                    \"contentType\": \"HTML\",\n                    \"content\": string `<p> Hi There, <br/>\n                        <h2> Welcome to Our Store </h2> <br/>\n                        <strong> What happens next? <strong> <br/>\n                        Keep an eye on your inbox as we’ll be sending you the best tips for [product/service]. <br/>\n                        Want to get more out of Our Store? <br/> visit our store at Shopify </p>` \n                },\n                toRecipients: recepients,\n                attachments: [attachment]\n            },\n            saveToSentItems: true\n        };\n        http:Response response = check outlook->sendMessage(messageContent);\n        if response.statusCode == http:STATUS_ACCEPTED {\n            log:printInfo(string `Welcome emails sent successfully!`);\n        } else {\n            return error(\"Failed to send the email from Outlook\", statusCode = response.statusCode);\n        }\n    }\n}\n  \n"},"__N_SSG":true}