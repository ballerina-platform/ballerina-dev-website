{"pageProps":{"frontmatter":{"title":"Build the GraalVM executable in a container","permalink":"/learn/build-the-executable-in-a-container/","description":"Building and packing the GraalVM executable from Ballerina in a container.","keywords":"ballerina, programming language, ballerina packages, language-guide, graalvm, native, executable, container, docker","active":"build-the-executable-in-a-container","intro":"This guide walks you through compiling a Ballerina application to a native executable and packing the GraalVM executable in a container."},"content":"\n## Prerequisites\n\nTo complete this part of the guide, you need:\n1. [Ballerina 2201.7.0 (Swan Lake)](/downloads) or greater\n2. A text editor\n   >**Tip:** Preferably, <a href=\"https://code.visualstudio.com/\" target=\"_blank\">Visual Studio Code</a> with the  <a href=\"https://wso2.com/ballerina/vscode/docs/\" target=\"_blank\">Ballerina extension</a> installed.\n3. [Docker](https://www.docker.com) installed and configured in your machine\n   >**Tip:** Since the GraalVM native build consumes a significant amount of memory, it is recommended to increase the memory allocated to Docker to at least 8GB and potentially add more CPUs as well. For more details, see [How to assign more memory to Docker container](https://stackoverflow.com/questions/44533319/how-to-assign-more-memory-to-docker-container/44533437#44533437).\n4. A command terminal\n\nAfter the environment is set up, follow the steps below to build the native executable and pack it in a container.\n\n## Build the GraalVM executable in a container\n\n1. Execute the command below to create a Ballerina service package.\n\n   ```\n   $ bal new hello_docker -t service\n   ```\n\n2. Replace the content of the file `service.bal` with the following.\n\n   ```ballerina\n   import ballerina/http;\n\n   service / on new http:Listener(8080) {\n       resource function get greeting() returns string {   \n           return \"Hello, Docker!\";   \n       }\n   }\n   ```\n\n3. Execute `bal build --graalvm --cloud=docker` to generate the artifacts with the native executable. \n\n   >**Info:** Optionally, you can create a file named `Cloud.toml` in the package directory to add cloud related configurations. For more information, see [Docker](/learn/by-example/c2c-docker-deployment/) and [Kubernetes](/learn/by-example/c2c-k8s-deployment/) documentation.\n\n   ```\n   $ bal build --graalvm --cloud=docker\n   Compiling source\n           user/hello_docker:0.1.0\n   \n   Generating artifacts\n   \n   Building the native image. This may take a while\n   \n   [+] Building 263.1s (16/16) FINISHED                                                  \n    => [internal] load build definition from Dockerfile                                  0.0s\n    => => transferring dockerfile: 395B                                                  0.0s\n    => [internal] load .dockerignore                                                     0.0s\n    => => transferring context: 2B                                                       0.0s\n    => [internal] load metadata for docker.io/library/debian:11-slim                     5.7s\n    => [internal] load metadata for docker.io/ballerina/native-builder:2201.7.x         10.1s\n    => [auth] ballerina/native-builder:pull token for registry-1.docker.io               0.0s\n    => [auth] library/debian:pull token for registry-1.docker.io                         0.0s\n    => [build 1/4] FROM docker.io/ballerina/native-builder:2201.7.x                      1.7s\n    => => resolve docker.io/ballerina/native-builder:2201.7.x                            0.0s\n    => CACHED [stage-1 1/4] FROM docker.io/library/debian:11-slim                        0.0s\n    => [internal] load build context                                                     0.3s\n    => => transferring context: 38.39MB                                                  0.3s\n    => [stage-1 2/4] RUN useradd -ms /bin/bash ballerina                                 0.5s\n    => [stage-1 3/4] WORKDIR /home/ballerina                                             0.0s\n    => [build 2/4] WORKDIR /app/build                                                    0.1s\n    => [build 3/4] COPY hello_docker.jar .                                               0.1s\n    => [build 4/4] RUN sh build-native.sh hello_docker.jar hello_docker                250.5s\n    => [stage-1 4/4] COPY --from=build /app/build/hello_docker .                         0.3s\n    => exporting to image                                                                0.3s\n    => => exporting layers                                                               0.3s\n    => => writing image                                                                  0.0s\n    => => naming to docker.io/library/hello_docker:latest                                0.0s\n   \n   Execute the below command to run the generated Docker image: \n           docker run -d -p 8080:8080 hello_docker:latest\n   ```\n\n   **The Docker file:**\n\n   ```\t\n   # Auto Generated Dockerfile\n   FROM ballerina/native-builder:latest as build\n   WORKDIR /app/build\n   COPY hello_docker.jar .\n   \n   RUN sh build-native.sh hello_docker.jar hello_docker\n   \n   FROM debian:11-slim\n   RUN useradd -ms /bin/bash ballerina\n   WORKDIR /home/ballerina\n   EXPOSE  8080\n   USER ballerina\n   COPY --from=build /app/build/hello_docker .\n   \n   CMD [\"./hello_docker\"]\n   ```\n\n4. Execute the Docker image.\n\n   ```\n   $ docker run -d -p 8080:8080 hello_docker:latest\n   ```\n\n5. Test the service with the cURL request below.\n\n   ```\n   $ curl http://localhost:8080/greeting\n   Hello, Docker!\n   ```\n","id":"build-the-executable-in-a-container","sub":"build-a-graalvm-executable","third":"","slug":"build-a-graalvm-executable/build-the-executable-in-a-container","codes":"[[-1619164373,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">import</span><span style=\\\"color: #24292E\\\"> ballerina/http;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">service</span><span style=\\\"color: #24292E\\\"> / </span><span style=\\\"color: #D73A49\\\">on</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">new</span><span style=\\\"color: #24292E\\\"> http:Listener(</span><span style=\\\"color: #005CC5\\\">8080</span><span style=\\\"color: #24292E\\\">) {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #D73A49\\\">resource</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">function</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #6F42C1\\\">get</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #6F42C1\\\">greeting</span><span style=\\\"color: #24292E\\\">() </span><span style=\\\"color: #D73A49\\\">returns</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> {   </span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        </span><span style=\\\"color: #D73A49\\\">return</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;Hello, Docker!&quot;</span><span style=\\\"color: #24292E\\\">;   </span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">}</span></span></code></pre>\"]]"},"__N_SSG":true}