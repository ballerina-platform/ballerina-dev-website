{"pageProps":{"samples":{"code":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/kafka;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/salesforce </span><span style=\"color:#D73A49\">as</span><span style=\"color:#24292E\"> sf;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> salesforceAccessToken </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> salesforceBaseUrl </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> salesforcePriceBookId </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> type</span><span style=\"color:#6F42C1\"> ProductPrice</span><span style=\"color:#D73A49\"> readonly</span><span style=\"color:#D73A49\"> &#x26;</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> name;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    float</span><span style=\"color:#24292E\"> unitPrice;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> type</span><span style=\"color:#6F42C1\"> ProductPriceUpdate</span><span style=\"color:#D73A49\"> readonly</span><span style=\"color:#D73A49\"> &#x26;</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    float</span><span style=\"color:#24292E\"> UnitPrice;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">listener</span><span style=\"color:#24292E\"> kafka</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Listener orderListener </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#E36209\">kafka</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">DEFAULT_URL, {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    groupId</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"order-group-id\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    topics</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"product_price_updates\"</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> sf</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client sfdcClient </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    baseUrl</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> salesforceBaseUrl,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    auth</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        token</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> salesforceAccessToken</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#24292E\"> orderListener {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    isolated</span><span style=\"color:#D73A49\"> remote</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> onConsumerRecord</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">ProductPrice</span><span style=\"color:#24292E\">[] </span><span style=\"color:#E36209\">prices</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        foreach </span><span style=\"color:#24292E\">ProductPrice {name, unitPrice} </span><span style=\"color:#D73A49\">in</span><span style=\"color:#24292E\"> prices {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            stream&#x3C;record</span><span style=\"color:#24292E\"> {}, </span><span style=\"color:#D73A49\">error?></span><span style=\"color:#24292E\"> retrievedStream </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> sfdcClient</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">query</span><span style=\"color:#24292E\">(</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">                string</span><span style=\"color:#032F62\"> `SELECT Id FROM PricebookEntry </span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                    WHERE Pricebook2Id = '${</span><span style=\"color:#24292E\">salesforcePriceBookId</span><span style=\"color:#032F62\">}' AND </span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                    Name = '${</span><span style=\"color:#24292E\">name</span><span style=\"color:#032F62\">}'`</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            record</span><span style=\"color:#24292E\"> {}[] retrieved </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> from</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {} entry </span><span style=\"color:#D73A49\">in</span><span style=\"color:#24292E\"> retrievedStream</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">                select</span><span style=\"color:#24292E\"> entry;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">            anydata</span><span style=\"color:#24292E\"> pricebookEntryId </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> retrieved[</span><span style=\"color:#005CC5\">0</span><span style=\"color:#24292E\">][</span><span style=\"color:#032F62\">\"Id\"</span><span style=\"color:#24292E\">];</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            if</span><span style=\"color:#24292E\"> pricebookEntryId </span><span style=\"color:#D73A49\">is</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                ProductPriceUpdate updatedPrice </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {UnitPrice</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> unitPrice};</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">                check</span><span style=\"color:#24292E\"> sfdcClient</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">update</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"PricebookEntry\"</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">pricebookEntryId</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">updatedPrice</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span></code></pre>"},"content":"\nimport ballerinax/kafka;\nimport ballerinax/salesforce as sf;\n\nconfigurable string salesforceAccessToken = ?;\nconfigurable string salesforceBaseUrl = ?;\nconfigurable string salesforcePriceBookId = ?;\n\npublic type ProductPrice readonly & record {|\n    string name;\n    float unitPrice;\n|};\n\npublic type ProductPriceUpdate readonly & record {|\n    float UnitPrice;\n|};\n\nlistener kafka:Listener orderListener = new (kafka:DEFAULT_URL, {\n    groupId: \"order-group-id\",\n    topics: \"product_price_updates\"\n});\n\nfinal sf:Client sfdcClient = check new ({\n    baseUrl: salesforceBaseUrl,\n    auth: {\n        token: salesforceAccessToken\n    }\n});\n\nservice on orderListener {\n    isolated remote function onConsumerRecord(ProductPrice[] prices) returns error? {\n        foreach ProductPrice {name, unitPrice} in prices {\n            stream<record {}, error?> retrievedStream = check sfdcClient->query(\n                string `SELECT Id FROM PricebookEntry \n                    WHERE Pricebook2Id = '${salesforcePriceBookId}' AND \n                    Name = '${name}'`);\n            record {}[] retrieved = check from record {} entry in retrievedStream\n                select entry;\n            anydata pricebookEntryId = retrieved[0][\"Id\"];\n            if pricebookEntryId is string {\n                ProductPriceUpdate updatedPrice = {UnitPrice: unitPrice};\n                check sfdcClient->update(\"PricebookEntry\", pricebookEntryId, updatedPrice);\n            }\n        }\n    }\n}\n"},"__N_SSG":true}