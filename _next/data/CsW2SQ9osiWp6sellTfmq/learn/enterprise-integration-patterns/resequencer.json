{"pageProps":{"tagline":"Reorder a received sequence of messages.","desc":"Resequencer reorders the sequence of messages received in the incorrect order.","category":"Message Routing","index":30,"helps":"Ballerina provides convenient map and table data structures for temporary message storage. The query expressions enable sorting arrays based on one or more item attributes.","tags":["Resequencer"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/Resequencer.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> Approval</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    TEAM_LEAD</span><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">MANAGER</span><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">SENIOR_MANAGER leadLevel;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    int</span><span style=\"color:#24292E\"> score;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    int</span><span style=\"color:#24292E\"> nextPromotionLevel;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">TEAM_LEAD</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#005CC5\"> 1</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">MANAGER</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#005CC5\"> 2</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">SENIOR_MANAGER</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#005CC5\"> 3</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#D73A49\"> map&#x3C;</span><span style=\"color:#24292E\">Approval[]</span><span style=\"color:#D73A49\">></span><span style=\"color:#24292E\"> incompleteApprovals </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client hrClient </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.wso2hr.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /api/v1</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> employees</span><span style=\"color:#24292E\">/[</span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> emoloyeeId</span><span style=\"color:#24292E\">]/approval(</span><span style=\"color:#E36209\">Approval</span><span style=\"color:#E36209\"> approvalReq</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        Approval[]</span><span style=\"color:#D73A49\">?</span><span style=\"color:#24292E\"> approvals </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> incompleteApprovals[emoloyeeId];</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> approvals </span><span style=\"color:#D73A49\">==</span><span style=\"color:#24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            incompleteApprovals[emoloyeeId] </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> [approvalReq];</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            return</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        approvals.</span><span style=\"color:#6F42C1\">push</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">approvalReq</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> approvals.</span><span style=\"color:#6F42C1\">length</span><span style=\"color:#24292E\">() </span><span style=\"color:#D73A49\">&#x3C;</span><span style=\"color:#005CC5\"> 3</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            return</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        from</span><span style=\"color:#24292E\"> Approval approval </span><span style=\"color:#D73A49\">in</span><span style=\"color:#24292E\"> approvals</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        order</span><span style=\"color:#D73A49\"> by</span><span style=\"color:#24292E\"> approval.leadLevel</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        do</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> hrClient</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">promotions</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">employees</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">[emoloyeeId]</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">approval.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">approval</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">targetType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#005CC5\"> json</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> incompleteApprovals.</span><span style=\"color:#6F42C1\">remove</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">emoloyeeId</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\ntype Approval record {\n    TEAM_LEAD|MANAGER|SENIOR_MANAGER leadLevel;\n    int score;\n    int nextPromotionLevel;\n};\n\nconst TEAM_LEAD = 1;\nconst MANAGER = 2;\nconst SENIOR_MANAGER = 3;\n\nfinal map<Approval[]> incompleteApprovals = {};\n\nfinal http:Client hrClient = check new (\"http://api.wso2hr.com.balmock.io\");\n\nservice /api/v1 on new http:Listener(8080) {\n\n    resource function post employees/[string emoloyeeId]/approval(Approval approvalReq) returns error? {\n        Approval[]? approvals = incompleteApprovals[emoloyeeId];\n        if approvals == () {\n            incompleteApprovals[emoloyeeId] = [approvalReq];\n            return;\n        }\n        approvals.push(approvalReq);\n        if approvals.length() < 3 {\n            return;\n        }\n        from Approval approval in approvals\n        order by approval.leadLevel\n        do {\n            _ = check hrClient->/promotions/employees/[emoloyeeId]/approval.post(approval, targetType = json);\n        };\n        _ = incompleteApprovals.remove(emoloyeeId);\n    }\n}\n","name":"resequencer.bal"}],"name":" Resequencer"},"__N_SSG":true}