{"pageProps":{"tagline":"Transfer data to another application","desc":"The document message transfers data from one application to another. The focus is on the data and reliability, not on the timing of the transfer.","category":"Message Construction","index":16,"helps":"Ballerina supports sending and receiving data in multiple formats such as JSON and XML over different protocols such as HTTP, GRPC, Kafka, etc. Depending on the protocol, Ballerina provides different reliability mechanisms. As an example, the Ballerina HTTP client supports retries, load balancing, and circuit breaking.","tags":["Document Message","Message Channel","Message Endpoint","Point-to-Point Channel","Request-Reply"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/DocumentMessage.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/mime;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> CsvRequest</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> org;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> filename;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> ZohoResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> status;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> code;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> message;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> file_id;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> created_time;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    |</span><span style=\"color:#24292E\">} details;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client zohoClient </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://content.zohoapis.com.balmock.io\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Retry 3 times with 1 second interval for error codes 404, 408, and 500.</span></span>\n<span class=\"line\"><span style=\"color:#E36209\">    retryConfig</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> {count</span><span style=\"color:#D73A49\">:</span><span style=\"color:#005CC5\"> 3</span><span style=\"color:#24292E\">, interval</span><span style=\"color:#D73A49\">:</span><span style=\"color:#005CC5\"> 1</span><span style=\"color:#24292E\">, statusCodes</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> [</span><span style=\"color:#005CC5\">404</span><span style=\"color:#24292E\">, </span><span style=\"color:#005CC5\">408</span><span style=\"color:#24292E\">, </span><span style=\"color:#005CC5\">500</span><span style=\"color:#24292E\">]}</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /crm</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> bulkUploadLeads</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">CsvRequest</span><span style=\"color:#E36209\"> csvRequest</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#24292E\"> ZohoResponse</span><span style=\"color:#D73A49\">|error</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Request request </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        request.</span><span style=\"color:#6F42C1\">addHeader</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"X-CRM_ORG\"</span><span style=\"color:#24292E\">, csvRequest.org);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        request.</span><span style=\"color:#6F42C1\">addHeader</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"feature\"</span><span style=\"color:#24292E\">, </span><span style=\"color:#032F62\">\"bulk-write\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        request.</span><span style=\"color:#6F42C1\">setFileAsPayload</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"./ftpincoming/\"</span><span style=\"color:#D73A49\"> +</span><span style=\"color:#24292E\"> csvRequest.filename, </span><span style=\"color:#E36209\">contentType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> mime</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">MULTIPART_FORM_DATA);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        return</span><span style=\"color:#24292E\"> zohoClient</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">crm</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">v5</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">upload.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">request</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\nimport ballerina/mime;\n\ntype CsvRequest record {|\n    string org;\n    string filename;\n|};\n\ntype ZohoResponse record {|\n    string status;\n    string code;\n    string message;\n    record {|\n        string file_id;\n        string created_time;\n    |} details;\n|};\n\nfinal http:Client zohoClient = check new (\"http://content.zohoapis.com.balmock.io\",\n    // Retry 3 times with 1 second interval for error codes 404, 408, and 500.\n    retryConfig = {count: 3, interval: 1, statusCodes: [404, 408, 500]}\n);\n\nservice /crm on new http:Listener(8080) {\n    resource function post bulkUploadLeads(CsvRequest csvRequest) returns ZohoResponse|error {\n        http:Request request = new;\n        request.addHeader(\"X-CRM_ORG\", csvRequest.org);\n        request.addHeader(\"feature\", \"bulk-write\");\n        request.setFileAsPayload(\"./ftpincoming/\" + csvRequest.filename, contentType = mime:MULTIPART_FORM_DATA);\n        return zohoClient->/crm/v5/upload.post(request);\n    }\n}\n","name":"document-message.bal"}],"name":" Document Message"},"__N_SSG":true}