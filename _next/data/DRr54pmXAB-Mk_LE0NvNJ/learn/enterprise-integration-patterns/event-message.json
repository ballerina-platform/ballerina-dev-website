{"pageProps":{"tagline":"Notify other applications about something that happened","helps":"Ballerina packages such as HTTP, Kafka, Websocket, etc., in the Ballerina library provide listeners, through which you can consume events from other applications. Each such package provides protocol-specific message sending APIs as well.","desc":"Event message notifies other applications about something that happened. Unlike document message, the focus is on the timing of the message rather than the content.","category":"Message Construction","index":17,"tags":["Event Message","Command Message","Point-to-Point Channel"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/EventMessage.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/mime;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/url;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> IncidentRequest</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> phoneNo;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    Incident incident;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> Incident</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> description;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> date;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> time;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">FROM_NO</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"+15005550006\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">API_VERSION</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"2010-04-01\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">TWILIO_SID</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"VBC1849a56d52g41s4b2b2cc004c0027aa8\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client twilio </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.twilio.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /api/v1</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> incidents</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">IncidentRequest</span><span style=\"color:#E36209\"> req</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> body </span><span style=\"color:#D73A49\">=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `Incident ${</span><span style=\"color:#24292E\">req</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">incident</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">description</span><span style=\"color:#032F62\">} reported: </span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                              ${</span><span style=\"color:#24292E\">req</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">incident</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">date</span><span style=\"color:#032F62\">} at ${</span><span style=\"color:#24292E\">req</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">incident</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">time</span><span style=\"color:#032F62\">}.`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Request twilioReq </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> payload </span><span style=\"color:#D73A49\">=</span><span style=\"color:#032F62\"> \"From=\"</span><span style=\"color:#D73A49\"> +</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> url</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">encode</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">FROM_NO</span><span style=\"color:#24292E\">, </span><span style=\"color:#032F62\">\"utf-8\"</span><span style=\"color:#24292E\">) +</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                         \"&#x26;To=\"</span><span style=\"color:#D73A49\"> +</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> url</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">encode</span><span style=\"color:#24292E\">(req.phoneNo, </span><span style=\"color:#032F62\">\"utf-8\"</span><span style=\"color:#24292E\">) +</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                         \"&#x26;Body=\"</span><span style=\"color:#D73A49\"> +</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> url</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">encode</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">body</span><span style=\"color:#24292E\">, </span><span style=\"color:#032F62\">\"utf-8\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        twilioReq.</span><span style=\"color:#6F42C1\">setTextPayload</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">payload</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">contentType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> mime</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">APPLICATION_FORM_URLENCODED);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> twilio</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">[API_VERSION]</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">Accounts</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">[TWILIO_SID]</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">Messages\\.json.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">twilioReq</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#E36209\">            targetType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Response</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        );</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\nimport ballerina/mime;\nimport ballerina/url;\n\ntype IncidentRequest record {\n    string phoneNo;\n    Incident incident;\n};\n\ntype Incident record {|\n    string description;\n    string date;\n    string time;\n|};\n\nconst FROM_NO = \"+15005550006\";\nconst API_VERSION = \"2010-04-01\";\nconst TWILIO_SID = \"VBC1849a56d52g41s4b2b2cc004c0027aa8\";\n\nfinal http:Client twilio = check new (\"http://api.twilio.com.balmock.io\");\n\nservice /api/v1 on new http:Listener(8080) {\n    resource function post incidents(IncidentRequest req) returns error? {\n        string body = string `Incident ${req.incident.description} reported: \n                              ${req.incident.date} at ${req.incident.time}.`;\n        http:Request twilioReq = new;\n        string payload = \"From=\" + check url:encode(FROM_NO, \"utf-8\") +\n                         \"&To=\" + check url:encode(req.phoneNo, \"utf-8\") +\n                         \"&Body=\" + check url:encode(body, \"utf-8\");\n        twilioReq.setTextPayload(payload, contentType = mime:APPLICATION_FORM_URLENCODED);\n        _ = check twilio->/[API_VERSION]/Accounts/[TWILIO_SID]/Messages\\.json.post(twilioReq,\n            targetType = http:Response\n        );\n    }\n}\n","name":"event-message.bal"}],"name":" Event Message"},"__N_SSG":true}