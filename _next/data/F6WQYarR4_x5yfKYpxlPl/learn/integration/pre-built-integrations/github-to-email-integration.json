{"pageProps":{"samples":{"code":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/email;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/log;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/github;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Github client configuration parameters</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> githubAccessToken </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> orgName </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> repoName </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Email client configuration parameters</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> smtpPassword </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> smtpUsername </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> smtpHost </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Email configuration parameters </span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> recipientAddress </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> fromAddress </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> main</span><span style=\"color:#24292E\">() </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client github </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        auth</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            token</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> githubAccessToken</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    });</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    email</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SmtpClient email </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#E36209\">host</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> smtpHost, </span><span style=\"color:#E36209\">username</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> smtpUsername, </span><span style=\"color:#E36209\">password</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> smtpPassword);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    //Get collaborator list</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> assigneeSummary </span><span style=\"color:#D73A49\">=</span><span style=\"color:#032F62\"> \"\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    stream&#x3C;</span><span style=\"color:#24292E\">github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">User, github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Error?</span><span style=\"color:#D73A49\">></span><span style=\"color:#24292E\"> collaborators </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">getCollaborators</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">orgName</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">repoName</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    check</span><span style=\"color:#24292E\"> collaborators.</span><span style=\"color:#6F42C1\">forEach</span><span style=\"color:#24292E\">(</span><span style=\"color:#D73A49\">function</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">User user) {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> query </span><span style=\"color:#D73A49\">=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `repo:${</span><span style=\"color:#24292E\">orgName</span><span style=\"color:#032F62\">}/${</span><span style=\"color:#24292E\">repoName</span><span style=\"color:#032F62\">} is:issue assignee:${</span><span style=\"color:#24292E\">user</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">login</span><span style=\"color:#032F62\">}`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SearchResult</span><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">github:Error issuesForAssignee </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">search</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">query</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SEARCH_TYPE_ISSUE, </span><span style=\"color:#005CC5\">1</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> issuesForAssignee </span><span style=\"color:#D73A49\">is</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SearchResult {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">            string</span><span style=\"color:#24292E\"> userName </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> user?.name </span><span style=\"color:#D73A49\">?:</span><span style=\"color:#032F62\"> \"Unknown\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            assigneeSummary </span><span style=\"color:#D73A49\">+=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `${</span><span style=\"color:#24292E\">userName</span><span style=\"color:#032F62\">} : ${</span><span style=\"color:#24292E\">issuesForAssignee</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">issueCount</span><span style=\"color:#032F62\">} ${\"</span><span style=\"color:#005CC5\">\\n</span><span style=\"color:#032F62\">\"}`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        } </span><span style=\"color:#D73A49\">else</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            log</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">printError</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Error while searching issues of an assignee.\"</span><span style=\"color:#24292E\">, 'error </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> issuesForAssignee);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    //Get open issues</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> query </span><span style=\"color:#D73A49\">=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `repo:${</span><span style=\"color:#24292E\">orgName</span><span style=\"color:#032F62\">}/${</span><span style=\"color:#24292E\">repoName</span><span style=\"color:#032F62\">} is:issue is:open`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SearchResult</span><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">github:Error openIssues </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">search</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">query</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SEARCH_TYPE_ISSUE, </span><span style=\"color:#005CC5\">1</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    if</span><span style=\"color:#24292E\"> openIssues </span><span style=\"color:#D73A49\">is</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Error {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        log</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">printError</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Error while searching open issues.\"</span><span style=\"color:#24292E\">, 'error </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> openIssues);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    int</span><span style=\"color:#24292E\"> totalOpenIssueCount </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> openIssues </span><span style=\"color:#D73A49\">is</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SearchResult ? openIssues.issueCount </span><span style=\"color:#D73A49\">:</span><span style=\"color:#005CC5\"> 0</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    //Get closed issues</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    query </span><span style=\"color:#D73A49\">=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `repo:${</span><span style=\"color:#24292E\">orgName</span><span style=\"color:#032F62\">}/${</span><span style=\"color:#24292E\">repoName</span><span style=\"color:#032F62\">} is:issue is:closed`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SearchResult</span><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">github:Error closedIssues </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">search</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">query</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SEARCH_TYPE_ISSUE, </span><span style=\"color:#005CC5\">1</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    if</span><span style=\"color:#24292E\"> closedIssues </span><span style=\"color:#D73A49\">is</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Error {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        log</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">printError</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Error while searching closed issues.\"</span><span style=\"color:#24292E\">, 'error </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> closedIssues);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    int</span><span style=\"color:#24292E\"> totalClosedIssueCount </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> closedIssues </span><span style=\"color:#D73A49\">is</span><span style=\"color:#24292E\"> github</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">SearchResult ? closedIssues.issueCount </span><span style=\"color:#D73A49\">:</span><span style=\"color:#005CC5\"> 0</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    //Send email</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> issueSummary </span><span style=\"color:#D73A49\">=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `ISSUE SUMMARY REPORT${\"</span><span style=\"color:#005CC5\">\\n\\n</span><span style=\"color:#032F62\">\"}Repository Name: ${</span><span style=\"color:#24292E\">repoName</span><span style=\"color:#032F62\">}</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">        ${\"</span><span style=\"color:#005CC5\">\\n</span><span style=\"color:#032F62\">\"}Total Issues Open: ${</span><span style=\"color:#24292E\">totalOpenIssueCount</span><span style=\"color:#032F62\">} ${\"</span><span style=\"color:#005CC5\">\\n</span><span style=\"color:#032F62\">\"}Total Issues Closed: ${</span><span style=\"color:#24292E\">totalClosedIssueCount</span><span style=\"color:#032F62\">}</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">        ${\"</span><span style=\"color:#005CC5\">\\n\\n</span><span style=\"color:#032F62\">\"}Issue Count by Assignee: ${\"</span><span style=\"color:#005CC5\">\\n</span><span style=\"color:#032F62\">\"}${</span><span style=\"color:#24292E\">assigneeSummary</span><span style=\"color:#032F62\">} ${\"</span><span style=\"color:#005CC5\">\\n</span><span style=\"color:#032F62\">\"}`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    email</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Message message </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        to</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> recipientAddress,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        'from</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> fromAddress,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        subject</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"Git Issue Summary\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        body</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> issueSummary</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    };</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    check</span><span style=\"color:#24292E\"> email</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">sendMessage</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">message</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    log</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">printInfo</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Email sent successfully!\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span></code></pre>"},"content":"\nimport ballerina/email;\nimport ballerina/log;\nimport ballerinax/github;\n\n// Github client configuration parameters\nconfigurable string githubAccessToken = ?;\nconfigurable string orgName = ?;\nconfigurable string repoName = ?;\n\n// Email client configuration parameters\nconfigurable string smtpPassword = ?;\nconfigurable string smtpUsername = ?;\nconfigurable string smtpHost = ?;\n\n// Email configuration parameters \nconfigurable string recipientAddress = ?;\nconfigurable string fromAddress = ?;\n\npublic function main() returns error? {\n    github:Client github = check new ({\n        auth: {\n            token: githubAccessToken\n        }\n    });\n    email:SmtpClient email = check new (host = smtpHost, username = smtpUsername, password = smtpPassword);\n\n    //Get collaborator list\n    string assigneeSummary = \"\";\n    stream<github:User, github:Error?> collaborators = check github->getCollaborators(orgName, repoName);\n    check collaborators.forEach(function(github:User user) {\n        string query = string `repo:${orgName}/${repoName} is:issue assignee:${user.login}`;\n        github:SearchResult|github:Error issuesForAssignee = github->search(query, github:SEARCH_TYPE_ISSUE, 1);\n        if issuesForAssignee is github:SearchResult {\n            string userName = user?.name ?: \"Unknown\";\n            assigneeSummary += string `${userName} : ${issuesForAssignee.issueCount} ${\"\\n\"}`;\n        } else {\n            log:printError(\"Error while searching issues of an assignee.\", 'error = issuesForAssignee);\n        }\n    });\n\n    //Get open issues\n    string query = string `repo:${orgName}/${repoName} is:issue is:open`;\n    github:SearchResult|github:Error openIssues = github->search(query, github:SEARCH_TYPE_ISSUE, 1);\n    if openIssues is github:Error {\n        log:printError(\"Error while searching open issues.\", 'error = openIssues);\n    }\n    int totalOpenIssueCount = openIssues is github:SearchResult ? openIssues.issueCount : 0;\n\n    //Get closed issues\n    query = string `repo:${orgName}/${repoName} is:issue is:closed`;\n    github:SearchResult|github:Error closedIssues = github->search(query, github:SEARCH_TYPE_ISSUE, 1);\n    if closedIssues is github:Error {\n        log:printError(\"Error while searching closed issues.\", 'error = closedIssues);\n    }\n    int totalClosedIssueCount = closedIssues is github:SearchResult ? closedIssues.issueCount : 0;\n\n    //Send email\n    string issueSummary = string `ISSUE SUMMARY REPORT${\"\\n\\n\"}Repository Name: ${repoName}\n        ${\"\\n\"}Total Issues Open: ${totalOpenIssueCount} ${\"\\n\"}Total Issues Closed: ${totalClosedIssueCount}\n        ${\"\\n\\n\"}Issue Count by Assignee: ${\"\\n\"}${assigneeSummary} ${\"\\n\"}`;\n    email:Message message = {\n        to: recipientAddress,\n        'from: fromAddress,\n        subject: \"Git Issue Summary\",\n        body: issueSummary\n    };\n    check email->sendMessage(message);\n    log:printInfo(\"Email sent successfully!\");\n}  \n  \n"},"__N_SSG":true}