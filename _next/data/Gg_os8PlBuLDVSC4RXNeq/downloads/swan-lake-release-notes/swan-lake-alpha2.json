{"pageProps":{"frontmatter":{"layout":"ballerina-left-nav-release-notes","title":"Swan Lake Alpha2","permalink":"/downloads/swan-lake-release-notes/swan-lake-alpha2/","active":"swan-lake-alpha2","redirect_from":["/downloads/swan-lake-release-notes/swan-lake-alpha2"]},"content":"### Overview of Ballerina Swan Lake Alpha2\n\nThis Alpha2 release includes the language features planned for the Ballerina Swan Lake release. Moreover, this release includes improvements and bug fixes to the compiler, runtime, standard library, and developer tooling. This release note lists only the features and updates added after the Alpha1 release of Ballerina Swan Lake.\n\n- [Updating Ballerina](#updating-ballerina)\n    - [For existing users](#for-existing-users)\n    - [For new users](#for-new-users)\n- [Highlights](#highlights)\n- [What is new in Ballerina Swan Lake Alpha2](#what-is-new-in-ballerina-swan-lake-alpha2)\n    - [Language](#language)\n        -  [Support for mapping and error binding patterns in the match statement](#support-for-mapping-and-error-binding-patterns-in-the-match-statement)\n    - [Runtime](#runtime)\n        - [Support for configurable variables of record and table types](#support-for-configurable-variables-of-record-and-table-types)\n        - [Support for decrypting string values using the new config lang library](#support-for-decrypting-string-values-using-the-new-config-lang-library)\n    - [Standard library](#standard-library)\n        - [HTTP module improvements](#http-module-improvements)\n        - [MIME module improvements](#mime-module-improvements)\n        - [WebSocket module improvements](#websocket-module-improvements)\n        - [GraphQL module improvements](#graphql-module-improvements)\n        - [WebSub module improvements](#websub-module-improvements)\n        - [WebSubHub module improvements](#websubhub-module-improvements)\n        - [IO module improvements](#io-module-improvements)\n        - [Email module improvements](#email-module-improvements)\n        - [UDP module improvements](#udp-module-improvements)\n        - [Crypto module improvements](#crypto-module-improvements)\n        - [JWT module improvements](#jwt-module-improvements)\n    - [Code to Cloud](#code-to-cloud)\n    - [Developer tools](#developer-tools)\n        - [Language Server](#language-server)\n        - [Debugger](#debugger)\n        - [Ballerina Shell REPL - EXPERIMENTAL](#ballerina-shell-repl-experimental)\n    - [Breaking changes](#breaking-changes)\n\n### Updating Ballerina\n\nYou can use the [update tool](/learn/cli-documentation/update-tool/) to update to Ballerina Swan Lake Alpha2 as follows.\n\n#### For existing users\n\nIf you are already using Ballerina, you can directly update your distribution to the Swan Lake channel using the [Ballerina update tool](/learn/cli-documentation/update-tool/). To do this, first, execute the command below to get the update tool updated to its latest version. \n\n> `bal update`\n\nIf you are using an **update tool version below 0.8.14**, execute the `ballerina update` command to update it. Next, execute the command below to update to Swan Lake Alpha2.\n\n> `bal dist pull slalpha2`\n\n#### For new users\n\nIf you have not installed Ballerina, then download the [installers](/downloads/#swanlake) to install.\n\n### Highlights\n\n- Support for mapping and error binding patterns in the `match` statement\n- Support for configurable variables of `record` and `table` types\n- Support for decrypting string values using the new `lang.config` lang library\n- Improvements to the HTTP, MIME, WebSocket, GraphQL, WebSub, WebSubHub, IO, email, UDP, crypto, and JWT standard library modules\n- The extension of the Ballerina package distribution file has been changed from `.balo` to `.bala`\n- Improvements to developer tools such as the Language Server and debugger\n\n### What is new in Ballerina Swan Lake Alpha2\n\n#### Language\n\n##### Support for mapping and error binding patterns in the match statement\n\n**Mapping binding pattern**\n\nThe `match` statement now supports mapping and error binding patterns with `var`.\n\n```ballerina\nmatch v {\n    var  {a, b} => {\n        // Matches mappings that contain at least the fields `a` and `b`.\n        // The values of these fields can be accessed via the variables \n        // `a` and `b` within this block.\n        io:println(a);\n    }\n\n    var {c: {x: a1, y: a2}, ...rest} => {\n        // Matches mappings that have a field `c` where its value is \n        // another mapping that contains at least the fields `x` and `y`.\n        // All of the remaining fields (if any) can be accessed via\n        // the new variable `rest`.\n        int length = rest.length();\n    }\n}\n```\n\n**Error binding pattern**\n\n```ballerina\nmatch v {\n    var error(message, error(causeMessage)) => {\n        // Matches errors that have a cause. \n        // The messages of the matched error and the cause error\n        // can be accessed via the variables `message` and \n        // `causeMessage` within this block.\n        io:println(causeMessage);\n    }\n\n    var error(a, code = matchedCode) => {\n        // Matches errors that have a detail entry with the key `code`.\n        // The `code` can be accessed using the `matchedCode` variable \n        // within this block.\n        io:println(matchedCode);\n    }\n}\n```\n\n#### Runtime\n\n##### Support for configurable variables of record and table types\n\n**Record type**\n\nRecord fields with simple types like `int`, `string`, `boolean`, `float`, `decimal`, and arrays of the respective types are now supported. \n\nFor example, if the `Config.toml` file contains the following TOML table,\n\n```toml\n[Pkg.testUserOne]\nusername = \"john\"\npassword = \"abcd\"\nscopes = [\"write\"]\n\n[Pkg.testUserTwo]\nusername = \"mary\"\npassword = \"test123\"\n```\n\nit can be loaded as configurable variables of a record type as follows.\n\n```ballerina\ntype AuthInfo record {\n    readonly string username;\n    string password;\n    string[] scopes?;\n};\n\nconfigurable AuthInfo & readonly testUserOne = ?;\nconfigurable AuthInfo & readonly testUserTwo = ?;\n```\n\n**Table type**\n\nBallerina now supports configurable variables of type `table` through TOML arrays of tables.\n\nFor example, if the `Config.toml` file contains the following TOML table array,\n\n```toml\n[[Pkg.users]]\nusername = \"alice\"\npassword = \"password1\"\nscopes = [\"scope1\"]\n\n[[Pkg.users]]\nusername = \"bob\"\npassword = \"password2\"\nscopes = [\"scope1\", \"scope2\"]\n\n[[Pkg.users]]\nusername = \"jack\"\npassword = \"password3\"\n```\n\nit can be loaded as a configurable variable of a `table` type as follows.\n\n```ballerina\nconfigurable table<AuthInfo> key(username) & readonly users = ?;\n```\n\n##### Support for decrypting string values using the new config lang library\n\nThe `bal encrypt` command can be used to encrypt plain text values and specify those in the `Config.toml` file. Then, the `config:decryptString()` function can be used to decrypt the configurable value. \n\nFor example, if the `Config.toml` file contains the following encrypted string value,\n\n```toml\npassword = \"@encrypted:{ODYUoKSw0xW31eoxa/s2ESdBNgk1gX77txBIgpLC6NQ=}\"\n```\n\nit can be decrypted in the Ballerina code as follows.\n\n```ballerina\nimport ballerina/lang.config;\n\nconfigurable string password = ?;\n\npublic function main() {\n    string decryptedPassword = config:decryptString(password);\n}\n```\n\n#### Standard library\n\n##### HTTP module improvements\n\n###### Introduced byte stream manipulation functions to the request and response \n\nThis introduction enables manipulating the payload as a stream of `byte[]`. The `setByteStream()` and `getByteStream()` methods use the Ballerina stream feature.\n\n```ballerina\nhttp:Request request = new;\nio:ReadableByteChannel byteChannel = check io:openReadableFile(\"path/to/file.tmp\");\nstream<io:Block, io:Error> byteStream = check byteChannel.blockStream(8196);\nrequest.setByteStream(byteStream);\n\nhttp:Response response = new;\nstream<byte[], io:Error>|error str = response.getByteStream();\n```\n\n###### Introduced the `http:Header` annotation to bind headers in an inbound request\n\nWith the introduction of the `@http:Header` annotation, inbound request headers can be retrieved by binding them to a resource method parameter. Individual headers can be accessed as `string` or `string[]` types while a parameter of type `http:Headers` can be used to access all headers. \n\n```ballerina\nservice on helloEP {\n    resource function get hello(@http:Header {name: \"Accept\"} string? acceptHeader, http:Headers allHeaders) {\n    //...\n    }\n}\n```\n\n##### MIME module improvements\n\n###### Introduced byte stream manipulation methods to the `mime:Entity` class\n\nThis introduction enables manipulating the entity body as a stream of `byte[]`.\n\n```ballerina\nfunction setByteStream(stream<byte[], io:Error> byteStream, string contentType = \"application/octet-stream\")\n\nfunction getByteStream(int arraySize = 8196) returns stream<byte[], io:Error>|mime:ParserError\n\nfunction getBodyPartsAsStream(int arraySize = 8196) returns stream<byte[], io:Error>|mime:ParserError\n\n```\n\n#### WebSocket module improvements\n\nIntroduced the Sync client. This is the primary client of the WebSocket module. This client is capable of reading and writing messages synchronously.\n\n**Reading and writing text messages**\n\n```ballerina\nwebsocket:Client wsClient = check new (\"ws://echo.websocket.org\");\nvar err = wsClient->writeTextMessage(\"Text message\");\nstring textResp = check wsClient->readTextMessage();\n```\n\n**Reading and writing binary messages**\n\n```ballerina\nwebsocket:Client wsClient = check new (\"ws://echo.websocket.org\");\nvar err = wsClient->writeBinaryMessage(\"Binary message\".toBytes());\nbyte[] byteResp = check wsClient->readBinaryMessage();\n```\n\n##### GraphQL module improvements\n\nBallerina GraphQL listeners can now be configured using the same configurations as the listener configurations in `http:Listener`. Additionally, a GraphQL service can be secured by defining a `maxQueryDepth` as an annotation to restrict the depth of a query before execution.\n\n```ballerina\nimport ballerina/graphql;\n\ngraphql:ListenerConfiguration configs = {\n    // http listener configurations\n};\nlistener graphql:Listener graphqlListener = new (9090, configs);\n\n@graphql:ServiceConfiguration {maxQueryDepth: 3}\nservice /graphql on graphqlListener {\n    // Service definition\n}\n```\n\n##### WebSub module improvements\n\nIncluded functionality to the `websub:SubscriberService` to respond with user-defined custom payloads/header parameters in error scenarios.\n\n```ballerina\nimport ballerina/websub;\n\nlistener websub:Listener subscriberListener = new (9001);\n\nservice /subscriber on subscriberListener {\n    remote function onSubscriptionValidationDenied(websub:SubscriptionDeniedError msg) returns websub:Acknowledgement? {\n        websub:Acknowledgement ack = {\n            headers: {\n                \"Content-Encoding\": \"gzip\"\n            },\n            body: {\n                \"message\": \"Successfully processed request\"\n            }\n        };\n        return ack;\n    }\n\n    remote function onSubscriptionVerification(websub:SubscriptionVerification msg) returns \n            websub:SubscriptionVerificationSuccess|websub:SubscriptionVerificationError {\n        if (msg.hubTopic == \"https://www.sample.topic\") {\n            return error websub:SubscriptionVerificationError(\"Hub topic not supported\", \n                                                              headers = {\"Content-Encoding\": \"gzip\"}, \n                                                              body = {\"message\": \"Hub topic not supported\"});\n        } else {\n            return {};\n        }\n    }\n\n    remote function onEventNotification(websub:ContentDistributionMessage event) returns websub:Acknowledgement|\n            websub:SubscriptionDeletedError? {\n        return error websub:SubscriptionDeletedError(\"Subscriber wants to unsubscribe\", \n                                                     headers = {\"Content-Encoding\": \"gzip\"}, \n                                                     body = {\"message\": \"Unsubscribing from the topic\"});\n    }\n}\n```\n\n##### WebSubHub module improvements\n\nIncluded functionality to the `websubhub:Service` to respond with user-defined custom payloads/header parameters in error scenarios.\n\n```ballerina\nimport ballerina/websubhub;\n\nservice /websubhub on new websubhub:Listener(9091) {\n    remote function onRegisterTopic(websubhub:TopicRegistration message) \n            returns websubhub:TopicRegistrationSuccess|websubhub:TopicRegistrationError {\n        if (message.topic == \"https://sub.topic.com\") {\n            websubhub:TopicRegistrationSuccess successResult = {body: <map<string>>{isSuccess: \"true\"}};\n            return successResult;\n        } else {\n            return error websubhub:TopicRegistrationError(\"Topic registration failed!\", \n                        headers = {\"Content-Encoding\": \"gzip\"}, \n                        body = {\"hub.additional.details\": \"Feature is not supported in the hub\"});\n        }\n    }\n\n    // Other remote methods...\n}\n```\n\n##### IO module improvements\n\nIntroduce a parameter of type `XmlWriteOptions` to specify the entity type and the document type declaration.\n\n```ballerina\npublic function fileWriteXml(@untainted string path, xml content, *XmlWriteOptions xmlOptions, FileWriteOption fileWriteOption = \n                             OVERWRITE) returns Error? {\n}\n```\n**Example**\n\n```ballerina\nimport ballerina/io;\n\npublic function main() returns error? {\n    xml content = xml `<note>\n        <to>Tove</to>\n        <from>Jani</from>\n        <heading>Reminder</heading>\n        <body>Don't forget me this weekend!</body>\n        </note>`;\n    string publicId = \"-//W3C//DTD HTML 4.01 Transitional//EN\";\n    string systemId = \"http://www.w3.org/TR/html4/loose.dtd\";\n    var writeResult = io:fileWriteXml(\"./xmlFileWithDoc.xml\", content, doctype = {\n        system: systemId,\n        'public: publicId\n    });\n}\n```\n\n**Output**\n```xml\n<!DOCTYPE note PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<note>\n    <to>Tove</to>\n    <from>Jani</from>\n    <heading>Reminder</heading>\n    <body>Don't forget me this weekend!</body>\n</note>\n```\n##### Email module improvements\n\n- Make the `body` field of the `email:Message` record optional. This enables sending an email with only the `htmlBody` field set without a text-typed `body` field.\n\n- Add `mime:Entity` type to the union type of the `attachments` field in the `email:Message` record. That enables attaching a single MIME Entity as an attachment. This `email:Message` record change would appear as follows.\n\n```ballerina\npublic type Message record {|\n    // ... other fields\n    mime:Entity|Attachment|(mime:Entity|Attachment)[] attachments?;\n|};\n```\n\n- The above-mentioned changes related to the `body` and `attachments` fields are updated in the `email:Options` record as given below in order to facilitate the same in the `sendEmail` method in the `email:SmtpClient`.\n\n```ballerina\npublic type Options record {|\n    // ... other fields\n    string body?;\n    mime:Entity|Attachment|(mime:Entity|Attachment)[] attachments?;\n|};\n```\n\n- Remove the `properties` field representing custom properties from all Email module related configuration records: `email:SmtpConfig`, `email:PopConfig`, `email:ImapConfig`, `email:PopListenerConfig`, and `email:ImapListenerConfig`.\n\n- The `mail.smtp.ssl.checkserveridentity` custom property was passed as an entry in the `properties` to enable/disable the server certificateâ€™s hostname verification. As the `properties` field is removed from the API, from this release onwards, the `verifyHostName` boolean field is introduced to the `secureSocket` record for all the configurations related to the Email module. \n\nThis `email:SecureSocket` record change would appear as follows.\n\n```ballerina\npublic type SecureSocket record {|\n    // ... other fields\n    boolean verifyHostname = true;\n|};\n```\n\n##### UDP module improvements\n\n- The `sendDatagram` method will now send multiple datagrams if the size of the `byte[]` value provided as the `data` field of the datagram exceeds 8KB.\n\n- Returning `Datagram` from the `onDatagram` or `onBytes` remote methods also sends multiple datagrams if the size of the `byte[]` value provided (as the `data` field of the datagram) exceeds 8KB.\n\n##### Crypto module improvements\n\nAdded support to decode private keys from `.key` files and public keys from `.cert` files and updated the APIs for decoding private/public keys. This enables reading private/public keys from PEM files.\n\n##### JWT module improvements\n\nExtended the private key support for JWT signature generation and public cert support for JWT signature validation.\n\n##### Log module improvements\n\nIntroduced a configuration in the log module to set the output format to JSON. You need to add the entry below in the `Config.toml` file to set the output format to JSON.\n\n```toml\n[log]\nformat = \"json\"\n```\n\n#### Code to Cloud\n\n- The `Kubernetes.toml` file is renamed to `Cloud.toml`. \n- The `--cloud=docker` build option is implemented. This will build the Dockerfile and Docker image without generating the Kubernetes artifacts.\n\n\n#### Developer tools\n\n##### Language Server\n\nImplemented renaming support in the Language Server. Now, VSCode users are able to select a symbol and rename all occurrences within the same module as well as across modules.\n\n##### Debugger\n\nAdded variable paging support. With this feature, the Ballerina variables, which contain a large number of child variables will be shown in a paged view in the debug variable presentation.\n\n##### Ballerina Shell REPL [EXPERIMENTAL]\n\n- Fixed the REPL expression output to output the `toBalString()` result.\n- Improved the REPL parser to support some partial snippets such as the example cases below.\n\t-  Template strings will allow continuing on new lines.\n\t- The CLI will wait for more input if the last character was an operator.\n\t- The CLI will not wait for unclosed double quotes.\n- Enabled REPL to exit on `Ctrl+D`.\n\n#### Breaking changes\n\n- Member access on a value of type `table` now returns `()` if the `table` does not contain a member with the specified key. Otherwise, the result is the member in the `table` value with the given key.\n\n```ballerina\nimport ballerina/io;\n\ntype Employee record {\n    readonly string name;\n    int id;\n};\n\npublic function main() {\n    table<Employee> key(name) employeeTable = table [\n        {name: \"Mike\", id: 1234},\n        {name: \"John\", id: 4567}\n    ];\n    Employee? emp1 = employeeTable[\"John\"];\n    io:println(emp1); // {\"name\":\"John\",\"id\":4567}\n    Employee? emp2 = employeeTable[\"Kate\"];\n    io:println(emp2 is ()); // true\n}\n```\n\n- Iterating over `xml` in a `from` clause in query expressions now returns `xml` and iterating over `xml<T>` returns `T`.\n\n```ballerina\nimport ballerina/io;\n\npublic function main() {\n    xml authorList = xml `<authorList>\n                            <author>\n                                <name>Sir Arthur Conan Doyle</name>\n                                <country>UK</country>\n                            </author>\n                            <author>\n                                <name>Dan Brown</name>\n                                <country>US</country>\n                            </author>\n                        </authorList>`;\n    xml authors = from xml y in authorList/<author>/<name>\n                  select y;\n    io:println(authors); //<name>Sir Arthur Conan Doyle</name><name>Dan Brown</name>\n}\n```\n\n- Variables of types `readonly` and `value:Cloneable` cannot be assigned to `any` since they may contain values of type `error`.\n","id":"swan-lake-alpha2"},"__N_SSG":true}