{"pageProps":{"tagline":"Process the data based on the received message format","desc":"The Format Indicator will identify the message format based on the version or structure and process it.","category":"Message Construction","index":23,"helps":"The `is` keyword in Ballerina distinguishes between structured types, aiding in distinguishing various message versions.","tags":["Format Indicator","Cannonical Data Model"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/FormatIndicator.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> type</span><span style=\"color:#6F42C1\"> PatientReqV1</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">    \"1.0\"</span><span style=\"color:#D73A49\"> version</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"1.0\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> firstName;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> lastName;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> dob;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> diagnosis;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> type</span><span style=\"color:#6F42C1\"> PatientReqV2</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">    \"2.0\"</span><span style=\"color:#D73A49\"> version</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"2.0\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    Patient patient;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> PatientReq</span><span style=\"color:#D73A49\"> PatientReqV1|PatientReqV2</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> type</span><span style=\"color:#6F42C1\"> Patient</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> fullName;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> dob;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> diagnosis;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client patientClient </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.patients.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /api/v1</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> data</span><span style=\"color:#24292E\">/patient(</span><span style=\"color:#E36209\">PatientReq</span><span style=\"color:#E36209\"> patintReq</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        Patient patient;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> patintReq </span><span style=\"color:#D73A49\">is</span><span style=\"color:#24292E\"> PatientReqV1 {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            patient </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                dob</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> patintReq.dob,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                fullName</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> patintReq.firstName + </span><span style=\"color:#032F62\">\" \"</span><span style=\"color:#24292E\"> + patintReq.lastName,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                diagnosis</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> patintReq.diagnosis</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            };</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        } </span><span style=\"color:#D73A49\">else</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            patient </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                dob</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> patintReq.patient.dob,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                fullName</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> patintReq.patient.fullName,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                diagnosis</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> patintReq.patient.diagnosis</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            };</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> patientClient</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">patient.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">patient</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">targetType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Response);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> patient</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">Patient</span><span style=\"color:#E36209\"> patient</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> patientClient</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">patient.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">patient</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">targetType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Response);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\npublic type PatientReqV1 record {|\n    \"1.0\" version = \"1.0\";\n    string firstName;\n    string lastName;\n    string dob;\n    string diagnosis;\n|};\n\npublic type PatientReqV2 record {|\n    \"2.0\" version = \"2.0\";\n    Patient patient;\n|};\n\ntype PatientReq PatientReqV1|PatientReqV2;\n\npublic type Patient record {|\n    string fullName;\n    string dob;\n    string diagnosis;\n|};\n\nfinal http:Client patientClient = check new (\"http://api.patients.com.balmock.io\");\n\nservice /api/v1 on new http:Listener(8080) {\n\n    resource function post data/patient(PatientReq patintReq) returns error? {\n        Patient patient;\n        if patintReq is PatientReqV1 {\n            patient = {\n                dob: patintReq.dob,\n                fullName: patintReq.firstName + \" \" + patintReq.lastName,\n                diagnosis: patintReq.diagnosis\n            };\n        } else {\n            patient = {\n                dob: patintReq.patient.dob,\n                fullName: patintReq.patient.fullName,\n                diagnosis: patintReq.patient.diagnosis\n            };\n        }\n        _ = check patientClient->/patient.post(patient, targetType = http:Response);\n    }\n\n    resource function post patient(Patient patient) returns error? {\n        _ = check patientClient->/patient.post(patient, targetType = http:Response);\n    }\n}\n","name":"format-indicator.bal"}],"name":" Format Indicator"},"__N_SSG":true}