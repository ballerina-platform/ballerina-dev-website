{"pageProps":{"frontmatter":{"title":"Scan tool","description":"Learn how to perform static code analysis on Ballerina projects to identify potential code smells, bugs, and vulnerabilities.","keywords":"ballerina runtime, troubleshoot, scan, thread dump","permalink":"/learn/scan-tool/","active":"scan-tool"},"content":"\nThe Ballerina scan tool is a static code analysis tool that performs analysis on Ballerina projects and identifies\npotential code smells, bugs, and vulnerabilities without executing them.\n\n> **Note:** Ballerina scan is an experimental feature that supports only a limited set of rules.\n\n## Install the tool\n\nExecute the command below to pull the scan tool from [Ballerina Central](https://central.ballerina.io/ballerina/scan/latest).\n\n```\n$ bal tool pull scan\n```\n\nTo verify the installation and check the version:\n\n```\n$ bal tool list\n```\n\nFor more information about managing Ballerina tools, refer to the [Ballerina CLI tool command documentation](https://ballerina.io/learn/cli-commands/#tool-commands).\n\n## Command syntax\n\nThe Ballerina scan tool follows this general syntax:\n\n```\n$ bal scan [OPTIONS] [<package>|<source-file>]\n```\n\n### Arguments\n\n- `<package>`: Analyzes all Ballerina files in the specified package (optional, defaults to current directory)\n- `<source-file>`: Analyzes a specific standalone Ballerina file (`.bal` extension required)\n\n> **Important:** Analyzing individual Ballerina files that are part of a package is not allowed.\n> You must analyze the entire package or work with standalone files.\n\n### Available options\n\n| Option                         | Description                                            |\n|--------------------------------|--------------------------------------------------------|\n| `--target-dir=<path>`          | Specify target directory for analysis reports          |\n| `--scan-report`                | Generate HTML report with detailed analysis results    |\n| `--format=<ballerina\\|sarif>`  | Specify the format of the report. Default is ballerina |\n| `--list-rules`                 | Display all available analysis rules                   |\n| `--include-rules=<rule1, ...>` | Run analysis for specific rules only                   |\n| `--exclude-rules=<rule1, ...>` | Exclude specific rules from analysis                   |\n| `--platforms=<platform1, ...>` | Define platforms for result reporting                  |\n\n## Running analysis\n\nYou can analyze all Ballerina files in the current package by running the following command inside the package\ndirectory:\n\n```\n$ bal scan\n```\n\nThis command will:\n\n- Compile and analyze all `.bal` files in the current package\n- Print results to the console\n- Save results in JSON format in the `target/scan` directory\n\nIf you want to analyze a specific package, you can provide the package name as an argument:\n\n```\n$ bal scan mypackage\n```\n\nIf you want to analyze a specific standalone Ballerina file, you can provide the file name as an argument:\n\n```\n$ bal scan myfile.bal\n```\n\n## Report generation\n\nTo generate a detailed HTML report of the analysis results, use the `--scan-report` option:\n\n```\n$ bal scan --scan-report\n```\n\nThis will produce an HTML report and scan results in JSON format inside the `target/report` directory.\n\nThe HTML report includes a summary of the number of code smells, bugs, and vulnerabilities found in each file.\n\n![scan-report-summary-view](/learn/images/scan-tool-html-report-summary-view.png)\n\nTo investigate further, you can click on a file name to view a detailed breakdown of the issues.\nThis view highlights the exact lines where problems were detected, along with a description, and the severity level.\n\n![scan-report-file-view](/learn/images/scan-tool-html-report-file-view.png)\n\n## Custom target directory\n\nYou can specify a custom target directory for the analysis results using the `--target-dir` option.\nThis is useful if you want to store the results in a specific location or if you are working with multiple projects.\n\n```\n$ bal scan --target-dir=\"path/to/your/target/directory\"\n```\n\n## Report formats\n\nBy default, the scan tool generates reports in `JSON` format.\nHowever, you can specify the report format using the `--format` option.\n\nThe available formats are `ballerina` and `sarif`. The `ballerina` format is the default, while `sarif` is a\nstandardized format for static analysis results.\n\nTo generate a report in the `sarif` format, use the following command:\n\n```\n$ bal scan --format=sarif\n```\n\n## List available rules\n\nTo view all available rules for your project, you can use the `--list-rules` option:\n\n```\n$ bal scan --list-rules\n```\n\nThis will display a comprehensive list of available rules for your project, which you can include or exclude in future\nscans.\n\nThe output will look something like this:\n\n![list-rules](/learn/images/scan-tool-list-rules.png)\n\n> **Note:** The displayed rules are project-specific and determined by your project's dependencies.\n\n## Include specific rules\n\nYou can run the analysis for specific rules by using the `--include-rules` option.\nThis allows you to focus on particular areas of your codebase that you want to analyze.\n\n```\n$ bal scan --include-rules=\"ballerina:1\"\n```\n\nYou can also include multiple rules by listing them as a comma-separated string:\n\n```\n$ bal scan --include-rules=\"ballerina:1, ballerina/io:2\"\n```\n\n## Exclude specific rules\n\nYou can exclude specific rules from the analysis using the `--exclude-rules` option.\nThis is useful if you want to ignore certain rules that are not relevant to your project or if you have already\naddressed them.\n\n```\n$ bal scan --exclude-rules=\"ballerina:1\"\n```\n\nTo exclude multiple rules, provide them as a comma-separated list:\n\n```\n$ bal scan --exclude-rules=\"ballerina:1, ballerina/io:2\"\n```\n\n## Platform integration\n\nYou can report the analysis results to platforms such as SonarQube using the `--platforms` option.\n\n```\n$ bal scan --platforms=\"sonarqube\"\n```\n\nTo specify more than one platform, separate them with commas:\n\n```\n$ bal scan --platforms=\"sonarqube, semgrep, codeql\"\n```\n\n## Publish static code analysis reports to SonarQube\n\nSonarQube is a popular open-source platform for continuous inspection of code quality.\nIt provides static code analysis, code coverage,\nand other features to help developers maintain clean, maintainable codebases.\nThe Ballerina scan tool can be integrated with SonarQube to publish static code analysis reports,\nenabling seamless integration into your CI/CD pipelines.\n\nThis guide walks you through the process of configuring SonarQube and publishing Ballerina static code analysis reports.\n\n### Prerequisites\n- SonarQube 9.9 LTA Community Edition installed.\n- SonarScanner CLI 4.8.0 or later installed, and added to your system `PATH`.\n- [SonarQube Ballerina plugin](https://github.com/ballerina-platform/sonar-ballerina/packages/2580146), and [SonarQube platform plugin](https://github.com/ballerina-platform/sonar-ballerina/packages/2580149) downloaded.\n\n### Configure the SonarQube server\n\n1. Install [Java 17](https://adoptium.net/en-gb/temurin/releases/?version=17) in your machine.\n    - If Java 17 is not the default Java installation, override it.\n\n      **For Unix/macOS:**\n       ```\n       export SONAR_JAVA_PATH=\"path/to/java17_home/bin/java\"\n       ```\n\n      **For Windows:**\n       ```\n       setx SONAR_JAVA_PATH=\"path\\to\\java17_home\\bin\\java\"\n       ```\n\n2. Setup SonarQube 9.9 LTA\n    - Download SonarQube 9.9 LTA from [here](https://www.sonarsource.com/products/sonarqube/downloads/historical-downloads/).\n    - Extract the downloaded zip file.\n\n3. Add the [SonarQube Ballerina plugin](https://github.com/ballerina-platform/sonar-ballerina/packages/2580146).\n    - Download the latest Ballerina SonarQube plugin JAR.\n    - Place the JAR file into the `extensions/plugins/` directory of your SonarQube installation.\n\n4. Navigate to the appropriate `bin/<OS>/` directory and run the SonarQube server.\n   ```\n   $ ./sonar.sh start\n   ```\n\n   You can access the SonarQube dashboard at http://localhost:9000 once the server is up.\n\n5. Create a new project in SonarQube.\n    - Log in to the SonarQube dashboard.\n    - Click on `Create Project`.\n    - Follow the prompts to set up your project.\n\n6. Install and configure SonarScanner CLI.\n    - Download SonarScanner CLI from [here](https://docs.sonarsource.com/sonarqube-server/9.9/analyzing-source-code/scanners/sonarscanner/).\n    - Add it to your system `PATH`.\n    - Ensure `sonar.host.url` is set correctly (either via a properties file or CLI parameter).\n\n### Configure the Ballerina project\n\n1. Download the [SonarQube platform plugin](https://github.com/ballerina-platform/sonar-ballerina/packages/2580149).\n\n2. Create a `sonar-project.properties` file at the root of your Ballerina project with the following content.\n   ```properties\n   sonar.projectKey=<your-project-key>\n   sonar.projectName=<your-project-name>\n   ```\n\n3. Create a Scan.toml at the root of your Ballerina project. Add additional SonarQube configurations by referencing the `sonar-project.properties` file.\n   ```toml\n   [[platform]]\n   name = \"sonarqube\"\n   path = \"<path-to-sonar-platform-plugin>\"\n   sonarProjectPropertiesPath = \"<path-to-sonar-project.properties>\"\n   ```\n\n### Publish reports to SonarQube\n\n1. Link a ballerina source repo to the SonarQube server from a DevOps platform or manually.\n\n2. Authenticate using a token.\n    - Generate a token from the `My Account`->`Security` section in the SonarQube UI.\n    - Set the token as an environment variable.\n\n      **For Unix/macOS:**\n       ```\n       $ export SONAR_TOKEN=<your-token>\n       ```\n\n      **For Windows:**\n       ```\n       $ set SONAR_TOKEN=<your-token>\n       ```\n\n3. Run the scan tool to publish the reports to SonarQube.\n   ```\n   $ bal scan\n   ```\n\n### After the scan\n- Once the scan completes, navigate to your project in the SonarQube dashboard.\n- View issues, vulnerabilities, code smells, and other static analysis results directly from the SonarQube UI.\n","id":"scan-tool","sub":"static-code-analysis","third":"","slug":"static-code-analysis/scan-tool","codes":"[[169635856,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">sonar.projectKey</span><span style=\\\"color:#24292E\\\">=&#x3C;your-project-key></span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">sonar.projectName</span><span style=\\\"color:#24292E\\\">=&#x3C;your-project-name></span></span></code></pre>\"],[-1557722917,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">[[</span><span style=\\\"color:#6F42C1\\\">platform</span><span style=\\\"color:#24292E\\\">]]</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">name = </span><span style=\\\"color:#032F62\\\">\\\"sonarqube\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">path = </span><span style=\\\"color:#032F62\\\">\\\"&#x3C;path-to-sonar-platform-plugin>\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">sonarProjectPropertiesPath = </span><span style=\\\"color:#032F62\\\">\\\"&#x3C;path-to-sonar-project.properties>\\\"</span></span></code></pre>\"]]"},"__N_SSG":true}