{"pageProps":{"frontmatter":{"layout":"ballerina-persist-documentation-left-nav-pages-swanlake","title":"Bal persist overview","description":"The section gives an overview of the `bal persist` feature.","keywords":"ballerina, programming language, ballerina packages, persist, data model, cli tool, client api","permalink":"/learn/ballerina-persist/persist-overview/","active":"persist_overview","intro":"The `bal persist` feature allows you to store data in different data stores and retrieve them when needed. A data store can be a database or an in-memory cache. The `bal persist` feature currently supports in-memory tables, MySQL, MSSQL, PostgreSQL databases, Google Sheets, and Redis as data stores. As you can use the same syntax to access data in all these data stores, you do not need to learn different syntaxes to access data in different data stores."},"content":"\nThis feature has three main components: the data model, CLI tool, and type-safe client API. \n* Data model: The data model definition is used to define the data model. \n* CLI tool: The CLI tool is used to generate the client API for the data model. \n* Client API: The type-safe client API is used to access the data in the data store.\n\nThe following diagram illustrates how the `bal persist` feature works.\n\n![bal persist diagram](/learn/images/bal-persist-diagram.png \"bal persist diagram\")\n\nThe data model definition shown in the above diagram is the source of truth for the data model of your application. The data model definition is used only to generate the client API, which contains the Ballerina client class and types. It cannot be used directly in your applications.\nThe Ballerina VS Code extension facilitates the validation, development (via code actions), and visualization (in an Entity Relationship diagram) of the data model definition when creating it.\nThe created data model definition will be used to generate the client API via the `bal persist` CLI tool as a Ballerina source file. You can import this generated client API into your Ballerina source files and use it in your business logic to access the data in the data store.\n\nThe following sections describe the data model, CLI tool, and client API in detail.\n\n## Data Model\n\nThe data model is defined in a Ballerina source file inside the `persist` directory in the project root directory. The data model is defined using the Ballerina record type. The following example shows how to define a data model for a table named `Employee` with the fields `id`, `name`, `age`, and `salary`.\n\n```ballerina\ntype Employee record {\n    readonly int id;\n    string name;\n    int age;\n    float salary;\n}\n```\n\nThe `readonly` keyword is used to define a field as a primary key. You need to have at least one primary key field in the `Entity` record. The primary key field is used to uniquely identify a record in the table. The primary key field is used to generate the `get`, `update`, and `delete` operations in the client API. You can define multiple primary key fields in the `Entity` record.\n\nLearn about how to define relationships between entity records and more about data modeling in the [Data Model](/learn/persist-model/) section.\n\n> **Note:** The Ballerina VS Code plugin provides validation and code actions for the persist model. Therefore, you can easily create the Persist Model using the Ballerina VS Code plugin.\n\n## CLI tool\n\nThe `bal persist` CLI is used to generate the client API for the data model. With the integration of bal persist code generation into the bal build command, project building now automatically triggers the generation of Client APIs. Additionally, based on the data store, additional configurable files and setup scripts are also generated. For example, if you are using a relational database as the data store, the `persist_db_config.bal` file, and the `script.sql` script are generated. The `persist_db_config.bal` file is used to configure the relational database connection. The `script.sql` file is used to create the tables in the relational database. The client API is generated in the `generated` directory in the project root directory.\n\nThe `bal persist` has two built-in CLI commands: `persist init` and `persist add` to initialize `bal persist` in the Ballerina project. The `persist init` command solely establishes the persist directory and creates a data model file. Conversely, the `persist add` command not only creates the model file but also configures tools to integrate with `bal build`. If integration with `bal build` for code generation isn't desired, the `persist generate` command provides a one-time generation option.\n\nThe `bal persist` CLI tool also provides `persist pull` command, which facilitates introspection of an existing database to generate the data model. Currently, introspection is supported for MySQL, MSSQL, and PostgreSQL databases.\n\nFurthermore, there is a experimental command: `persist migrate`. The `persist migrate` generates SQL scripts to alter the table structure in the database when modifications are made to the data model.\n\nLearn more about `bal persist` CLI in the [CLI tool](/learn/persist-cli-tool/) section.\n\n## Type-safe client API\n\nThe client API is used to access the data in the data store. The client API is generated using the CLI tool, and it is located in the `generated` directory in the project root directory. The client API consists of a Ballerina client object with a resource for each entity record modeled in the Ballerina project. For each client resource, there are resource methods to perform CRUD operations on the data store.\n\nFor example, if you have an `Employee` entity record in the Ballerina project, you can perform CRUD operations on the `Employee` table in the data store using the client object as follows.\n\n```ballerina\n// Create a new `employee` record.\nEmployeeInsert employee = {id: 1, name: \"John\", age: 30, salary: 3000.0};\nint[]|error employeeId = sClient->/employees.post([employee]);\n\n// Get the `employee` record with the ID 1.\nEmployee|error employee = sClient->/employees/1;\n\n// Update the `employee` record with the ID 1.\nEmployee|error updated = sClient->/employees/1.put({salary: 4000.0});\n\n// Delete the employee record with the ID 1.\nEmployee|error deleted = sClient->/employees/1.delete();\n\n// Get records of all employees.\nstream<Employee, error?> employees = sClient->/employees;\n```\n\nLearn more about persist client APIs in the [Client API](/learn/persist-client-api/) section.\n","id":"bal-persist-overview","sub":"ballerina-persist","third":"","slug":"ballerina-persist/bal-persist-overview","codes":"[[-345316219,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">type</span><span style=\\\"color:#6F42C1\\\"> Employee</span><span style=\\\"color:#D73A49\\\"> record</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    readonly</span><span style=\\\"color:#005CC5\\\"> int</span><span style=\\\"color:#24292E\\\"> id;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">    string</span><span style=\\\"color:#24292E\\\"> name;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">    int</span><span style=\\\"color:#24292E\\\"> age;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">    float</span><span style=\\\"color:#24292E\\\"> salary;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span></code></pre>\"],[-1637738814,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Create a new `employee` record.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">EmployeeInsert employee </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> {id</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#005CC5\\\"> 1</span><span style=\\\"color:#24292E\\\">, name</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#032F62\\\"> \\\"John\\\"</span><span style=\\\"color:#24292E\\\">, age</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#005CC5\\\"> 30</span><span style=\\\"color:#24292E\\\">, salary</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#005CC5\\\"> 3000.0</span><span style=\\\"color:#24292E\\\">};</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">[]</span><span style=\\\"color:#D73A49\\\">|error</span><span style=\\\"color:#24292E\\\"> employeeId </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> sClient</span><span style=\\\"color:#D73A49\\\">->/</span><span style=\\\"color:#24292E\\\">employees.</span><span style=\\\"color:#6F42C1\\\">post</span><span style=\\\"color:#24292E\\\">([employee]);</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Get the `employee` record with the ID 1.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">Employee</span><span style=\\\"color:#D73A49\\\">|error</span><span style=\\\"color:#24292E\\\"> employee </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> sClient</span><span style=\\\"color:#D73A49\\\">->/</span><span style=\\\"color:#24292E\\\">employees</span><span style=\\\"color:#D73A49\\\">/</span><span style=\\\"color:#005CC5\\\">1</span><span style=\\\"color:#24292E\\\">;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Update the `employee` record with the ID 1.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">Employee</span><span style=\\\"color:#D73A49\\\">|error</span><span style=\\\"color:#24292E\\\"> updated </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> sClient</span><span style=\\\"color:#D73A49\\\">->/</span><span style=\\\"color:#24292E\\\">employees</span><span style=\\\"color:#D73A49\\\">/</span><span style=\\\"color:#005CC5\\\">1</span><span style=\\\"color:#24292E\\\">.</span><span style=\\\"color:#6F42C1\\\">put</span><span style=\\\"color:#24292E\\\">({salary</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#005CC5\\\"> 4000.0</span><span style=\\\"color:#24292E\\\">});</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Delete the employee record with the ID 1.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">Employee</span><span style=\\\"color:#D73A49\\\">|error</span><span style=\\\"color:#24292E\\\"> deleted </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> sClient</span><span style=\\\"color:#D73A49\\\">->/</span><span style=\\\"color:#24292E\\\">employees</span><span style=\\\"color:#D73A49\\\">/</span><span style=\\\"color:#005CC5\\\">1</span><span style=\\\"color:#24292E\\\">.</span><span style=\\\"color:#6F42C1\\\">delete</span><span style=\\\"color:#24292E\\\">();</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Get records of all employees.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">stream&#x3C;</span><span style=\\\"color:#24292E\\\">Employee, </span><span style=\\\"color:#D73A49\\\">error?></span><span style=\\\"color:#24292E\\\"> employees </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> sClient</span><span style=\\\"color:#D73A49\\\">->/</span><span style=\\\"color:#24292E\\\">employees;</span></span></code></pre>\"]]"},"__N_SSG":true}