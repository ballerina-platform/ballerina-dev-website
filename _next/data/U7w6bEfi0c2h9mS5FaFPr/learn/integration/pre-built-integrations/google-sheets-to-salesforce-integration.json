{"pageProps":{"samples":{"code":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/log;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/googleapis.sheets;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerinax/salesforce </span><span style=\"color:#D73A49\">as</span><span style=\"color:#24292E\"> sf;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> type</span><span style=\"color:#6F42C1\"> Contact</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> Id;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> Email;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">int</span><span style=\"color:#005CC5\"> HEADINGS_ROW</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#005CC5\"> 1</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Google sheets configuration parameters</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> spreadsheetId </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> worksheetName </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> duplicateWorksheetName </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> sheetsAccessToken </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Salesforce configuration parameters</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> salesforceAccessToken </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">configurable</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#24292E\"> salesforceBaseUrl </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> ?</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#24292E\">sheets</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client sheets </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> ({auth</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {token: sheetsAccessToken}});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#24292E\">sf</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client salesforce </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    baseUrl</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> salesforceBaseUrl,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    auth</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        token</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> salesforceAccessToken</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">public</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> main</span><span style=\"color:#24292E\">() </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    sheets</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Range range </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> sheets</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">getRange</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">spreadsheetId</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">worksheetName</span><span style=\"color:#24292E\">, </span><span style=\"color:#032F62\">\"A1:G\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    (</span><span style=\"color:#005CC5\">int</span><span style=\"color:#D73A49\">|</span><span style=\"color:#005CC5\">string</span><span style=\"color:#D73A49\">|</span><span style=\"color:#005CC5\">decimal</span><span style=\"color:#24292E\">)[] headers </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> range.values[</span><span style=\"color:#005CC5\">0</span><span style=\"color:#24292E\">];</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    foreach </span><span style=\"color:#24292E\">(</span><span style=\"color:#005CC5\">int</span><span style=\"color:#D73A49\">|</span><span style=\"color:#005CC5\">string</span><span style=\"color:#D73A49\">|</span><span style=\"color:#005CC5\">decimal</span><span style=\"color:#24292E\">)[] item </span><span style=\"color:#D73A49\">in</span><span style=\"color:#24292E\"> range.values.</span><span style=\"color:#6F42C1\">slice</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">HEADINGS_ROW</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        int</span><span style=\"color:#24292E\">? indexOfEmail </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> headers.</span><span style=\"color:#6F42C1\">indexOf</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Email\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> indexOfEmail </span><span style=\"color:#D73A49\">is</span><span style=\"color:#24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            return</span><span style=\"color:#D73A49\"> error</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Email column not found\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        stream&#x3C;</span><span style=\"color:#24292E\">Contact, </span><span style=\"color:#D73A49\">error?></span><span style=\"color:#24292E\"> retrievedStream </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> salesforce</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">query</span><span style=\"color:#24292E\">(</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">            string</span><span style=\"color:#032F62\"> `SELECT Id, Email FROM Contact WHERE Email='${</span><span style=\"color:#24292E\">item</span><span style=\"color:#032F62\">[</span><span style=\"color:#24292E\">indexOfEmail</span><span style=\"color:#032F62\">]</span><span style=\"color:#032F62\">}'`</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> retrievedStream.</span><span style=\"color:#6F42C1\">next</span><span style=\"color:#24292E\">() </span><span style=\"color:#D73A49\">!is</span><span style=\"color:#24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            log</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">printInfo</span><span style=\"color:#24292E\">(</span><span style=\"color:#005CC5\">string</span><span style=\"color:#032F62\"> `Contact already exists. Email : ${</span><span style=\"color:#24292E\">item</span><span style=\"color:#032F62\">[</span><span style=\"color:#24292E\">indexOfEmail</span><span style=\"color:#032F62\">]</span><span style=\"color:#032F62\">}`</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> sheets</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">appendValue</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">spreadsheetId</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">item</span><span style=\"color:#24292E\">, {sheetName</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> duplicateWorksheetName});</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            continue</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        record</span><span style=\"color:#24292E\"> {} newContact </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> map</span><span style=\"color:#D73A49\"> from</span><span style=\"color:#005CC5\"> int</span><span style=\"color:#24292E\"> index </span><span style=\"color:#D73A49\">in</span><span style=\"color:#005CC5\"> 0</span><span style=\"color:#24292E\"> ..</span><span style=\"color:#D73A49\">&#x3C;</span><span style=\"color:#24292E\"> headers.</span><span style=\"color:#6F42C1\">length</span><span style=\"color:#24292E\">()</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            let</span><span style=\"color:#005CC5\"> int</span><span style=\"color:#D73A49\">|</span><span style=\"color:#005CC5\">string</span><span style=\"color:#D73A49\">|</span><span style=\"color:#005CC5\">decimal</span><span style=\"color:#24292E\"> header </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> headers[index]</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            select</span><span style=\"color:#24292E\"> [header.</span><span style=\"color:#6F42C1\">toString</span><span style=\"color:#24292E\">(), item[index]];</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> salesforce</span><span style=\"color:#D73A49\">-></span><span style=\"color:#6F42C1\">create</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"Contact\"</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">newContact</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        log</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">printInfo</span><span style=\"color:#24292E\">(</span><span style=\"color:#005CC5\">string</span><span style=\"color:#032F62\"> `Contact created successfully!. Email : ${</span><span style=\"color:#24292E\">item</span><span style=\"color:#032F62\">[</span><span style=\"color:#24292E\">indexOfEmail</span><span style=\"color:#032F62\">]</span><span style=\"color:#032F62\">}`</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span></code></pre>"},"content":"\nimport ballerina/log;\nimport ballerinax/googleapis.sheets;\nimport ballerinax/salesforce as sf;\n\npublic type Contact record {|\n    string Id;\n    string Email;\n|};\n\nconst int HEADINGS_ROW = 1;\n\n// Google sheets configuration parameters\nconfigurable string spreadsheetId = ?;\nconfigurable string worksheetName = ?;\nconfigurable string duplicateWorksheetName = ?;\nconfigurable string sheetsAccessToken = ?;\n\n// Salesforce configuration parameters\nconfigurable string salesforceAccessToken = ?;\nconfigurable string salesforceBaseUrl = ?;\n\nsheets:Client sheets = check new ({auth: {token: sheetsAccessToken}});\n\nsf:Client salesforce = check new ({\n    baseUrl: salesforceBaseUrl,\n    auth: {\n        token: salesforceAccessToken\n    }\n});\n\npublic function main() returns error? {\n    sheets:Range range = check sheets->getRange(spreadsheetId, worksheetName, \"A1:G\");\n    (int|string|decimal)[] headers = range.values[0];\n    foreach (int|string|decimal)[] item in range.values.slice(HEADINGS_ROW) {\n        int? indexOfEmail = headers.indexOf(\"Email\");\n        if indexOfEmail is () {\n            return error(\"Email column not found\");\n        }\n        stream<Contact, error?> retrievedStream = check salesforce->query(\n            string `SELECT Id, Email FROM Contact WHERE Email='${item[indexOfEmail]}'`);\n        if retrievedStream.next() !is () {\n            log:printInfo(string `Contact already exists. Email : ${item[indexOfEmail]}`);\n            _ = check sheets->appendValue(spreadsheetId, item, {sheetName: duplicateWorksheetName});\n            continue;\n        }\n        record {} newContact = map from int index in 0 ..< headers.length()\n            let int|string|decimal header = headers[index]\n            select [header.toString(), item[index]];\n        _ = check salesforce->create(\"Contact\", newContact);\n        log:printInfo(string `Contact created successfully!. Email : ${item[indexOfEmail]}`);\n    }\n}\n\n"},"__N_SSG":true}