{"pageProps":{"frontmatter":{},"content":" # Specification: Ballerina SQL Library\n\n_Owners_: @daneshk @niveathika  \n_Reviewers_: @daneshk  \n_Created_: 2022/01/13   \n_Updated_: 2022/07/07  \n_Edition_: Swan Lake  \n\n## Introduction\n\nThis is the specification for the SQL standard library of [Ballerina language](https://ballerina.io/), which provides the generic interface and functionality to interact with a SQL database.  \n\nThe SQL library specification has evolved and may continue to evolve in the future. The released versions of the specification can be found under the relevant GitHub tag. \n\nIf you have any feedback or suggestions about the library, start a discussion via a [GitHub issue](https://github.com/ballerina-platform/ballerina-standard-library/issues) or in the [Slack channel](https://ballerina.io/community/). Based on the outcome of the discussion, the specification and implementation can be updated. Community feedback is always welcome. Any accepted proposal, which affects the specification is stored under `/docs/proposals`. Proposals under discussion can be found with the label `type/proposal` in GitHub.\n\nThe conforming implementation of the specification is released and included in the distribution. Any deviation from the specification is considered a bug.\n\n## Contents\n\n1. [Overview](#1-overview)  \n2. [Client](#2-client)  \n   2.1. [Handle connection pools](#21-handle-connection-pools)  \n   2.2. [Closing the Client](#22-close-the-client)\n3. [Queries and Values](#3-queries-and-values)  \n   3.1. [ParameterizedQuery and Values](#31-parameterizedquery-and-values)  \n   3.2. [ParameterizedCallQuery and Parameters](#32-parameterizedcallquery-and-parameters)  \n   3.3. [Query concatenation](#33-query-concatenation)  \n4. [Database operations](#4-database-operations)  \n   4.1. [Query](#41-query)  \n   4.2. [Query row](#42-query-row)  \n   4.3. [Execute](#43-execute)  \n   4.4. [Batch execute](#44-batch-execute)  \n   4.5. [Call](#45-call)  \n5. [Metadata operations](#5-metadata-operations)  \n   5.1. [Schema client](#51-schema-client)  \n   5.2. [Metadata types](#52-metadata-types)  \n   5.3. [Metadata methods](#53-metadata-methods)  \n6. [Errors](#6-errors)\n\n# 1. Overview\n\nThis specification elaborates on the generic `Client` interface used in ballerina SQL connectors\nto interface with a relational database such as MySQL, MSSQL, Postgresql and OracleDB. \n\n`Client` supports five database operations as follows,\n1. Executes the query, which may return multiple results.\n2. Executes the query, which is expected to return at most one row of the result.\n3. Executes the SQL query. Only the metadata of the execution is returned.\n4. Executes the SQL query with multiple sets of parameters in a batch. Only the metadata of the execution is returned.\n5. Executes a SQL query, which calls a stored procedure. This can either return results or nil.\n\nAll the above operations make use of `ParameterizedQuery` object, backtick surrounded string template to pass \nSQL statements to the database. `ParameterizedQuery` supports passing of Ballerina basic types or Typed SQL Values such \nas `CharValue`, `BigIntValue`, etc. to indicate parameter types in SQL statements. \n\n# 2. Client\n\nEach client represents a pool of connections to the database. The pool of connections is maintained throughout the \nlifetime of the client.\n\n## 2.1. Handle connection pools\n\n**Configuration available for tweaking the connection pool properties:**\n\n   ```ballerina\n   # The properties, which are used to configure a DB connection pool.\n   # Default values of the fields can be set through the configuration API.\n   #\n   # + maxOpenConnections - The maximum number of open connections that the pool is allowed to have.\n   #                        Includes both idle and in-use connections. The default value is 15. This can be changed through\n   #                        the configuration API with the `ballerina.sql.maxOpenConnections` key\n   # + maxConnectionLifeTime - The maximum lifetime (in seconds) of a connection in the pool. The default value is 1800\n   #                           seconds (30 minutes). This can be changed through the configuration API with the\n   #                           `ballerina.sql.maxConnectionLifeTime` key. A value of 0 indicates an unlimited maximum\n   #                           lifetime (infinite lifetime)\n   # + minIdleConnections - The minimum number of idle connections that the pool tries to maintain. The default\n   #                        value is the same as `maxOpenConnections` and it can be changed through the configuration\n   #                        API with the `ballerina.sql.minIdleConnections` key\n   public type ConnectionPool record {|\n       int maxOpenConnections = maxOpenConnections;\n       decimal maxConnectionLifeTime = maxConnectionLifeTime;\n       int minIdleConnections = minIdleConnections;\n   |};\n   ```\n\nThere are three possible scenarios for connection pool handling,\n1. Global, shareable, default connection pool\n\n   If the `poolOptions` field is **NOT** provided when creating the database client, a globally-shareable pool will be\n   created for the database connection unless a connection pool matching with the properties provided already exists.\n   The JDBC module sample below shows how the global connection pool is used.\n\n    ```ballerina\n    jdbc:Client|sql:Error dbClient = new (\"jdbc:mysql://localhost:3306/testdb\", \"root\", \"root\");\n    ```\n\n2. Client-owned, un-sharable connection pool\n\n   If the `connectionPool` field is defined inline when creating the database client with the `sql:ConnectionPool` type,\n   an un-sharable connection pool will be created. The JDBC module sample below shows how the global\n   connection pool is used.\n\n    ```ballerina\n    jdbc:Client|sql:Error dbClient =  new (url = \"jdbc:mysql://localhost:3306/testdb\",\n                                                connectionPool = { maxOpenConnections: 5 });\n    ```\n\n3. Local, shareable connection pool\n\n   If a record of the `sql:ConnectionPool` type is created and reused in the configuration of multiple clients,\n   for each set of clients that connects to the same database instance with the same set of properties, a shared\n   connection pool will be created. The JDBC module sample below shows how the global connection pool is used.\n\n    ```ballerina\n    sql:ConnectionPool connPool = { maxOpenConnections: 5 };\n    \n    jdbc:Client|sql:Error dbClient1 = new (url = \"jdbc:mysql://localhost:3306/testdb\", connectionPool = connPool);\n    jdbc:Client|sql:Error dbClient2 = new (url = \"jdbc:mysql://localhost:3306/testdb\", connectionPool = connPool);\n    jdbc:Client|sql:Error dbClient3 = new (url = \"jdbc:mysql://localhost:3306/testdb\", connectionPool = connPool);\n    ```\n\n## 2.2. Close the client\n\nOnce all the database operations are performed, the client can be closed by invoking the `close()`\noperation. This will close the corresponding connection pool if it is not shared by any other database clients.\n\n   ```ballerina\n    # Closes the SQL client and shuts down the connection pool.\n    #\n    # + return - Possible error when closing the client\n    public isolated function close() returns Error?;\n   ```\n\n# 3. Queries and values\n\n## 3.1. `ParameterizedQuery` and values\n\nThe `sql:ParameterizedQuery` is used to construct the SQL query to be executed by the client. It is backtick string \ntemplate which allows dynamic values for query parameters.\n\n*Query with constant values*\n\n```ballerina\nsql:ParameterizedQuery query = `SELECT * FROM students WHERE id < 10 AND age > 12`;\n```\n\n*Query with dynamic values*\n\n```ballerina\nint[] ids = [10, 50];\nint age = 12;\nsql:ParameterizedQuery query = `SELECT * FROM students WHERE id < ${ids[0]} AND age > ${age}`;\n```\n\nAll primitive Ballerina types are supported for parameter values in `sql:ParameterizedQuery`. Following mapping is used to map ballerina types to SQL types,\n\n| Ballerina type | SQL type |\n|:--------------:|:--------:|\n|     String     | VARCHAR  |\n|      int       | INTEGER  |\n|    boolean     | BOOLEAN  |\n|     float      |   REAL   |\n|    decimal     | DECIMAL  |\n|     byte[]     |  BINARY  |\n|      xml       |  SQLXML  |\n|   record {}    |  STRUCT  |\n|     Array      |  ARRAY   |\n\nIn addition to the above `time` module constructs are used to represent SQL Time data types.\n\n| `time` constructs | SQL type  |\n|:-----------------:|:---------:|\n|     time:Date     |   DATE    |\n|  time:TimeOfDay   |   TIME    |\n|    time:Civil     | DATETIME  |\n|     time:Utc      | TIMESTAMP |\n\nFurthermore, typed values are used to map values to a specific SQL data type such as `BIGINT`,\n   ```ballerina\n      BigIntValue value = new(1000000000000);\n      sql:ParameterizedQuery query = `SELECT * FROM students WHERE id < ${value}`;\n   ```\n\nList of typed values:\n\n1. VarcharValue\n2. NVarcharValue\n3. CharValue\n4. NCharValue\n5. TextValue \n6. ClobValue\n7. NClobValue\n8. SmallIntValue\n9. IntegerValue\n10. BigIntValue\n11. NumericValue \n12. DecimalValue\n13. RealValue\n14. FloatValue\n15. DoubleValue \n16. BitValue\n17. BooleanValue\n18. BinaryValue\n19. VarBinaryValue\n20. BlobValue\n21. DateValue\n22. TimeValue\n23. DateTimeValue\n24. TimestampValue \n25. RefValue \n26. StructValue \n27. RowValue\n\n## 3.2. `ParameterizedCallQuery` and parameters\n\nThe `sql:ParameterizedCallQuery` is used to construct the SQL CALL Statement to be executed by the client. It is backtick string\ntemplate which allows dynamic values for query parameters. In addition to Values supported by `sql:ParameterizedQuery`, \n`sql:ParameterizedCallQuery` supports following SQL Parameters,\n\n1. InOutParameter\n2. Typed OutParameters\n\nThese types can be used to retrieve values from SQL stored procedures using the `get()` method.\n\n   ```ballerina\n   # Parses returned Char SQL value to a ballerina value.\n   #\n   # + typeDesc - The `typedesc` of the type to which the result needs to be returned\n   # + return - The result in the `typeDesc` type, or an `sql:Error`\n   public isolated function get(typedesc<anydata> typeDesc = <>) returns typeDesc|Error;\n   ```\n\n   ```ballerina\n   InOutParameter parameter = new (\"varchar value\");\n   \n   // Execute the DB call method\n   \n   string procedureParam = parameter.get();\n   ```\n   Type of the returned value is inferred from LHS of the expression.\n\n## 3.3. Query concatenation\n\n`sql:ParameterizedQuery` can be concatenated using util methods such as `sql:queryConcat()` and \n`sql:arrayFlattenQuery()` which makes it easier to create a dynamic/constant complex query.\n\nThe `sql:queryConcat()` is used to create a parameterized query by concatenating a set of parameterized queries.\n\n```ballerina\nint id = 10;\nint age = 12;\nsql:ParameterizedQuery query = `SELECT * FROM students`;\nsql:ParameterizedQuery query1 = ` WHERE id < ${id} AND age > ${age}`;\nsql:ParameterizedQuery sqlQuery = sql:queryConcat(query, query1);\n```\n\nThe query with the `IN` operator can be created using the `sql:ParameterizedQuery()`. Here the values in the array are\nflattened with a comma separator to add it in the query.\n\n```ballerina\nint[] ids = [1, 2, 3];\nsql:ParameterizedQuery query = `SELECT count(*) as total FROM DataTable \n                                WHERE row_id in (${ids[0]}, ${ids[1]}, ${ids[2]})`;\n```\n\nThe util function `sql:arrayFlattenQuery()` can be used to make the array flatten easier. It makes the inclusion of \nvarying array elements into the query easier by flattening the array to return a parameterized query.\n\n```ballerina\nint[] ids = [1, 2];\nsql:ParameterizedQuery sqlQuery = sql:queryConcat(`SELECT * FROM DataTable WHERE id IN (`, \n                                          sql:arrayFlattenQuery(ids), `)`);\n```\n\n# 4. Database operations\n\nThe client supports five remote methods, each for one Database operation\n\n## 4.1. Query\n\n`query()` remote method execute the SQL query and returns multiple results.\n\n```ballerina\n# Executes the query, which may return multiple results.\n#\n# + sqlQuery - The SQL query\n# + rowType - The `typedesc` of the record to which the result needs to be returned\n# + return - Stream of records in the `rowType` type\nremote isolated function query(ParameterizedQuery sqlQuery, typedesc<record {}> rowType = <>) \n                        returns stream <rowType, Error?>;\n```\n\nHere the returned stream can consist of following types of records,\n1. Open record  \n   The property name in the open record type will be the same as how the column is defined in the database.\n   ```ballerina\n   sql:ParameterizedQuery query = `SELECT * FROM students WHERE id < ${id} AND age > ${age}`;\n   stream<record {}, sql:Error?> resultStream = dbClient->query(query);\n   ```\n   \n2. Typed record  \n   A ballerina record type is created to represent the returned result set. the `SELECT` query is executed\n   via the `query` remote function of the client. Once the query is executed, each data record can be retrieved by looping\n   the result set. The `stream` returned by the select operation holds a pointer to the actual data in the database, and it\n   loads data from the table only when it is accessed. This stream can be iterated only once.\n\n   This record can be defined as an open or a closed record according to the requirement. If an open record is defined, \n   the returned stream type will include both defined fields in the record and additional database columns fetched by \n   the SQL query that are not defined in the record. Additional column names added to the returned record as in the \n   SQL query. If the record is defined as a close record, only defined fields in the record are returned or gives \n   an error when additional columns present in the SQL query.\n\n   Note the mapping of the database column to the returned record's property is case-insensitive if it is defined in the\n   record(i.e., the `ID` column in the result can be mapped to the `id` property in the record).\n   \n   ```ballerina\n   type Student record {\n       int id;\n       int age;\n       string name;\n   };\n   \n   int id = 10;\n   int age = 12;\n   sql:ParameterizedQuery query = `SELECT * FROM students WHERE id < ${id} AND age > ${age}`;\n   stream<Student, sql:Error?> resultStream = dbClient->query(query);\n   ```\n   \n   `sql:Column` annotation can be used to map database columns to record fields of different name. This annotation should be attached to record fields.\n   ```ballerina\n   type Student record {\n       int id;\n       @sql:Column { name: \"first_name\" }\n       string firstName;\n       @sql:Column { name: \"last_name\" }\n       string lastName\n   };\n   ```\n   The above annotation will map the database column `first_name` to the Ballerina record field `firstName`. If the `query()` function does not return `first_name` column, the field will not be populated.\n\n   Multiple table columns can be matched to a single Ballerina record within a returned record. For instance if the query returns data from multiple tables as follows,\n   ![schema](../proposals/resources/schema1.png)\n   Both `TEACHERS.id` and `TEACHERS.name` can be grouped to another Typed record such as `Teacher` type.\n\n   ```ballerina\n   public type Students record {|\n       int id;\n       string name;\n       string? age;\n       float? gpa;\n       Teachers teachers;\n   |}\n   type Teachers record {|\n       int id;\n       string name;\n   |}\n   ```\n   In the above scenario also, `sql:Column` annotation can be used to rename field name such as,\n   ```ballerina\n   public type Students record {|\n       int id;\n       string name;\n       string? age;\n       float? gpa;\n       @sql:Column { name: \"teachers\" }\n       Teacher teacher;\n   |}\n   ```\n\nThe returned stream needs to be closed properly to release resources. The stream is automatically closed if either it\nis iterated fully or consists of an error. If result is accessed one by one using `next()` method, it should be closed \nafter the required results are accessed.\n```ballerina\n# Releases the associated resources such as the database connection, results, etc.\n#\n# + return - An `sql:Error` if any error occurred while cleanup\npublic isolated function close() returns Error?;\n```\n\nUsage:\n```ballerina\ncheck resultStream.close();\n```\n\n## 4.2. Query row\n\n`queryRow()` remote method executes the SQL query return at most one row of the result.\n```ballerina\n# Executes the query, which is expected to return at most one row of the result.\n# If the query does not return any results, `sql:NoRowsError` is returned.\n#\n# + sqlQuery - The SQL query\n# + returnType - The `typedesc` of the record to which the result needs to be returned.\n#                It can be a basic type if the query result contains only one column\n# + return - Result in the `returnType` type or an `sql:Error`\nremote isolated function queryRow(ParameterizedQuery sqlQuery, typedesc<anydata> returnType = <>)\n                                            returns returnType|Error;\n```\n\nThe provided return type(inferred from LHS) can be of 2 types,\n1. Ballerina record\n   Returns only the first row retrieved by the query as a record.\n   \n   ```ballerina\n   int id = 10;\n   sql:ParameterizedQuery query = `SELECT * FROM students WHERE id = ${id}`;\n   Student retrievedStudent = check dbClient->queryRow(query);\n   ```\n2. Ballerina primitive type\n   Return the value of the first column of the first row retrieved by the query.\n   \n   ```ballerina\n   int age = 12;\n   sql:ParameterizedQuery query = `SELECT COUNT(*) FROM students WHERE age < ${age}`;\n   int youngStudents = check dbClient->queryRow(query);\n   ```\n\n`sql:NoRowsError` is returned if the query does not return at most of one result.\n\n## 4.3. Execute\n\n`execute()` remote method executes the SQL query return metadata of the execution.\n```ballerina\n# Executes the SQL query. Only the metadata of the execution is returned (not the results from the query).\n#\n# + sqlQuery - The SQL query\n# + return - Metadata of the query execution as an `sql:ExecutionResult` or an `sql:Error`\nremote isolated function execute(ParameterizedQuery sqlQuery) returns ExecutionResult|Error;\n```\n\nThe metadata is returned as `sql:ExecutionResult` record,\n```ballerina\n# Metadata of the query execution.\n#\n# + affectedRowCount - Number of rows affected by the execution of the query. It may be one of the following,  \n#                      (1) A number greater than or equal to zero, the count of affected rows after the successful \n#                          execution of the query  \n#                      (2) A value of the `SUCCESS_NO_INFO`, the count of affected rows is unknown after the successful \n#                          execution of the query  \n#                      (3) A value of the `EXECUTION_FAILED`, the query execution failed\n# + lastInsertId - The ID generated by the database in response to a query execution. This can be `()` in case \n#                  the database does not support this feature\npublic type ExecutionResult record {\n    int? affectedRowCount;\n    string|int? lastInsertId;\n};\n```\n\nThis sample demonstrates modifying data by executing an `UPDATE` statement via the `execute` remote function of\nthe client.\n\n```ballerina\nint age = 23;\nsql:ParameterizedQuery query = `UPDATE students SET name = 'John' WHERE age = ${age}`;\nsql:ExecutionResult result = check dbClient->execute(query);\n```\n\n\n## 4.4. Batch execute\n\n`batchExecute()` remote method executes the SQL query with multiple sets of parameters in a batch.\n```ballerina\n# Executes the SQL query with multiple sets of parameters in a batch. Only the metadata of the execution is returned\n# (not the results from the query).\n# If one of the commands in the batch fails, an `sql:BatchExecuteError` will be returned. However, the driver may\n# or may not continue to process the remaining commands in the batch after a failure.\n#\n# + sqlQueries - The SQL query with multiple sets of parameters\n# + return - Metadata of the query execution as an `sql:ExecutionResult[]` or an `sql:Error`\nremote isolated function batchExecute(ParameterizedQuery[] sqlQueries) returns ExecutionResult[]|Error;\n```\n\nThis sample demonstrates how to insert multiple records with a single `INSERT` statement that is executed via the\n`batchExecute` remote function of the client. This is done by creating a `table` with multiple records and\nparameterized SQL query as same as the above `execute` operations.\n\n```ballerina\nvar data = [\n  { name: \"John\", age: 25  },\n  { name: \"Peter\", age: 24 },\n  { name: \"jane\", age: 22 }\n];\n\nsql:ParameterizedQuery[] batch = from var row in data\n                                 select `INSERT INTO students ('name', 'age')\n                                           VALUES (${row.name}, ${row.age})`;\nsql:ExecutionResult[] result = check dbClient->batchExecute(batch);\n```\n\n## 4.5. Call\n\n`call()` remote method executes a SQL query, which calls a stored procedure. This can either return results or nil.\n```ballerina\n# Executes an SQL query, which calls a stored procedure. This may or may not return results.\n#\n# + sqlQuery - The SQL query\n# + rowTypes - `typedesc` array of the records to which the results need to be returned\n# + return - Summary of the execution and results are returned in an `sql:ProcedureCallResult`, or an `sql:Error`\nremote isolated function call(ParameterizedCallQuery sqlQuery, typedesc<record {}>[] rowTypes = [])\nreturns ProcedureCallResult|Error;\n```\n\nThe returned results are returned as of type `sql:ProcedureCallResult`,\n```ballerina\n# Represents the results from the `call` method holding the returned results or metadata of the query execution.\n#\n# + executionResult - Summary of the query execution\n# + queryResult - Results from the SQL query\n# + customResultIterator - Any custom result iterator to be used to override the default behaviour\npublic class ProcedureCallResult {\n    public ExecutionResult? executionResult = ();\n    public stream<record {}, Error?>? queryResult = ();\n    public CustomResultIterator? customResultIterator;\n\n    public isolated function init(CustomResultIterator? customResultIterator = ());\n\n    # Updates `executionResult` or `queryResult` field with the succeeding result in the result list. \n    # This will also close the current result when called.\n    #\n    # + return - True if the next result is `queryResult`\n    public isolated function getNextQueryResult() returns boolean|Error;\n\n    # Releases the associated resources such as the database connection, results, etc.\n    #\n    # + return - An `sql:Error` if any error occurred while cleanup\n    public isolated function close();\n}\n```\n\nHere `getNextQueryResult()` can be used to update the pointer to iterate through the returned result sets.\n\nThis sample demonstrates how to execute a stored procedure with a single `INSERT` statement that is executed via the\n`call` remote function of the client.\n\n```ballerina\nint uid = 10;\nsql:IntegerOutParameter insertId = new;\n\nsql:ProcedureCallResult result = \n                         check dbClient->call(`call InsertPerson(${uid}, ${insertId})`);\nstream<record{}, sql:Error?>? resultStr = result.queryResult;\nif resultStr is stream<record{}, sql:Error?> {\n    check from record{} value in resultStr\n        do {\n          // Can perform operations using the record 'result'.\n        };\n}\ncheck result.close();\n```\nThe close operation needs to be explicitly invoked on the `sql:ProcedureCallResult` to release the connection resources \nand avoid a connection leak as shown above.\n\n# 5. Metadata operations\n\n## 5.1. Schema client\nThe `SchemaClient` is used to query the database to retrieve the relevant metadata. On initialization,\nthe user would have to provide credentials to access the relevant metadata tables. It is also required to provide the name\nof the database regarding which the metadata should be retrieved.\n\n```ballerina\nisolated client class MockSchemaClient {\n    *SchemaClient;\n\n    public function init(string host, int port, string user, string password, string database) returns Error? {\n        self.database = database;\n        self.dbClient = check new(url, user, password);\n    }\n}\n```\n\nThis client will be extended by each SQL connector to customize the implementation as necessary.\n\n## 5.2. Metadata types\nNew record-types would be introduced to represent the metadata which may be retrieved.\n- `TableDefinition`\n- `ColumnDefinition`\n- `CheckConstraintDefinition`\n- `ReferentialConstraintDefinition`\n- `RoutineDefinition`\n- `ParameterDefinition`\n\nThese record types contain only fields which are common to relational databases. However, they may be inherited and then\nextended by each SQL connector to provide support for additional database-specific fields.\n\n### Table definition\n```ballerina\n# Represents a table in the database.\n#\n# + name - The name of the table\n# + 'type - Whether the table is a base table or a view\n# + columns - The columns included in the table\npublic type TableDefinition record {\n    string name;\n    TableType 'type;\n    ColumnDefinition[] columns?;\n};\n```\n\nThe `columns` field is optional as there are use cases where the user would not want to retrieve information regarding\nthe columns of a table.\n\nThe `TableType` type is an enum, which can take one of two values:\n- `BASE_TABLE`\n- `VIEW`\n\n### Column definition\n```ballerina\n# Represents a column in a table.\n#\n# + name - The name of the column  \n# + 'type - The SQL data-type associated with the column\n# + defaultValue - The default value of the column  \n# + nullable - Whether the column is nullable  \n# + referentialConstraints - Referential constraints (foreign key relationships) associated with the column\n# + checkConstraints - Check constraints associated with the column\npublic type ColumnDefinition record {\n    string name;\n    string 'type;\n    anydata? defaultValue;\n    boolean nullable;\n    ReferentialConstraint[] referentialConstraints?;\n    CheckConstraint[] checkConstraints?;\n};\n```\n\nThe `referentialConstraints` and `checkConstraints` fields are optional as there may be use cases where the user does not\nwant to retrieve this information.\n\n### Referential constraint\n```ballerina\n# Represents a referential constraint (foriegn key constraint).\n# \n# + name - The name of the constraint\n# + tableName - The name of the table which contains the referenced column\n# + columnName - The name of the referenced column\n# + updateRule - The action taken when an update statement violates the constraint\n# + deleteRule - The action taken when a delete statement violates the constraint\npublic type ReferentialConstraint record {\n    string name;\n    string tableName;\n    string columnName;\n    ReferentialRule updateRule;\n    ReferentialRule deleteRule; \n};\n```\n\nThe `ReferentialRule` type is an enum with four possible values:\n- `NO_ACTION`\n- `RESTRICT`\n- `CASCADE`\n- `SET_NULL`\n- `SET_DEFAULT`\n\n### Check constraint\n```ballerina\n# Represents a check constraint.\n# \n# + name - The name of the constraint\n# + clause - The actual text of the SQL definition statement\npublic type CheckConstraint record {\n    string name;\n    string clause;\n};\n```\n\n### Routine definition\n```ballerina\n# Represents a routine.\n# \n# + name - The name of the routine\n# + 'type - The type of the routine (procedure or function)\n# + returnType - If the routine returns a value, the return data-type. Else ()\n# + parameters - The parameters associated with the routine\npublic type RoutineDefinition record {\n    string name;\n    RoutineType 'type;\n    string? returnType;\n    ParameterDefinition[] parameters;\n};\n```\n\nThe `RoutineType` type is an enum which can take one of two values\n- `PROCEDURE`\n- `FUNCTION`\n\n### Parameter definition\n```ballerina\n# Represents a routine parameter.\n# \n# + mode - The mode of the parameter (IN, OUT, INOUT)\n# + name - The name of the parameter\n# + type - The data-type of the parameter\npublic type ParameterDefinition record {\n    ParameterMode mode;\n    string name;\n    string type;\n};\n```\n\nThe `ParameterMode` type is an enum which can take one of three values\n- `IN`\n- `OUT`\n- `INOUT`\n\n## 5.3. Metadata methods\nThe `SchemaClient` contains six methods which may be used to retrieve metadata.\n- `listTables()`\n- `getTableInfo()`\n- `listRoutines()`\n- `getRoutineInfo()`\n\nAll of these methods will be implemented by each SQL connector.\n\n### Retrieve all tables\n```ballerina\nremote isolated function listTables() returns string[]|Error;\n```\nThis would fetch the names of all the tables in the database.\n\n### Retrieve a single table\n```ballerina\nremote isolated function getTableInfo(string tableName, ColumnRetrievalOptions include = COLUMNS_ONLY) returns TableDefinition|Error;\n\npublic enum ColumnRetrievalOptions {\n    NO_COLUMNS,\n    COLUMNS_ONLY,\n    COLUMNS_WITH_CONSTRAINTS\n}\n```\nThis would fetch all relevant information from a given table from the database. Based on the option provided for the `include` parameter, relevant column information would also be retrieved.\n\n### Retrieve all routines\n```ballerina\nremote isolated function listRoutines() returns string[]|Error;\n```\nThis would fetch the names of all the routines created in the database.\n\n### Retrieve a single routine\n```ballerina\nremote isolated function getRoutineInfo(string name) returns RoutineDefinition|Error;\n```\nThis would fetch all relevant information regarding the provided routine (including the parameter data).\n\n# 6. Errors\n\n`sql` package consists of following Errors,\n```bash\n.\n└── Error                            # Generic error type for the `sql` module. \n    ├── DatabaseError                # Error caused by an issue related to database accessibility, erroneous queries, etc\n    ├── BatchExecuteError            # Error that occurs during the execution of batch queries.\n    ├── NoRowsError                  # Error when a query retrieves does not retrieve any rows when at least one row is expected.\n    └── ApplicationError             # Error originating from application-level configurations.\n        └── DataError                # Error during the processing of the parameters or returned results.\n            ├── TypeMismatchError    # Error when a query retrieves a result that differs from the supported result type.\n            ├── ConversionError      # Error when result is corrupted and cannot be casted to expected result type.\n            ├── FieldMismatchError   # Error when a query retrieves a result that cannot be mapped to the expected record type.\n            └── UnsupportedTypeError # Error that occurs when an unsupported parameter type is added to the query.\n```\n\nAll errors include detailed error message.\n\nInclude error details along with this `sql:DatabaseError` as follows.\n```ballerina\n# Represents the properties belonging to an `sql:DatabaseError`.\n#\n# + errorCode - SQL error code\n# + sqlState - SQL state\npublic type DatabaseErrorDetail record {\n    int errorCode;\n    string? sqlState;\n};\n```\n\n`sql:BatchExecuteError` includes detail of the metadata of the executed queries before the error occurred.\n```ballerina\n# Represents the properties belonging to an `sql:BatchExecuteError`.\n#\n# + errorCode - SQL error code\n# + sqlState - SQL state\n# + executionResults - Metadata of the query executions\npublic type BatchExecuteErrorDetail record {\n    int errorCode;\n    string? sqlState;\n    ExecutionResult[] executionResults;\n};\n```\n"},"__N_SSG":true}