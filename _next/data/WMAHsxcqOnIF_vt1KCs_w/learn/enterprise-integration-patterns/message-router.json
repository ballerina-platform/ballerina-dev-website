{"pageProps":{"tagline":"Route messages to different output channels","desc":"Message router consumes a message from one channel and republishes it to a different channel depending on a set of conditions.","category":"Messaging Systems","index":3,"helps":"Ballerina supports conditional logic with if-else and match statements. This can be used to route messages based on message content, header, or any custom logic. Ballerina type system supports union types (e.g. `Country` enum below is a union) which helps to define choices in a type-safe and readable manner.","tags":["Message Router","Message Channel","Message Endpoint","Message"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/MessageRouter.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> DhlUkResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> url;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> id;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        Status status;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    |</span><span style=\"color:#24292E\">}[] shipments;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> DhlDpiResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    Status[] events;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> publicUrl;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> barcode;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> Status</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> statusCode;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> status;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">enum</span><span style=\"color:#6F42C1\"> Country</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    UK</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    DE</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client dhl </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.dhl.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /shipments</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> get</span><span style=\"color:#24292E\"> [</span><span style=\"color:#E36209\">Country</span><span style=\"color:#E36209\"> country</span><span style=\"color:#24292E\">]/[</span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> trackingNumber</span><span style=\"color:#24292E\">]/status() </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#D73A49\">|error</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        match</span><span style=\"color:#24292E\"> country {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            UK </span><span style=\"color:#D73A49\">=></span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                DhlUkResponse response </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> dhl</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">parceluk</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">tracking</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">v1</span><span style=\"color:#D73A49\">/</span><span style=\"color:#6F42C1\">shipments</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">trackingNumber</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> trackingNumber);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">                return</span><span style=\"color:#24292E\"> response.shipments[</span><span style=\"color:#005CC5\">0</span><span style=\"color:#24292E\">].status.status;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            DE </span><span style=\"color:#D73A49\">=></span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                DhlDpiResponse response </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> dhl</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">dpi</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">tracking</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">v1</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">trackings</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">[trackingNumber];</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">                return</span><span style=\"color:#24292E\"> response.events[</span><span style=\"color:#005CC5\">0</span><span style=\"color:#24292E\">].status;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            _ </span><span style=\"color:#D73A49\">=></span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">                return</span><span style=\"color:#D73A49\"> error</span><span style=\"color:#24292E\">(</span><span style=\"color:#032F62\">\"County not supported\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\ntype DhlUkResponse record {|\n    string url;\n    record {|\n        string id;\n        Status status;\n    |}[] shipments;\n|};\n\ntype DhlDpiResponse record {|\n    Status[] events;\n    string publicUrl;\n    string barcode;\n|};\n\ntype Status record {|\n    string statusCode;\n    string status;\n|};\n\nenum Country {\n    UK,\n    DE\n}\n\nfinal http:Client dhl = check new (\"http://api.dhl.com.balmock.io\");\n\nservice /shipments on new http:Listener(8080) {\n\n    resource function get [Country country]/[string trackingNumber]/status() returns string|error {\n        match country {\n            UK => {\n                DhlUkResponse response = check dhl->/parceluk/tracking/v1/shipments(trackingNumber = trackingNumber);\n                return response.shipments[0].status.status;\n            }\n            DE => {\n                DhlDpiResponse response = check dhl->/dpi/tracking/v1/trackings/[trackingNumber];\n                return response.events[0].status;\n            }\n            _ => {\n                return error(\"County not supported\");\n            }\n        }\n    }\n}\n","name":"message-router.bal"}],"name":" Message Router"},"__N_SSG":true}