{"pageProps":{"tagline":"Process messages with different formats","desc":"Normalizer routes each message type through a custom message translator so that the resulting messages match a common format.","category":"Message Transformation","index":40,"helps":"Ballerina's type test (`is` keyword) and match statement can both be used to test the structure of incoming data. Then the data can be transformed into the required format to construct new data structures. Ballerina's data-oriented design helps with complex transformations with features such as destructuring, query expressions, spread operator, etc.","tags":["Normalizer","Message Channel","Message Endpoint","Message Translator","Message Router","Message"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/Normalizer.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> ZendeskResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> url;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        int</span><span style=\"color:#24292E\"> id;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> subject;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    |</span><span style=\"color:#24292E\">} ticket;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client zendeskClient </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.zendesk.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /api/v1</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> ticket</span><span style=\"color:#24292E\">(@</span><span style=\"color:#005CC5\">http</span><span style=\"color:#24292E\">:</span><span style=\"color:#005CC5\">Payload</span><span style=\"color:#005CC5\"> json</span><span style=\"color:#D73A49\">|</span><span style=\"color:#005CC5\">xml</span><span style=\"color:#E36209\"> request</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#D73A49\">|error</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        json</span><span style=\"color:#24292E\"> normalizedRequest;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> request </span><span style=\"color:#D73A49\">is</span><span style=\"color:#005CC5\"> json</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            normalizedRequest </span><span style=\"color:#D73A49\">=</span><span style=\"color:#6F42C1\"> normalize</span><span style=\"color:#24292E\">(</span><span style=\"color:#D73A49\">check</span><span style=\"color:#24292E\"> request.subject,</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> request.comment);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        } </span><span style=\"color:#D73A49\">else</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            normalizedRequest </span><span style=\"color:#D73A49\">=</span><span style=\"color:#6F42C1\"> normalize</span><span style=\"color:#24292E\">((</span><span style=\"color:#E36209\">request</span><span style=\"color:#D73A49\">/&#x3C;</span><span style=\"color:#E36209\">subject</span><span style=\"color:#D73A49\">></span><span style=\"color:#24292E\">).</span><span style=\"color:#6F42C1\">data</span><span style=\"color:#24292E\">(), (</span><span style=\"color:#E36209\">request</span><span style=\"color:#D73A49\">/&#x3C;</span><span style=\"color:#E36209\">comment</span><span style=\"color:#D73A49\">></span><span style=\"color:#24292E\">).</span><span style=\"color:#6F42C1\">data</span><span style=\"color:#24292E\">());</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        ZendeskResponse zendeskResponse </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> zendeskClient</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">api</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">v2</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">tickets.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">normalizedRequest</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        return</span><span style=\"color:#24292E\"> zendeskResponse.ticket.url;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">function</span><span style=\"color:#6F42C1\"> normalize</span><span style=\"color:#24292E\">(</span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> subject</span><span style=\"color:#24292E\">, </span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> comment</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#005CC5\"> json</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    return</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        ticket</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            subject,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            comment</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">                body</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> comment</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    };</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\ntype ZendeskResponse record {\n    record {|\n        string url;\n        int id;\n        string subject;\n    |} ticket;\n};\n\nfinal http:Client zendeskClient = check new (\"http://api.zendesk.com.balmock.io\");\n\nservice /api/v1 on new http:Listener(8080) {\n\n    resource function post ticket(@http:Payload json|xml request) returns string|error {\n        json normalizedRequest;\n        if request is json {\n            normalizedRequest = normalize(check request.subject, check request.comment);\n        } else {\n            normalizedRequest = normalize((request/<subject>).data(), (request/<comment>).data());\n        }\n        ZendeskResponse zendeskResponse = check zendeskClient->/api/v2/tickets.post(normalizedRequest);\n        return zendeskResponse.ticket.url;\n    }\n}\n\nfunction normalize(string subject, string comment) returns json {\n    return {\n        ticket: {\n            subject,\n            comment: {\n                body: comment\n            }\n        }\n    };\n}\n","name":"normalizer.bal"}],"name":" Normalizer"},"__N_SSG":true}