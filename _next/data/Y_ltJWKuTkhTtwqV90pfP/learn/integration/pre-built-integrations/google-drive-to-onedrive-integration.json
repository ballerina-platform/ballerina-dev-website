{"pageProps":{"samples":{"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerina/log;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerinax/googleapis.drive;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerinax/microsoft.onedrive;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> gDriveAccessToken </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> gDriveFolderId </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> oneDriveAccessToken </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> oneDrivePath </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">boolean</span><span style=\"color: #24292E\"> filesOverridable </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  </span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    drive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client gDriveEndpoint </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {token: gDriveAccessToken}});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    onedrive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client onedriveEndpoint </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {token: oneDriveAccessToken}});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> gDriveQuery </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`&#39;${</span><span style=\"color: #24292E\">gDriveFolderId</span><span style=\"color: #032F62\">}&#39; in parents and trashed = false`</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">drive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">File</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\"> filesInGDrive </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> gDriveEndpoint</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">getAllFiles</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gDriveQuery</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">drive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">File file </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> filesInGDrive {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">? fileName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> file?.name;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">? fileId </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> file?.id;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">boolean</span><span style=\"color: #24292E\"> writable </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">false</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> fileName </span><span style=\"color: #D73A49\">!is</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">||</span><span style=\"color: #24292E\"> fileId </span><span style=\"color: #D73A49\">!is</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;File name or ID not found&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">!</span><span style=\"color: #24292E\">filesOverridable {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">boolean</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> isExistingFile </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">checkIfFileExistsInOneDrive</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">fileName</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">onedriveEndpoint</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> isExistingFile </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Searching files in Microsoft OneDrive failed!&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">isExistingFile</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            writable </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">!</span><span style=\"color: #24292E\">isExistingFile;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> filesOverridable </span><span style=\"color: #D73A49\">||</span><span style=\"color: #24292E\"> writable {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            drive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">FileContent</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> fileContent </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> gDriveEndpoint</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">getFileContent</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">fileId</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> fileContent </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Retrieving file from Google Drive failed!&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">fileContent</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            onedrive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">DriveItemData</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> uploadFileToFolderByPath </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> onedriveEndpoint</span><span style=\"color: #D73A49\">-&gt;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #6F42C1\">uploadFileToFolderByPath</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">oneDrivePath</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">fileName</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">fileContent?</span><span style=\"color: #24292E\">.content,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #E36209\">fileContent?</span><span style=\"color: #24292E\">.mimeType);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> uploadFileToFolderByPath </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Uploading file to Microsoft OneDrive failed!&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">uploadFileToFolderByPath</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`File ${</span><span style=\"color: #24292E\">fileName</span><span style=\"color: #032F62\">} uploaded successfully!`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  </span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">isolated</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">checkIfFileExistsInOneDrive</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fileName</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">onedrive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client onedriveEndpoint) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">boolean</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">onedrive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">DriveItemData, onedrive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Error?</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\"> searchDriveItems </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> onedriveEndpoint</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">searchDriveItems</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">fileName</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">onedrive</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">DriveItemData value;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">}</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> next </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> searchDriveItems.</span><span style=\"color: #6F42C1\">next</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> next </span><span style=\"color: #D73A49\">!is</span><span style=\"color: #24292E\"> ();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"content":"\nimport ballerina/log;\nimport ballerinax/googleapis.drive;\nimport ballerinax/microsoft.onedrive;\n\nconfigurable string gDriveAccessToken = ?;\nconfigurable string gDriveFolderId = ?;\n\nconfigurable string oneDriveAccessToken = ?;\nconfigurable string oneDrivePath = ?;\n\nconfigurable boolean filesOverridable = ?;\n\npublic function main() returns error? {\n  \n    drive:Client gDriveEndpoint = check new ({auth: {token: gDriveAccessToken}});\n\n    onedrive:Client onedriveEndpoint = check new ({auth: {token: oneDriveAccessToken}});\n\n    string gDriveQuery = string `'${gDriveFolderId}' in parents and trashed = false`;\n    stream<drive:File> filesInGDrive = check gDriveEndpoint->getAllFiles(gDriveQuery);\n\n    foreach drive:File file in filesInGDrive {\n        string? fileName = file?.name;\n        string? fileId = file?.id;\n        boolean writable = false;\n\n        if fileName !is string || fileId !is string {\n            log:printError(\"File name or ID not found\");\n            continue;\n        }\n        if !filesOverridable {\n            boolean|error isExistingFile = checkIfFileExistsInOneDrive(fileName, onedriveEndpoint);\n            if isExistingFile is error {\n                log:printError(\"Searching files in Microsoft OneDrive failed!\", isExistingFile);\n                continue;\n            }\n            writable = !isExistingFile;\n        }\n        if filesOverridable || writable {\n            drive:FileContent|error fileContent = gDriveEndpoint->getFileContent(fileId);\n            if fileContent is error {\n                log:printError(\"Retrieving file from Google Drive failed!\", fileContent);\n                continue;\n            }\n            onedrive:DriveItemData|error uploadFileToFolderByPath = onedriveEndpoint->\n                    uploadFileToFolderByPath(oneDrivePath, fileName, fileContent?.content,\n                    fileContent?.mimeType);\n            if uploadFileToFolderByPath is error {\n                log:printError(\"Uploading file to Microsoft OneDrive failed!\", uploadFileToFolderByPath);\n                continue;\n            }\n            log:printInfo(string `File ${fileName} uploaded successfully!`);\n        }\n    }\n}\n  \nisolated function checkIfFileExistsInOneDrive(string fileName, onedrive:Client onedriveEndpoint) returns boolean|error {\n    stream<onedrive:DriveItemData, onedrive:Error?> searchDriveItems = check onedriveEndpoint->searchDriveItems(\n        fileName);\n    record {|onedrive:DriveItemData value;|}? next = check searchDriveItems.next();\n    return next !is ();\n}\n"},"__N_SSG":true}