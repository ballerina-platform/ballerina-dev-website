{"pageProps":{"tagline":"Route messages to multiple recipients","desc":"The recipient list pattern inspects an incoming message, determines the list of desired recipients, and forwards the message to all channels associated with the recipients in the list.","category":"Message Routing","index":27,"helps":"Ballerina can extract information from messages and execute logic based on that. Iteration constructs such as `foreach` and `while` and query expressions can be used to execute a given logic for each recipient. Ballerina supports sending multiple messages in a single incoming message.","tags":["Recipient List","Content Based Router","Message Router"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/RecipientList.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">Recipient</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">readonly</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">&amp;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> recpientId;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> catergory;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> contact;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #032F62\">&quot;EMAIL&quot;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #032F62\">&quot;SMS&quot;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #032F62\">&quot;NOTIFICATION&quot;</span><span style=\"color: #24292E\"> subscription;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">Message</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">readonly</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">&amp;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> subject?;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> body;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> signature?;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">map&lt;</span><span style=\"color: #24292E\">Recipient[]</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\"> recipientList </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client emailManagerClient </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #032F62\">&quot;http://api.email.manager.com.balmock.io&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client smsManagerClient </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #032F62\">&quot;http://api.sms.manager.com.balmock.io&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client notificationManagerClient </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #032F62\">&quot;http://api.notification.manager.com.balmock.io&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">service</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">/api/v1</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> http:Listener(</span><span style=\"color: #005CC5\">8080</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">resource</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">post</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">quotes</span><span style=\"color: #24292E\">/[</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">catergory</span><span style=\"color: #24292E\">](</span><span style=\"color: #E36209\">Message</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">message</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #005CC5\">var</span><span style=\"color: #24292E\"> {contact, subscription} </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> recipientList.</span><span style=\"color: #6F42C1\">get</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">catergory</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">match</span><span style=\"color: #24292E\"> subscription {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">&quot;EMAIL&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> emailManagerClient</span><span style=\"color: #D73A49\">-&gt;/</span><span style=\"color: #24292E\">send</span><span style=\"color: #D73A49\">/</span><span style=\"color: #24292E\">[contact].</span><span style=\"color: #6F42C1\">post</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">message</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">targetType</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Response);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">&quot;SMS&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> smsManagerClient</span><span style=\"color: #D73A49\">-&gt;/</span><span style=\"color: #24292E\">send</span><span style=\"color: #D73A49\">/</span><span style=\"color: #24292E\">[contact].</span><span style=\"color: #6F42C1\">post</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">message</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">targetType</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Response);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">&quot;NOTIFICATION&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> notificationManagerClient</span><span style=\"color: #D73A49\">-&gt;/</span><span style=\"color: #24292E\">send</span><span style=\"color: #D73A49\">/</span><span style=\"color: #24292E\">[contact].</span><span style=\"color: #6F42C1\">post</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">message</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">targetType</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Response);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\ntype Recipient readonly & record {|\n    string recpientId;\n    string catergory;\n    string contact;\n    \"EMAIL\"|\"SMS\"|\"NOTIFICATION\" subscription;\n|};\n\ntype Message readonly & record {|\n    string subject?;\n    string body;\n    string signature?;\n|};\n\nfinal map<Recipient[]> recipientList = {};\n\nfinal http:Client emailManagerClient = check new (\"http://api.email.manager.com.balmock.io\");\nfinal http:Client smsManagerClient = check new (\"http://api.sms.manager.com.balmock.io\");\nfinal http:Client notificationManagerClient = check new (\"http://api.notification.manager.com.balmock.io\");\n\nservice /api/v1 on new http:Listener(8080) {\n\n    resource function post quotes/[string catergory](Message message) returns error? {\n        foreach var {contact, subscription} in recipientList.get(catergory) {\n            match subscription {\n                \"EMAIL\" => {\n                    _ = check emailManagerClient->/send/[contact].post(message, targetType = http:Response);\n                }\n                \"SMS\" => {\n                    _ = check smsManagerClient->/send/[contact].post(message, targetType = http:Response);\n                }\n                \"NOTIFICATION\" => {\n                    _ = check notificationManagerClient->/send/[contact].post(message, targetType = http:Response);\n                }\n            }\n        }\n    }\n}\n","name":"recipient-list.bal"}],"name":" Recipient List"},"__N_SSG":true}