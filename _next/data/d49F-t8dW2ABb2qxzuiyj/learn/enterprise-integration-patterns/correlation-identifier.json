{"pageProps":{"tagline":"Identify the message that a reply is for","desc":"A correlation Identifier is a unique identifier that indicates which request message this reply is for.","category":"Message Construction","index":20,"helps":"Ballerina can send and receive messages over multiple protocols. Ballerina supports extracting and injecting information into the messages. The extracted information can be stored for later use as a correlation identifier. Module-level variables can be used for temporary storage. For a more robust solution, Ballerina provides a rich set of packages to interact with databases and key-value stores, such as SQL and Redis.","tags":["Correlation Identifier","Request Reply","Selective Consumer","Messsage"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/CorrelationIdentifier.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerina/http;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerinax/kafka;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">OrderRequest</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> orderId;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> name;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> address;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> phoneNumber;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    OrderItem[] items;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">OrderItem</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> itemCode;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">int</span><span style=\"color: #24292E\"> quantity;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">float</span><span style=\"color: #24292E\"> unitPrice;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">InvoiceDetails</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> orderId;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> invoiceId;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">const </span><span style=\"color: #005CC5\">INVOICE_GENERATING</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;INVOICE_GENERATING&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">const </span><span style=\"color: #005CC5\">INVOICE_GENERATED</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;INVOICE_GENERATED&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">InvoiceGenerating</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    INVOICE_GENERATING status </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> INVOICE_GENERATING;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">InvoiceGenerated</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    INVOICE_GENERATED status </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> INVOICE_GENERATED;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> invoiceId;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">map&lt;</span><span style=\"color: #24292E\">InvoiceGenerating</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">InvoiceGenerated</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\"> processedOrders </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {};</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">service</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">/api/v1</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> http:Listener(</span><span style=\"color: #005CC5\">8080</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">private</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> kafka</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Producer kafkaPublisher;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">init</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">self</span><span style=\"color: #24292E\">.kafkaPublisher </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">kafka</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">DEFAULT_URL);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">resource</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">post</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">process</span><span style=\"color: #24292E\">/&#39;order(</span><span style=\"color: #E36209\">OrderRequest</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">orderRequest</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">self</span><span style=\"color: #24292E\">.kafkaPublisher</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">send</span><span style=\"color: #24292E\">({</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            topic</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;order-events&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            value</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> orderRequest</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        });</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        processedOrders[orderRequest.orderId] </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #032F62\">&quot;status&quot;</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> INVOICE_GENERATING</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">listener</span><span style=\"color: #24292E\"> kafka</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Listener orderListener </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">kafka</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">DEFAULT_URL, {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    groupId</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;order-group-id&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    topics</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;invoice-events&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">service</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> orderListener {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">remote</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">onConsumerRecord</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">InvoiceDetails</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">invoices</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #005CC5\">var</span><span style=\"color: #24292E\"> invoice </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> invoices {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            processedOrders[invoice.orderId] </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">&quot;status&quot;</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> INVOICE_GENERATED,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">&quot;invoiceId&quot;</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> invoice.invoiceId</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\nimport ballerinax/kafka;\n\ntype OrderRequest record {|\n    string orderId;\n    string name;\n    string address;\n    string phoneNumber;\n    OrderItem[] items;\n|};\n\ntype OrderItem record {|\n    string itemCode;\n    int quantity;\n    float unitPrice;\n|};\n\ntype InvoiceDetails record {|\n    string orderId;\n    string invoiceId;\n|};\n\nconst INVOICE_GENERATING = \"INVOICE_GENERATING\";\nconst INVOICE_GENERATED = \"INVOICE_GENERATED\";\n\ntype InvoiceGenerating record {|\n    INVOICE_GENERATING status = INVOICE_GENERATING;\n|};\n\ntype InvoiceGenerated record {|\n    INVOICE_GENERATED status = INVOICE_GENERATED;\n    string invoiceId;\n|};\n\nfinal map<InvoiceGenerating|InvoiceGenerated> processedOrders = {};\n\nservice /api/v1 on new http:Listener(8080) {\n\n    private final kafka:Producer kafkaPublisher;\n\n    function init() returns error? {\n        self.kafkaPublisher = check new (kafka:DEFAULT_URL);\n    }\n\n    resource function post process/'order(OrderRequest orderRequest) returns error? {\n        check self.kafkaPublisher->send({\n            topic: \"order-events\",\n            value: orderRequest\n        });\n        processedOrders[orderRequest.orderId] = {\n            \"status\": INVOICE_GENERATING\n        };\n    }\n}\n\nlistener kafka:Listener orderListener = new (kafka:DEFAULT_URL, {\n    groupId: \"order-group-id\",\n    topics: \"invoice-events\"\n});\n\nservice on orderListener {\n    remote function onConsumerRecord(InvoiceDetails[] invoices) returns error? {\n        foreach var invoice in invoices {\n            processedOrders[invoice.orderId] = {\n                \"status\": INVOICE_GENERATED,\n                \"invoiceId\": invoice.invoiceId\n            };\n        }\n    }\n}\n","name":"correlation-identifier.bal"}],"name":" Correlation Identifier"},"__N_SSG":true}