{"pageProps":{"tagline":"Filters the received messages using a criteria","desc":"Selective consumer filters the messages which come from a message channel using a criteria.","category":"Messaging Endpoints","index":49,"helps":"Ballerina supports rich set of messaging protocols. Some of these protocols supports channels with filtering capabilities.  Below example uses GraphQL's filtering capabilities to select the data it receives.  If a protocol does not support filtering, user may write their own logic using Ballerina control flow constructs such as `if`-`else` and `match` statements.","tags":["Selective Consumer","Message Filter","Content Based Router","Message"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/MessageSelector.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerina/graphql;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerina/io;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">InventoryResponse</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">Inventory[] products;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">} data;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">Inventory</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> name;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">int</span><span style=\"color: #24292E\"> productsCount;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">CsvRecord</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> name;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    RequestType requestType;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">enum</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">RequestType</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">REQUIRED</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">URGENT</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> graphql</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client shopify </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #032F62\">&quot;http://blackwellsbooks.myshopify.com.balmock.io&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">category</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> csvFilePath </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;./resources/orderRequests.csv&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> document </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`{ products(productType: &quot;${</span><span style=\"color: #24292E\">category</span><span style=\"color: #032F62\">}&quot;) { name, productsCount } } `</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    InventoryResponse inventories </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> shopify</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">execute</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">document</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    CsvRecord[] csvContent </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> [];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #005CC5\">var</span><span style=\"color: #24292E\"> {name, productsCount} </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> inventories.data.products {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> productsCount </span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">10</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            csvContent.</span><span style=\"color: #6F42C1\">push</span><span style=\"color: #24292E\">({name</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> name, requestType</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> URGENT});</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        } </span><span style=\"color: #D73A49\">else</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> productsCount </span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">25</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            csvContent.</span><span style=\"color: #6F42C1\">push</span><span style=\"color: #24292E\">({name</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> name, requestType</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> REQUIRED});</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> io</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">fileWriteCsv</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">csvFilePath</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">csvContent</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/graphql;\nimport ballerina/io;\n\ntype InventoryResponse record {|\n    record {|Inventory[] products;|} data;\n|};\n\ntype Inventory record {|\n    string name;\n    int productsCount;\n|};\n\ntype CsvRecord record {|\n    string name;\n    RequestType requestType;\n|};\n\nenum RequestType {\n    REQUIRED,\n    URGENT\n};\n\nfinal graphql:Client shopify = check new (\"http://blackwellsbooks.myshopify.com.balmock.io\");\n\npublic function main(string category) returns error? {\n    string csvFilePath = \"./resources/orderRequests.csv\";\n    string document = string `{ products(productType: \"${category}\") { name, productsCount } } `;\n    InventoryResponse inventories = check shopify->execute(document);\n    CsvRecord[] csvContent = [];\n    foreach var {name, productsCount} in inventories.data.products {\n        if productsCount < 10 {\n            csvContent.push({name: name, requestType: URGENT});\n        } else if productsCount < 25 {\n            csvContent.push({name: name, requestType: REQUIRED});\n        }\n    }\n    check io:fileWriteCsv(csvFilePath, csvContent);\n}\n","name":"selective-consumer.bal"}],"name":" Selective Consumer"},"__N_SSG":true}