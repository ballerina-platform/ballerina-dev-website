{"pageProps":{"tagline":"Add data to the message","desc":"Content enricher adds data that was not sent by the original sender to the message.","category":"Message Transformation","index":37,"helps":"Ballerina enables additional lookups to enrich the message, such as database lookups, REST API calls, etc. Spread operator (...) helps to create new records out of existing records while enriching them with additional data.","tags":["Content Enricher","Message Channel","Message Endpoint","Message"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/DataEnricher.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> BankAccountReq</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> name;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> accountNumber;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> routingNumber;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\">? country;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> IbanRequest</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">    \"json\"</span><span style=\"color:#D73A49\">|</span><span style=\"color:#032F62\">\"xml\"</span><span style=\"color:#24292E\"> format </span><span style=\"color:#D73A49\">=</span><span style=\"color:#032F62\"> \"json\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> country_iso;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> nid;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> IbanResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> bank_code;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> BankAccount</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    *</span><span style=\"color:#24292E\">BankAccountReq;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> id;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\">? bankCode;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client iban </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.iban.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client intuit </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.intuit.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /finance</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> customers</span><span style=\"color:#24292E\">/[</span><span style=\"color:#005CC5\">int</span><span style=\"color:#E36209\"> id</span><span style=\"color:#24292E\">]/accounts(</span><span style=\"color:#E36209\">BankAccountReq</span><span style=\"color:#E36209\"> req</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#24292E\"> BankAccount</span><span style=\"color:#D73A49\">|error</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        IbanRequest ibanReq </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {country_iso</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> req.country ?</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"US\"</span><span style=\"color:#24292E\">, nid</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> req.accountNumber};</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        IbanResponse ibanRes </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> iban</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">clients</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">api</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">banksuite</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">nid.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">ibanReq</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        return</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> intuit</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">quickbooks</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">v4</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">customers</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">[id]</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">bank\\</span><span style=\"color:#D73A49\">-</span><span style=\"color:#24292E\">accounts.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">({</span><span style=\"color:#D73A49\">...</span><span style=\"color:#24292E\">req, bankCode</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> ibanRes.bank_code});</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\ntype BankAccountReq record {|\n    string name;\n    string accountNumber;\n    string routingNumber;\n    string? country;\n|};\n\ntype IbanRequest record {|\n    \"json\"|\"xml\" format = \"json\";\n    string country_iso;\n    string nid;\n|};\n\ntype IbanResponse record {\n    string bank_code;\n};\n\ntype BankAccount record {\n    *BankAccountReq;\n    string id;\n    string? bankCode;\n};\n\nfinal http:Client iban = check new (\"http://api.iban.com.balmock.io\");\nfinal http:Client intuit = check new (\"http://api.intuit.com.balmock.io\");\n\nservice /finance on new http:Listener(8080) {\n\n    resource function post customers/[int id]/accounts(BankAccountReq req) returns BankAccount|error {\n        IbanRequest ibanReq = {country_iso: req.country ?: \"US\", nid: req.accountNumber};\n        IbanResponse ibanRes = check iban->/clients/api/banksuite/nid.post(ibanReq);\n        return check intuit->/quickbooks/v4/customers/[id]/bank\\-accounts.post({...req, bankCode: ibanRes.bank_code});\n    }\n}\n","name":"content-enricher.bal"}],"name":" Content Enricher"},"__N_SSG":true}