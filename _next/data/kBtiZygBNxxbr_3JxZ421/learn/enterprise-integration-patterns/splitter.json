{"pageProps":{"tagline":"Process messages with multiple elements","desc":"Splitter splits the message into multiple messages, each containing one of the elements.","helps":"Ballerina supports arrays and maps as first-class data structures. These structures can be iterated over using `foreach` and query expressions.","category":"Message Routing","index":28,"tags":["Splitter","Content Filter","Event Message"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/Sequencer.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/mime;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/url;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> ReminderRequest</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> date;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    Event[] events;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> Event</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> eventName;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    Attendee[] attendees;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> Attendee</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> name;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> number;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">FROM_NO</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"+15005550006\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">TWILIO_SID</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"VAC1829a53d52f41b4b2b1cc003c0026aa8\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">const </span><span style=\"color:#005CC5\">API_VERSION</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#032F62\"> \"2010-04-01\"</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client twilio </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.twilio.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /api/v1</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> reminders</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">ReminderRequest</span><span style=\"color:#E36209\"> request</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        foreach </span><span style=\"color:#005CC5\">var</span><span style=\"color:#24292E\"> event </span><span style=\"color:#D73A49\">in</span><span style=\"color:#24292E\"> request.events {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">            foreach </span><span style=\"color:#005CC5\">var</span><span style=\"color:#24292E\"> attendee </span><span style=\"color:#D73A49\">in</span><span style=\"color:#24292E\"> event.attendees {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">                check</span><span style=\"color:#6F42C1\"> sendReminder</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">attendee</span><span style=\"color:#24292E\">, event.eventName, request.date);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">function</span><span style=\"color:#6F42C1\"> sendReminder</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">Attendee</span><span style=\"color:#E36209\"> attendee</span><span style=\"color:#24292E\">, </span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> eventName</span><span style=\"color:#24292E\">, </span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> date</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> body </span><span style=\"color:#D73A49\">=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `Hi ${</span><span style=\"color:#24292E\">attendee</span><span style=\"color:#032F62\">.</span><span style=\"color:#24292E\">name</span><span style=\"color:#032F62\">}, looking forward to meet you at the ${</span><span style=\"color:#24292E\">eventName</span><span style=\"color:#032F62\">} on ${</span><span style=\"color:#24292E\">date</span><span style=\"color:#032F62\">}`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> payload </span><span style=\"color:#D73A49\">=</span><span style=\"color:#032F62\"> \"From=\"</span><span style=\"color:#D73A49\"> +</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> url</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">encode</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">FROM_NO</span><span style=\"color:#24292E\">, </span><span style=\"color:#032F62\">\"utf-8\"</span><span style=\"color:#24292E\">) +</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                     \"&#x26;To=\"</span><span style=\"color:#D73A49\"> +</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> url</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">encode</span><span style=\"color:#24292E\">(attendee.number, </span><span style=\"color:#032F62\">\"utf-8\"</span><span style=\"color:#24292E\">) +</span></span>\n<span class=\"line\"><span style=\"color:#032F62\">                     \"&#x26;Body=\"</span><span style=\"color:#D73A49\"> +</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> url</span><span style=\"color:#D73A49\">:</span><span style=\"color:#6F42C1\">encode</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">body</span><span style=\"color:#24292E\">, </span><span style=\"color:#032F62\">\"utf-8\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Request twilioReq </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    twilioReq.</span><span style=\"color:#6F42C1\">setTextPayload</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">payload</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">contentType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> mime</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">APPLICATION_FORM_URLENCODED);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> twilio</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">[API_VERSION]</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">Accounts</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">[TWILIO_SID]</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">Messages\\.json.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">twilioReq</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">targetType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Response);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\nimport ballerina/mime;\nimport ballerina/url;\n\ntype ReminderRequest record {\n    string date;\n    Event[] events;\n};\n\ntype Event record {|\n    string eventName;\n    Attendee[] attendees;\n|};\n\ntype Attendee record {|\n    string name;\n    string number;\n|};\n\nconst FROM_NO = \"+15005550006\";\nconst TWILIO_SID = \"VAC1829a53d52f41b4b2b1cc003c0026aa8\";\nconst API_VERSION = \"2010-04-01\";\n\nfinal http:Client twilio = check new (\"http://api.twilio.com.balmock.io\");\n\nservice /api/v1 on new http:Listener(8080) {\n    resource function post reminders(ReminderRequest request) returns error? {\n        foreach var event in request.events {\n            foreach var attendee in event.attendees {\n                check sendReminder(attendee, event.eventName, request.date);\n            }\n        }\n    }\n}\n\nfunction sendReminder(Attendee attendee, string eventName, string date) returns error? {\n    string body = string `Hi ${attendee.name}, looking forward to meet you at the ${eventName} on ${date}`;\n    string payload = \"From=\" + check url:encode(FROM_NO, \"utf-8\") +\n                     \"&To=\" + check url:encode(attendee.number, \"utf-8\") +\n                     \"&Body=\" + check url:encode(body, \"utf-8\");\n    http:Request twilioReq = new;\n    twilioReq.setTextPayload(payload, contentType = mime:APPLICATION_FORM_URLENCODED);\n    _ = check twilio->/[API_VERSION]/Accounts/[TWILIO_SID]/Messages\\.json.post(twilioReq, targetType = http:Response);\n}\n","name":"splitter.bal"}],"name":" Splitter"},"__N_SSG":true}