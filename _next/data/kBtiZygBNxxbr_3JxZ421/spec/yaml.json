{"pageProps":{"frontmatter":{},"content":"# Specification: Ballerina Yaml Library\n\n_Owners_: @MadhukaHarith92 @sameerajayasoma @nipunayf  \n_Reviewers_: @shafreenAnfar  \n_Created_: 2023/04/04  \n_Updated_: 2023/04/04  \n_Edition_: Swan Lake\n\n## Introduction\nThis is the specification for the Yaml library of [Ballerina language](https://ballerina.io/), which provides APIs to convert a YAML configuration file to JSON, and vice-versa. The module supports both the functions of reading and writing either a single YAML document or a YAML stream.\n\nThe Yaml library specification has evolved and may continue to evolve in the future. The released versions of the specification can be found under the relevant GitHub tag.\n\nIf you have any feedback or suggestions about the library, start a discussion via a [GitHub issue](https://github.com/ballerina-platform/ballerina-library/issues) or in the [Discord server](https://discord.gg/ballerinalang). Based on the outcome of the discussion, the specification and implementation can be updated. Community feedback is always welcome. Any accepted proposal, which affects the specification is stored under `/docs/proposals`. Proposals under discussion can be found with the label `type/proposal` in GitHub.\n\nThe conforming implementation of the specification is released and included in the distribution. Any deviation from the specification is considered a bug.\n\n## Contents\n\n1. [Overview](#1-overview)\n2. [Compatibility](#2-compatibility)\n3. [Parsing a YAML File](#3-parsing-a-yaml-file)\n4. [Writing a YAML File](#4-writing-a-yaml-file)\n5. [YAML Schema and Supported Data Types](#5-yaml-schema-and-supported-data-types)\n6. [Custom YAML Types](#6-custom-yaml-types)\n\n## 1. Overview\nThis specification elaborates on the functions available in the Yaml library.\n\nSince the parser is following LL(1) grammar, it follows a non-recursive predictive parsing algorithm that operates in a linear time complexity.\n\n## 2. Compatibility\n\n| Language  | Version                        |\n| --------- | ------------------------------ |\n| Ballerina | Ballerina 2201.0.0 (Swan Lake) |\n| YAML      | 1.2.2                          |\n\nThe parser follows the grammar rules particularized in the [YAML specification 1.2.2](https://yaml.org/spec/1.2.2/).\n\n## 3. Parsing a YAML File\n\nThe read function allows the user to obtain either a YAML document or an array of YAML streams if the `isStream` flag is set.\n\n```ballerina\n// Parsing a YAML document\njson|yaml:Error yamlDoc = yaml:readFile(\"path/to/file.yml\");\n\n// Parsing a YAML stream\njson|yaml:Error yamlDocs = yaml:readFile(\"path/to/file.yml\", isStream = true);\n\n// Parsing a YAML string \njson|yaml:Error yamlLine = yaml:readString(\"outer: {inner: value}\");\n```\n\nThe user can either set the `allowAnchorRedefinition` or `allowMapEntryRedefinition` to let the parser overwrite anchors and map entry keys respectively.\n\n## 4. Writing a YAML File\n\nThe user can write either a document or a stream using this function.\n\n```ballerina\n// Writing a YAML document\ncheck yaml:writeFile(\"path/to/file.yaml\", yamlContent);\n\n// Writing a YAML stream\ncheck yaml:writeFile(\"path/to/file.yaml\", yamlContent, isStream = true);\n\n// Writing a YAML string\njson|yaml:Error jsonOutput = yaml:writeString(\"outer: {inner: value}\");\n```\n\nBy default, the parser attempts to write the YAML scalars in planar style. However, there are some scalars that cause ambiguity against a few control symbols in YAML. In this case to remove the vagueness, the parser will either add  `\"` quotes or `'` quotes based on the `useSingleQuotes` flag is set. Further, if the `forceQuotes` flag is set, then all the scalars will be quoted.\n\nThe following options can be set to further format the output YAML file.\n\n| Option                  | Default | Description                                                                                         |\n| ----------------------- | ------- | --------------------------------------------------------------------------------------------------- |\n| `int indentationPolicy` | `2`     | The number of whitespaces considered to a indent.                                                   |\n| `int blockLevel`        | `1`     | The maximum depth level for the block-style collections before the flow-style collections are used. |\n| `boolean canonical`     | `false` | If the flag is set, the parser will write the tag along with the node.                              |\n\n## 5. YAML Schema and Supported Data Types\n\nThe `Fail Safe Schema` is the most basic schema supported by any YAML document. The corresponding Ballerina data types are listed as shown below.\n\n| YAML Tag | Ballerina Data Type     |\n| -------- | ----------------------- |\n| !!str    | `ballerina.lang.string` |\n| !!seq    | `ballerina.lang.array`  |\n| !!map    | `ballerina.lang.map`    |\n\nIn addition to the `Fail-Safe Schema`, the `JSON Schema` defines the following tags to enable basic JSON support. The `Core Schema` is an extension of the `JSON Schema` that supports the same tags with more human-readable notations.\n\n| YAML Tag | Ballerina Data Type      |\n| -------- | ------------------------ |\n| !!null   | `()`                     |\n| !!bool   | `ballerina.lang.boolean` |\n| !!int    | `ballerina.lang.int`     |\n| !!float  | `ballerina.lang.float`   |\n\n## 6. Custom YAML Types\n\nA custom tag support can be added to the YAML parser by writing a record of the type `YamlType`. All the custom YAML tags must be provided as an array to the `yamlTypes` property in the config. The following code segment demonstrates an example of adding a custom tag to the parser.\n\n```ballerina\nimport ballerina/yaml;\n\ntype RGB [int, int, int];\n\n// Validation function to check before constructing the RGB\nfunction constructRGB(json data) returns json|yaml:SchemaError {\n    RGB|error value = data.cloneWithType();\n\n    if value is error {\n        return error(\"Invalid shape for RGB\");\n    }\n\n    foreach int index in value {\n        if index > 255 || index < 0 {\n            return error(\"One RGB value must be between 0-255\");\n        }\n    }\n\n    return value;\n}\n\npublic function main() returns error? {\n    yaml:YamlType rgbType = {\n        tag: \"!rgb\",\n        ballerinaType: RGB,\n        kind: yaml:SEQUENCE,\n        construct: constructRGB,\n        represent: function(json data) returns string => data.toString()\n    };\n\n    RGB color = [256, 12, 32];\n    json balStruct = {color};\n\n    check yaml:writeFile(\"rgb.yml\", balStruct, canonical = true, yamlTypes = [rgbType]);\n}\n```\n\nThe parser considers these custom tags before the default tags when resolving. Thus, the output tag is `!rgb` rather than `!seq`.\n\n```yaml\n!!str color: !rgb [!!int 256, !!int 12, !!int 32]\n```\n","codeSnippets":"[[-1121179197,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Parsing a YAML document</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">json</span><span style=\\\"color:#D73A49\\\">|yaml:</span><span style=\\\"color:#24292E\\\">Error yamlDoc </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">readFile</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"path/to/file.yml\\\"</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Parsing a YAML stream</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">json</span><span style=\\\"color:#D73A49\\\">|yaml:</span><span style=\\\"color:#24292E\\\">Error yamlDocs </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">readFile</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"path/to/file.yml\\\"</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">isStream</span><span style=\\\"color:#D73A49\\\"> =</span><span style=\\\"color:#D73A49\\\"> true</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Parsing a YAML string </span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">json</span><span style=\\\"color:#D73A49\\\">|yaml:</span><span style=\\\"color:#24292E\\\">Error yamlLine </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">readString</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"outer: {inner: value}\\\"</span><span style=\\\"color:#24292E\\\">);</span></span></code></pre>\"],[-1088236197,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Writing a YAML document</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">check</span><span style=\\\"color:#24292E\\\"> yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">writeFile</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"path/to/file.yaml\\\"</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">yamlContent</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Writing a YAML stream</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">check</span><span style=\\\"color:#24292E\\\"> yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">writeFile</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"path/to/file.yaml\\\"</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">yamlContent</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">isStream</span><span style=\\\"color:#D73A49\\\"> =</span><span style=\\\"color:#D73A49\\\"> true</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Writing a YAML string</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">json</span><span style=\\\"color:#D73A49\\\">|yaml:</span><span style=\\\"color:#24292E\\\">Error jsonOutput </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">writeString</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"outer: {inner: value}\\\"</span><span style=\\\"color:#24292E\\\">);</span></span></code></pre>\"],[-165635697,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">import</span><span style=\\\"color:#24292E\\\"> ballerina/yaml;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">type</span><span style=\\\"color:#6F42C1\\\"> RGB</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">];</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">// Validation function to check before constructing the RGB</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">function</span><span style=\\\"color:#6F42C1\\\"> constructRGB</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#005CC5\\\">json</span><span style=\\\"color:#E36209\\\"> data</span><span style=\\\"color:#24292E\\\">) </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#005CC5\\\"> json</span><span style=\\\"color:#D73A49\\\">|</span><span style=\\\"color:#24292E\\\">yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\">SchemaError {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    RGB</span><span style=\\\"color:#D73A49\\\">|error</span><span style=\\\"color:#24292E\\\"> value </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> data.</span><span style=\\\"color:#6F42C1\\\">cloneWithType</span><span style=\\\"color:#24292E\\\">();</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    if</span><span style=\\\"color:#24292E\\\"> value </span><span style=\\\"color:#D73A49\\\">is</span><span style=\\\"color:#D73A49\\\"> error</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">        return</span><span style=\\\"color:#D73A49\\\"> error</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"Invalid shape for RGB\\\"</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    foreach </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\"> index </span><span style=\\\"color:#D73A49\\\">in</span><span style=\\\"color:#24292E\\\"> value {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">        if</span><span style=\\\"color:#24292E\\\"> index </span><span style=\\\"color:#D73A49\\\">></span><span style=\\\"color:#005CC5\\\"> 255</span><span style=\\\"color:#D73A49\\\"> ||</span><span style=\\\"color:#24292E\\\"> index </span><span style=\\\"color:#D73A49\\\">&#x3C;</span><span style=\\\"color:#005CC5\\\"> 0</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">            return</span><span style=\\\"color:#D73A49\\\"> error</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"One RGB value must be between 0-255\\\"</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    return</span><span style=\\\"color:#24292E\\\"> value;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">public</span><span style=\\\"color:#D73A49\\\"> function</span><span style=\\\"color:#6F42C1\\\"> main</span><span style=\\\"color:#24292E\\\">() </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#D73A49\\\"> error?</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\">YamlType rgbType </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        tag</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#032F62\\\"> \\\"!rgb\\\"</span><span style=\\\"color:#24292E\\\">,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        ballerinaType</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> RGB,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        kind</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> yaml:SEQUENCE,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">        construct</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#005CC5\\\">constructRGB</span><span style=\\\"color:#24292E\\\">,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        represent</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\"> function</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#005CC5\\\">json</span><span style=\\\"color:#E36209\\\"> data</span><span style=\\\"color:#24292E\\\">) returns string </span><span style=\\\"color:#D73A49\\\">=></span><span style=\\\"color:#24292E\\\"> data.</span><span style=\\\"color:#6F42C1\\\">toString</span><span style=\\\"color:#24292E\\\">()</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    };</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    RGB color </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">256</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">12</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">32</span><span style=\\\"color:#24292E\\\">];</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">    json</span><span style=\\\"color:#24292E\\\"> balStruct </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> {color};</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    check</span><span style=\\\"color:#24292E\\\"> yaml</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">writeFile</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#032F62\\\">\\\"rgb.yml\\\"</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">balStruct</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">canonical</span><span style=\\\"color:#D73A49\\\"> =</span><span style=\\\"color:#D73A49\\\"> true</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">yamlTypes</span><span style=\\\"color:#D73A49\\\"> =</span><span style=\\\"color:#24292E\\\"> [rgbType]);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span></code></pre>\"],[-1231129006,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">!!str</span><span style=\\\"color:#22863A\\\"> color</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#D73A49\\\">!rgb</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#D73A49\\\">!!int</span><span style=\\\"color:#005CC5\\\"> 256</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#D73A49\\\">!!int</span><span style=\\\"color:#005CC5\\\"> 12</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#D73A49\\\">!!int</span><span style=\\\"color:#005CC5\\\"> 32</span><span style=\\\"color:#24292E\\\">]</span></span></code></pre>\"]]"},"__N_SSG":true}