{"pageProps":{"frontmatter":{"layout":"ballerina-testing-code-left-nav-pages-swanlake","title":"Execute tests in parallel","description":"Learn how to execute tests in parallel.","keywords":"ballerina, programming language, testing, test execution","permalink":"/learn/test-ballerina-code/execute-tests-in-parallel/","active":"execute-tests-in-parallel","intro":"Ballerina test framework allows developers to execute test cases in parallel, which can significantly reduce the overall test execution time, especially for large codebases with a large number of test cases."},"content":"\n## Enable parallel execution of tests\n\nTests are executed serially by default. The user has to explicitly activate the parallel execution by providing the `--parallel` flag as follows.\n\n```\nbal test --parallel\n```\n\nBefore running tests concurrently, it is crucial to ensure concurrency safety. Ballerina inherently evaluates the concurrency safety of tests to some extent using a predefined set of rules. Tests that do not comply with these rules are executed sequentially, regardless of the parallel flag being enabled.\n\n## Exclude a specific test from parallel execution\n\nCertain tests may have dependencies or requirements that make them incompatible with parallel execution, such as shared resources or specific environment setups. If such a requirement is identified, the user may need to set the `serialExecution` flag to `true` as follows:\n\n```ballerina\n@test:Config {serialExecution: true}\nfunction testAssertEquals6() {\n    test:assertEquals(100, 100);\n}\n```\n\n## Write a concurrent safe test case\n\nThe following conditions have to be met for a test to be identified as one that can be run in parallel.\n\n1. The test function must be isolated. If the function is not exposed publicly and all the conditions for `isolated` functions are met, the compiler may infer the test functions as `isolated`. \n2. If it is a data provider test, \n   - The data provider of the test function must be isolated, either explicitly marked or inferred to be isolated.\n   - The types of the test function parameters must be subtypes of `readonly`. I.e., only immutable values can be passed as arguments.\n3. Corresponding set-up and tear-down functions (`before`, `after`, `BeforeEach`, `AfterEach`, `BeforeGroups`, `AfterGroups`) of the test function must be isolated.\n\nTo learn more about concurrency safety in Ballerina, see [Concurrency safety](https://ballerina.io/learn/concurrency/#concurrency-safety).\n\nA warning related to unparallelized tests is printed at the beginning of the parallel test execution with the reasons.\nConsider the following example.\n\n```ballerina\nimport ballerina/lang.runtime;\nimport ballerina/test;\n\nint a = 0;\n\n@test:Config {\n    dataProvider: mapDataProvider\n}\nfunction mapDataProviderTest(int value1, int value2, string fruit) returns error? {\n    test:assertEquals(value1, value2, msg = \"The provided values are not equal\");\n    runtime:sleep(0.1);\n    a = 8;\n}\n\nfunction mapDataProvider() returns map<[int, int, string]>|error {\n    a = 10;\n    map<[int, int, string]> dataSet = {\n        \"banana\": [10, 10, \"banana\"],\n        \"cherry\": [5, 5, \"cherry\"],\n        \"apple\": [5, 5, \"apple\"],\n        \"orange\": [5, 5, \"orange\"]\n    };\n    return dataSet;\n}\n```\n\nThe above code results in the following warning.\n\n```\nWARNING: Test function 'mapDataProviderTest' cannot be parallelized, reason: non-isolated test function, non-isolated data-provider function\n```\nBased on the warning, the code can be improved as follows.\n\n```ballerina\nimport ballerina/lang.runtime;\nimport ballerina/test;\n\nisolated int a = 0;\n\n@test:Config {\n    dataProvider: mapDataProvider\n}\nisolated function mapDataProviderTest(int value1, int value2, string fruit) returns error? {\n    test:assertEquals(value1, value2, msg = \"The provided values are not equal\");\n    runtime:sleep(0.1);\n    lock {\n        a = 8;\n    }\n}\n\nisolated function mapDataProvider() returns map<[int, int, string]>|error {\n    lock {\n        a = 10;\n    }\n    map<[int, int, string]> dataSet = {\n        \"banana\": [10, 10, \"banana\"],\n        \"cherry\": [5, 5, \"cherry\"],\n        \"apple\": [5, 5, \"apple\"],\n        \"orange\": [5, 5, \"orange\"]\n    };\n    return dataSet;\n}\n```\n","id":"execute-tests-in-parallel","sub":"test-document-the-code","third":"test-ballerina-code","slug":"test-document-the-code/test-ballerina-code/execute-tests-in-parallel","codes":"[[1920712451,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">@</span><span style=\\\"color:#005CC5\\\">test</span><span style=\\\"color:#24292E\\\">:</span><span style=\\\"color:#005CC5\\\">Config</span><span style=\\\"color:#24292E\\\"> {serialExecution</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#005CC5\\\"> true</span><span style=\\\"color:#24292E\\\">}</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">function</span><span style=\\\"color:#6F42C1\\\"> testAssertEquals6</span><span style=\\\"color:#24292E\\\">() {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    test</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">assertEquals</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#005CC5\\\">100</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">100</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span></code></pre>\"],[1471248468,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">import</span><span style=\\\"color:#24292E\\\"> ballerina/lang.runtime;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">import</span><span style=\\\"color:#24292E\\\"> ballerina/test;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\"> a </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#005CC5\\\"> 0</span><span style=\\\"color:#24292E\\\">;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">@</span><span style=\\\"color:#005CC5\\\">test</span><span style=\\\"color:#24292E\\\">:</span><span style=\\\"color:#005CC5\\\">Config</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    dataProvider</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> mapDataProvider</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">function</span><span style=\\\"color:#6F42C1\\\"> mapDataProviderTest</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#E36209\\\"> value1</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#E36209\\\"> value2</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">string</span><span style=\\\"color:#E36209\\\"> fruit</span><span style=\\\"color:#24292E\\\">) </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#D73A49\\\"> error?</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    test</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">assertEquals</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#E36209\\\">value1</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">value2</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">msg</span><span style=\\\"color:#D73A49\\\"> =</span><span style=\\\"color:#032F62\\\"> \\\"The provided values are not equal\\\"</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    runtime</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">sleep</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#005CC5\\\">0.1</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    a </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#005CC5\\\"> 8</span><span style=\\\"color:#24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">function</span><span style=\\\"color:#6F42C1\\\"> mapDataProvider</span><span style=\\\"color:#24292E\\\">() </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#D73A49\\\"> map&#x3C;</span><span style=\\\"color:#24292E\\\">[</span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">string</span><span style=\\\"color:#24292E\\\">]</span><span style=\\\"color:#D73A49\\\">>|error</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    a </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#005CC5\\\"> 10</span><span style=\\\"color:#24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    map&#x3C;</span><span style=\\\"color:#24292E\\\">[</span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">string</span><span style=\\\"color:#24292E\\\">]</span><span style=\\\"color:#D73A49\\\">></span><span style=\\\"color:#24292E\\\"> dataSet </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"banana\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">10</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">10</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"banana\\\"</span><span style=\\\"color:#24292E\\\">],</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"cherry\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"cherry\\\"</span><span style=\\\"color:#24292E\\\">],</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"apple\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"apple\\\"</span><span style=\\\"color:#24292E\\\">],</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"orange\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"orange\\\"</span><span style=\\\"color:#24292E\\\">]</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    };</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    return</span><span style=\\\"color:#24292E\\\"> dataSet;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span></code></pre>\"],[1860089111,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">import</span><span style=\\\"color:#24292E\\\"> ballerina/lang.runtime;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">import</span><span style=\\\"color:#24292E\\\"> ballerina/test;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">isolated</span><span style=\\\"color:#005CC5\\\"> int</span><span style=\\\"color:#24292E\\\"> a </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#005CC5\\\"> 0</span><span style=\\\"color:#24292E\\\">;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">@</span><span style=\\\"color:#005CC5\\\">test</span><span style=\\\"color:#24292E\\\">:</span><span style=\\\"color:#005CC5\\\">Config</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    dataProvider</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> mapDataProvider</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">isolated</span><span style=\\\"color:#D73A49\\\"> function</span><span style=\\\"color:#6F42C1\\\"> mapDataProviderTest</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#E36209\\\"> value1</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#E36209\\\"> value2</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">string</span><span style=\\\"color:#E36209\\\"> fruit</span><span style=\\\"color:#24292E\\\">) </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#D73A49\\\"> error?</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    test</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">assertEquals</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#E36209\\\">value1</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">value2</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#E36209\\\">msg</span><span style=\\\"color:#D73A49\\\"> =</span><span style=\\\"color:#032F62\\\"> \\\"The provided values are not equal\\\"</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    runtime</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#6F42C1\\\">sleep</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#005CC5\\\">0.1</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    lock</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        a </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#005CC5\\\"> 8</span><span style=\\\"color:#24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">isolated</span><span style=\\\"color:#D73A49\\\"> function</span><span style=\\\"color:#6F42C1\\\"> mapDataProvider</span><span style=\\\"color:#24292E\\\">() </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#D73A49\\\"> map&#x3C;</span><span style=\\\"color:#24292E\\\">[</span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">string</span><span style=\\\"color:#24292E\\\">]</span><span style=\\\"color:#D73A49\\\">>|error</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    lock</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        a </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#005CC5\\\"> 10</span><span style=\\\"color:#24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    map&#x3C;</span><span style=\\\"color:#24292E\\\">[</span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">int</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">string</span><span style=\\\"color:#24292E\\\">]</span><span style=\\\"color:#D73A49\\\">></span><span style=\\\"color:#24292E\\\"> dataSet </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"banana\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">10</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">10</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"banana\\\"</span><span style=\\\"color:#24292E\\\">],</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"cherry\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"cherry\\\"</span><span style=\\\"color:#24292E\\\">],</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"apple\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"apple\\\"</span><span style=\\\"color:#24292E\\\">],</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#032F62\\\">        \\\"orange\\\"</span><span style=\\\"color:#D73A49\\\">:</span><span style=\\\"color:#24292E\\\"> [</span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#005CC5\\\">5</span><span style=\\\"color:#24292E\\\">, </span><span style=\\\"color:#032F62\\\">\\\"orange\\\"</span><span style=\\\"color:#24292E\\\">]</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    };</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    return</span><span style=\\\"color:#24292E\\\"> dataSet;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span></code></pre>\"]]"},"__N_SSG":true}