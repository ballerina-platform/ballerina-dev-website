{"pageProps":{"frontmatter":{"layout":"ballerina-left-nav-release-notes","title":"Swan Lake Preview 5","permalink":"/downloads/swan-lake-release-notes/swan-lake-preview5/","active":"swan-lake-preview5","redirect_from":["/downloads/swan-lake-release-notes/swan-lake-preview5"]},"content":"### Overview of Ballerina Swan Lake Preview 5 \n\nThis release is the fifth preview version of Ballerina Swan Lake. This release includes a new set of language features along with improvements and bug fixes to the compiler, runtime, standard libraries, and developer tooling.\n\n- [Updating Ballerina](#updating-ballerina)\n    - [For existing users](#for-existing-users)\n    - [For new users](#for-new-users)\n- [Highlights](#highlights)\n- [What is new in Ballerina Swan Lake Preview 5](#what-is-new-in-ballerina-swan-lake-preview-5)\n    - [Language](#language)\n        - [Isolated objects](#isolated-objects)\n        - [Lang lib functions to replace XML functional constructors](#lang-lib-functions-to-replace-xml-functional-constructors)\n        - [Unified object method scope and object field scope](#unified-object-method-scope-and-object-field-scope)\n        - [Improved lang library functions](#improved-lang-library-functions)\n    - [Runtime](#runtime)\n    - [Standard Library](#standard-library)\n        - [HTTP client remote method API improvement with data-binding support](#http-client-remote-method-api-improvement-with-data-binding-support)\n        - [SQL procedure call API improvement](#sql-procedure-call-api-improvement)\n        - [Misfire policy support for tasks](#misfire-policy-support-for-tasks)\n    - [Developer Tools](#developer-tools)\n        - [Code formatting](#code-formatting)\n- [Known Issues](#known-issues)\n\n### Updating Ballerina\n\nYou can use the update tool to update to Ballerina Swan Lake Preview 5 as follows.\n\n#### For existing users\n\nIf you are already using Ballerina, you can directly update your distribution to the Swan Lake channel using the [Ballerina update tool](/learn/cli-documentation/update-tool/). To do this, first, execute the command below to get the update tool updated to its latest version. \n                        \n> `ballerina update`\n\n Next, execute the command below to update to Swan Lake Preview 5.\n\n > `ballerina dist pull slp5`                 \n\nHowever, if you are using a Ballerina version below 1.1.0, install via the [installers](https://ballerina.io/downloads/).\n\n#### For new users\n\nIf you have not installed Ballerina, then download the [installers](https://ballerina.io/downloads/) to install.\n\n### Highlights\n\n- Migration from JDK 8 to JDK 11\n- Introduction of isolated objects for class definitions or object-type descriptors\n- Replacement of XML functional constructors by lang lib functions\n- Unification of the object field scope and object method scope into a single scope\n- Ability to assign a simple JSON value to a variable of the same type without casting\n- Improvements to the lang library functions\n- Improved HTTP client remote method API with data-binding support\n- Improved SQL procedure call API \n- Misfire policy support for tasks\n- Improved code formatting support for all the language features\n\n### What is new in Ballerina Swan Lake Preview 5\n\n#### Language\n\n##### Isolated objects\n\nA class definition or an object-type descriptor can now be marked as `isolated`. All fields of an `isolated` object that are not `final` or are not a subtype of `readonly` or `isolated object {}` have to be `private` fields.\n\nThe methods of an `isolated` object that access such fields can only refer to `self` within a `lock` statement, which ensures that there is no data race in accessing mutable state. If a method accesses such a field, additional rules apply to how values are transferred in and out in order to ensure that there are no references into the objectâ€™s mutable storage except via isolated objects. The initial value expressions of the fields also need to ensure the same.\n\n```ballerina\ntype Coordinates record {|\n    int latitude;\n    int longitude;\n|};\n\nisolated class Hotels {\n\n    private map<Coordinates> hotels = {};\n\n    isolated function add(string name, Coordinates coordinates) {\n        lock {\n            self.hotels[name] = coordinates.clone();\n        }\n    }\n\n    isolated function getCoordinates() returns map<Coordinates> {\n        lock {\n            return self.hotels.clone();\n        }\n    }\n}\n```\n\nAn `isolated` function can also access a `final` variable if the type of the variable is a subtype of `isolated object {}`.\n\n```ballerina\nfinal Hotels hotels = new;\n\nisolated function getCoordinates() returns Coordinates[] => hotels.getCoordinates().toArray();\n```\n\n##### Lang lib functions to replace XML functional constructors\n\nXML functional constructor syntax has been removed. In place of XML functional constructors, `'xml:createXXX` functions should be used. \n\n**Disallowed syntax**\n```ballerina\n'xml:Element element = 'xml:Element(\"elem\");\n'xml:Comment comment = 'xml:Comment(\"comment content\");\n'xml:ProcessingInstruction proceInstruc = 'xml:ProcessingInstruction(\"DONOT\", \"print this\");\n'xml:Text text = 'xml:Text(\"this is a character sequence\");\n```\n\n**Valid syntax**\n```ballerina\n'xml:Element element = 'xml:createElement(\"elem\");\n'xml:Comment comment = 'xml:createComment(\"comment content\");\n'xml:ProcessingInstruction proceInstruc = 'xml:createProcessingInstruction(\"DONOT\", \"print this\");\n'xml:Text text = 'xml:createText(\"this is a character sequence\");\n```\n\n##### Unified object method scope and object field scope \n\nObject field scope and object method scope have been unified into a single scope. This means that it is no longer possible to have fields and methods with the same name.\n\nWith this change, object methods can be accessed similar to object fields and the reference to `self` is captured in the resulting function pointer.\n\n```ballerina\nclass Accumulator {\n    int i;\n\n    function init(int i) {\n        self.i = i;\n    }\n\n    function accumulate(int acc) {\n        self.i = self.i + acc;\n    }\n\n    function get() returns int {\n        return self.i;\n    }\n}\n\npublic function main() {\n    Accumulator accumulator = new(0);\n    var acc = accumulator.accumulate; // access a method as a field\n    var getVal = accumulator.get;\n    acc(1); // similar to calling accumulator.accumulate(1);\n    acc(2);\n    int val = getVal();\n}\n```\n\n###### Improvement in accessing simple values in a JSON\n\nA non-structural value (i.e., simple value) in a JSON object can now be directly assigned to a variable of the same type without casting.\n\nFor this, the field access expression should be used with the `check` expression. The simple value should belong to one of the types: `()`, `int`, `float`, `decimal`, `string`, or  `boolean`.\n\n```ballerina\npublic function main() returns error? {\n    json j1 = {name: \"Anne\", age: 20, marks: {math: 90, language: 95}};\n    string name = check j1.name;\n    int age = check j1.age;\n}\n```\n\n##### Improved lang library functions\n\nSeveral changes and improvements have been introduced to the `ballerina/lang.value` lang library module.\n\n###### New `ensureType` function\n\nThis method can be used to check if a value belongs to the given type similar to the type cast expression. However, instead of panicking, this method returns an error if the type test fails.\n\n###### New `toBalString()` and `fromBalstring()` functions\n\nTwo new functions namely `toBalString()` and `fromBalstring()` have been introduced to roundtrip between `anydata` and Ballerina expression-like `string`. The `toBalString()` function converts a Ballerina value to a `string` that looks like a Ballerina expression (expression style). \n\nThe `fromBalstring()` function parses and evaluates a `string` produced by `toBalString()` when applied to an `anydata` value. The details of the conversion performed in `toBalString()` are specified by the `ToString` abstract operation defined in the Ballerina Language Specification using the expression style.\n\n###### More `isolated` lang library functions\n\nThese include lang library functions that accept an argument of a `function` type. With these functions, a parameter, which is of a `function` type may be annotated with the `@isolatedParam` annotation. \n\n```ballerina\npublic isolated function forEach(Type[] arr, @isolatedParam function(Type val) returns () func) returns () = external;\n``` \n\nWhen such a function is called in a context where an `isolated` call is expected, the argument passed for a parameter that is annotated with `@isolatedParam` should also be an `isolated` function.\n\n```ballerina\nint total = 0;\n\nfunction sum(int i) {\n    total += i;\n}\n\nisolated function validate(int i) {\n    if i > 100 {\n        panic error(string `Invalid Value: ${i}`);\n    }\n}\n\nfunction arraySum() {\n    int[] x = [1, 2, 3];\n\n    // Since `arraySum` is not `isolated`, non-isolated \n    // function `sum` can be passed as the argument.\n    x.forEach(sum);\n}\n\nisolated function validateArray() {\n    int[] x = [1, 2, 3];\n\n    // Since `validateArray` is `isolated`, the argument \n    // should also be an `isolated` function.\n    x.forEach(validate);\n}\n```\n\n#### Runtime\n\nThe Ballerina runtime Java API package name has been changed from `org.ballerinalang.jvm` to `io.ballerina.runtime`. A new `io.ballerina.api.TypeCreator` API is introduced to create Ballerina types at runtime.\n\n#### Standard library\n\n##### HTTP client remote method API improvement with data-binding support\n\nResponse payload binding functionality is provided for an HTTP client by returning the payload according to the `targetType` defaultable parameter that is mentioned in the remote method.\n\n**Previous syntax:**\n```ballerina\nhttp:Response|error res = clientEP->post(\"/path\", req);\n```\n\n**New syntax:**\n```ballerina\nhttp:Response|http:Payload|error res = clientEP->post(\"/path\", req, json);\n// or\njson payload = <json> check clientEP->post(\"/path\", req, json);\n```\n\n##### SQL procedure call API improvement\n\nThe SQL data type of the `Out` Parameter can now be defined in the SQL procedure call API, thus, eliminating the use of metadata to configure `Out` Parameter types.\n\n**Previous syntax:**\n```ballerina\nsql:OutParameter filterId = new;\n```\n\n**New syntax**\n```ballerina\nsql:IntegerOutParameter filterId = new;\n```\n\n##### Misfire policy support for tasks\n\nThe task module now supports the misfire policy. A new `misfirePolicy` field has been introduced in the `task:TimerConfiguration` and `task:AppointmentConfiguration` to specify the policy.\n\n#### Developer tools\n\n##### Code formatting\n\nImproved formatting support for all the language features. The new formatter also supports:\n\n- Range formatting\n- Line wrapping\n\n#### Known issues\n\n- The [WebSub](https://docs.central.ballerina.io/ballerina/websub/latest/) standard library module (ballerina/websub) is not working with Swan Lake Preview 5.\n- The [Socket](https://docs.central.ballerina.io/) standard library module (ballerina/socket) can only be built offline (i.e., with the `--offline` parameter) with Swan Lake Preview 5.\n","id":"swan-lake-preview5"},"__N_SSG":true}