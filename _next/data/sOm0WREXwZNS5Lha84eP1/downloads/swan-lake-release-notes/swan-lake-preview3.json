{"pageProps":{"frontmatter":{"layout":"ballerina-left-nav-release-notes","title":"Swan Lake Preview 3","permalink":"/downloads/swan-lake-release-notes/swan-lake-preview3/","active":"swan-lake-preview3","redirect_from":["/downloads/swan-lake-release-notes/swan-lake-preview3"]},"content":"### Overview of Ballerina Swan Lake Preview 3\n\nThis release is the third preview version of Ballerina Swan Lake. This release includes a new set of language features along with improvements and bug fixes to the compiler, runtime, standard libraries, and developer tooling.\n\nYou can use the update tool to update to Ballerina Swan Lake Preview 3 as follows.\n\n**For existing users:**\n\nIf you are already using jBallerina, you can directly update your distribution to the Swan Lake channel using the [Ballerina update tool](/learn/cli-documentation/update-tool/). To do this, first, execute the command below to get the update tool updated to its latest version. \n                        \n> `ballerina update`\n\n Next, execute the command below to update to Swan Lake Preview 3.\n\n > `ballerina dist pull slp3`                  \n\nHowever, if you are using a jBallerina version below 1.1.0, install via the [installers](https://ballerina.io/downloads/).\n\n**For new users:**\n\nIf you have not installed jBallerina, then download the [installers](https://ballerina.io/downloads/) to install.\n\n### Highlights\n\n- Support for defining external object method bodies\n- Order by clause for sorting\n- Inner/Nested query expressions \n- Support for executing stored procedures in the SQL connector\n- Azure Functions support\n\n### What's new in Ballerina Swan Lake Preview 3\n\n#### Language\n\nThe language implementation is based on [Ballerina Language Specifications Draft 2020-06-18](https://ballerina.io/spec/lang/draft/v2020-06-18/).\n\n##### External object method bodies\n\nThis release introduces support for defining object methods with external function bodies.\n\n```ballerina\ntype Person object {\n    string fname;\n    string lname;\n\n    function init(string fname, string lname) {\n        self.lname = lname;\n        self.fname = fname;\n    }\n\n    function getFullName() returns string = @java:Method {\n        class: \"abc.Hello\"\n    } external;\n};\n```\n\nThe Java method to which the `getFullName()` method is bound:\n\n```java\npublic static BString getFullName(ObjectValue objectValue) {\n        return objectValue.getStringValue(new BmpStringValue(\"fname\")).concat(new BmpStringValue(\" \")).concat(\n                    objectValue.getStringValue(new BmpStringValue(\"lname\")));\n}\n```\n\n##### `Order by` clause for sorting \n\nThis release introduces the `order by` clause support for sorting in query expression/action. An order-by clause is executed by constructing a list of entries.\n\n```ballerina\nStudent s1 = {id: 1, fname: \"John\", fee: 2000.56, age: 20};\nStudent s2 = {id: 2, fname: \"John\", fee: 2000.56, age: 22};\nStudent s3 = {id: 3, fname: \"Roger\", fee: 4000.56, age: 21};\nStudent s4 = {id: 4, fname: \"Kate\", fee: 2000.56, age: 24};\n\nStudent[] studentList = [s1, s2, s3, s4];\n\nStudent[] sortedList =  from var student in studentList\n                        order by student.age ascending, student.fname\n                        select student;\n```\n\n##### Inner/Nested query expressions\n\nThis release introduces the support to write inner/nested query expression/action.\n\n```ballerina\nPerson[] personList = [\n    {id: 1, fname: \"Alex\", lname: \"George\"},\n    {id: 2, fname: \"Ranjan\", lname: \"Fonseka\"},\n    {id: 3, fname: \"Idris\", lname: \"Elba\"},\n    {id: 4, fname: \"Dermot\", lname: \"Crowley\"}\n];\n\nDepartment[] deptList = [\n    {id: 1, name:\"HR\"},\n    {id: 2, name:\"Operations\"},\n    {id: 3, name:\"Engineering\"}\n];\n\nEmployee[] empList = [\n    {personId: 1, deptId: 2},\n    {personId: 2, deptId: 1},\n    {personId: 3, deptId: 3},\n    {personId: 4, deptId: 3}\n];\n\n\nDeptPerson[] deptPersonList =\n        from var emp in (from var e in empList select e)\n        join Person psn in (from var p in personList select p)\n            on emp.personId equals psn.id\n        join Department dept in (from var d in deptList select d)\n            on emp.deptId equals dept.id\n        select {\n            fname : psn.fname,\n            lname : psn.lname,\n            dept : dept.name\n        };\n```\n\n#### Standard library\n\n##### SQL connectors\n\nStored procedures can now be executed through SQL connectors (JDBC & MySQL). \n\n```ballerina\nint uid = 10;\nsql:OutParameter insertId = new;\n\nvar ret = dbClient->call(`call InsertPerson(${uid}, ${insertId})`);\nif (ret is error) {\n    io:println(\"Error occurred:\", err.message());\n} else {\n    io:println(\"Out Parameter insert id: \", insertId.get(int));\n    stream<record{}, sql:Error>? resultStr = ret.queryResult;\n    if (!(resultStr is ())) {\n        sql:Error? e = resultStr.forEach(function(record{} result) {\n        io:println(\"Full Customer details: \", result);\n      });\n    } else {\n        io:println(\"Stored  procedure does not return anything.\");\n    }\n}\n\n```\n##### Module organization\n\nThe `ballerina/nats` library was moved to Ballerina Central. Previously, this module was packed in the Ballerina distribution. With this change, this library can now be released independently.\n\n#### Developer tools\n\n##### Language server\n\n###### Introducing AI-based `Data Mapping` code action\n\nTwo record types can now be mapped automatically using the `Data Mapping` code action. Once a possible record mapping instance is identified, it suggests a mapping based on an AI algorithm. A mapping function will be generated automatically and added to the workspace to perform the record mapping.\n\nThe following is a sample in which the code action to generate a mapping function will appear when attempting to assign a mapping value to a variable of a type that is not directly assignable. \n\n```ballerina\ntype Grade record {|\n   int maths;\n   int physics;\n   int chemistry;\n|};\n \ntype NameAndGrade record {|\n   string name;\n   string surname;\n   int maths;\n   int physics;\n   int chemistry;\n|};\n \npublic function main() {\n   NameAndGrade student = {\n\tname: \"Kamal\",\n\tsurname: “Perera”,\n\tmaths: 90,\nphysics: 99,\nchemistry: 95\n   };\n   Grade grades = student;\n}\n```\nBy choosing the `Generate mapping function`code action, the following function will be added to the workspace.\n\n```ballerina\nfunction mapNameAndGradeToGrade(NameAndGrade nameAndGrade) returns Grade {\n// Some record fields might be missing in the AI-based mapping.\n   Grade grade = {\nmaths: nameAndGrade.maths, \nphysics: nameAndGrade.physics, \nchemistry: nameAndGrade.chemistry};\n   return grade;\n}\n```\n\nFurthermore, the line with the error would be replaced with a function call as shown below.\n\n```ballerina\nGrade grades = mapNameAndGradeToGrade(student);\n```\n\nFor more information, see [Code Actions](https://marketplace.visualstudio.com/items?itemName=WSO2.ballerina).\n\n##### Test framework\n\n###### Support single test execution\n\nA single test function or a set of functions can now be executed using the `--tests` flag as follows.\n\n```cmd\n$ ballerina test --tests <test_function> --all\n```\n\n###### API change in `assertEquals` and `assertNotEquals` functions\n\nDeep value equality is supported only for `anydata`-typed values according to the language specification. The `assertEquals` function has been changed to accept only  `anydata`-typed values to reflect this behavior.\n\n###### Introduction of the `assertExactEquals` and `assertNotExactEquals` functions\n\nThe `assertExactEquals` function compares two values to assert whether they refer to the same entity (i.e., they are exactly equal). \n\n```ballerina\nimport ballerina/test;\n\ntype Person object {\n    public string name = \"\";\n    public int age = 0;\n    public Person? parent = ();\n    private string email = \"default@abc.com\";\n    string address = \"No 20, Palm grove\";\n};\n\n@test:Config {}\nfunction testAssertObjectEquals() {\n   Person p1 = new;\n   Person p2 = p1;\n   test:assertExactEquals(p1, p2);\n}\n\n@test:Config {}\nfunction testAssertObjectNotEquals() {\n    Person p1 = new;\n    Person p2 = new ();\n    test:assertNotExactEquals(p1, p2);\n}\n\n```\n\n###### Introduction of the `@test:BeforeGroups` and `@test:AfterGroups` functions\n\nThese two new annotations can now be used when writing tests with the Ballerina test framework.\n\n\n```ballerina\nimport ballerina/io;\nimport ballerina/test;\n\n@test:BeforeGroups { value : [\"group1\"] }\nfunction beforeGroupsFunc() {\n\tio:println(“I’m a before groups function!”)\n}\n\n@test:Config {}\nfunction testFunction() {\n\tio:println(“I’m a test function!”)\n\n}\n\n@test:AfterGroups { value : [\"group1\"] }\nfunction afterGroupsFunc() {\n\tio:println(“I’m a after groups function!”)\n\n}\n```\n\n###### Introduction of the `alwaysRun` field to the `@test:AfterSuite` annotation\n\nYou can now specify `alwaysRun : true|false` in the `@AfterSuite` annotation, which enables running the `@AfterSuite` even if the `@BeforeSuite` function fails during the test execution. The default value is `false`.\n\n```ballerina\nimport ballerina/io;\nimport ballerina/test;\n\n\n@test:BeforeSuite\nfunction beforeSuiteFunc() {\n\tio:println(\"I’m the before suite function\");\n\tint a = 2/0;\n}\n\n@test:AfterSuite {}\nfunction afterSuiteFunc1() {\n\tio:println(\"I will be run only if before suite function executes successfully.\");\n}\n\n@test:AfterSuite { alwaysRun:true }\nfunction afterSuiteFunc2() {\n\tio:println(\"I will be run even if the before suite function fails.\");\n}\n```\n\n#### Code to Cloud\n\n##### Azure Functions support\n\nBallerina now supports writing serverless functions using the Azure Functions framework. \n\n```ballerina\nimport ballerina/http;\nimport ballerinax/azure.functions as af;\n\n@af:Function\npublic function fromHttpToQueue(af:Context ctx,\n        \t@af:HTTPTrigger {} af:HTTPRequest req,\n        \t@af:QueueOutput { queueName: \"queue1\" } af:StringOutputBinding msg)\n        \treturns @af:HTTPOutput af:HTTPBinding {\n\tmsg.value = req.body;\n\treturn { statusCode: 200, payload: \"Request: \" + req.toString() };\n}\n```\n\nFor more information, see [Azure Functions](https://ballerina.io/swan-lake/learn/deployment/azure-functions/).\n","id":"swan-lake-preview3"},"__N_SSG":true}