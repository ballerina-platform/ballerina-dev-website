{"pageProps":{"frontmatter":{"layout":"ballerina-asyncapi-support-left-nav-pages-swanlake","title":"AsyncAPI tool","description":"Check out how the Ballerina AsyncAPI tool makes it easy for you to start developing a service documented in an AsyncAPI contract.","keywords":"ballerina, programming language, asyncapi, contract","permalink":"/learn/asyncapi-tool/","active":"asyncapi-tool","intro":"AsyncAPI is a specification, which is used to describe and document message-driven APIs in a machine-readable format for easy development, discovery, and integration. Ballerina Swan Lake supports the AsyncAPI Specification version 2.x."},"content":"\n## Usage\n\nThe Ballerina AsyncAPI tool makes it easy for you to start the development of an event API documented in an AsyncAPI contract in Ballerina by generating a Ballerina service and listener skeletons.\n\n### Update the tool\n\nExecute the command below to update the asyncapi tool to the latest compatible version.\n\n```\n$ bal tool update asyncapi\n```\n\nFor more information on tool command, run `bal tool --help`.\n\n## Prepare the AsyncAPI contract\n\nBefore using the tool, there are some modifications that should be made by adding some custom tags to the contract.\n\nThis guide uses only a part of the <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/blob/main/asyncapi/slack/asyncapi.yml\" target=\"_blank\">AsyncAPI specification of Slack</a> for the purpose of simplicity.\n\n```yaml\nasyncapi: 2.1.0\nx-ballerina-event-identifier:\n  type: \"body\"\n  path: \"event.type\"\ncomponents:\n  schemas:\n    GenericEventWrapper:\n      additionalProperties: true\n      description: Adapted from auto-generated content\n      properties:\n        event:\n          additionalProperties: true\n          properties:\n            event_ts:\n              title: When the event was dispatched\n              type: string\n            type:\n              title: The specific name of the event\n              type: string\n            text:\n              title: The message content\n              type: string\n          required:\n            - type\n            - event_ts\n          title: \"The actual event, an object, which happened\"\n          type: object\n      required:\n        - event\n      title: Standard event wrapper for the Events API\n      type: object\nchannels:\n  app:\n    subscribe:\n      message:\n        oneOf:\n          - x-ballerina-event-type: \"app_mention\"\n            externalDocs:\n              description: Event documentation for `app_mention`\n            payload:\n              $ref: \"#/components/schemas/GenericEventWrapper\"\n            summary: Subscribe to only the message events that mention your app or bot\n            tags:\n              - name: allows_user_tokens\n              - name: app_event\n            x-scopes-required: []\n            x-tokens-allowed:\n              - user\n          - x-ballerina-event-type: \"app_rate_limited\"\n            externalDocs:\n              description: Event documentation for `app_rate_limited`\n            payload:\n              $ref: \"#/components/schemas/GenericEventWrapper\"\n            summary: Indicates that your app's event subscriptions are being rate limited\n            tags:\n              - name: allows_user_tokens\n              - name: app_event\n              - name: allows_workspace_tokens\n            x-scopes-required: []\n            x-tokens-allowed:\n              - user\n              - workspace\n```\n\nThere are custom tags in this YAML starting with `x-ballerina`. It is very important that these tags must be added to the AsyncAPI contract before using the tool. The usage of those tags are as follows.\n\n1\\. `x-ballerina-event-identifier` - When the listener receives an event from the event source (Slack is the event source in this scenario), there should be a way to identify the event type. This includes two parts, `type`, and `path`.\n\n- `type` - Type can be either header or body. In other words, the type of event can be included in the payload either as an HTTP header or as an attribute in the body.\n\n  > **Note:** Currently, this tool supports only the body property. Hence, the path is equal to the JSON path of the attribute.\n\n- `path` - Path is equal to the header-name if the type is `header`, or the JSON path of the attribute if the type is `body`.\n\n  > **Note:** Currently, this tool supports only HTTP-based event APIs.\n\n2\\. `x-ballerina-event-type` - This should be there in every event inside the channel. This is the name of the event or the value of the attribute mentioned above for a specific event.\n\n## Usage\n\nAfter modifying the AsyncAPI contract, the Ballerina sources can be generated using the commands below.\n\n```\n$ bal asyncapi [-i | --input] <asyncapi-contract-file-path> [-o | --output] <output-location>\n```\n\nThe generated service can be used as a code template to start the service implementation.\nFor example,\n\n```\n$ bal asyncapi -i hello.yaml\n```\n\n## Command options\n\nThe below command-line arguments can be used with the command.\n\n| Command option      | Description                                                                                                                                                                                                                                                                                                                                                                     | Mandatory/Optional |\n|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n| `-i, --input`  | The `asyncapi-contract-path` command option specifies the path of the AsyncAPI contract file (e.g., `my-api.yaml` or `my-api.json`).                                                                                                                                                                                                                                                                                                                               | Mandatory           |\n| `-o, --output`     | The Ballerina files get generated at the same location from which the `bal asyncapi` command is executed. Optionally, you can point to another directory location by using this flag.                                                                                                                                           | Optional           |\n\nThis command generates Ballerina service and listener skeletons (i.e., the four Ballerina files below) from the given AsyncAPI definition file.\n\n1. `data_types.bal` - contains all the Ballerina data types extracted from the AsyncAPI definition\n2. `service_types.bal` - contains all the service types relevant to the event API described in the AsyncAPI definition\n3. `listener.bal` - contains the HTTP listener, which listens to the relevant third-party service\n4. `dispacther_service.bal` - contains the event dispatching logic\n\nThe generated Ballerina sources are written into the same directory from which the command is run. The above command can be run from anywhere on the execution path. It is not mandatory to run it from within a Ballerina package. \n\nThe above AsyncAPI to Ballerina command supports several usages in the Ballerina AsyncAPI tool as follows.\n\n## Generate to a specified location\n\nIf you want to generate Ballerina sources to a specific provided output location, you can modify the above command as below.\n\n```\n$ bal asyncapi -i hello.yaml -o ./output_path\n```\n\nThen, the generated files can be modified according to the custom requirements. When modifying the generated code segments, it is easier to consider the below facts.\n\n- All the incoming requests are received by the resource method in the `dispatcher_service.bal` file. Hence, if there is a necessity to add an authentication logic for the incoming calls, that logic can be included there before processing the incoming HTTP request.\n- If more information is needed when initializing the listener such as secrets, endpoint URLs, tokens, refresh tokens, etc., update the `init` function in the `listener.bal` file.\n\nBelow are some example libraries generated using the tool.\n\n| Module     | AsyncAPI specification                                                                                                                | Generated and modified code                                                                                                | Published module                                                                                 |\n| ---------- | ------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ |\n| **Slack**  | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/blob/main/asyncapi/slack/asyncapi.yml\" target=\"_blank\">`asyncapi.yml` of Slack</a>   | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/tree/main/asyncapi/slack\" target=\"_blank\">`asyncapi-triggers/slack`</a>   | <a href=\"https://central.ballerina.io/ballerinax/trigger.slack\" target=\"_blank\">`ballerinax/trigger.slack`</a>   |\n| **Twilio** | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/blob/main/asyncapi/twilio/asyncapi.yml\" target=\"_blank\">`asyncapi.yml` of Twilio</a> | <a href=\"https://github.com/ballerina-platform/asyncapi-triggers/tree/main/asyncapi/twilio\" target=\"_blank\">`asyncapi-triggers/twilio`</a> | <a href=\"https://central.ballerina.io/ballerinax/trigger.twilio\" target=\"_blank\">`ballerinax/trigger.twilio`</a> |\n\n## Example\n\nFollow the steps below to execute the generated Ballerina sources.\n\n1\\. Navigate to the directory in which the generated files exist.\n\n2\\. Execute the `bal init` command.\n\n> **Info:** This generates a `Ballerina.toml` file.\n\n3\\. Create a new Ballerina file inside the directory (e.g., `slack_service.bal` ) and copy the code below to it.\n\n```ballerina\nlistener Listener webhookListener = new (8090);\n\nservice AppService on webhookListener {\n    remote function onAppMention(GenericEventWrapper event) returns error? {\n        //Implement the logic to use the received `event` here.\n    }\n\n    remote function onAppRateLimited(GenericEventWrapper event) returns error? {\n        //Implement the logic to use the received `event` here.\n    }\n}\n```\n\n4\\. Execute the `bal run` command to execute this.\n","id":"asyncapi-tool","sub":"","third":"","slug":"asyncapi-tool","codes":"[[-1856071241,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">asyncapi</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#005CC5\\\">2.1.0</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">x-ballerina-event-identifier</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">  type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">\\\"body\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">  path</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">\\\"event.type\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">components</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">  schemas</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">    GenericEventWrapper</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">      additionalProperties</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#005CC5\\\">true</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">      description</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">Adapted from auto-generated content</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">      properties</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">        event</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">          additionalProperties</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#005CC5\\\">true</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">          properties</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            event_ts</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              title</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">When the event was dispatched</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">string</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            type</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              title</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">The specific name of the event</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">string</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            text</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              title</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">The message content</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">string</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">          required</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">            - </span><span style=\\\"color:#032F62\\\">type</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">            - </span><span style=\\\"color:#032F62\\\">event_ts</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">          title</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">\\\"The actual event, an object, which happened\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">          type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">object</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">      required</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">        - </span><span style=\\\"color:#032F62\\\">event</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">      title</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">Standard event wrapper for the Events API</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">      type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">object</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">channels</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">  app</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">    subscribe</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">      message</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">        oneOf</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">          - </span><span style=\\\"color:#22863A\\\">x-ballerina-event-type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">\\\"app_mention\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            externalDocs</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              description</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">Event documentation for `app_mention`</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            payload</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              $ref</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">\\\"#/components/schemas/GenericEventWrapper\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            summary</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">Subscribe to only the message events that mention your app or bot</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            tags</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#22863A\\\">name</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">allows_user_tokens</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#22863A\\\">name</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">app_event</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            x-scopes-required</span><span style=\\\"color:#24292E\\\">: []</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            x-tokens-allowed</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#032F62\\\">user</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">          - </span><span style=\\\"color:#22863A\\\">x-ballerina-event-type</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">\\\"app_rate_limited\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            externalDocs</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              description</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">Event documentation for `app_rate_limited`</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            payload</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">              $ref</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">\\\"#/components/schemas/GenericEventWrapper\\\"</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            summary</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">Indicates that your app's event subscriptions are being rate limited</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            tags</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#22863A\\\">name</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">allows_user_tokens</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#22863A\\\">name</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">app_event</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#22863A\\\">name</span><span style=\\\"color:#24292E\\\">: </span><span style=\\\"color:#032F62\\\">allows_workspace_tokens</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            x-scopes-required</span><span style=\\\"color:#24292E\\\">: []</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#22863A\\\">            x-tokens-allowed</span><span style=\\\"color:#24292E\\\">:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#032F62\\\">user</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">              - </span><span style=\\\"color:#032F62\\\">workspace</span></span></code></pre>\"],[884221294,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color:#fff;color:#24292e\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">listener</span><span style=\\\"color:#24292E\\\"> Listener webhookListener </span><span style=\\\"color:#D73A49\\\">=</span><span style=\\\"color:#D73A49\\\"> new</span><span style=\\\"color:#24292E\\\"> (</span><span style=\\\"color:#005CC5\\\">8090</span><span style=\\\"color:#24292E\\\">);</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">service</span><span style=\\\"color:#24292E\\\"> AppService </span><span style=\\\"color:#D73A49\\\">on</span><span style=\\\"color:#24292E\\\"> webhookListener {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    remote</span><span style=\\\"color:#D73A49\\\"> function</span><span style=\\\"color:#6F42C1\\\"> onAppMention</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#E36209\\\">GenericEventWrapper</span><span style=\\\"color:#E36209\\\"> event</span><span style=\\\"color:#24292E\\\">) </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#D73A49\\\"> error?</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">        //Implement the logic to use the received `event` here.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#D73A49\\\">    remote</span><span style=\\\"color:#D73A49\\\"> function</span><span style=\\\"color:#6F42C1\\\"> onAppRateLimited</span><span style=\\\"color:#24292E\\\">(</span><span style=\\\"color:#E36209\\\">GenericEventWrapper</span><span style=\\\"color:#E36209\\\"> event</span><span style=\\\"color:#24292E\\\">) </span><span style=\\\"color:#D73A49\\\">returns</span><span style=\\\"color:#D73A49\\\"> error?</span><span style=\\\"color:#24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#6A737D\\\">        //Implement the logic to use the received `event` here.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color:#24292E\\\">}</span></span></code></pre>\"]]"},"__N_SSG":true}