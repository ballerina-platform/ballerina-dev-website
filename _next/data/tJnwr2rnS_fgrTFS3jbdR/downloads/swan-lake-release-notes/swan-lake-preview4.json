{"pageProps":{"frontmatter":{"layout":"ballerina-left-nav-release-notes","title":"Swan Lake Preview 4","permalink":"/downloads/swan-lake-release-notes/swan-lake-preview4/","active":"swan-lake-preview4","redirect_from":["/downloads/swan-lake-release-notes/swan-lake-preview4"]},"content":"### Overview of Ballerina Swan Lake Preview 4 \n\nThis release is the fourth preview version of Ballerina Swan Lake. This release includes a new set of language features along with improvements and bug fixes to the compiler, runtime, standard libraries, and developer tooling.\n\n- [Updating Ballerina](#updating-ballerina)\n    - [For existing users](#for-existing-users)\n    - [For new users](#for-new-users)\n- [Highlights](#highlights)\n- [What is new in Ballerina Swan Lake Preview 4](#what-is-new-in-ballerina-swan-lake-preview-4)\n    - [Language](#language)\n        - [Class definitions](#class-definitions)\n        - [Object-constructor expressions](#object-constructor-expressions)\n        - [Distinct objects](#distinct-objects)\n        - [Final fields in objects](#final-fields-in-objects)\n        - [Isolated functions](#isolated-functions)\n        - [Improved support for quoted identifiers](#improved-support-for-quoted-identifiers)\n        -  [Subsequent initialization support for local final variables](#subsequent-initialization-support-for-local-final-variables)\n        - [Handle errors at a single point](#handle-errors-at-a-single-point)\n        - [The `fail` statement](#the-fail-statement)\n        - [Predeclared module prefixes](#predeclared-module-prefixes)\n        - [Improved lang library functions](#improved-lang-library-functions)\n    - [Runtime](#runtime)\n        - [jBallerina runtime APIs](#jballerina-runtime-apis)\n        - [Asynchronous Java interoperability](#asynchronous-java-interoperability)\n    - [Standard library](#standard-library)\n    - [Developer tools](#developer-tools)\n        - [The OpenAPI tool](#the-openapi-tool)\n        - [Improvements related to code actions](#improvements-related-to-code-actions)\n        - [Code formatting](#code-formatting)\n\n### Updating Ballerina\n\nYou can use the update tool to update to Ballerina Swan Lake Preview 4 as follows.\n\n#### For existing users\n\nIf you are already using Ballerina, you can directly update your distribution to the Swan Lake channel using the [Ballerina update tool](http://ballerina.io/swan-lake/learn/keeping-ballerina-up-to-date/). To do this, first, execute the command below to get the update tool updated to its latest version. \n                        \n> `ballerina update`\n\n Next, execute the command below to update to Swan Lake Preview 4.\n\n > `ballerina dist pull slp4`                  \n\nHowever, if you are using a Ballerina version below 1.1.0, install via the [installers](https://ballerina.io/downloads/).\n\n#### For new users\n\nIf you have not installed Ballerina, then download the [installers](https://ballerina.io/downloads/) to install.\n\n### Highlights\n\n- Revised Ballerina object syntax, which differentiates the object type from the `class`, from which you can create object values. \n- Introducing `isolated` functions to achieve concurrency safety together with `readonly` values.  \n- Introducing `distinct` object types offering the functionality similar to what is  provided in nominal type systems.\n- Improvements to quoted identifiers to support arbitrary, non-empty strings as Ballerina identifiers.\n\n### What is new in Ballerina Swan Lake Preview 4\n\n#### Language\n\nThe language implementation is based on the [Ballerina Language Specifications Draft 2020-09-22](https://ballerina.io/spec/lang/draft/v2020-09-22/) and the new [Transactions proposal](https://github.com/ballerina-platform/ballerina-spec/blob/master/lang/proposals/transaction/transaction.md).\n\n##### Class definitions\n\n###### Module-class definitions\n\nWith the introduction of module-class definitions, the type of the object and the implementation of the behavior of the object are separated. Module-class definitions describe both the type of the object and the behavior of that object whereas object-type definitions describe only the type of the object. \n\nThe `abstract` objects are now plain object-type definitions and the previous object-type definitions with implementations are now module-class definitions.\n\nTo migrate existing code easily, you can abstract this change by simply replacing `type Obj object {...};` with `class Obj {...}`.\n\n**Previous syntax:**\n\n```ballerina\npublic type Obj object {\n    int i;\n    function init(int i) {\n        self.i = i;\n    }\n};\n```\n\n**New syntax:**\n\n```ballerina\npublic class Obj {\n    int i;\n    function init(int i) {\n        self.i = i;\n    }\n}\n```\n\n###### Object-type descriptor\n\nObject-type descriptors can be used to describe an object type. \n\n>**Note:** They cannot be used to create object values. \n\nSimilar to the previous `abstract object`, object-type definitions no longer support specifying the default values for fields.\n\nTo migrate existing abstract object-type definitions, you can simply remove the `abstract` keyword from the type definition.\n\n**Previous syntax:**\n\n```ballerina\ntype Obj abstract object {\n    function foo(int i);\n};\n```\n\n**New syntax:**\n\n```ballerina\ntype Obj object {\n    function foo(int i);\n};\n```\n\n##### Object-constructor expressions\n\nObject-constructor expressions can be used to define an object inline as opposed to referring to a pre-defined class with a `new` expression. The parameter list of an `init` method within an object constructor expression must be empty.\n\n```Ballerina\npublic function main() {\n    var ob = object { \n        function foo() { \n            // do something \n        }\n    };\n}\n```\n\nObject-constructor expressions also support a type reference in which the referenced type is included in the object type in the same way as in an object-type inclusion.\n\n```ballerina\nclass RefClass {\n    int x;\n    function init(int y) {\n        self.x = y;\n    }\n}\n\nvar objectValue = object RefClass { \n    function init() {\n        self.x = 4;\n    }\n};\n```\n\n##### Distinct objects\n\nThis release adds support for defining `distinct` object types. This provides a way to achieve an effect similar to nominal typing for objects within the Ballerina structural type system.\n\n```ballerina\ndistinct class Student {\n    function getKind() returns string {\n        return \"Student\";\n    }\n}\n\ndistinct class Employee {\n    function getKind() returns string {\n        return \"Employee\";\n    }\n}\n\nStudent p = new ();\nEmployee q = p; // error: incompatible types: expected 'Employee', found 'Student'\n// Sub-typing relationship is indicated by type inclusion of `Employee`.\ndistinct class Manager {\n    *Employee;\n    function getKind() returns string {\n        return \"Manager\";\n    }\n}\n\nManager r = new ();\nEmployee s = r; // This is allowed since ‘Manager’ is a distinct subtype of ‘Employee’\n\n```\n\n##### Final fields in objects\n\nClasses and object-constructor expressions can define fields as `final` fields. A value can only be assigned to such a field during the object construction (i.e., via an initializer expression or in the `init` method). A `final` field of an object cannot be assigned a new value once the object is created.\n\n```ballerina\nclass Controller {\n    final string id = \"default\";\n    final map<decimal> config;\n    int priority;\n\n    function init(map<decimal> config, int priority) {\n        self.config = config;\n        self.priority = priority;\n    }\n}\n```\n\n>**Note:** Objects no longer allow `read-only` fields. \n\n##### Isolated functions\n\nA function that accesses mutable values only via its parameters can now be marked as an `isolated` function. Concurrency safety can be guaranteed when `isolated` functions are used with immutable values or by controlling the arguments passed to the `isolated` function.\n\n```ballerina\nisolated function addSum(int[] arr, int i, int j) {\n    arr.push(i + j);\n}\n```\n\nA function can be marked as `isolated` if it\n- accesses the global state only if it is immutable (i.e., variables that are implicitly or explicitly `final` and the type is a subtype of `readonly` (immutable values)) \n- calls a function or a method only if that function or method is `isolated`\n- does not start new workers\n\n##### Improved support for quoted identifiers\n\nThe quoted identifier feature has been improved by adding the support for extending the types of the characters that are allowed. This adds the possibility of using arbitrary, non-empty strings as identifiers. The quoted identifiers can be used with a `’` prefix and the following supported character sets.\n\n- Alphanumeric characters\n- Underscore\n- ASCII special characters with a preceding `\\` escape character\n- The JVM-reserved character set is now supported by Ballerina through an encoding scheme\n- Unicode characters \n- Characters specified with hexadecimal Unicode code points (e.g., ` \\u{1234}`)\n\n```ballerina\n// Quoted identifiers in type names and field names.\ntype 'Person_\\{name\\&ĀǤȆ\\} record {|\n    string 'first\\ name;\n    int 'ĀǤȆ;\n|};\n\n// Quoted identifiers in function names.\nfunction 'get_ɱȅșșȧǧȅ_with\\#(int value) returns string {\n    return value.toString() + \" is numeric value\";\n}\n\npublic function main() {\n    'Person_\\{name\\&ĀǤȆ\\} person = {'first\\ name: \"John\",  'ĀǤȆ: 25};\n\n    string message = 'get_ɱȅșșȧǧȅ_with\\#(5);\n\n    // Quoted identifiers with hexadecimal code points.\n    string 'unicode_\\u{2324} = \"John Doe\";\n}\n```\n\n##### Subsequent initialization support for local final variables\n\nLocal final variables can now be defined without an initializer expression as long as they are initialized before they are referenced, similar to ordinary local variables. However, a value cannot be assigned to a `final` variable more than once.\n\n```ballerina\nmap<int> lengths = {};\n\nfunction addLength(string key, string|string[] value) {\n    final int length;\n\n    if value is string {\n        length = value.length();\n    } else if value.length() == 0 {\n        length = 0;\n    } else {\n        length = value[0].length();\n    }\n\n    lengths[key] = length;\n}\n```\n\n##### Handle errors at a single point\nBallerina supports handling errors at a single place using the `on fail` clause. The `on fail` clause can be used optionally with statements such as `while`, `foreach`, `do`, `transaction`, `retry`, `lock`, and `match`. \n\n```ballerina\n    do {\n        int parsedNum = check parse(\"12\");\n\n        // Parsing a random string will return an error. \n        // Thereafter, the control is transferred to the `on fail` clause.\n        int parsedStr = check parse(\"invalid\");\n\n        var res = commit;\n    } on fail error e {\n        io:println(\"Error occurred during parsing: \", e.message());\n    }\n\n```\n\n##### The `fail` statement\n\nExecuting a `fail` Statement will cause the control flow to transfer to the `on fail` clause of the nearest lexically-enclosing statement that has an `on fail` clause. If there is no `on fail` clause, then it breaks the current execution and returns an error.\n\n```ballerina\n    do {\n        if (accountID < 0) {\n            InvalidAccountIDError invalidAccountIdError = \n                InvalidAccountIDError(INVALID_ACCOUNT_ID, accountID = accountID);\n            fail invalidAccountIdError;\n        } else if (accountID > 100) {             \n            AccountNotFoundError accountNotFoundError = \n                AccountNotFoundError(ACCOUNT_NOT_FOUND, accountID = accountID);\n            fail accountNotFoundError;\n        }\n    // The type of `e` should be the union of the error types that could\n    // result in transferring control from the `do` statement.\n    } on fail InvalidAccountIDError|AccountNotFoundError e {\n        io:println(\"Error occurred: \", e.message(),\", Account ID: \", e.detail()[\"accountID\"]);\n    }\n```\n\n##### Predeclared module prefixes\n\nThe module prefix `t` (which could be `boolean`, `decimal`, `error`, `float`, `future`, `int`, `map`, `object`, `stream`, `string`, `table`, `typedesc`, or `xml`) has been predeclared as referring to the `lang.t` lang library module now.\n\nSuch modules can now be used without explicitly importing them.\n\n```ballerina\npublic function main() {\n    int max = 'int:max(311, 22, 41234);\n}\n```\n\n##### Improved lang library functions\n\nSeveral changes and improvements have been introduced to the `ballerina/lang.value` and `ballerina/lang.array` lang library modules. \n\n###### Improved lang library support for JSON\n\nTwo new functions (i.e., `fromJsonDecimalString()` and `fromJsonFloatString()`) have been introduced to support different numeric types when converting (parsing) a `string` as `json`. The `fromJsonDecimalString()` function converts numeric values to `decimal` whereas the `fromJsonFloatString()` function converts them to `float`.\n\nThe `fromJsonString()` function now converts numeric values as follows. \n\nIf the numeric value starts with the negative sign (`-`) and is numerically equal to zero (0), it is converted to `float`  `-0.0`. If the numeric value is syntactically an integer, it is converted to an `int` value. All other numeric values are converted to `decimal` values.\n\n###### Changes to `toString()`\n\nThe `toString()` function now performs a direct conversion of the value to a string rather than producing a string that describes the value. The details of the conversion are specified by the `ToString` abstract operation defined in the Ballerina Language Specification using the direct style.\n\nIf a `student` is a record value defined as follows,\n\n```ballerina\nStudent student = {\n   name : \"Anne\",\n   address : (),\n   age : 23,\n   grades : [\"A\", \"A+\", \"B\"]\n};\n```\n\nevaluating `student.toString()` results in a different output as follows.\n\n**Previous result:**\n\n```bash\nname=Anne address= age=23 grades=A A+ B\n```\n\n**New result:**\n\n```bash\n{\"name\":\"Anne\",\"address\":null,\"age\":23,\"grades\":[\"A\",\"A+\",\"B\"]}\n```\n\n###### Improved `lang.array:sort()` function\n\nThis release supports an improved `ballerina/lang.array:sort()` function. Now, you can specify the `direction` in which the sorting should be done and a `key` function, which returns a value that is used to order the members when sorting. \n\nThe `sort()` function returns an array consisting of the members of the original array in the sorted order. If the member type of the array is not ordered, then the key function must be specified. \n\n```ballerina\nstring[] cars = [\"Ford\", \"Toyota\", \"Mitsubishi\", \"BMW\", \"Tesla\"];\nstring[] sortedCars = cars.sort(array:DESCENDING, car => car.length());\n```\n\n#### Runtime\n\n##### jBallerina runtime APIs\n\nThe jBallerina runtime APIs were moved to the `org.ballerinalang.jvm.api` package and new APIs were introduced. The following APIs can be used to manage various runtime constructs.\n\n| Class         | Usage |\n|---------------|--------------------|\n| BValueCreator | Create ballerina value instances.|\n| BErrorCreator | Create ballerina error instances.|\n| BExecutor | The entry point from the server connector side to the Ballerina side.  After finding the resource, server connector implementations can use this API to invoke the Ballerina engine.|\n| BRuntime     | The external API to be used by the interop users to control the Ballerina runtime behavior.|\n| BStringUtils  | Common utility methods used for string manipulation.|\n\n##### Asynchronous Java interoperability \n\nCalling async Java methods from Ballerina has been formalized using a new API. Previously, this was achieved by setting internal values to the Ballerina `Strand` object. With this change, any Java extern method accepting `BalEnv` as the first parameter, will be given an instance of the execution context. \n\nThe `BalEnv` execution context instance provides a `markAsync` method, which will mark the current Java method as asynchronous making the Ballerina runtime wait on it in a non-blocking way.\n\n##### Ballerina Intermediate Representation (BIR) optimizations and improvements\n\nThe BIR has been optimized to reuse temporary variables inside Ballerina functions. This reduces the number of instructions in the byte-code representation contributing to reductions in method sizes and slightly-better runtime performance.\n\nAlso, The BIR binary format is now represented in a structured form using the [Kaitai Struct Language](https://doc.kaitai.io/user_guide.html). Kaitai Struct Language is a commonly-used approach to define binary formats. With the structured format, the BIR now can be easily understood and validated, which will help any user who wants to understand and work on generating different target executable code (e.g., generating LLVM-based executable code by reading the BIR). \n\nThe BIR binary structure is represented as the [Kaitai Structure](https://github.com/ballerina-platform/ballerina-lang/blob/master/docs/bir-spec/src/main/resources/kaitai/bir.ksy).\n\nThe BIR is now improved by including local variable scope information. With this support, the debugging view of local variables within functions has been improved to show correct-scoped variables during the debugging sessions. \n\nAlong with the scoping, BIR now contains a new variable kind named `SYNTHETIC`, which identifies the variables generated at the de-sugar phase. These are skipped when adding meta-data so that generated variables do not appear in the scope with a debug hit.\n\n#### Standard library\n\nRe-align organization names of the connectors. \n\n|Modules|Old Organisation|New Organisation|\n|:---:|:---:|:---:|\n|mysql| ballerina/mysql| ballerinax/mysql|\n|kafka| ballerina/kafka| ballerinax/kafka|\n|rabbitmq| ballerina/rabbitmq| ballerinax/rabbitmq|\n|nats| ballerina/nats| ballerinax/nats|\n\n#### Developer tools\n\n##### The OpenAPI tool\n\n###### OpenAPI CLI\n\nThe behavior of the OpenAPI CLI command was changed to make it easier to use. Now, you can generate Ballerina code from an OpenAPI contract and vice versa.\n\n###### OpenAPI to Ballerina\n\n```bash\n$  ballerina openapi -i <contract>  -o <output path>\n```\n\n- You can give the contract file in the YAML or JSON format.\n- The above command generates both the service and client stubs.\n- The command will give an output of three files containing the service, client and schema.\n\n**Command output example:**\n\n``` bash\n$ ballerina openapi -i petstore.yaml  \nThe service generation process is complete. The following files were created.\n-- petstore-service.bal\n-- petstore-client.bal\n-- schema.bal\n```\n\n- If you are interested in creating only a service, you can use the `mode` option to give the required mode. The `mode` can be a service or a client.\n\n```bash\n$  ballerina openapi -i <contract> --mode (service | client ) -o <output Path>\n```\n\n- You can specify the output path with the `-o` option.\n\n```bash\n$  ballerina openapi -i <contract> --service-name <service name> -o <output Path>\n```\n\n- If you are interested in creating a service with resources having a specific tag or an `operationId`, you can do the following.\n\n```bash\n$  ballerina openapi -i <contract> --tags <tags> -o <output Path>\n$  ballerina openapi -i <contract> --operations <operationIds> -o <output Path>\n```\n\n###### Ballerina to OpenAPI\n\n```bash\n$  ballerina openapi -i <ballerina service file>   -o <output path> \n```\n\nThe service name is not mandatory and you can give the service name if you want to document a specific service. Otherwise, it will generate all the services that are included in the Ballerina source file.\n\n\n```bash\n$  ballerina openapi -i <ballerina service file>  --service <service Name> -o <output path>\n```\n\n##### Improvements related to code actions\n\n###### Azure Functions\n\nFix for [Pure HTTP Functions Not Working](https://github.com/ballerina-platform/module-ballerinax-azure.functions/issues/33).\n\n###### AWS Lambda\n\nAdded domain-specific event types support.\n\n##### Code formatting\n\nA new formatter is introduced with a limited support for language features.\n","id":"swan-lake-preview4"},"__N_SSG":true}