{"pageProps":{"frontmatter":{"layout":"ballerina-left-nav-release-notes","title":"Swan Lake Preview 8","permalink":"/downloads/swan-lake-release-notes/swan-lake-preview8/","active":"swan-lake-preview8","redirect_from":["/downloads/swan-lake-release-notes/swan-lake-preview8"]},"content":"\n### Overview of Ballerina Swan Lake Preview 8 \n\nThis release is the eighth preview version of Ballerina Swan Lake. It includes a new set of language features along with improvements and bug fixes to the compiler, runtime, standard library, and developer tooling.\n\n- [Updating Ballerina](#updating-ballerina)\n    - [For Existing Users](#for-existing-users)\n    - [For New Users](#for-new-users)\n- [Highlights](#highlights)\n- [What is new in Ballerina Swan Lake Preview 8](#what-is-new-in-ballerina-swan-lake-preview-8)\n    - [Language](#language)\n        - [Support Identifier Escapes Without an Initial Quote](#support-identifier-escapes-without-an-initial-quote)\n        - [Included Record Parameters](#included-record-parameters)\n        - [Service Typing Changes](#service-typing-changes)\n        - [Listener Object](#listener-object)\n        - [Transactional Services](#transactional-services)\n    - [Standard Library](#standard-library)\n        - [HTTP Module Changes](#http-module-changes)\n        - [Log Module Changes](#log-module-changes)\n        - [Email Module Changes](#email-module-changes)\n        - [WebSub Module Changes](#websub-module-changes)\n        - [Introduced New Modules](#introduced-new-modules)\n\n#### Updating Ballerina\n\nYou can use the update tool to update to Ballerina Swan Lake Preview 8 as follows.\n\n##### For existing users\n\nIf you are already using Ballerina, you can directly update your distribution to the Swan Lake channel using the [Ballerina update tool](http://ballerina.io/swan-lake/learn/keeping-ballerina-up-to-date/). To do this, first, execute the command below to get the update tool updated to its latest version. \n                        \n> `ballerina update`\n\n Next, execute the command below to update to Swan Lake Preview 8.\n\n > `ballerina dist pull slp8`                 \n\nHowever, if you are using a Ballerina version below 1.1.0, install via the [installers](https://ballerina.io/downloads/).\n\n##### For new users\n\nIf you have not installed Ballerina, then download the [installers](https://ballerina.io/downloads/) to install.\n\n#### Highlights\n\n- Ability to use `\\` to escape the special characters in an identifier without specifying the initial quote\n- Introduction of included record parameters\n- Introduction of service typing changes basing services on objects\n- Extension of Ballerina transaction capabilities to define transactional resource functions and transactional remote functions\n- Improvements to the HTTP, Log, Email, and WebSub Standard Library modules\n- Introduction of the new GraphQL, NATS Streaming (STAN), UUID, and WebSocket Standard Library modules\n\n### What is new in Ballerina Swan Lake Preview 8\n\n#### Language\n\n##### Support identifier escapes without an initial quote\n\nNow, `\\` can simply be used to escape the special characters in an identifier without specifying the initial quote. For example, both the formats below are supported now.\n\n```ballerina\nint a\\-b;\nint 'a\\-b;\n```\n\n##### Included record parameters\n\nIncluded record parameters can be specified as `*T P` in which `T` denotes a record type descriptor and `P` denotes the name of the parameter.\n\nAn included record parameter is similar to a required parameter, but it also allows the caller of the function to specify the value for a field of the record type as a named argument using the field's name, as if it had been declared as a parameter.\n\nThe names of the fields in the record type of an included record parameter must be distinct from each other and also from the names of the other parameters, unless it is an optional field of type `never`.\n\nA named argument in a function call can correspond to the fields of an included record parameter in two different ways.\n\n1. Being relevant to a field of the included recorded parameter, which is not of the `never` type.\n\n   ```ballerina \n   import ballerina/io;\n \n   type Student record {\n       string firstName;\n       string lastName?;\n   };\n \n   function printStudentDetails(int admissionNo, *Student student) {\n       string name = student.firstName;\n \n       string? lastName = student?.lastName;\n       if lastName is string {\n           name += string ` ${lastName}`;\n       }\n \n       io:println(\"Admission No: \", admissionNo, \", Student Name: \", name);\n   }  \n \n   public function main() {\n       printStudentDetails(1001, firstName = \"Peter\");\n       printStudentDetails(1002, firstName = \"Anne\", lastName = \"Doe\");\n   } \n\n   ```\n\n2. Being relevant to a record rest descriptor of an included record parameter that is of an open record type. The following conditions should be satisfied for this.\n\n    - In the parameter list, there should be only one included record parameter that is of an open record type.\n    - The open record type must disallow fields of the same names as the other parameters and individual field descriptors of the other included record parameters, by including optional individual field descriptors of the type `never`.  In addition to these optional individual field descriptors, there should not be any other field descriptors in this record type.\n\n   ```ballerina\n   import ballerina/io;\n \n   type Grades record {|\n       never math?;\n       never physics?;\n       int...;\n   |};\n \n   function printAverage(int math, int physics, *Grades grades) {\n       int totalMarks = math + physics;\n       int count = grades.length() + 2;\n \n       foreach int grade in grades {\n           totalMarks += grade;\n       }\n \n       io:println(\"Average: \", totalMarks/count);\n   }\n \n   public function main() {\n       printAverage(90, 85);\n       printAverage(85, 85, chemistry = 75);\n       printAverage(75, 85, chemistry = 90, zoology = 80);\n   }\n   ```\n\n##### Service typing changes\n\nServices are now based on objects. The service declaration syntax below is mere syntactic sugar for creating a new instance of a service class and then attaching it to a listener. With this change, the path that the service should serve on can be provided in the service-declaration syntax. This was previously provided using an annotation.\n\n**Previous syntax**\n\n```ballerina\nimport ballerina/http;\n\nservice hello on new http:Listener(9090) {\n\n    resource function sayHello() returns error? {\n\n    }\n}\n```\n\n**New syntax**\n\n```ballerina\nimport ballerina/http;\n\nservice [/optional_base_path] on new http:Listener(9090) {\n\n    resource function get sayHello() returns string {\n\n    }\n}\n```\n\n>**Note:** There is no longer a service variable name as `hello` in the first example. \nSince services are objects, they can contain fields and regular methods. In addition to that, services can contain remote methods and resource methods.\n\nResource methods are defined as follows:\n\n `resource function` `resource-method-name` `resource-path` `() { }`\n\n- Resource methods do not have a method name similar to a regular method.\n- The `resource-method-name` informs the listener of the operations this resource allows. For example, in the HTTP listener, the `resource-method-name` maps to the HTTP methods such as `GET` or `PUT`.\n- The `resource-path` is the path in which this resource resides within the service. You can use `.` as the `resource-path` to indicate the path `/`.\n\nA service declared using the service-declaration syntax cannot be referred to using an identifier anymore. Instead, you need to use an object constructor prepended by the `service` keyword to declare a service object or create a new instance of a service class.\n\n```ballerina\nservice object { } hello = service object {\n    string message = \"Hello\";\n\n    resource function get sayHello() returns string {\n\n    }\n}\n\nlistener http:Listener l = new (7000);\nstring[] basePath = [\"/\"]; // service base path: /\nl.attach(hello, basePath);\n```\n\n```ballerina\nservice class HelloService {\n    string message;\n    resource function get sayHello() returns string {\n\n    }\n\n    function init(string message) {\n        self.message = message;\n    }\n}\n\nvar hello = new HelloService(\"Hello\");\nlistener http:Listener l = new(7000);\nstring[] basePath = [\"hello\", \"path\"]; // service on \"/hello/path\"\nl.attach(hello, basePath);\n```\n\n##### Listener object \n\nListener is no longer defined in `ballerina/lang.object` lang-library, now it is a compiler known internal type.\nA type is a listener object type if it is a subtype of the object type Listener<T,A>, for some type `T` that is a subtype of `service object {}` and some type `A` that is a subtype of `string[]|string|()`.\n\nThe `object type Listener<T,A>`, is described by the following object type descriptor:\n\n```ballerina\nobject {\n   public function attach(T svc, A attachPoint) returns error?;\n   public function detach(T svc) returns error?;\n   public function start() returns error?;\n   public function gracefulStop() returns error?;\n   public function immediateStop() returns error?;\n}\n```\n\n##### Transactional services\n\nBallerina transaction capabilities have been extended to services. Now, you can define transactional resource methods and transactional remote methods. These methods will be participants of global distributed transactions. Infection and agreement protocols are implemented based on the Ballerina distributed transaction protocol. \n\nBy defining services as participants, all services work as a single unit of work. If any of the services fail, the whole transaction will be reverted and if all the services are successfully called, the transaction will be completed and committed successfully. \n\n###### Defining transactional resource methods in a service\n\n```ballerina\ntransactional resource function get message(http:Caller caller, http:Request req) {\n    http:Response res = new;\n    callSomeService(res);        \n    callAnotherService(res);\n    checkpanic caller->respond(res);\n}\n```\n\n###### Defining transactional remote methods in a client object\n\n\n```ballerina\ntransactional remote function callMyFirstService() returns @tainted any|error {\n    return self.httpClient1->get(\"/echo/message\");\n}\n\ntransactional remote function callMySecondService() returns @tainted any|error {\n    return self.httpClient2->get(\"/user/history\");\n}\n```\n\n###### Calling the service\n\n```ballerina\ntransaction {\n    var res1 = client->callMyFirstService();\n    var res2 = client ->callMySecondService();\n    \n    var x = commit;\n    if (x is error) {\n        // error code\n    } else {\n        // success code\n    }\n}\n```                                                             \n\n#### Standard library\n\n##### `http` module changes\n\n###### Service declaration\n\n- Basepath field has been removed from the `ServiceConfig` annotation. Use the `absolute resource path` that begins with `/` as the basePath which is optional and defaults to `/` when not specified.\n- The service type can be added as `http:Service`, which is optional after the `service` keyword.\n\n**Previous syntax**\n\n```ballerina\n@http:ServiceConfig {\n    basePath: “hello”\n}\nservice myService on new http:Listener(9090) {\n\n}\n```\n\n**New syntax**\n\n```ballerina\nservice http:Service /hello on new http:Listener(9090) {\n\n}\n```\n\n###### Resource method declaration\n\n- Use the resource method name to specify the HTTP method to support instead of the `methods` field of the `ResourceConfig` annotation (e.g., `get`).\n- Use `default` as the resource method name when the resource has to support all methods including standard HTTP methods and custom methods (e.g., the passthrough/proxy use case).\n- The resource path segment represents the `path` as the `path` field of the `ResourceConfig` has been removed.\n- Use `.` to specify the resource path segment if the path needs to be set as `/`.\n- Path params are specified in the resource path segment within square brackets along with the type. The supported types are string, int, float, boolean (e.g., `path/[string foo]`).\n- Resource signature parameters are optional. Even the `Caller` and `Request` are optional and not ordered.\n- Query param binding support is added. The supported types are string, int, float, boolean, decimal, and the array types of the aforementioned types. The `Query` param type can be nilable (e.g., `(string? bar)`).\n- Rest param support is added. It can be used as a wildcard path segment to accept requests to multiple different paths. Earlier it was used as `/*` and now it can be specified as `[string… s]` in which `s` is accessible within the resource. \n- Use the `@http:Payload {}` annotation to denote the data binding param in the resource signature as the `body` field of the `ResourceConfig` has been removed.\n\n```ballerina\nservice http:Service /mytest on new http:Listener(9090) {\n    resource function post  foo/[int id]/bar/[string... extra](string? bar, http:Caller caller, @http:Payload {} json p) {\n        // [int id] is a path param\n        // [string... extra] is a rest param\n        // string? bar is a query param\n        // json p is the request payload\n    }\n}\n```\n\n\n##### `log` module changes\n\n- Log levels are reduced to `INFO` and `ERROR`. There will be no user configuration to control the log level. All the logs will be printed to the standard error stream.\n- There are only two APIs to log messages as follows.\n\n    1. Log `INFO` messages\n\n    ```ballerina\n    log:print(\"something went wrong\", id = 845315);\n\n    Output:\n    time = 2019-08-09 11:47:07,342 module = \"myorg/hello\" message = \"something went wrong\" id = 845315\n    ```\n\n    2. Log `ERROR` messages\n\n    ```ballerina\n    log:printError(\"something went wrong\", err = e, id = 845315);\n\n    Output:\n    time = 2019-08-09 11:47:07,342 module = \"myorg/hello\" message = \"something went wrong\" error = \"invaild operation\" id = 845315\n    ```\n\n- The API supports passing any number of key/value pairs along with the message.\n- Log messages are printed following the `LogFMT` standards.\n\n##### `email` module changes\n\nThe methods related to sending and receiving emails were renamed. The Listener API was divided into the POP and IMAP protocols. \n\n###### Client changes\n\n - The `email:Email` definition is changed to `email:Message`.\n - The `read` method of the `email:ImapClient`, `email:PopClient`, and `email:Listener` (i.e., the new `email:PopListener` and `email:ImapListener`) are changed to `receiveEmailMessage`.\n\n###### Service declaration\n\n- The `email:Listener` is split into the `email:PopListener` and `email:ImapListener`. Therefore, the `protocol` field is removed from the new protocol-specific listeners. The `email:PopConfig` or `email:ImapConfig` that was used as a field for the `email:Listener` is not required for new the API implementation. The protocol configuration-related fields are made parts of the new listeners.\n- The resource methods are changed to remote methods in the new listener APIs.\n- The service name is given as a string with the new Ballerina language changes.\n- The `onMessage` method of the `email:Listener` (i.e., the new `email:PopListener` and `email:ImapListener`) is changed to `onEmailMessage`.\n- The `pollingInterval` field of the `email:Listener` is changed to `pollingIntervalInMillis` in new listener APIs. That makes it consistent with other Ballerina modules, which have time durations configured in milliseconds.\n\nA sample POP3 listener is given below.\n\n**Previous syntax**\n\n```ballerina\nemail:PopConfig popConfig = {\n     port: 995,\n     enableSsl: true\n};\n\nlistener email:Listener emailListener = new ({\n    host: \"pop.email.com\",\n    username: \"reader@email.com\",\n    password: \"pass456\",\n    protocol: \"POP\",\n    protocolConfig: popConfig,\n    pollingInterval: 2000\n});\n\nservice emailObserver on emailListener {\n\n    resource function onMessage(email:Email emailMessage) {\n\n    }\n\n    resource function onError(email:Error emailError) {\n\n    }\n\n}\n```\n\n**New syntax**\n\n```ballerina\nlistener email:PopListener emailListener = new ({\n    host: \"pop.email.com\",\n    username: \"reader@email.com\",\n    password: \"pass456\",\n    pollingIntervalInMillis: 2000,\n    port: 995,\n    enableSsl: true\n});\n\nservice \"emailObserver\" on emailListener {\n\n    remote function onEmailMessage(email:Message emailMessage) {\n\n    }\n\n    remote function onError(email:Error emailError) {\n\n    }\n\n}\n```\n\n##### `websub` module changes\n\n- The base path is removed from the `SubscriberServiceConfig` annotation.\n- The `onNotification` and `onIntentVerification` resources are converted to remote methods.\n\n**Previous syntax**\n\n```ballerina\n@websub:SubscriberServiceConfig {\n  path: \"/websub\",\n  target: [\"http://localhost:9191/websub/hub\", \"http://websubpubtopic.com\"]\n}\nservice websubSubscriber on new websub:Listener(8181) {\n  resource function onIntentVerification(websub:Caller caller,  websub:IntentVerificationRequest request) {}\n  resource function onNotification(websub:Notification notification) {}\n}\n```\n\n**New syntax**\n\n```ballerina\n@websub:SubscriberServiceConfig {\n   target: [\"http://localhost:23191/websub/hub\", \"http://one.websub.topic.com\"]\n}\nservice websub:SubscriberService /websub on new websub:Listener(8181) {\n   remote function onIntentVerification(websub:Caller caller, websub:IntentVerificationRequest request) {}\n   remote function onNotification (websub:Notification notification) {}\n}\n```\n\n##### Introduced new modules\n\n###### GraphQL\n\nThe Ballerina GraphQL module is introduced with this release. This module provides the support to define GraphQL services and handle simple GraphQL queries. Currently, this supports GraphQL service endpoints with the resource methods, which return `graphql:Scalar` values (`int`, `string`, `boolean`, and `float`) and record types only.\n\n###### NATS Streaming (STAN)\n\nWith this release, a new module is introduced for NATS Streaming. Previously, the Ballerina NATS module included the support for streaming as well. Now, NATS and NATS Streaming are separated into Ballerina NATS and Ballerina STAN modules.\n\n###### UUID\n\nThe Ballerina UUID module is introduced with this release. This module provides functions related to UUID (Universally Unique Identifier) such as generating different types of UUIDs and validating and checking the versions of UUID strings.\n\n###### WebSocket\n\n- The WebSocket module has been moved out of the HTTP module. Therefore, you will have to change the import from `ballerina/http` to `ballerina/websocket`.\n- Introduced a new listener for the WebSocket module.\n\n**Previous syntax**\n\n```ballerina\nlistener http:Listener wsListener = new (9090);\n```\n\n**New syntax**\n\n```ballerina\nlistener websocket:Listener wsListener = new (9090);\n```\n\n- The base path is removed from the `WebSocketServiceConfig`.\n- Has 2 types of services. In order to work with WebSockets, the two services below are mandatory.\n\n    1. `websocket:UpgradeService` - This is to handle the WebSocket upgrade. This takes the `http:Request` and `http:Caller` parameters in. This service has a predefined `onUpgrade` remote method that returns a `websocket:Service` or an error. Earlier, this was handled by an HTTP upgrade resource. \n    2. `websocket:Service` - This is to handle events after the WebSocket upgrade. This service is still similar to the earlier WebSocket service, which had predefined resources like `onText`, `onBinary`, `onError`, `onPing`, and `onPong`. With the new syntax, all those resources are converted into remote methods.\n\n**Previous syntax**\n\n```ballerina\nimport ballerina/http;\n\nlistener http:Listener socketListener = new (9000);\n \n@http:WebSocketServiceConfig {\n   path: \"/basic\"\n}\nservice echo on socketListener {\n   resource function onText(http:WebSocketCaller caller, json text) {}\n   resource function onBinary(http:WebSocketCaller caller, byte[] b) {}\n}\n```\n\n**New syntax**\n\n```ballerina\nimport ballerina/http;\nimport ballerina/websocket;\n\nservice websocket:UpgradeService / basic on new websocket:Listener(9000) {\n\n    remote isolated function onUpgrade(http:Caller caller, http:Request req) \n            returns websocket:Service|websocket:WebSocketError {\n        return new WsService();\n    }\n}\n\nservice class WsService {\n    *websocket:Service;\n\n    remote isolated function onText(websocket:Caller caller, string data) {\n    }\n\n    remote isolated function onBinary(websocket:Caller caller, byte[] data) {\n    }\n}\n```\n","id":"swan-lake-preview8"},"__N_SSG":true}