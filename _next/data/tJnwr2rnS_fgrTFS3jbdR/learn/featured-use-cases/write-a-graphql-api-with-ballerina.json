{"pageProps":{"frontmatter":{"layout":"ballerina-graphql-guide-left-nav-pages-swanlake","title":"Write a GraphQL API with Ballerina","description":"This guide helps you understand the basics of Ballerina constructs which allow you to write GraphQL APIs.","keywords":"ballerina, graphql, ballerina packages, language-guide, standard library","permalink":"/learn/write-a-graphql-api-with-ballerina/","active":"write-a-graphql-api-with-ballerina","intro":"This guide walks through the steps of writing a GraphQL API in Ballerina.","redirect_from":["/learn/writing-a-graphql-api-with-ballerina/","/learn/writing-a-graphql-api-with-ballerina","/learn/write-a-graphql-api-with-ballerina","/learn/getting-started/writing-a-graphql-api-with-ballerina/","/learn/getting-started/writing-a-graphql-api-with-ballerina"]},"content":"\nDue to the batteries included nature of the Ballerina language, there is no need to add any third-party libraries to implement the GraphQL API. The Ballerina standard library itself is adequate. In this guide, you will be writing a simple GraphQL service to serve a dummy dataset related to COVID-19.\n\n## Set up the prerequisites\n\nTo complete this tutorial, you need:\n\n1. A command terminal\n2. A text editor\n    >**Tip:** Preferably, [Visual Studio Code](https://code.visualstudio.com/) with the [Ballerina extension](https://marketplace.visualstudio.com/items?itemName=WSO2.ballerina) installed.\n3. A [Ballerina installation](/learn/install-ballerina/set-up-ballerina/)\n\n## Design the GraphQL endpoint\n\nUsually, a GraphQL endpoint is defined using a GraphQL schema. Some languages require the GraphQL schema to create a\nGraphQL service (schema-first approach) while others do not need the schema to create the service\n(code-first approach). Ballerina GraphQL package uses the latter. Therefore, you do not need the schema file to create\nyour service, and instead, once you write the Ballerina service, the Ballerina GraphQL package will generate the schema.\n\nThe GraphQL endpoint you are going to create in this guide will have two main operations, `Query` and `Mutation`. The\n`Query` type will be used to read the data in the data source, and the `Mutation` operation will be used to update the\ndata in the data source.\n\n### The `Query` Type\nThe `Query` type has two fields.\n* The `all` field - This field will return all the data in the data source as an array.\n\n* The `filter` field - This field will return the data filtered by the ISO Code of a country(`isoCode`).\n\n### The `Mutation` Type\nThe `Mutation` type has a single field.\n* The `add` field - This field will add a given entry to the data source.\n\n## Create a data source for the project\n\nBefore writing the GraphQL service, let's create a data source for the project. This will mimic a database that stores\nthe data for the service. In this guide, you are going to use an in-memory table in Ballerina as the data source.\n\n### Define the types for the data source\n\n To create the table, you have to define the data type to use in the table. The following code defines the record type\n `CovidEntry`. A single entry will include the ISO code for the location (`isoCode`), name of the country (`country`),\n number of cases (`cases`), number of deaths (`deaths`), number of recovered cases (`recovered`), and the number of\n active cases (`active`).\n\n```ballerina\npublic type CovidEntry record {|\n    readonly string isoCode;\n    string country;\n    decimal cases?;\n    decimal deaths?;\n    decimal recovered?;\n    decimal active?;\n|};\n```\n\n### Add data to the data source\nNow you can add define the data table.\n\n```ballerina\ntable<CovidEntry> key(isoCode) covidEntriesTable = table [\n    {isoCode: \"AFG\", country: \"Afghanistan\", cases: 159303, deaths: 7386, recovered: 146084, active: 5833},\n    {isoCode: \"SL\", country: \"Sri Lanka\", cases: 598536, deaths: 15243, recovered: 568637, active: 14656},\n    {isoCode: \"US\", country: \"USA\", cases: 69808350, deaths: 880976, recovered: 43892277, active: 25035097}\n];\n```\nNow, as the data source is completed, let's move on to writing the GraphQL service.\n\n## Write the Ballerina service\n\nSince the data used in this guide map to a GraphQL `Object`, you first have to define this object type. In Ballerina, a\nGraphQL output object can be defined using either a service type or a record type.\n\nIn this guide, the endpoint is going to return the number of cases in thousands. Therefore, a service type is used to\ndefine the output object type, and inside the service type, each resource function will return the original value\ndivided by 1000.\n\n> **Note:** Since the GraphQL spec does not allow using an input object as an output object, the same record type cannot\n> be used as the input type of a method and the output type of a method.\n\n### Create the GraphQL object types\n\nThe following is the definition of the `CovidData` object type.\n\n```ballerina\npublic distinct service class CovidData {\n    private final readonly & CovidEntry entryRecord;\n\n    function init(CovidEntry entryRecord) {\n        self.entryRecord = entryRecord.cloneReadOnly();\n    }\n\n    resource function get isoCode() returns string {\n        return self.entryRecord.isoCode;\n    }\n\n    resource function get country() returns string {\n        return self.entryRecord.country;\n    }\n\n    resource function get cases() returns decimal? {\n        if self.entryRecord.cases is decimal {\n            return self.entryRecord.cases / 1000;\n        }\n        return;\n    }\n\n    resource function get deaths() returns decimal? {\n        if self.entryRecord.deaths is decimal {\n            return self.entryRecord.deaths / 1000;\n        }\n        return;\n    }\n\n    resource function get recovered() returns decimal? {\n        if self.entryRecord.recovered is decimal {\n            return self.entryRecord.recovered / 1000;\n        }\n        return;\n    }\n\n    resource function get active() returns decimal? {\n        if self.entryRecord.active is decimal {\n            return self.entryRecord.active / 1000;\n        }\n        return;\n    }\n}\n```\n\nHere, you are creating the `CovidData` service type to represent the GraphQL `Object` type that represents an entry in\nthe data set. Each resource method in this service represents a field of the GraphQL object type.  The return type of\nthe resource method is the type of the field.\nThe resource methods returning `isoCode` and the `country` have the return type `string`, which means these fields\ncannot be `null` in the GraphQL response. In other words, these fields have `NON_NULL` types. (In GraphQL, these are\nrepresented by the exclamation mark `!`. E.g., `String!`). However, the resource methods returning numbers can return `null`\nvalues. Therefore, the type of fields represented by those resource methods is nullable.\n\n> **Note:**  The `decimal` type is used as a return type. This will add a `Scalar` type named `Decimal` to the GraphQL\n> schema, which will be generated by the Ballerina GraphQL package.\n\n### Write the GraphQL service\n\nNow you are all set to write the GraphQL service. To write the service, you need to create a GraphQL listener object.\nTo create a listener object, you need to import the Ballerina GraphQL package.\n\n```ballerina\nimport ballerina/graphql;\n\nservice /covid19 on new graphql:Listener(9000) {\n\n}\n```\n\nIn the above code snippet, the path of this service is defined as `/covid19`. If you want to host the service on the\nroot, you can remove the path as the following code snippet:\n\n```ballerina\nimport ballerina/graphql;\n\nservice on new graphql:Listener(9000) {\n\n}\n```\n\nWhen creating the `graphql:Listener` object, you need to provide the port to which it is listening. Alternatively, an\nexisting `http:Listener` object can also be used to initialize the `graphql:Listener` as below.\n\n```ballerina\nimport ballerina/graphql;\nimport ballerina/http;\n\nlistener http:Listener httpListener = check new(9000);\n\nservice /covid19 on new graphql:Listener(httpListener) {\n\n}\n```\n\nThis is as same as the first code snippet above, which will listen on the port `9000` and serve on `/covid19`.\n\nNow, create the service methods.\n\nAs per the design, there are two fields in the `Query` type and one field in the `Mutation` type in your GraphQL\nservice. The fields of the `Query` type are represented by resource methods in Ballerina, while The fields of the\n`Mutation` type are represented by the remote methods in Ballerina.\n\nLet's first create the `all` field. This should return an array of `CovidData` type.\n\n```ballerina\nimport ballerina/graphql;\n\nservice /covid19 on new graphql:Listener(9000) {\n    resource function get all() returns CovidData[] {\n        CovidEntry[] covidEntries = covidEntriesTable.toArray().cloneReadOnly();\n        return covidEntries.map(entry => new CovidData(entry));\n    }\n}\n```\n\n> **Note:** A Ballerina GraphQL resource or remote method can return a `table` as well. When a method is returning a\n> `table`, the corresponding GraphQL field type is a `LIST` type.\n\nThe resource method definition has the accessor `get`, which is used to identify the resource methods as a field of the\n`Query` type. No other accessor is allowed. Then comes the name of the field. The return type is the type of the field.\n\nThe above resource method first retrieves the array of `CovidEntry` records from the data source as an array, then\nreturns an array of `CovidData` service type array as the result using the built-in `map` function.\n\nSimilarly, you can define another resource method to add the `filter` field.\n\n>**Note:** This field has an input `isoCode` to filter the data.\n\n```ballerina\nresource function get filter(string isoCode) returns CovidData? {\n    CovidEntry? covidEntry = covidEntriesTable[isoCode];\n    if covidEntry is CovidEntry {\n        return new (covidEntry);\n    }\n    return;\n}\n```\n\nIn the above resource method, the `filter` field is defined in the root `Query` type. Since this field has an\ninput parameter `isoCode`, you have to add an input parameter to the resource method. This method returns the\ncorresponding data for the given `isoCode` if such data is available in our data set, otherwise, it returns `null`.\n\nAs the `Query` type is completed now, you need to define the `Mutation` type using remote methods.\n\nLet's define a remote method to add an entry to our data source:\n\n```ballerina\nremote function add(CovidEntry entry) returns CovidData {\n    covidEntriesTable.add(entry);\n    return new CovidData(entry);\n}\n```\n\nThis method requires a `CovidEntry` record as the input. When a remote or resource method has a record type as an\ninput, it will be mapped to a GraphQL input object type. Therefore, this cannot be used as an output type.\n\nBelow is the complete code for the Ballerina GraphQL service:\n```ballerina\nimport ballerina/graphql;\n\npublic type CovidEntry record {|\n    readonly string isoCode;\n    string country;\n    decimal cases?;\n    decimal deaths?;\n    decimal recovered?;\n    decimal active?;\n|};\n\ntable<CovidEntry> key(isoCode) covidEntriesTable = table [\n    {isoCode: \"AFG\", country: \"Afghanistan\", cases: 159303, deaths: 7386, recovered: 146084, active: 5833},\n    {isoCode: \"SL\", country: \"Sri Lanka\", cases: 598536, deaths: 15243, recovered: 568637, active: 14656},\n    {isoCode: \"US\", country: \"USA\", cases: 69808350, deaths: 880976, recovered: 43892277, active: 25035097}\n];\n\npublic distinct service class CovidData {\n    private final readonly & CovidEntry entryRecord;\n\n    function init(CovidEntry entryRecord) {\n        self.entryRecord = entryRecord.cloneReadOnly();\n    }\n\n    resource function get isoCode() returns string {\n        return self.entryRecord.isoCode;\n    }\n\n    resource function get country() returns string {\n        return self.entryRecord.country;\n    }\n\n    resource function get cases() returns decimal? {\n        if self.entryRecord.cases is decimal {\n            return self.entryRecord.cases / 1000;\n        }\n        return;\n    }\n\n    resource function get deaths() returns decimal? {\n        if self.entryRecord.deaths is decimal {\n            return self.entryRecord.deaths / 1000;\n        }\n        return;\n    }\n\n    resource function get recovered() returns decimal? {\n        if self.entryRecord.recovered is decimal {\n            return self.entryRecord.recovered / 1000;\n        }\n        return;\n    }\n\n    resource function get active() returns decimal? {\n        if self.entryRecord.active is decimal {\n            return self.entryRecord.active / 1000;\n        }\n        return;\n    }\n}\n\nservice /covid19 on new graphql:Listener(9000) {\n    resource function get all() returns CovidData[] {\n        CovidEntry[] covidEntries = covidEntriesTable.toArray().cloneReadOnly();\n        return covidEntries.map(entry => new CovidData(entry));\n    }\n\n    resource function get filter(string isoCode) returns CovidData? {\n        CovidEntry? covidEntry = covidEntriesTable[isoCode];\n        if covidEntry is CovidEntry {\n            return new (covidEntry);\n        }\n        return;\n    }\n\n    remote function add(CovidEntry entry) returns CovidData {\n        covidEntriesTable.add(entry);\n        return new CovidData(entry);\n    }\n}\n```\n\nNow, you can run this service to serve a GraphQL API to our data source. To run, execute the following command:\n\n```shell\nbal run\n```\n\n> **Note:** The console should have warning logs related to the isolatedness of resources. It is a built-in service concurrency safety feature of Ballerina.\n\nIf you connect to this service using any GraphQL client tools, it will show the following schema.\n\n```graphql\ntype CovidData {\n    isoCode: String!\n    country: String!\n    cases: Decimal\n    recovered: Decimal\n    active: Decimal\n    deaths: Decimal\n}\n\ninput CovidEntry {\n    isoCode: String!\n    country: String!\n    cases: Decimal\n    recovered: Decimal\n    active: Decimal\n    deaths: Decimal\n}\n\nScalar Decimal\n\ntype Query {\n    all: [CovidData!]!\n    filter(isoCode: String!): CovidData\n}\n\ntype Mutation {\n    add(entry: CovidEntry!): CovidData!\n}\n```\n\n## Access the GraphQL endpoint\n\nTo access the endpoint, you can use cURL or a GraphQL client such as [GraphiQL](https://github.com/graphql/graphiql).\n\nThe following cURL request will retrieve all the data from the endpoint:\n\n```shell\ncurl -X POST -H \"Content-type: application/json\" -H \"scope: unknown\" -d '{ \"query\": \"query { all { country cases active}  }\" }' 'http://localhost:9000/covid19'\n```\n\nIn this request, an HTTP POST request is sent to the GraphQL endpoint. The request body contains the GraphQL query.\n\nThe result of this request is the following JSON.\n\n```JSON\n{\n  \"data\": {\n    \"all\": [\n      {\n        \"country\": \"Afghanistan\",\n        \"cases\": 159.303,\n        \"active\": 5.833\n      },\n      {\n        \"country\": \"Sri Lanka\",\n        \"cases\": 598.536,\n        \"active\": 14.656\n      },\n      {\n        \"country\": \"USA\",\n        \"cases\": 69808.35,\n        \"active\": 25035.097\n      }\n    ]\n  }\n}\n```\n","id":"write-a-graphql-api-with-ballerina","sub":"","third":"","slug":"write-a-graphql-api-with-ballerina"},"__N_SSG":true}