{"pageProps":{"frontmatter":{"layout":"ballerina-rest-api-guide-left-nav-pages-swanlake","title":"Write a RESTful API with Ballerina","permalink":"/learn/write-a-restful-api-with-ballerina/","description":"This guide helps you understand the basics of Ballerina constructs, which allow you to write RESTful APIs.","keywords":"ballerina, programming language, restful-api, ballerina packages, language-guide","active":"write-a-restful-api-with-ballerina","intro":"This guide helps you understand the basics of Ballerina constructs, which allow you to write RESTful APIs.","redirect_from":["/learn/writing-a-restful-api-with-ballerina","/learn/writing-a-restful-api-with-ballerina/","/learn/write-a-restful-api-with-ballerina","/learn/getting-started/writing-a-restful-api-with-ballerina/","/learn/getting-started/writing-a-restful-api-with-ballerina"]},"content":"\n## Set up the prerequisites\n\nTo complete this tutorial, you need:\n\n1. [Ballerina 2202.0.0 (Swan Lake)](/learn/install-ballerina/set-up-ballerina/) or greater\n2. A text editor\n  >**Tip:** Preferably, [Visual Studio Code](https://code.visualstudio.com/) with the [Ballerina extension](https://marketplace.visualstudio.com/items?itemName=WSO2.ballerina) installed.\n3. A command terminal\n\n## Understand the implementation\n\nDue to the batteries included nature of the Ballerina language, there is no need to add any third-party libraries to implement a RESTful API. The Ballerina standard library itself is adequate.\n\nThis guide will walk you through creating a RESTful API with two endpoints. In this API, you will be writing a simple CRUD-like RESTful service. The sample is built around a set of COVID-19 data. Following are the URLs of each of the endpoints.\n\n1. `/covid/status/countries`\n2. `/covid/status/countries/{iso_code}`\n\n### The first endpoint\n\nThe first endpoint is about getting data from the service as well as adding data to the service. Therefore, the service should handle both HTTP `GET` and `POST` requests.\n- The `GET` request is to get data, and the response should be `200 OK`.\n- The `POST` request is to add data, and the response should be `201 Created`.\n\n### The second endpoint\n\nThe second endpoint is about getting data filtered from the service. The data is filtered by the ISO code. Therefore, the second endpoint accepts the ISO code as part of the URL and responds with the `200 OK` status code. In the event of an error, the relevant error is sent back to the client.\n\n>**Info:** For the complete source code of this implementation, see [The complete code](/learn/write-a-restful-api-with-ballerina/#the-complete-code).\n\n## Create the service package \n\nBallerina uses packages to group code. You need to create a Ballerina package and write the business logic in it. In the terminal, execute the command below to create the Ballerina package for the API implementation.\n\n> **Info:** For more information on Ballerina packages, see [Organizing Ballerina code](/learn/organize-ballerina-code/).\n\n```bash\n$ bal new covid19 -t service\n```\n\nYou view the output below.\n\n```bash\nCreated new package 'covid19' at covid19.\n```\n\nThis creates a directory named `covid19` with the default module along with a sample code for the service as shown below. \n\n```bash\n.\n├── covid19\n│   ├── Ballerina.toml\n│   └── service.bal\n```\n\n- `Ballerina.toml` is the file that makes the folder a Ballerina package. It also contains a test directory to include tests for the service. However, this will not be used in this guide. \n- The `service.bal` template file provides a look and feel about Ballerina services. \n\n## Create the dataset\n\nTo keep things simple, an in-memory dataset is used with three entries. To add the definition of the record and the declaration of the table, replace the API template file (i.e., `service.bal`) with the code below.\n\n```ballerina\npublic type CovidEntry record {|\n    readonly string iso_code;\n    string country;\n    decimal cases;\n    decimal deaths;\n    decimal recovered;\n    decimal active;\n|};\n\npublic final table<CovidEntry> key(iso_code) covidTable = table [\n    {iso_code: \"AFG\", country: \"Afghanistan\", cases: 159303, deaths: 7386, recovered: 146084, active: 5833},\n    {iso_code: \"SL\", country: \"Sri Lanka\", cases: 598536, deaths: 15243, recovered: 568637, active: 14656},\n    {iso_code: \"US\", country: \"USA\", cases: 69808350, deaths: 880976, recovered: 43892277, active: 25035097}\n];\n```\n\nIn this code:\n\n- Ballerina tables are used to store data. Each entry in the table is represented by a Ballerina record.\n\n\n## Create the service\n\nBallerina resources can only reside inside a service. Therefore, first, a service needs to be created. To create the service, add the code below to the API template file (i.e., `service.bal`).\n\n```ballerina\nservice /covid/status on new http:Listener(9000) {\n}\n```\n\nIn this code:\n\n- As both endpoints have a common URL segment, this is moved to the service level as the base path when creating the service.\n- The service is associated with an `http:Listener`, which is the Ballerina abstraction that deals with network-level details such as the host, port, SSL, etc.\n\n## Implement the first endpoint\n\nThe first endpoint has two resources one to get data and the other to add data.\n\n### Create the first resource to get data\n\nTo create the first resource of the first endpoint to get data, add the code below to the API template file (i.e., `service.bal`).\n\n**Info:** \n\n```ballerina\nservice /covid/status on new http:Listener(9000){\n\tresource function get countries() returns CovidEntry[] {\n        return covidTable.toArray();\n    }\n}\n```\n\nIn this code:\n\n- Unlike normal functions, resource functions can have accessors. In this case, the accessor is set to `get`, which means only HTTP `GET` requests could hit this resource. Ballerina automatically serializes Ballerina records as JSON and sends them over the wire. The default status code HTTP responses are `200 OK`.\n\n### Create the second resource to add data\n\nTo create the second resource of the first endpoint to add new COVID-19 data to the dataset by ISO code, add the code below to the API template file (i.e., `service.bal`).\n\n\n```ballerina\nresource function post countries(@http:Payload CovidEntry[] covidEntries)\n                                    returns CreatedCovidEntries|ConflictingIsoCodesError {\n\n    string[] conflictingISOs = from CovidEntry covidEntry in covidEntries\n        where covidTable.hasKey(covidEntry.iso_code)\n        select covidEntry.iso_code;\n\n    if conflictingISOs.length() > 0 {\n        return <ConflictingIsoCodesError>{\n            body: {\n                errmsg: string:'join(\" \", \"Conflicting ISO Codes:\", ...conflictingISOs)\n            }\n        };\n    } else {\n        covidEntries.forEach(covdiEntry => covidTable.add(covdiEntry));\n        return <CreatedCovidEntries>{body: covidEntries};\n    }\n}\n```\n\nIn this code:\n\n- It is chosen to either accept the entire payload or send back an error. Copying this straightway results in an error, which is expected as the `CreatedCovidEntries` and `ConflictingIsoCodesError` types are not defined yet.\n\n#### Define the record type\n\nTo define the `CreatedCovidEntries` record, add the code below to the API template file (i.e., `service.bal`).\n\n```ballerina\npublic type CreatedCovidEntries record {|\n   *http:Created;\n   CovidEntry[] body;\n|};\n```\n\nIn this code:\n- This resource has a resource argument named `covidEntries` annotated with `@http:Payload`. This means the resource is expecting a payload with type `CovideEntry[]`. There are two types of records `CreatedCovidEntries` and `ConflictingIsoCodesError` as the return values. Following is the definition of `CreatedCovidEntries`.\n- `*http:Created` is the Ballerina way of saying one type is a subtype of another. In this case, `CreatedCovidEntries` is a subtype of `*http:Created`.\n- Ballerina has defined a set of types for each HTTP status code. This allows you to write services in a type-oriented way, which in turn is helpful when it comes to tooling and generating OpenAPI specifications for HTTP services. \n- Returning this record results in an HTTP `201` response with a JSON payload. The body of the response is of type `CovidEntry[]`.\n\n#### Define the error records\n\nTo define the error records, add the code below to the API template file (i.e., `service.bal`).\n\n```ballerina\npublic type ConflictingIsoCodesError record {|\n   *http:Conflict;\n   ErrorMsg body;\n|};\n\npublic type ErrorMsg record {|\n   string errmsg;\n|};\n```\n\nIn this code:\n- The body of the response is of type `ErrorMsg`, which simply has a string field named `errmsg`. Based on the need, users can have any data type for their response body.\n\n## Implement the second endpoint\n\nThe second endpoint has only one resource to get COVID-19 data filtered by the ISO code.\n\n### Create the resource of the second endpoint\n\nTo create the resource of the second endpoin, add the code below to the API template file (i.e., `service.bal`).\n\n```ballerina\nresource function get countries/[string iso_code]() returns CovidEntry|InvalidIsoCodeError {\n    CovidEntry? covidEntry = covidTable[iso_code];\n    if covidEntry is () {\n        return {\n            body: {\n                errmsg: string `Invalid ISO Code: ${iso_code}`\n            }\n        };\n    }\n    return covidEntry;\n}\n```\n\nIn this code:\n- This resource is a bit more different than the first two resources. As explained earlier, resource functions have accessors.\n- In addition, it also supports hierarchical paths making it ideal for implementing RESTful APIs. Hierarchical paths can have path params.\n-  In this case, `iso_code` is used as the path param, which in turn, becomes a string variable.\n\n#### Define the error record\n\nTo define the `InvalidIsoCodeError` record, add the code below to the API template file (i.e., `service.bal`).\n\n```ballerina\npublic type InvalidIsoCodeError record {|\n    *http:NotFound;\n    ErrorMsg body;\n|};\n```\n\nIn this code:\n- As in the previous example, this resource also includes its own return types. However, the basic principle behind them is as the previous example. \n\n## The complete code\n\nThe below is the complete code of the service implementation.\n\n```ballerina\nimport ballerina/http;\n\nservice /covid/status on new http:Listener(9000) {\n\n    resource function get countries() returns CovidEntry[] {\n        return covidTable.toArray();\n    }\n\n    resource function post countries(@http:Payload CovidEntry[] covidEntries)\n                                    returns CreatedCovidEntries|ConflictingIsoCodesError {\n\n        string[] conflictingISOs = from CovidEntry covidEntry in covidEntries\n            where covidTable.hasKey(covidEntry.iso_code)\n            select covidEntry.iso_code;\n\n        if conflictingISOs.length() > 0 {\n            return {\n                body: {\n                    errmsg: string:'join(\" \", \"Conflicting ISO Codes:\", ...conflictingISOs)\n                }\n            };\n        } else {\n            covidEntries.forEach(covdiEntry => covidTable.add(covdiEntry));\n            return <CreatedCovidEntries>{body: covidEntries};\n        }\n    }\n\n    resource function get countries/[string iso_code]() returns CovidEntry|InvalidIsoCodeError {\n        CovidEntry? covidEntry = covidTable[iso_code];\n        if covidEntry is () {\n            return {\n                body: {\n                    errmsg: string `Invalid ISO Code: ${iso_code}`\n                }\n            };\n        }\n        return covidEntry;\n    }\n}\n\npublic type CovidEntry record {|\n    readonly string iso_code;\n    string country;\n    decimal cases;\n    decimal deaths;\n    decimal recovered;\n    decimal active;\n|};\n\npublic final table<CovidEntry> key(iso_code) covidTable = table [\n    {iso_code: \"AFG\", country: \"Afghanistan\", cases: 159303, deaths: 7386, recovered: 146084, active: 5833},\n    {iso_code: \"SL\", country: \"Sri Lanka\", cases: 598536, deaths: 15243, recovered: 568637, active: 14656},\n    {iso_code: \"US\", country: \"USA\", cases: 69808350, deaths: 880976, recovered: 43892277, active: 25035097}\n];\n\npublic type CreatedCovidEntries record {|\n    *http:Created;\n    CovidEntry[] body;\n|};\n\npublic type ConflictingIsoCodesError record {|\n    *http:Conflict;\n    ErrorMsg body;\n|};\n\npublic type InvalidIsoCodeError record {|\n    *http:NotFound;\n    ErrorMsg body;\n|};\n\npublic type ErrorMsg record {|\n    string errmsg;\n|};\n```\n\n- It is always a good practice to document your interfaces. However, this example has omitted documentation for brevity. Nevertheless, any production-ready API interface must include API documentation. \n- You can also try generating an OpenAPI specification for the written service by executing the following command, which creates a `yaml` file in the current folder.\n\n## Run the service\n\nIn the terminal, navigate to the `covid19` directory, and execute the command below to run the service package.\n\n> **Info**: The console should have warning logs related to the isolatedness of resources. It is a built-in service concurrency safety feature of Ballerina.\n\n\n```bash\n$ bal run\n```\n\nYou view the output below.\n\n```bash\nCompiling source\n\texample/covid19:0.1.0\n\nRunning executable\n```\n\n## Try the service\n\nIn another terminal, execute the cURL commands below one by one to try out the service.\n\n### Get all countries\n\nExecute the cURL command below.\n\n```bash\n$ curl http://localhost:9000/covid/status/countries\n```\n\nYou view the output below.\n\n```bash\n[{\"iso_code\":\"AFG\", \"country\":\"Afghanistan\", \"cases\":159303, \"deaths\":7386, \"recovered\":146084, \"active\":5833}, {\"iso_code\":\"SL\", \"country\":\"Sri Lanka\", \"cases\":598536, \"deaths\":15243, \"recovered\":568637, \"active\":14656}, {\"iso_code\":\"US\", \"country\":\"USA\", \"cases\":69808350, \"deaths\":880976, \"recovered\":43892277, \"active\":25035097}]\n```\n\n### Add a country by the ISO code \n\nExecute the cURL command below.\n\n```bash\n$ curl http://localhost:9000/covid/status/countries -d '[{\"iso_code\":\"DEU\", \"country\":\"Germany\", \"cases\":159333, \"deaths\":7390, \"recovered\":126084, \"active\":6833}]'\n```\n\nYou view the output below.\n\n```bash\n[{\"iso_code\":\"DEU\", \"country\":\"Germany\", \"cases\":159333.0, \"deaths\":7390.0, \"recovered\":126084.0, \"active\":6833.0}]\n```\n\n### Filter a country by the ISO code\n\nExecute the cURL command below.\n\n```bash\n$ curl http://localhost:9000/covid/status/countries/AFG\n```\n\nYou view the output below.\n\n```bash\n{\"iso_code\":\"AFG\", \"country\":\"Afghanistan\", \"cases\":159303, \"deaths\":7386, \"recovered\":146084, \"active\":5833}\n```\n\n## Learn more\n\nTo learn more about RESTful services in Ballerina, see the following:\n- [`http` library documentation](https://lib.ballerina.io/ballerina/http/latest)\n- [Service path and resource path](/learn/by-example/http-absolute-path-and-path)","id":"write-a-restful-api-with-ballerina","sub":"","third":"","slug":"write-a-restful-api-with-ballerina"},"__N_SSG":true}