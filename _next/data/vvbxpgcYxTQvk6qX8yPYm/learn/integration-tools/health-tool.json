{"pageProps":{"frontmatter":{"layout":"ballerina-health-support-left-nav-pages-swanlake","title":"Health tool (FHIR/HL7)","description":"The health tool generates accelerators for developing healthcare integrations in Ballerina.","keywords":"ballerina, programming language, health, contract","permalink":"/learn/health-tool/","active":"health-tool","intro":"The health tool generates accelerators for developing healthcare integrations in Ballerina."},"content":"\nThe Health tool can generate accelerators primarily focussed on the <a href=\"https://www.hl7.org/fhir/overview.html\" target=\"_blank\">Fast Healthcare Interoperability Resources (FHIR)</a> standard. The Health tool is supported from Ballerina Swan Lake version 2201.7.0 onwards.\n\n## Ballerina FHIR package generator\n\nThis tool generates a Ballerina package for a given FHIR implementation guide. The FHIR resources in the implementation guide will be represented as Ballerina records including the correct cardinality constraints and metadata.\n\nFHIR integration developers can leverage the generated package when transforming custom health data into FHIR format without referring to the specification.\n\n## Prerequisites\n\n- <a href=\"https://ballerina.io/downloads/\" target=\"_blank\">Ballerina 2201.7.0 (Swan Lake Update 7)</a>\n- A directory containing all FHIR specification definition files. You can download a preferred standard implementation guide from the <a href=\"http://fhir.org/guides/registry/\" target=\"_blank\">FHIR Implementation Guide registry</a>\n\n    >**Note:** It is recommended to use the STU version of the implementation guides. Make sure that the downloaded specification archive has the `StructureDefinition`, `ValueSet`, and `CodeSystem` files for the Implementation Guide (IG) resources when extracted.\n\n## Available parameters\n\nThe parameters that are available with the tool are listed below.\n\n| Parameter      | Description                                                                                                                                                                                                                                                                                                                                                                     | Mandatory/Optional |\n|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n| `-m, --mode`     | Mode can be `package`. If `mode` is set to `package`, a Ballerina package will be generated including all the records and types. New modes will be added in future releases.                                                                                                                                                                                                      | mandatory          |\n| `-o, --output`   | Location of the generated Ballerina artifacts. If this path is not specified, the output will be written to the same directory from which the command is run.                                                                                                                                                                                                                   | optional           |\n| `--package-name` | Name of the Ballerina package to be generated. The package name can be explicitly set using this argument. Unless specified, the default name of the implementation guide will be taken to construct the name of the package. For more information, see <a href=\"https://ballerina.io/learn/package-references/#the-name-field\" target=\"_blank\">the <code>name</code> field</a>. | optional           |\n| `--org-name`     | Organization name of the Ballerina package to be generated. For more information, see <a href=\"https://ballerina.io/learn/package-references/#the-org-field\" target=\"_blank\"> the <code>org</code> field</a>.                                                                                                                                                                   | optional           |\n| `-v, --version`  | Print the version information of the Health tool.                                                                                                                                                                                                                                                                                                                               | optional           |\n| `-h, --help`     | Print the usage details of the Health tool.                                                                                                                                                                                                                                                                                                                                     | optional           |\n\n## Example\n\nFollow the steps below to try out an example of using the Health tool.\n\n1. Pull the Health tool from Ballerina Central.\n\n    ```\n    $ bal tool pull health\n    health:1.0.0 pulled successfully.\n    health:1.0.0 successfully set as the active version.\n    ```\n\n2. Download the **JSON Definitions ZIP archive** from the <a href=\"http://hl7.org/fhir/us/carin-bb/STU2/downloads.html\" target=\"_blank\">Carin BB implementation guide</a> and extract it to your current directory.\n\n3. Run the tool with the [required arguments](#available-parameters).\n\n    >**Note:** Provide values for mandatory arguments. Make sure to give the directory path of the downloaded FHIR definitions as the last argument.\n\n    ```\n    $ bal health fhir -m package --org-name healthcare --package-name carinbb.lib -o gen ./definitions.json\n    Ballerina FHIR package generation completed successfully.\n    ```\n\n4. Build the generated package and push it to a repository.\n\n    >**Info:** You can push either to the local repository or the remote repository in Ballerina Central.\n\n    ```\n    $ cd gen/carinbb.lib\n    $ bal pack\n    Compiling source\n            healthcare/carinbb.lib:0.0.1\n\n    Creating bala\n            target/bala/healthcare-carinbb.lib-any-0.0.1.bala\n    ```\n\n    ```\n    $ bal push --repository local\n    Successfully pushed target/bala/healthcare-carinbb.lib-any-0.0.1.bala to 'local' repository.\n    ```\n\n5. Create a Ballerina project and import the generated package. \n\n    >**Note:** Make sure to add the correct version and repository to the `Ballerina.toml` file.\n\n    ```\n    [package]\n    org = \"healthcare\"\n    name = \"integration.carinbb\"\n    version = \"1.0.0\"\n    distribution = \"2201.7.0\"\n\n    [[dependency]]\n    org = \"healthcare\"\n    name = \"carinbb.lib\"\n    version = \"0.0.1\"\n    repository = \"local\"\n    ```\n\n6. Implement the business logic/mapping using the generated FHIR resource records.\n\n    ```ballerina\n    import ballerina/http;\n    import ballerinax/health.fhir.r4;\n    import healthcare/carinbb.lib as carinbb;\n\n    listener http:Listener httpListener = new (9090);\n\n    public type Patient record {\n        string id;\n        string lastName?;\n        string firstName;\n        string middleName;\n        string gender?;\n    };\n\n    service / on httpListener {\n\n        isolated resource function get [string fhirType]/[string id]() returns @http:Payload {mediaType: [\"application/fhir+json\", \"application/fhir+xml\"]} r4:FHIRWireFormat|error {\n\n            // Mock the patient payload from the legacy healthcare system.\n\n            Patient patient = {\n                id: \"2121\",\n                lastName: \"Doe\",\n                firstName: \"John\",\n                middleName: \"Hemish\",\n                gender: \"male\"\n            };\n\n            // Convert to the Carin BB Patient structure.\n            carinbb:C4BBPatient c4bbPatient = {\n                id: patient.id,\n                identifier: [\n                    {\n                        system: \"http://hl7.org/fhir/sid/us-ssn\",\n                        value: patient.id\n                    }\n                ]\n        ,\n                gender: <carinbb:PatientGender>patient.gender,\n                name: [\n                    {\n                        family: patient.lastName,\n                        given: [patient.firstName, patient.middleName]\n                    }\n                ]\n            };\n\n            return c4bbPatient.toJson();\n        }\n    }\n    ```\n\n7. Run the Ballerina project and validate the output.\n\n    ```\n    $ bal run\n    Compiling source\n            healthcare/integration.carinbb:1.0.0\n\n    Running executable\n    ```\n\n8. Invoke the API to test it.\n\n    ```\n    $ curl --location --request GET 'http://localhost:9090/Patient/2121'\n    ```\n\n    You can view the response shown below.\n\n    ```\n    {\n        \"resourceType\": \"Patient\",\n        \"gender\": \"male\",\n        \"id\": \"2121\",\n        \"identifier\": [\n            {\n                \"system\": \"http://hl7.org/fhir/sid/us-ssn\",\n                \"value\": \"2121\"\n            }\n        ],\n        \"meta\": {\n            \"profile\": [\n                \"http://hl7.org/fhir/us/carin-bb/StructureDefinition/C4BB-Patient\"\n            ]\n        },\n        \"name\": [\n            {\n                \"family\": \"Doe\",\n                \"given\": [\n                    \"John\",\n                    \"Hemish\"\n                ]\n            }\n        ]\n    }\n    ```\n","id":"health-tool","sub":"","third":"","slug":"health-tool","codes":"[[-572513141,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">import</span><span style=\\\"color: #24292E\\\"> ballerina/http;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">import</span><span style=\\\"color: #24292E\\\"> ballerinax/health.fhir.r4;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">import</span><span style=\\\"color: #24292E\\\"> healthcare/carinbb.lib </span><span style=\\\"color: #D73A49\\\">as</span><span style=\\\"color: #24292E\\\"> carinbb;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">listener</span><span style=\\\"color: #24292E\\\"> http</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\">Listener httpListener </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">new</span><span style=\\\"color: #24292E\\\"> (</span><span style=\\\"color: #005CC5\\\">9090</span><span style=\\\"color: #24292E\\\">);</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">public</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">type</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #6F42C1\\\">Patient</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">record</span><span style=\\\"color: #24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> id;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> lastName?;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> firstName;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> middleName;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> gender?;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">};</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">service</span><span style=\\\"color: #24292E\\\"> / </span><span style=\\\"color: #D73A49\\\">on</span><span style=\\\"color: #24292E\\\"> httpListener {</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #D73A49\\\">isolated</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">resource</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">function</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #6F42C1\\\">get</span><span style=\\\"color: #24292E\\\"> [</span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #E36209\\\">fhirType</span><span style=\\\"color: #24292E\\\">]/[</span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #E36209\\\">id</span><span style=\\\"color: #24292E\\\">]() </span><span style=\\\"color: #D73A49\\\">returns</span><span style=\\\"color: #24292E\\\"> @http</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\">Payload {mediaType</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> [</span><span style=\\\"color: #032F62\\\">&quot;application/fhir+json&quot;</span><span style=\\\"color: #24292E\\\">, </span><span style=\\\"color: #032F62\\\">&quot;application/fhir+xml&quot;</span><span style=\\\"color: #24292E\\\">]} r4</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\">FHIRWireFormat</span><span style=\\\"color: #D73A49\\\">|error</span><span style=\\\"color: #24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        </span><span style=\\\"color: #6A737D\\\">// Mock the patient payload from the legacy healthcare system.</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        Patient patient </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            id</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;2121&quot;</span><span style=\\\"color: #24292E\\\">,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            lastName</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;Doe&quot;</span><span style=\\\"color: #24292E\\\">,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            firstName</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;John&quot;</span><span style=\\\"color: #24292E\\\">,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            middleName</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;Hemish&quot;</span><span style=\\\"color: #24292E\\\">,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            gender</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;male&quot;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        };</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        </span><span style=\\\"color: #6A737D\\\">// Convert to the Carin BB Patient structure.</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        carinbb</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\">C4BBPatient c4bbPatient </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            id</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> patient.id,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            identifier</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> [</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                    </span><span style=\\\"color: #6F42C1\\\">system</span><span style=\\\"color: #24292E\\\">: </span><span style=\\\"color: #032F62\\\">&quot;http://hl7.org/fhir/sid/us-ssn&quot;</span><span style=\\\"color: #24292E\\\">,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                    </span><span style=\\\"color: #6F42C1\\\">value</span><span style=\\\"color: #24292E\\\">: patient.id</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            ]</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    ,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            gender</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> &lt;carinbb:PatientGender</span><span style=\\\"color: #D73A49\\\">&gt;</span><span style=\\\"color: #24292E\\\">patient.gender,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            name</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\"> [</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                    </span><span style=\\\"color: #6F42C1\\\">family</span><span style=\\\"color: #24292E\\\">: patient.lastName,</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                    </span><span style=\\\"color: #6F42C1\\\">given</span><span style=\\\"color: #24292E\\\">: [patient.firstName, patient.middleName]</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">                }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">            ]</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        };</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">        </span><span style=\\\"color: #D73A49\\\">return</span><span style=\\\"color: #24292E\\\"> c4bbPatient.</span><span style=\\\"color: #6F42C1\\\">toJson</span><span style=\\\"color: #24292E\\\">();</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    }</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">}</span></span></code></pre>\"]]"},"__N_SSG":true}