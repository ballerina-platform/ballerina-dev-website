{"pageProps":{"tagline":"Safely receive the same message multiple times","desc":"An idempotent receiver is a receiver that can safely receive the same message multiple times.","category":"Messaging Endpoints","index":51,"helps":"When implementing idempotent endpoints, such as HTTP PUT, users may use Ballerina to create logic that leaves the state in the same state even if the same message is received multiple times. Explicit de-duping can be implemented using Ballerina's rich set of packages to interact with databases and key-value stores, such as SQL and Redis.","tags":["Idempotent Receiver","Message","Message Channel"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/IdempotentReceiver.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">type</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">OrderDetail</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> orderId;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    OrderStatus status;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">enum</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">OrderStatus</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">CREATED</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">SHIPPED</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">COMPLETED</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">CANCELLED</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">map&lt;</span><span style=\"color: #24292E\">OrderStatus</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\"> orderStatuses </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {};</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">service</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">/api/v1</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> http:Listener(</span><span style=\"color: #005CC5\">8080</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">resource</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">put</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">manage</span><span style=\"color: #24292E\">\\-orders/[</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">orderId</span><span style=\"color: #24292E\">](</span><span style=\"color: #E36209\">OrderDetail</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">orderDetail</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">STATUS_NO_CONTENT</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">http:STATUS_CREATED {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        OrderStatus</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> orderStatus </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> orderStatuses[orderId];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> orderStatus </span><span style=\"color: #D73A49\">==</span><span style=\"color: #24292E\"> orderDetail.status {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">STATUS_NO_CONTENT;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        } </span><span style=\"color: #D73A49\">else</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            orderStatuses[orderId] </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> orderDetail.status;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">STATUS_CREATED;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\ntype OrderDetail record {\n    string orderId;\n    OrderStatus status;\n};\n\nenum OrderStatus {\n    CREATED,\n    SHIPPED,\n    COMPLETED,\n    CANCELLED\n};\n\nfinal map<OrderStatus> orderStatuses = {};\n\nservice /api/v1 on new http:Listener(8080) {\n\n    resource function put manage\\-orders/[string orderId](OrderDetail orderDetail) returns\n        http:STATUS_NO_CONTENT|http:STATUS_CREATED {\n        OrderStatus? orderStatus = orderStatuses[orderId];\n        if orderStatus == orderDetail.status {\n            return http:STATUS_NO_CONTENT;\n        } else {\n            orderStatuses[orderId] = orderDetail.status;\n            return http:STATUS_CREATED;\n        }\n    }\n}\n","name":"idempotent-receiver.bal"}],"name":" Idempotent Receiver"},"__N_SSG":true}