{"pageProps":{"frontmatter":{},"content":"# Specification: Ballerina UDP Library\n\n_Owners_: @Maninda @MohamedSabthar @shafreenAnfar  \n_Reviewers_: @shafreenAnfar @Maninda  \n_Created_: 2020/11/10  \n_Updated_: 2022/02/18  \n_Edition_: Swan Lake  \n\n## Introduction\n\nThis is the specification for the UDP standard library of [Ballerina language](https://ballerina.io/), which provides UDP client-server functionalities.\n\nThe UDP library specification has evolved and may continue to evolve in the future. The released versions of the specification can be found under the relevant GitHub tag.\n\nIf you have any feedback or suggestions about the library, start a discussion via a [GitHub issue](https://github.com/ballerina-platform/ballerina-standard-library/issues) or in the [Slack channel](https://ballerina.io/community/). Based on the outcome of the discussion, the specification and implementation can be updated. Community feedback is always welcome. Any accepted proposal, which affects the specification is stored under `/docs/proposals`. Proposals under discussion can be found with the label `type/proposal` in GitHub.\n\nThe conforming implementation of the specification is released and included in the distribution. Any deviation from the specification is considered a bug.\n\n## Contents\n\n1. [Overview](#1-overview)\n2. [User Datagram Protocol (UDP)](#2-user-datagram-protocol)\n3. [Client](#3-client)\n    * 3.1. [Datagram](#31-datagram)\n    * 3.2. [Connectionless Client](#32-connectionless-client)\n        * 3.2.1. [`init` function](#321-init-function)\n        * 3.2.2. [`sendDatagram` function](#322-senddatagram-function)\n        * 3.2.3. [`receiveDatagram` function](#323-receivedatagram-function)\n        * 3.2.4. [`close` function](#324-close-function)\n    * 3.3. [Connection Oriented Client](#33-connection-oriented-client)\n        * 3.3.1. [`writeBytes` function](#331-writebytes-function)\n        * 3.3.2. [`readBytes` function](#332-readbytes-function)\n        * 3.3.3. [`close` function](#333-close-function)\n4. [Service](#4-service)\n    * 4.1. [Listener](#41-listener)\n        * 4.1.1. [Configuration](#411-configuration)\n        * 4.1.2. [`init` function](#412-init-function)\n    * 4.2. [Service](#42-service)\n    * 4.3. [Caller](#43-caller)\n        * 4.3.1. [`sendDatagram` function](#431-senddatagram-function)\n        * 4.3.2. [`sendBytes` function](#432-sendbytes-function)\n5. [Samples](#5-samples)\n    * 5.1. [Client](#51-client)\n        * 5.1.1. [Connectionless Client](#511-connectionless-client)\n        * 5.1.2. [Connection Oriented Client](#512-connection-oriented-client)\n    * 5.2. [Service](#52-service)\n\n## 1. Overview\nThis specification elaborates on Basic UDP clients and services/listeners.\n\n## 2. User Datagram Protocol\nUDP is the transport layer protocol used for unreliable connectionless data communication across a network.\n\nBallerina UDP library has the capability of sending and receiving data via UDP protocol using both clients and services.\n\n## 3. Client\nIntroduce two different clients, one for connectionless scenarios and another for connection oriented scenarios.\n\n### 3.1 Datagram\nA self-contained, independent entity of data carrying sufficient information to be routed from the source to the destination nodes without reliance on earlier exchanges between the nodes and the transporting network.\n\n```ballerina\npublic type Datagram record {|\n    string remoteHost;\n    int remotePort;\n    byte[] data;\n|};\n```\n\n### 3.2 Connectionless Client\nFollows the principles of pure UDP protocol with connectionless data.\n\n```ballerina\npublic type ClientConfiguration record {\n    decimal timeout = 300;\n    string localhost?;\n}\n\npublic isolated client class Client {\n\n    public isolated function init(*ClientConfiguration config) returns udp:Error? {}\n\n    isolated remote function sendDatagram(udp:Datagram datagram) returns udp:Error? {}\n\n    isolated remote function receiveDatagram() returns (readonly & udp:Datagram)|udp:Error {}\n\n    isolated remote function close() returns udp:Error? {}\n}\n```\n\n#### 3.2.1 `init` function\nBinds the client to the host address that is provided in `config`. Otherwise bind the client to localhost with an ephemeral port.\n\n#### 3.2.2 `sendDatagram` function\nA blocking method where each execution of this method will result in sending a datagram to the remote host or in error, nothing in between. If the `byte[]` size is too large than what the native networking software can support, the method may or may not return an error. This is entirely dependent on the host machine and the OS.\nFollowing is the list of categorization of Datagram data sizes,\n - IPv4 theoretical size limit 65507 bytes\n - IPv6 theoretical size limit 65536 bytes\n - Practical safe size limit which many protocols use 8192 bytes\n - Max practical safe size limit 512 bytes\n\n#### 3.2.3 `receiveDatagram` function\nListened datagrams are retrieved one-by-one. If an error happens during the receiving, an error is returned.\n\n#### 3.2.4 `close` function\nClears the external-party-related information from the client.\n\n### 3.3 Connection Oriented Client\nIs configured so that it only receives datagrams from an external party, and sends datagrams to an external party, using the given remote address. Once connected, datagrams may not be received from or sent to any other address. The client remains connected until it is explicitly disconnected or until it is closed.\n\n```ballerina\npublic type ConnectClientConfiguration record {\n    decimal timeout = 300;\n    string localhost?;\n}\n\npublic isolated client class ConnectClient {\n\n    public isolated function init(string remoteHost, int remotePort, *ConnectClientConfiguration config) returns upd:Error? {}\n\n    isolated remote function writeBytes(byte[] data) returns udp:Error? {}\n\n    isolated remote function readBytes() returns (readonly & byte[])|udp:Error {}\n\n    isolated remote function close() returns udp:Error? {}\n}\n```\n\n#### 3.3.1 `writeBytes` function\nWrites everything in the `data` to the remote server. If the `data`â€™s `byte[]` is too large it writes multiple `Datagram`s until the size of the `byte[]` is zero.\n\n#### 3.3.2 `readBytes` function\nReads data as `byte[]`s received from the external party. Returns an error if any interruption happens during the receive operation.\n\n#### 3.3.3 `close` function\nClears the external-party-related information from the client.\n\n## 4. Service\nA service can listen to a listener to read data from the UDP socket. Following types are defined to implement the UDP listener-based read/write operations.\n\n### 4.1 Listener\n\n```ballerina\npublic type ListenerConfiguration record {\n    string remoteHost?;\n    int remotePort?;\n    string localHost?;\n}\n\npublic class Listener {\n\n    public isolated function init(int localPort, *ListenerConfiguration config) returns upd:error? {}\n\n    public isolated function attach(Service s, () name = ()) returns error? {}\n\n    public isolated function detach(Service s) returns error? {}\n}\n```\n\n#### 4.1.1 Configuration\nConfigured using the record, `ListenerConfiguration` with the connection details required.\nIn absense of `remotePort`, the listener does not listen to a remote port but to the local port.\n\n#### 4.1.2 `init` function\nInitialize the listener with the given details.\n\n### 4.2 Service\n```ballerina\npublic type Service service object {};\n```\n\n### 4.3 Caller\nSimilar in behavior to a client.\n\n\n```ballerina\npublic client class Caller {\n\n    public string? remoteHost = ();\n    public int? remotePort = ();\n\n    isolated function init() {}\n\n    remote isolated function sendBytes(byte[] data) returns Error? {}\n\n    remote isolated function sendDatagram(udp:Datagram datagram) returns Error? {}\n}\n```\n\n#### 4.3.1 `sendDatagram` function\n`sendDatagram` function send pre-defined datagrams one-by-one.\n\n#### 4.3.2 `sendBytes` function\nSimilar to the `sendDatagram` function but can be given `data`, longer than the allowed maximum size of a datagram, where `data` array is ieratively read and sent as a sequene of datagrams.\n\n## 5 Samples\n\n### 5.1 Client\n\n#### 5.1.1 Connectionless Client\n\n```ballerina\npublic function main() returns error? {\n    udp:Client socketClient = check new;\n    byte[] data = \"Hello from UDP client\".toBytes();\n    udp:Datagram datagram = {data, remoteHost: \"localhost\", remortPort: 80};\n    check socketClient->sendDatagram(datagram);\n    readonly & udp:Datagram result = check socketClient->receiveDatagram();\n    check socketClient->close();\n}\n```\n\n#### 5.1.2 Connection Oriented Client\n\n```ballerina\npublic function main() returns error? {\n    udp:ConnectClient socketClient = check new(\"remote.host.com\", 80);\n    byte[] data = \"Hello from UDP client\".toBytes();\n    check socketClient->writeBytes(data);\n    readonly & byte[] result = check socketClient->readBytes();\n    check socketClient->close();\n}\n```\n\n### 5.2 Service\n\n```ballerina\nservice on new udp:Listener(8080) {\n\n    remote function onBytes(readonly & byte[] data) returns byte[]|udp:Error? {\n        //echo back\n        return data;\n    }\n\n    remote function onDatagram(readonly & udp:Datagram datagram, udp:Caller caller) returns udp:Datagram|udp:Error? {\n        check caller->sendDatagram(datagram);\n        // instead we can directly return datagram too, to echo back\n        // return datagram;\n    }\n\n    remote function onError(udp:Error err) {\n        io:println(err);\n    }\n}\n```\n"},"__N_SSG":true}