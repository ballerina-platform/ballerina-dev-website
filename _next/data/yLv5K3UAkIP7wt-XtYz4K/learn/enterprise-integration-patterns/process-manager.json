{"pageProps":{"tagline":"Process messages with steps unknown at design time","desc":"The process manager orchestrates a sequence of steps that are not known at design time.","helps":"Ballerina provides control flow constructs such as `if`-`else` and `match` statements to implement complex process flows.","category":"Message Routing","index":34,"tags":["Process Manager","Command Message","Aggregator","Point-to-Point Channel"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html","content":[{"headerCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#D73A49\">import</span><span style=\"color:#24292E\"> ballerina/http;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> OrderRequest</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> email;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    Address address;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    OrderItemRequest[] orderItems;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> OrderResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> email;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> currency;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    float</span><span style=\"color:#24292E\"> total;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    Address address;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    OrderItemResponse[] orderItems;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> trackingNumber;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> Address</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> fullName;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> address1;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> phone;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> city;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> country;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> OrderItemRequest</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> itemName;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    int</span><span style=\"color:#24292E\"> quantity;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> OrderItemResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> itemName;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    int</span><span style=\"color:#24292E\"> quantity;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    float</span><span style=\"color:#24292E\"> price;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> currencyCode;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> ShipmentRequest</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    float</span><span style=\"color:#24292E\"> amount;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> currency;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> personName;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> email;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    DHLAddress</span><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">FedexAddress address;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> FedexAddress</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> address1;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> city;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> country;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> phoneNumber;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> DHLAddress</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> name;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    *</span><span style=\"color:#24292E\">FedexAddress;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> FedexResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> transactionId;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> trackingNumber;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">type</span><span style=\"color:#6F42C1\"> DHLResponse</span><span style=\"color:#D73A49\"> record</span><span style=\"color:#24292E\"> {</span><span style=\"color:#D73A49\">|</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> trackingNumber;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">|</span><span style=\"color:#24292E\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client shopify </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://BlackwellsBooks.myshopify.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client dhlExpress </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://express.api.dhl.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client fedEx </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.fedex.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">final</span><span style=\"color:#24292E\"> http</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\">Client sendgrid </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> (</span><span style=\"color:#032F62\">\"http://api.sendgrid.com.balmock.io\"</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span></code></pre>","mainCode":"<pre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">service</span><span style=\"color:#6F42C1\"> /api/v1</span><span style=\"color:#D73A49\"> on</span><span style=\"color:#D73A49\"> new</span><span style=\"color:#24292E\"> http:Listener(</span><span style=\"color:#005CC5\">8080</span><span style=\"color:#24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    resource</span><span style=\"color:#D73A49\"> function</span><span style=\"color:#6F42C1\"> post</span><span style=\"color:#6F42C1\"> orders</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">OrderRequest</span><span style=\"color:#E36209\"> orderReq</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        OrderResponse response </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> shopify</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">admin</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">api</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">orders\\.json.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">orderReq</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        string</span><span style=\"color:#24292E\"> trackingNumber;</span></span>\n<span class=\"line\"><span style=\"color:#D73A49\">        if</span><span style=\"color:#24292E\"> response.address.country </span><span style=\"color:#D73A49\">==</span><span style=\"color:#032F62\"> \"United States\"</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            FedexResponse fedexResp </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#6F42C1\"> createFedexShipment</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">response</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            trackingNumber </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> fedexResp.trackingNumber;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        } </span><span style=\"color:#D73A49\">else</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            DHLResponse dhlResp </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#6F42C1\"> creeateDhlShipment</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">response</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            trackingNumber </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> dhlResp.trackingNumber;</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">        var</span><span style=\"color:#24292E\"> _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> start</span><span style=\"color:#6F42C1\"> sendConfirmationMail</span><span style=\"color:#24292E\">(response.address.fullName, response.email, </span><span style=\"color:#E36209\">trackingNumber</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">function</span><span style=\"color:#6F42C1\"> createFedexShipment</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">OrderResponse</span><span style=\"color:#E36209\"> response</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#24292E\"> FedexResponse</span><span style=\"color:#D73A49\">|error</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    ShipmentRequest fedexReq </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        amount</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.total,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        currency</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.currency,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        personName</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.fullName,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        email</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.email,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        address</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            address1</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.address1,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            city</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.city,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            country</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.country,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            phoneNumber</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.phone</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    return</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> fedEx</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">api</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">en\\</span><span style=\"color:#D73A49\">-</span><span style=\"color:#24292E\">us</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">catalog</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">ship</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">v1</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">shipments.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">fedexReq</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">function</span><span style=\"color:#6F42C1\"> creeateDhlShipment</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">OrderResponse</span><span style=\"color:#E36209\"> response</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#24292E\"> DHLResponse</span><span style=\"color:#D73A49\">|error</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    ShipmentRequest dhlReq </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        amount</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.total,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        currency</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.currency,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        personName</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.fullName,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        email</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.email,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        address</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            name</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.fullName,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            address1</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.address1,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            city</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.city,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            country</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.country,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">            phoneNumber</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> response.address.phone</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">    return</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> dhlExpress</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">mydhlapi</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">shipments.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">dhlReq</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#D73A49\">function</span><span style=\"color:#6F42C1\"> sendConfirmationMail</span><span style=\"color:#24292E\">(</span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> name</span><span style=\"color:#24292E\">, </span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> email</span><span style=\"color:#24292E\">, </span><span style=\"color:#005CC5\">string</span><span style=\"color:#E36209\"> trackingNumber</span><span style=\"color:#24292E\">) </span><span style=\"color:#D73A49\">returns</span><span style=\"color:#D73A49\"> error?</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    string</span><span style=\"color:#24292E\"> body </span><span style=\"color:#D73A49\">=</span><span style=\"color:#005CC5\"> string</span><span style=\"color:#032F62\"> `&#x3C;p>Hello ${</span><span style=\"color:#24292E\">name</span><span style=\"color:#032F62\">}!&#x3C;/p>&#x3C;p>Your Order has been shipped. `</span><span style=\"color:#D73A49\"> +</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">                  string</span><span style=\"color:#032F62\"> `Track your order using ${</span><span style=\"color:#24292E\">trackingNumber</span><span style=\"color:#032F62\">}&#x3C;/p>`</span><span style=\"color:#24292E\">;</span></span>\n<span class=\"line\"><span style=\"color:#005CC5\">    var</span><span style=\"color:#24292E\"> mailReq </span><span style=\"color:#D73A49\">=</span><span style=\"color:#24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        toInfo</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> email,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        fromInfo</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"orders@blackwell.com\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        subject</span><span style=\"color:#D73A49\">:</span><span style=\"color:#032F62\"> \"Order Confirmation\"</span><span style=\"color:#24292E\">,</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">        content</span><span style=\"color:#D73A49\">:</span><span style=\"color:#24292E\"> body</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#24292E\">    _ </span><span style=\"color:#D73A49\">=</span><span style=\"color:#D73A49\"> check</span><span style=\"color:#24292E\"> sendgrid</span><span style=\"color:#D73A49\">->/</span><span style=\"color:#24292E\">v3</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">mail</span><span style=\"color:#D73A49\">/</span><span style=\"color:#24292E\">send.</span><span style=\"color:#6F42C1\">post</span><span style=\"color:#24292E\">(</span><span style=\"color:#E36209\">mailReq</span><span style=\"color:#24292E\">, </span><span style=\"color:#E36209\">targetType</span><span style=\"color:#D73A49\"> =</span><span style=\"color:#005CC5\"> json</span><span style=\"color:#24292E\">);</span></span>\n<span class=\"line\"><span style=\"color:#24292E\">}</span></span>\n<span class=\"line\"></span></code></pre>","raw":"import ballerina/http;\n\ntype OrderRequest record {|\n    string email;\n    Address address;\n    OrderItemRequest[] orderItems;\n|};\n\ntype OrderResponse record {|\n    string email;\n    string currency;\n    float total;\n    Address address;\n    OrderItemResponse[] orderItems;\n    string trackingNumber;\n|};\n\ntype Address record {|\n    string fullName;\n    string address1;\n    string phone;\n    string city;\n    string country;\n|};\n\ntype OrderItemRequest record {\n    string itemName;\n    int quantity;\n};\n\ntype OrderItemResponse record {|\n    string itemName;\n    int quantity;\n    float price;\n    string currencyCode;\n|};\n\ntype ShipmentRequest record {|\n    float amount;\n    string currency;\n    string personName;\n    string email;\n    DHLAddress|FedexAddress address;\n|};\n\ntype FedexAddress record {|\n    string address1;\n    string city;\n    string country;\n    string phoneNumber;\n|};\n\ntype DHLAddress record {|\n    string name;\n    *FedexAddress;\n|};\n\ntype FedexResponse record {|\n    string transactionId;\n    string trackingNumber;\n|};\n\ntype DHLResponse record {|\n    string trackingNumber;\n|};\n\nfinal http:Client shopify = check new (\"http://BlackwellsBooks.myshopify.com.balmock.io\");\nfinal http:Client dhlExpress = check new (\"http://express.api.dhl.com.balmock.io\");\nfinal http:Client fedEx = check new (\"http://api.fedex.com.balmock.io\");\nfinal http:Client sendgrid = check new (\"http://api.sendgrid.com.balmock.io\");\n\nservice /api/v1 on new http:Listener(8080) {\n    resource function post orders(OrderRequest orderReq) returns error? {\n        OrderResponse response = check shopify->/admin/api/orders\\.json.post(orderReq);\n        string trackingNumber;\n        if response.address.country == \"United States\" {\n            FedexResponse fedexResp = check createFedexShipment(response);\n            trackingNumber = fedexResp.trackingNumber;\n        } else {\n            DHLResponse dhlResp = check creeateDhlShipment(response);\n            trackingNumber = dhlResp.trackingNumber;\n        }\n        var _ = start sendConfirmationMail(response.address.fullName, response.email, trackingNumber);\n    }\n}\n\nfunction createFedexShipment(OrderResponse response) returns FedexResponse|error {\n    ShipmentRequest fedexReq = {\n        amount: response.total,\n        currency: response.currency,\n        personName: response.address.fullName,\n        email: response.email,\n        address: {\n            address1: response.address.address1,\n            city: response.address.city,\n            country: response.address.country,\n            phoneNumber: response.address.phone\n        }\n    };\n\n    return check fedEx->/api/en\\-us/catalog/ship/v1/shipments.post(fedexReq);\n\n}\n\nfunction creeateDhlShipment(OrderResponse response) returns DHLResponse|error {\n    ShipmentRequest dhlReq = {\n        amount: response.total,\n        currency: response.currency,\n        personName: response.address.fullName,\n        email: response.email,\n        address: {\n            name: response.address.fullName,\n            address1: response.address.address1,\n            city: response.address.city,\n            country: response.address.country,\n            phoneNumber: response.address.phone\n        }\n    };\n\n    return check dhlExpress->/mydhlapi/shipments.post(dhlReq);\n}\n\nfunction sendConfirmationMail(string name, string email, string trackingNumber) returns error? {\n    string body = string `<p>Hello ${name}!</p><p>Your Order has been shipped. ` +\n                  string `Track your order using ${trackingNumber}</p>`;\n    var mailReq = {\n        toInfo: email,\n        fromInfo: \"orders@blackwell.com\",\n        subject: \"Order Confirmation\",\n        content: body\n    };\n\n    _ = check sendgrid->/v3/mail/send.post(mailReq, targetType = json);\n}\n","name":"process-manager.bal"}],"name":" Process Manager"},"__N_SSG":true}