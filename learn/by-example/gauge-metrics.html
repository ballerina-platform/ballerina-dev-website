---
layout: ballerina-example-page-old
title: Gauge-Based Metrics
description: BBE on how to use the default Gauge Metrics Observability feature in Ballerina.
keywords: ballerina, ballerina by example, bbe, observability, tracing, opentracing, gauge
permalink: /learn/by-example/gauge-metrics
active: gauge-metrics
redirect_from:
  - /swan-lake/learn/by-example/gauge-metrics
  - /swan-lake/learn/by-example/gauge-metrics.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">observe</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerinax</span><span class="o">/</span><span class="nx">prometheus</span> <span class="k">as</span> <span class="nx">_</span><span class="p">;</span>

<span class="c1">//Create a gauge as a global variable in the service with the optional field description,</span>
<span class="c1">//default statistics configurations = { timeWindow: 600000, buckets: 5,</span>
<span class="c1">// and percentiles: [0.33, 0.5, 0.66, 0.99] }.</span>
<span class="nx">observe</span><span class="p">:</span><span class="nx">Gauge</span> <span class="nx">globalGauge</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;global_gauge&quot;</span><span class="p">,</span> <span class="s">&quot;Global gauge defined&quot;</span><span class="p">);</span>

<span class="kd">service</span> <span class="o">/</span><span class="nx">onlineStoreService</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9090</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">get</span> <span class="nx">makeOrder</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;------------------------------------------&quot;</span><span class="p">);</span>
        <span class="c1">//Incrementing the global gauge defined by 15.0.</span>
        <span class="nx">globalGauge</span><span class="p">.</span><span class="nx">increment</span><span class="p">(</span><span class="mf">15.0</span><span class="p">);</span>
        <span class="c1">//Log the current state of global gauge.</span>
        <span class="nx">printGauge</span><span class="p">(</span><span class="nx">globalGauge</span><span class="p">);</span>


        <span class="c1">//Create a gauge with simply a name, and default statistics configurations.</span>
        <span class="nx">observe</span><span class="p">:</span><span class="nx">Gauge</span> <span class="nx">localGauge</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;local_operations&quot;</span><span class="p">);</span>
        <span class="c1">//Increment the local gauge by default value 1.0.</span>
        <span class="nx">localGauge</span><span class="p">.</span><span class="nx">increment</span><span class="p">();</span>
        <span class="c1">//Increment the value of the gauge by 20.</span>
        <span class="nx">localGauge</span><span class="p">.</span><span class="nx">increment</span><span class="p">(</span><span class="mf">20.0</span><span class="p">);</span>
        <span class="c1">//Decrement the local gauge by default value 1.0.</span>
        <span class="nx">localGauge</span><span class="p">.</span><span class="nx">decrement</span><span class="p">();</span>
        <span class="c1">//Decrement the value of the gauge by 20.</span>
        <span class="nx">localGauge</span><span class="p">.</span><span class="nx">decrement</span><span class="p">(</span><span class="mf">10.0</span><span class="p">);</span>
        <span class="c1">//Log the current state of local gauge.</span>
        <span class="nx">printGauge</span><span class="p">(</span><span class="nx">localGauge</span><span class="p">);</span>


        <span class="c1">//Create a gauge with optional fields description, and tags defined.</span>
        <span class="nx">observe</span><span class="p">:</span><span class="nx">Gauge</span> <span class="nx">registeredGaugeWithTags</span> <span class="p">=</span>
                  <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;registered_gauge_with_tags&quot;</span><span class="p">,</span> <span class="s">&quot;RegisteredGauge&quot;</span><span class="p">,</span>
                       <span class="p">{</span><span class="nx">property</span><span class="p">:</span> <span class="s">&quot;gaugeProperty&quot;</span><span class="p">,</span> <span class="nx">gaugeType</span><span class="p">:</span> <span class="s">&quot;RegisterType&quot;</span><span class="p">});</span>

        <span class="c1">//Register the gauge instance, therefore it is stored in the global registry and can be reported to the</span>
        <span class="c1">//metrics server such as Prometheus. Additionally, this operation will register to the global registry for the</span>
        <span class="c1">//first invocation and will throw an error if there is already a registration of different metrics instance</span>
        <span class="c1">//or type. And subsequent invocations of register() will simply retrieve the stored metrics instance</span>
        <span class="c1">//for the provided name and tags fields, and use that instance for the subsequent operations on the</span>
        <span class="c1">//Counter instance.</span>
        <span class="nx">error</span><span class="err">?</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">registeredGaugeWithTags</span><span class="p">.</span><span class="nx">register</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error in registering gauge&quot;</span><span class="p">,</span> <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//Set the value of the gauge with the new value.</span>
        <span class="nx">registeredGaugeWithTags</span><span class="p">.</span><span class="nx">increment</span><span class="p">();</span>
        <span class="kt">float</span> <span class="nx">value</span> <span class="p">=</span> <span class="nx">registeredGaugeWithTags</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
        <span class="kt">float</span> <span class="nx">newValue</span> <span class="p">=</span> <span class="nx">value</span> <span class="o">*</span> <span class="mf">12.0</span><span class="p">;</span>
        <span class="nx">registeredGaugeWithTags</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">newValue</span><span class="p">);</span>
        <span class="c1">//Log the current state of registered gauge with tags.</span>
        <span class="nx">printGauge</span><span class="p">(</span><span class="nx">registeredGaugeWithTags</span><span class="p">);</span>


        <span class="c1">//Create a gauge with statistics disabled by passing empty statistics config array.</span>
        <span class="nx">observe</span><span class="p">:</span><span class="nx">StatisticConfig</span><span class="p">[]</span> <span class="nx">statsConfigs</span> <span class="p">=</span> <span class="p">[];</span>
        <span class="nx">observe</span><span class="p">:</span><span class="nx">Gauge</span> <span class="nx">gaugeWithNoStats</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;gauge_with_no_stats&quot;</span><span class="p">,</span>
                                        <span class="s">&quot;Some description&quot;</span><span class="p">,</span> <span class="p">(),</span> <span class="nx">statsConfigs</span><span class="p">);</span>
        <span class="nx">gaugeWithNoStats</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="nx">printGauge</span><span class="p">(</span><span class="nx">gaugeWithNoStats</span><span class="p">);</span>


        <span class="c1">//Create gauge with custom statistics config.</span>
        <span class="nx">observe</span><span class="p">:</span><span class="nx">StatisticConfig</span> <span class="nx">config</span> <span class="p">=</span> <span class="p">{</span>
            <span class="nx">timeWindow</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
            <span class="nx">percentiles</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">],</span>
            <span class="nx">buckets</span><span class="p">:</span> <span class="mi">3</span>
        <span class="p">};</span>
        <span class="nx">statsConfigs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="nx">config</span><span class="p">;</span>
        <span class="nx">observe</span><span class="p">:</span><span class="nx">Gauge</span> <span class="nx">gaugeWithCustomStats</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;gauge_with_custom_stats&quot;</span><span class="p">,</span>
                                        <span class="s">&quot;Some description&quot;</span><span class="p">,</span> <span class="p">(),</span> <span class="nx">statsConfigs</span><span class="p">);</span>
        <span class="kt">int</span> <span class="nx">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">gaugeWithCustomStats</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(&lt;</span><span class="kt">float</span><span class="p">&gt;(</span><span class="mi">100</span> <span class="o">*</span> <span class="nx">i</span><span class="p">));</span>
            <span class="nx">i</span> <span class="p">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//Log the current state of registered gauge with tags.</span>
        <span class="nx">printGauge</span><span class="p">(</span><span class="nx">gaugeWithCustomStats</span><span class="p">);</span>

        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;------------------------------------------&quot;</span><span class="p">);</span>

        <span class="c1">//Send response to the client.</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">res</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="c1">// Use a util method to set a string payload.</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setPayload</span><span class="p">(</span><span class="s">&quot;Order Processed!&quot;</span><span class="p">);</span>

        <span class="c1">// Send the response back to the caller.</span>
        <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error sending response&quot;</span><span class="p">,</span> <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printGauge</span><span class="p">(</span><span class="nx">observe</span><span class="p">:</span><span class="nx">Gauge</span> <span class="nx">gauge</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Get the statistics snapshot of the gauge.</span>
    <span class="nx">io</span><span class="p">:</span><span class="nx">print</span><span class="p">(</span><span class="s">&quot;Gauge - &quot;</span> <span class="o">+</span> <span class="nx">gauge</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s">&quot; Snapshot: &quot;</span><span class="p">);</span>
    <span class="nx">observe</span><span class="p">:</span><span class="nx">Snapshot</span><span class="p">[]</span><span class="err">?</span> <span class="nx">snapshots</span> <span class="p">=</span> <span class="nx">gauge</span><span class="p">.</span><span class="nx">getSnapshot</span><span class="p">();</span>
    <span class="kt">json</span><span class="p">|</span><span class="nx">error</span> <span class="nx">snapshotAsAJson</span> <span class="p">=</span> <span class="nx">snapshots</span><span class="p">.</span><span class="nx">cloneWithType</span><span class="p">(</span><span class="kt">json</span><span class="p">);</span>
    <span class="k">if</span> <span class="nx">snapshotAsAJson</span> <span class="nx">is</span> <span class="kt">json</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="nx">snapshotAsAJson</span><span class="p">.</span><span class="nx">toJsonString</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="c1">//Get the current value of the gauge.</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Gauge - &quot;</span><span class="p">,</span> <span class="nx">gauge</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s">&quot; Current Value: &quot;</span>
        <span class="p">,</span> <span class="nx">gauge</span><span class="p">.</span><span class="nx">getValue</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Gauge-Based Metrics</h2>
                            <p><p>Ballerina supports Observability out of the box and Metrics is one of the three important aspects of the
 Observability. To observe Ballerina code, the build time flag <code>--observability-included</code> should be given along with the
 <code>Config.toml</code> file when starting the service. The <code>Config.toml</code> file contains the required runtime configurations related to observability.
 The developers can define and use metrics to measure their own logic. A gauge is one type of the metrics that is
 supported by default in Ballerina, and it represents a single numerical value that can arbitrarily go up and down,
 and also based on the statistics configurations provided to the Gauge, it can also report the statistics such as max,
 min, mean, percentiles, etc.<br/><br/>
 For more information about configs and observing applications, see <a href="https://ballerina.io/learn/observing-ballerina-code/">Observing Ballerina Code</a>.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="counter-metrics.html?is_ref_by_example=true">
                                        <span>< PREVIOUS</span>
                                        <p>Counter-Based Metrics</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="c2c-deployment.html?is_ref_by_example=true">
                                        <span>NEXT ></span>
                                        <p>Kubernetes</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="gauge-metrics">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <div class="cTopControlsContainer">
                        <div class="cTopControlsRow">
                            <div class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-distribution/tree/master/examples/gauge-metrics/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                        
                                    </ul>
                                </div>
                            </div> 
                        </div>
                    </div>
              
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/io;
import ballerina/log;
import ballerina/observe;
import ballerinax/prometheus as _;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>observe:Gauge globalGauge = new (&quot;global_gauge&quot;, &quot;Global gauge defined&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create a gauge as a global variable in the service with the optional field description,
default statistics configurations = { timeWindow: 600000, buckets: 5,
 and percentiles: [0.33, 0.5, 0.66, 0.99] }.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service /onlineStoreService on new http:Listener(9090) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function get makeOrder(http:Caller caller, http:Request req) {
        io:println(&quot;------------------------------------------&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        globalGauge.increment(15.0);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Incrementing the global gauge defined by 15.0.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        printGauge(globalGauge);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Log the current state of global gauge.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        observe:Gauge localGauge = new (&quot;local_operations&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create a gauge with simply a name, and default statistics configurations.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        localGauge.increment();
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Increment the local gauge by default value 1.0.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        localGauge.increment(20.0);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Increment the value of the gauge by 20.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        localGauge.decrement();
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Decrement the local gauge by default value 1.0.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        localGauge.decrement(10.0);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Decrement the value of the gauge by 20.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        printGauge(localGauge);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Log the current state of local gauge.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        observe:Gauge registeredGaugeWithTags =
                  new (&quot;registered_gauge_with_tags&quot;, &quot;RegisteredGauge&quot;,
                       {property: &quot;gaugeProperty&quot;, gaugeType: &quot;RegisterType&quot;});
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create a gauge with optional fields description, and tags defined.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        error? result = registeredGaugeWithTags.register();
        if (result is error) {
            log:printError(&quot;Error in registering gauge&quot;, &#39;error = result);
        }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Register the gauge instance, therefore it is stored in the global registry and can be reported to the
metrics server such as Prometheus. Additionally, this operation will register to the global registry for the
first invocation and will throw an error if there is already a registration of different metrics instance
or type. And subsequent invocations of register() will simply retrieve the stored metrics instance
for the provided name and tags fields, and use that instance for the subsequent operations on the
Counter instance.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        registeredGaugeWithTags.increment();
        float value = registeredGaugeWithTags.getValue();
        float newValue = value * 12.0;
        registeredGaugeWithTags.setValue(newValue);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Set the value of the gauge with the new value.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        printGauge(registeredGaugeWithTags);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Log the current state of registered gauge with tags.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        observe:StatisticConfig[] statsConfigs = [];
        observe:Gauge gaugeWithNoStats = new (&quot;gauge_with_no_stats&quot;,
                                        &quot;Some description&quot;, (), statsConfigs);
        gaugeWithNoStats.setValue(100);
        printGauge(gaugeWithNoStats);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create a gauge with statistics disabled by passing empty statistics config array.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        observe:StatisticConfig config = {
            timeWindow: 30000,
            percentiles: [0.33, 0.5, 0.9, 0.99],
            buckets: 3
        };
        statsConfigs[0] = config;
        observe:Gauge gaugeWithCustomStats = new (&quot;gauge_with_custom_stats&quot;,
                                        &quot;Some description&quot;, (), statsConfigs);
        int i = 1;
        while (i &lt; 6) {
            gaugeWithCustomStats.setValue(&lt;float&gt;(100 * i));
            i = i + 1;
        }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create gauge with custom statistics config.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        printGauge(gaugeWithCustomStats);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Log the current state of registered gauge with tags.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        io:println(&quot;------------------------------------------&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        http:Response res = new;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Send response to the client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        res.setPayload(&quot;Order Processed!&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Use a util method to set a string payload.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        result = caller-&gt;respond(res);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Send the response back to the caller.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        if (result is error) {
            log:printError(&quot;Error sending response&quot;, &#39;error = result);
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function printGauge(observe:Gauge gauge) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    io:print(&quot;Gauge - &quot; + gauge.name + &quot; Snapshot: &quot;);
    observe:Snapshot[]? snapshots = gauge.getSnapshot();
    json|error snapshotAsAJson = snapshots.cloneWithType(json);
    if snapshotAsAJson is json {
        io:println(snapshotAsAJson.toJsonString());
    }
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Get the statistics snapshot of the gauge.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>    io:println(&quot;Gauge - &quot;, gauge.name, &quot; Current Value: &quot;
        , gauge.getValue());
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Get the current value of the gauge.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file and execute the `bal run` command below with the `--observability-included` build time flag and the `Config.toml` runtime configuration file.
BAL_CONFIG_FILES=Config.toml bal run --observability-included gauge_metrics.bal
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>ballerina: started Prometheus HTTP listener 0.0.0.0:9797
------------------------------------------
Gauge - global_gauge Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:15.0, &quot;max&quot;:15.0, &quot;min&quot;:15.0, &quot;stdDev&quot;:0.0, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.5, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.66, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.75, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.95, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.99, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.999, &quot;value&quot;:15.0}]}]
Gauge - global_gauge Current Value: 15.0
Gauge - local_operations Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:13.0390625, &quot;max&quot;:21.1171875, &quot;min&quot;:1.0, &quot;stdDev&quot;:8.180620171277893, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:10.0546875}, {&quot;percentile&quot;:0.5, &quot;value&quot;:10.0546875}, {&quot;percentile&quot;:0.66, &quot;value&quot;:20.1171875}, {&quot;percentile&quot;:0.75, &quot;value&quot;:20.1171875}, {&quot;percentile&quot;:0.95, &quot;value&quot;:21.1171875}, {&quot;percentile&quot;:0.99, &quot;value&quot;:21.1171875}, {&quot;percentile&quot;:0.999, &quot;value&quot;:21.1171875}]}]
Gauge - local_operations Current Value: 10.0
Gauge - registered_gauge_with_tags Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:6.515625, &quot;max&quot;:12.0546875, &quot;min&quot;:1.0, &quot;stdDev&quot;:5.515625, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:1.0}, {&quot;percentile&quot;:0.5, &quot;value&quot;:1.0}, {&quot;percentile&quot;:0.66, &quot;value&quot;:12.0546875}, {&quot;percentile&quot;:0.75, &quot;value&quot;:12.0546875}, {&quot;percentile&quot;:0.95, &quot;value&quot;:12.0546875}, {&quot;percentile&quot;:0.99, &quot;value&quot;:12.0546875}, {&quot;percentile&quot;:0.999, &quot;value&quot;:12.0546875}]}]
Gauge - registered_gauge_with_tags Current Value: 12.0
Gauge - gauge_with_no_stats Snapshot: null
Gauge - gauge_with_no_stats Current Value: 100.0
Gauge - gauge_with_custom_stats Snapshot: [{&quot;timeWindow&quot;:30000, &quot;mean&quot;:300.7, &quot;max&quot;:501.5, &quot;min&quot;:100.0, &quot;stdDev&quot;:141.775033062948, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:200.5}, {&quot;percentile&quot;:0.5, &quot;value&quot;:301.5}, {&quot;percentile&quot;:0.9, &quot;value&quot;:501.5}, {&quot;percentile&quot;:0.99, &quot;value&quot;:501.5}]}]
Gauge - gauge_with_custom_stats Current Value: 500.0
------------------------------------------
------------------------------------------
Gauge - global_gauge Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:22.53125, &quot;max&quot;:30.0625, &quot;min&quot;:15.0, &quot;stdDev&quot;:7.53125, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.5, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.66, &quot;value&quot;:30.0625}, {&quot;percentile&quot;:0.75, &quot;value&quot;:30.0625}, {&quot;percentile&quot;:0.95, &quot;value&quot;:30.0625}, {&quot;percentile&quot;:0.99, &quot;value&quot;:30.0625}, {&quot;percentile&quot;:0.999, &quot;value&quot;:30.0625}]}]
Gauge - global_gauge Current Value: 30.0
Gauge - local_operations Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:13.0390625, &quot;max&quot;:21.1171875, &quot;min&quot;:1.0, &quot;stdDev&quot;:8.180620171277893, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:10.0546875}, {&quot;percentile&quot;:0.5, &quot;value&quot;:10.0546875}, {&quot;percentile&quot;:0.66, &quot;value&quot;:20.1171875}, {&quot;percentile&quot;:0.75, &quot;value&quot;:20.1171875}, {&quot;percentile&quot;:0.95, &quot;value&quot;:21.1171875}, {&quot;percentile&quot;:0.99, &quot;value&quot;:21.1171875}, {&quot;percentile&quot;:0.999, &quot;value&quot;:21.1171875}]}]
Gauge - local_operations Current Value: 10.0
Gauge - registered_gauge_with_tags Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:55.4140625, &quot;max&quot;:156.9921875, &quot;min&quot;:1.0, &quot;stdDev&quot;:61.38432884406833, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:12.0546875}, {&quot;percentile&quot;:0.5, &quot;value&quot;:12.0546875}, {&quot;percentile&quot;:0.66, &quot;value&quot;:52.2421875}, {&quot;percentile&quot;:0.75, &quot;value&quot;:52.2421875}, {&quot;percentile&quot;:0.95, &quot;value&quot;:156.9921875}, {&quot;percentile&quot;:0.99, &quot;value&quot;:156.9921875}, {&quot;percentile&quot;:0.999, &quot;value&quot;:156.9921875}]}]
Gauge - registered_gauge_with_tags Current Value: 156.0
Gauge - gauge_with_no_stats Snapshot: null
Gauge - gauge_with_no_stats Current Value: 100.0
Gauge - gauge_with_custom_stats Snapshot: [{&quot;timeWindow&quot;:30000, &quot;mean&quot;:300.7, &quot;max&quot;:501.5, &quot;min&quot;:100.0, &quot;stdDev&quot;:141.775033062948, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:200.5}, {&quot;percentile&quot;:0.5, &quot;value&quot;:301.5}, {&quot;percentile&quot;:0.9, &quot;value&quot;:501.5}, {&quot;percentile&quot;:0.99, &quot;value&quot;:501.5}]}]
Gauge - gauge_with_custom_stats Current Value: 500.0
------------------------------------------
------------------------------------------
Gauge - global_gauge Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:30.0625, &quot;max&quot;:45.1875, &quot;min&quot;:15.0, &quot;stdDev&quot;:12.298479750223873, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:15.0}, {&quot;percentile&quot;:0.5, &quot;value&quot;:30.0625}, {&quot;percentile&quot;:0.66, &quot;value&quot;:30.0625}, {&quot;percentile&quot;:0.75, &quot;value&quot;:45.1875}, {&quot;percentile&quot;:0.95, &quot;value&quot;:45.1875}, {&quot;percentile&quot;:0.99, &quot;value&quot;:45.1875}, {&quot;percentile&quot;:0.999, &quot;value&quot;:45.1875}]}]
Gauge - global_gauge Current Value: 45.0
Gauge - local_operations Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:13.0390625, &quot;max&quot;:21.1171875, &quot;min&quot;:1.0, &quot;stdDev&quot;:8.180620171277893, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:10.0546875}, {&quot;percentile&quot;:0.5, &quot;value&quot;:10.0546875}, {&quot;percentile&quot;:0.66, &quot;value&quot;:20.1171875}, {&quot;percentile&quot;:0.75, &quot;value&quot;:20.1171875}, {&quot;percentile&quot;:0.95, &quot;value&quot;:21.1171875}, {&quot;percentile&quot;:0.99, &quot;value&quot;:21.1171875}, {&quot;percentile&quot;:0.999, &quot;value&quot;:21.1171875}]}]
Gauge - local_operations Current Value: 10.0
Gauge - registered_gauge_with_tags Snapshot: [{&quot;timeWindow&quot;:600000, &quot;mean&quot;:377.1927083333333, &quot;max&quot;:1887.9921875, &quot;min&quot;:1.0, &quot;stdDev&quot;:676.7534301455432, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:12.0546875}, {&quot;percentile&quot;:0.5, &quot;value&quot;:52.2421875}, {&quot;percentile&quot;:0.66, &quot;value&quot;:156.9921875}, {&quot;percentile&quot;:0.75, &quot;value&quot;:157.9921875}, {&quot;percentile&quot;:0.95, &quot;value&quot;:1887.9921875}, {&quot;percentile&quot;:0.99, &quot;value&quot;:1887.9921875}, {&quot;percentile&quot;:0.999, &quot;value&quot;:1887.9921875}]}]
Gauge - registered_gauge_with_tags Current Value: 1884.0
Gauge - gauge_with_no_stats Snapshot: null
Gauge - gauge_with_no_stats Current Value: 100.0
Gauge - gauge_with_custom_stats Snapshot: [{&quot;timeWindow&quot;:30000, &quot;mean&quot;:300.7, &quot;max&quot;:501.5, &quot;min&quot;:100.0, &quot;stdDev&quot;:141.775033062948, &quot;percentileValues&quot;:[{&quot;percentile&quot;:0.33, &quot;value&quot;:200.5}, {&quot;percentile&quot;:0.5, &quot;value&quot;:301.5}, {&quot;percentile&quot;:0.9, &quot;value&quot;:501.5}, {&quot;percentile&quot;:0.99, &quot;value&quot;:501.5}]}]
Gauge - gauge_with_custom_stats Current Value: 500.0
------------------------------------------
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR hover-enable cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>curl http://localhost:9090/onlineStoreService/makeOrder
Order Processed!
curl http://localhost:9090/onlineStoreService/makeOrder
Order Processed!
curl http://localhost:9090/onlineStoreService/makeOrder
Order Processed!
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Invoke the service three times using the cURL commands below.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    


                     
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                // hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // get code text
                var codeSnippet = document.getElementsByClassName('FullCode')[0];
                var codeText = codeSnippet.getElementsByTagName('pre')[0].textContent;

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return codeText;
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
