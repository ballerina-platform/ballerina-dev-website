---
layout: ballerina-example-page-old
title: Response with multiparts
description: BBE on how Ballerina supports encoding and decoding multipart content in HTTP responses along with nested parts.
keywords: ballerina, ballerina by example, bbe, mime, multiparts, entity
permalink: /learn/by-example/http-response-with-multiparts
active: http-response-with-multiparts
redirect_from:
  - /swan-lake/learn/by-example/http-response-with-multiparts
  - /swan-lake/learn/by-example/http-response-with-multiparts.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">mime</span><span class="p">;</span>

<span class="c1">// Creates an endpoint for the client.</span>
<span class="nx">http</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">clientEP</span> <span class="p">=</span> <span class="nx">check</span> <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;http://localhost:9092&quot;</span><span class="p">);</span>

<span class="kd">service</span> <span class="o">/</span><span class="nx">multiparts</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9092</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">get</span> <span class="nx">encode_out_response</span><span class="p">()</span> <span class="nx">returns</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="p">{</span>
        <span class="c1">// Creates an enclosing entity to hold the child parts.</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">parentPart</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>

        <span class="c1">// Creates a child part with the JSON content.</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">childPart1</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="nx">childPart1</span><span class="p">.</span><span class="nx">setJson</span><span class="p">({</span><span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;wso2&quot;</span><span class="p">});</span>
        <span class="c1">// Creates another child part with a file.</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">childPart2</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="c1">// This file path is relative to where the Ballerina is running.</span>
        <span class="c1">//If your file is located outside, please give the</span>
        <span class="c1">//absolute file path instead.</span>
        <span class="nx">childPart2</span><span class="p">.</span><span class="nx">setFileAsEntityBody</span><span class="p">(</span><span class="s">&quot;./files/test.xml&quot;</span><span class="p">,</span>
            <span class="nx">contentType</span> <span class="p">=</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">TEXT_XML</span><span class="p">);</span>
        <span class="c1">// Creates an array to hold the child parts.</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span><span class="p">[]</span> <span class="nx">childParts</span> <span class="p">=</span> <span class="p">[</span><span class="nx">childPart1</span><span class="p">,</span> <span class="nx">childPart2</span><span class="p">];</span>
        <span class="c1">// [Sets the child parts to the parent part](https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#setBodyParts).</span>
        <span class="nx">parentPart</span><span class="p">.</span><span class="nx">setBodyParts</span><span class="p">(</span><span class="nx">childParts</span><span class="p">,</span>
            <span class="nx">contentType</span> <span class="p">=</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">MULTIPART_MIXED</span><span class="p">);</span>
        <span class="c1">// Creates an array to hold the parent part and set it to the response.</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span><span class="p">[]</span> <span class="nx">immediatePartsToResponse</span> <span class="p">=</span> <span class="p">[</span><span class="nx">parentPart</span><span class="p">];</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">outResponse</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="nx">outResponse</span><span class="p">.</span><span class="nx">setBodyParts</span><span class="p">(</span><span class="nx">immediatePartsToResponse</span><span class="p">,</span>
            <span class="nx">contentType</span> <span class="p">=</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">MULTIPART_FORM_DATA</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">outResponse</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Binds the listener to the service.</span>
<span class="kd">service</span> <span class="o">/</span><span class="nx">multiparts</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9090</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// This resource accepts multipart responses.</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">get</span> <span class="nx">decode_in_response</span><span class="p">()</span>
            <span class="nx">returns</span> <span class="kt">string</span><span class="p">|</span><span class="nx">http</span><span class="p">:</span><span class="nx">InternalServerError</span> <span class="p">{</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span><span class="p">|</span><span class="nx">error</span> <span class="nx">returnResult</span> <span class="p">=</span> <span class="nx">clientEP</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span>
                        <span class="s">&quot;/multiparts/encode_out_response&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">returnResult</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// [Extracts the body parts](https://docs.central.ballerina.io/ballerina/http/latest/classes/Response#getBodyParts)  from the response.</span>
            <span class="k">var</span> <span class="nx">parentParts</span> <span class="p">=</span> <span class="nx">returnResult</span><span class="p">.</span><span class="nx">getBodyParts</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">parentParts</span> <span class="nx">is</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span><span class="p">[])</span> <span class="p">{</span>
                <span class="c1">//Loops through body parts.</span>
                <span class="nx">foreach</span> <span class="k">var</span> <span class="nx">parentPart</span> <span class="nx">in</span> <span class="nx">parentParts</span> <span class="p">{</span>
                    <span class="nx">handleNestedParts</span><span class="p">(</span><span class="nx">parentPart</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="s">&quot;Body Parts Received!&quot;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">{</span> <span class="nx">body</span><span class="p">:</span> <span class="s">&quot;Invalid payload&quot;</span><span class="p">};</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">{</span> <span class="nx">body</span><span class="p">:</span> <span class="s">&quot;Connection error&quot;</span><span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Gets the child parts that are nested within the parent.</span>
<span class="kd">function</span> <span class="nx">handleNestedParts</span><span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">parentPart</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="nx">contentTypeOfParent</span> <span class="p">=</span> <span class="nx">parentPart</span><span class="p">.</span><span class="nx">getContentType</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">contentTypeOfParent</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s">&quot;multipart/&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">childParts</span> <span class="p">=</span> <span class="nx">parentPart</span><span class="p">.</span><span class="nx">getBodyParts</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">childParts</span> <span class="nx">is</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span><span class="p">[])</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;Nested Parts Detected!&quot;</span><span class="p">);</span>
            <span class="nx">foreach</span> <span class="k">var</span> <span class="nx">childPart</span> <span class="nx">in</span> <span class="nx">childParts</span> <span class="p">{</span>
                <span class="nx">handleContent</span><span class="p">(</span><span class="nx">childPart</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error retrieving child parts! &quot;</span> <span class="o">+</span>
                            <span class="nx">childParts</span><span class="p">.</span><span class="kt">message</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//The content logic that handles the body parts</span>
<span class="c1">//vary based on your requirement.</span>
<span class="kd">function</span> <span class="nx">handleContent</span><span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">bodyPart</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="nx">baseType</span> <span class="p">=</span> <span class="nx">getBaseType</span><span class="p">(</span><span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getContentType</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">APPLICATION_XML</span> <span class="o">==</span> <span class="nx">baseType</span> <span class="o">||</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">TEXT_XML</span> <span class="o">==</span> <span class="nx">baseType</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// [Extracts XML data](https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#getXml) from the body part.</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getXml</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">xml</span><span class="p">)</span> <span class="p">{</span>
             <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;XML data: &quot;</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
             <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error in parsing XML data&quot;</span><span class="p">,</span> <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">APPLICATION_JSON</span> <span class="o">==</span> <span class="nx">baseType</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// [Extracts JSON data](https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#getJson) from the body part.</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getJson</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">json</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;JSON data: &quot;</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">toJsonString</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
             <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error in parsing JSON data&quot;</span><span class="p">,</span> <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">TEXT_PLAIN</span> <span class="o">==</span> <span class="nx">baseType</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// [Extracts text data](https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#getText) from the body part.</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getText</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;Text data: &quot;</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error in parsing text data&quot;</span><span class="p">,</span> <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">APPLICATION_PDF</span> <span class="o">==</span> <span class="nx">baseType</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// [Extracts the byte stream](https://docs.central.ballerina.io/ballerina/http/latest/classes/Response#getByteStream) from the body part and saves it as a file.</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getByteStream</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="nx">stream</span><span class="p">&lt;</span><span class="nx">byte</span><span class="p">[],</span> <span class="nx">io</span><span class="p">:</span><span class="nx">Error</span><span class="err">?</span><span class="p">&gt;)</span> <span class="p">{</span>
            <span class="c1">//Writes the incoming stream to a file using `io:fileWriteBlocksFromStream` API by providing the file location to which the content should be written to.</span>
            <span class="nx">io</span><span class="p">:</span><span class="nx">Error</span><span class="p">? result = io:fileWriteBlocksFromStream(</span>
                                    <span class="s">&quot;./files/ReceivedFile.pdf&quot;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred while writing &quot;</span><span class="p">,</span>
                                <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">result</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">close</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error in parsing byte channel :&quot;</span><span class="p">,</span>
                            <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Gets the base type from a given content type.</span>
<span class="kd">function</span> <span class="nx">getBaseType</span><span class="p">(</span><span class="kt">string</span> <span class="nx">contentType</span><span class="p">)</span> <span class="nx">returns</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">getMediaType</span><span class="p">(</span><span class="nx">contentType</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">MediaType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">getBaseType</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">panic</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Closes the byte stream.</span>
<span class="kd">function</span> <span class="nx">close</span><span class="p">(</span><span class="nx">stream</span><span class="p">&lt;</span><span class="nx">byte</span><span class="p">[],</span> <span class="nx">io</span><span class="p">:</span><span class="nx">Error</span><span class="err">?</span><span class="p">&gt;</span> <span class="nx">byteStream</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">cr</span> <span class="p">=</span> <span class="nx">byteStream</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cr</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error occurred while closing the stream: &quot;</span><span class="p">,</span>
                       <span class="err">&#39;</span><span class="nx">error</span> <span class="p">=</span> <span class="nx">cr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Response with multiparts</h2>
                            <p><p>Ballerina supports encoding and decoding multipart content in HTTP responses along with the nested parts.
 When you request multiparts from an HTTP inbound response, you get an array of the parts of the body (an array of
 entities). If the received parts contain nested parts, you can loop through the parent parts and get the child parts.<br/><br/>
 For more information on the underlying module,
 see the <a href="https://docs.central.ballerina.io/ballerina/mime/latest/">Mime module</a>.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="http-disable-chunking.html">
                                        <span>< PREVIOUS</span>
                                        <p>Chunking</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="http-request-with-multiparts.html">
                                        <span>NEXT ></span>
                                        <p>Request with multiparts</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="http-response-with-multiparts">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <div class="cTopControlsContainer">
                        <div class="cTopControlsRow">
                            <div class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-distribution/tree/v2201.1.0/examples/http-response-with-multiparts/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                        
                                    </ul>
                                </div>
                            </div> 
                        </div>
                    </div>
              
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/io;
import ballerina/log;
import ballerina/mime;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>http:Client clientEP = check new (&quot;http://localhost:9092&quot;);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates an endpoint for the client.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service /multiparts on new http:Listener(9092) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function get encode_out_response() returns http:Response {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity parentPart = new;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates an enclosing entity to hold the child parts.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity childPart1 = new;
        childPart1.setJson({&quot;name&quot;: &quot;wso2&quot;});
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates a child part with the JSON content.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity childPart2 = new;
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates another child part with a file.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        childPart2.setFileAsEntityBody(&quot;./files/test.xml&quot;,
            contentType = mime:TEXT_XML);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This file path is relative to where the Ballerina is running.
If your file is located outside, please give the
absolute file path instead.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity[] childParts = [childPart1, childPart2];
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates an array to hold the child parts.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        parentPart.setBodyParts(childParts,
            contentType = mime:MULTIPART_MIXED);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p><a href="https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#setBodyParts">Sets the child parts to the parent part</a>.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity[] immediatePartsToResponse = [parentPart];
        http:Response outResponse = new;
        outResponse.setBodyParts(immediatePartsToResponse,
            contentType = mime:MULTIPART_FORM_DATA);
        return outResponse;
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates an array to hold the parent part and set it to the response.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service /multiparts on new http:Listener(9090) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Binds the listener to the service.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    resource function get decode_in_response()
            returns string|http:InternalServerError {
        http:Response|error returnResult = clientEP-&gt;get(
                        &quot;/multiparts/encode_out_response&quot;);
        if (returnResult is http:Response) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource accepts multipart responses.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            var parentParts = returnResult.getBodyParts();
            if (parentParts is mime:Entity[]) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p><a href="https://docs.central.ballerina.io/ballerina/http/latest/classes/Response#getBodyParts">Extracts the body parts</a>  from the response.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                foreach var parentPart in parentParts {
                    handleNestedParts(parentPart);
                }
                return &quot;Body Parts Received!&quot;;
            } else {
                return { body: &quot;Invalid payload&quot;};
            }
        } else {
            return { body: &quot;Connection error&quot;};
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Loops through body parts.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function handleNestedParts(mime:Entity parentPart) {
    string contentTypeOfParent = parentPart.getContentType();
    if (contentTypeOfParent.startsWith(&quot;multipart/&quot;)) {
        var childParts = parentPart.getBodyParts();
        if (childParts is mime:Entity[]) {
            log:printInfo(&quot;Nested Parts Detected!&quot;);
            foreach var childPart in childParts {
                handleContent(childPart);
            }
        } else {
            log:printError(&quot;Error retrieving child parts! &quot; +
                            childParts.message());
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Gets the child parts that are nested within the parent.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function handleContent(mime:Entity bodyPart) {
    string baseType = getBaseType(bodyPart.getContentType());
    if (mime:APPLICATION_XML == baseType || mime:TEXT_XML == baseType) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The content logic that handles the body parts
vary based on your requirement.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        var payload = bodyPart.getXml();
        if (payload is xml) {
             log:printInfo(&quot;XML data: &quot; + payload.toString());
        } else {
             log:printError(&quot;Error in parsing XML data&quot;, &#39;error = payload);
        }
    } else if (mime:APPLICATION_JSON == baseType) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p><a href="https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#getXml">Extracts XML data</a> from the body part.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        var payload = bodyPart.getJson();
        if (payload is json) {
            log:printInfo(&quot;JSON data: &quot; + payload.toJsonString());
        } else {
             log:printError(&quot;Error in parsing JSON data&quot;, &#39;error = payload);
        }
    } else if (mime:TEXT_PLAIN == baseType) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p><a href="https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#getJson">Extracts JSON data</a> from the body part.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        var payload = bodyPart.getText();
        if (payload is string) {
            log:printInfo(&quot;Text data: &quot; + payload);
        } else {
            log:printError(&quot;Error in parsing text data&quot;, &#39;error = payload);
        }
    } else if (mime:APPLICATION_PDF == baseType) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p><a href="https://docs.central.ballerina.io/ballerina/mime/latest/classes/Entity#getText">Extracts text data</a> from the body part.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        var payload = bodyPart.getByteStream();
        if (payload is stream&lt;byte[], io:Error?&gt;) {
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p><a href="https://docs.central.ballerina.io/ballerina/http/latest/classes/Response#getByteStream">Extracts the byte stream</a> from the body part and saves it as a file.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            io:Error? result = io:fileWriteBlocksFromStream(
                                    &quot;./files/ReceivedFile.pdf&quot;, payload);
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Writes the incoming stream to a file using <code>io:fileWriteBlocksFromStream</code> API by providing the file location to which the content should be written to.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            if (result is error) {
                log:printError(&quot;Error occurred while writing &quot;,
                                &#39;error = result);
            }
            close(payload);
        } else {
            log:printError(&quot;Error in parsing byte channel :&quot;,
                            &#39;error = payload);
        }
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function getBaseType(string contentType) returns string {
    var result = mime:getMediaType(contentType);
    if (result is mime:MediaType) {
        return result.getBaseType();
    } else {
        panic result;
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Gets the base type from a given content type.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="cTR hover-enable">

                                <div class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>function close(stream&lt;byte[], io:Error?&gt; byteStream) {
    var cr = byteStream.close();
    if (cr is error) {
        log:printError(&quot;Error occurred while closing the stream: &quot;,
                       &#39;error = cr);
    }
}
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Closes the byte stream.</p>

                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># In the directory, which contains the `.bal` file, create a directory named `files`,
# and add an XML file named `test.xml` in it.
bal run response_with_multiparts.bal
time = 2021-01-21 22:20:38,143 level = INFO  module = &quot;&quot; message = &quot;Nested Parts Detected!&quot; 
time = 2021-01-21 22:20:38,185 level = INFO  module = &quot;&quot; message = &quot;JSON data: {&quot;name&quot;:&quot;wso2&quot;}&quot; 
time = 2021-01-21 22:20:38,324 level = INFO  module = &quot;&quot; message = &quot;XML data: &lt;ballerinalang&gt;
    &lt;version&gt;0.963&lt;/version&gt;
    &lt;test&gt;test xml file to be used as a file part&lt;/test&gt;
&lt;/ballerinalang&gt;&quot; 
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="codeSnippeset">

                        <div class="cBBE-body">
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>#To encode the outbound response with multiparts.
curl -X GET http://localhost:9092/multiparts/encode_out_response
--5afd3d91ee639af3
content-type: multipart/mixed;boundary=de5520ef3bc703d7
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>--de5520ef3bc703d7
content-type: application/json
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>{&quot;name&quot;:&quot;wso2&quot;}
--de5520ef3bc703d7
content-type: text/xml
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>&lt;ballerinalang&gt;
    &lt;version&gt;0.963&lt;/version&gt;
    &lt;test&gt;test xml file to be used as a file part&lt;/test&gt;
&lt;/ballerinalang&gt;
--de5520ef3bc703d7--
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>--5afd3d91ee639af3--
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                            <div class="cTR cOutputTr">

                                <div class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>#To decode the inbound response with multiparts.
curl -X GET http://localhost:9090/multiparts/decode_in_response
Body Parts Received!
</code></pre></div>

                                </div>
                                <div class="docs">
                                    
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    


                     
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                // hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // get code text
                var codeSnippet = document.getElementsByClassName('FullCode')[0];
                var codeText = codeSnippet.getElementsByTagName('pre')[0].textContent;

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return codeText;
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
