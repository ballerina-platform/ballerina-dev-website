---
layout: ballerina-example-page
title: Batch Execute Operations
description: Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.
permalink: /swan-lake/learn/by-example/mysql-batch-execute-operation
redirect_from:
  - /vswan-lake/learn/by-example/mysql-batch-execute-operation
  - /vswan-lake/learn/by-example/mysql-batch-execute-operation.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">sql</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerinax</span><span class="o">/</span><span class="nx">mysql</span><span class="p">;</span>

<span class="c1">// The username and password of the MySQL database. This is used in the below</span>
<span class="c1">// examples when initializing the MySQL connector. You need to change these</span>
<span class="c1">// based on your setup if you try locally.</span>
<span class="kt">string</span> <span class="nx">dbUser</span> <span class="p">=</span> <span class="s">&quot;root&quot;</span><span class="p">;</span>
<span class="kt">string</span> <span class="nx">dbPassword</span> <span class="p">=</span> <span class="s">&quot;Test@123&quot;</span><span class="p">;</span>
<span class="kt">string</span> <span class="nx">dbName</span> <span class="p">=</span> <span class="s">&quot;MYSQL_BBE&quot;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">initializeDatabase</span><span class="p">()</span> <span class="nx">returns</span> <span class="nx">sql</span><span class="p">:</span><span class="nx">Error</span><span class="err">?</span> <span class="p">{</span>
    <span class="c1">// Initialize the client without any database to create the database.</span>
    <span class="nx">mysql</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">mysqlClient</span> <span class="p">=</span> <span class="nx">check</span> <span class="nx">new</span> <span class="p">(</span><span class="nx">user</span> <span class="p">=</span> <span class="nx">dbUser</span><span class="p">,</span> <span class="nx">password</span> <span class="p">=</span> <span class="nx">dbPassword</span><span class="p">);</span>
    <span class="c1">// Create the database if it does not exist. If any error occurred,</span>
    <span class="c1">// the error will be returned.</span>
    <span class="nx">sql</span><span class="p">:</span><span class="nx">ExecutionResult</span> <span class="nx">result</span> <span class="p">=</span>
        <span class="nx">check</span> <span class="nx">mysqlClient</span><span class="o">-&gt;</span><span class="nx">execute</span><span class="p">(</span><span class="s">&quot;CREATE DATABASE IF NOT EXISTS &quot;</span> <span class="o">+</span> <span class="nx">dbName</span><span class="p">);</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Database created. &quot;</span><span class="p">);</span>
    <span class="c1">// Close the MySQL client.</span>
    <span class="nx">check</span> <span class="nx">mysqlClient</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initializeTable</span><span class="p">(</span><span class="nx">mysql</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">mysqlClient</span><span class="p">)</span>
<span class="nx">returns</span> <span class="nx">sql</span><span class="p">:</span><span class="nx">Error</span><span class="err">?</span> <span class="p">{</span>
    <span class="c1">// Execute dropping the table. The `sql:ExecutionResult` is returned upon</span>
    <span class="c1">// successful execution. An error will be returned in case of a failure.</span>
    <span class="nx">sql</span><span class="p">:</span><span class="nx">ExecutionResult</span> <span class="nx">result</span> <span class="p">=</span>
        <span class="nx">check</span> <span class="nx">mysqlClient</span><span class="o">-&gt;</span><span class="nx">execute</span><span class="p">(</span><span class="s">&quot;DROP TABLE IF EXISTS Customers&quot;</span><span class="p">);</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Drop table executed: &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>

    <span class="c1">// Similarly, to drop a table, the `create` table query is executed.</span>
    <span class="c1">// Here, the `customerId` is an auto-generated column.</span>
    <span class="nx">result</span> <span class="p">=</span> <span class="nx">check</span> <span class="nx">mysqlClient</span><span class="o">-&gt;</span><span class="nx">execute</span><span class="p">(</span>
                    <span class="s">&quot;CREATE TABLE IF NOT EXISTS Customers ( &quot;</span> <span class="o">+</span>
                    <span class="s">&quot;customerId INTEGER NOT NULL AUTO_INCREMENT, &quot;</span> <span class="o">+</span>
                    <span class="s">&quot;firstName VARCHAR(300), lastName VARCHAR(300), &quot;</span> <span class="o">+</span>
                    <span class="s">&quot;registrationID INTEGER UNIQUE, creditLimit DOUBLE, &quot;</span> <span class="o">+</span>
                    <span class="s">&quot;country VARCHAR(300), PRIMARY KEY (customerId))&quot;</span><span class="p">);</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Create table executed: &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>

<span class="p">}</span>

<span class="kd">function</span> <span class="nx">insertRecords</span><span class="p">(</span><span class="nx">mysql</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">mysqlClient</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Records to be inserted.</span>
    <span class="k">var</span> <span class="nx">insertRecords</span> <span class="p">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="nx">firstName</span><span class="p">:</span> <span class="s">&quot;Peter&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">:</span> <span class="s">&quot;Stuart&quot;</span><span class="p">,</span> <span class="nx">registrationID</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nx">creditLimit</span><span class="p">:</span> <span class="mf">5000.75</span><span class="p">,</span> <span class="nx">country</span><span class="p">:</span> <span class="s">&quot;USA&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="nx">firstName</span><span class="p">:</span> <span class="s">&quot;Stephanie&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">:</span> <span class="s">&quot;Mike&quot;</span><span class="p">,</span> <span class="nx">registrationID</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                    <span class="nx">creditLimit</span><span class="p">:</span> <span class="mf">8000.00</span><span class="p">,</span> <span class="nx">country</span><span class="p">:</span> <span class="s">&quot;USA&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="nx">firstName</span><span class="p">:</span> <span class="s">&quot;Bill&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">:</span> <span class="s">&quot;John&quot;</span><span class="p">,</span> <span class="nx">registrationID</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                    <span class="nx">creditLimit</span><span class="p">:</span> <span class="mf">3000.25</span><span class="p">,</span> <span class="nx">country</span><span class="p">:</span> <span class="s">&quot;USA&quot;</span><span class="p">}</span>
    <span class="p">];</span>

    <span class="c1">// Create a batch Parameterized Query.</span>
    <span class="nx">sql</span><span class="p">:</span><span class="nx">ParameterizedQuery</span><span class="p">[]</span> <span class="nx">insertQueries</span> <span class="p">=</span>
            <span class="nx">from</span> <span class="k">var</span> <span class="nx">data</span> <span class="nx">in</span> <span class="nx">insertRecords</span>
                <span class="nx">select</span>  <span class="s">`INSERT INTO Customers</span>
<span class="s">                    (firstName, lastName, registrationID, creditLimit, country)</span>
<span class="s">                    VALUES (${data.firstName}, ${data.lastName},</span>
<span class="s">                            ${data.registrationID}, ${data.creditLimit},</span>
<span class="s">                            ${data.country})`</span><span class="p">;</span>

    <span class="c1">// Insert the records with the auto-generated ID.</span>
    <span class="nx">sql</span><span class="p">:</span><span class="nx">ExecutionResult</span><span class="p">[]|</span><span class="nx">sql</span><span class="p">:</span><span class="nx">Error</span> <span class="nx">result</span> <span class="p">=</span>
        <span class="nx">mysqlClient</span><span class="o">-&gt;</span><span class="nx">batchExecute</span><span class="p">(</span><span class="nx">insertQueries</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">sql</span><span class="p">:</span><span class="nx">ExecutionResult</span><span class="p">[])</span> <span class="p">{</span>
        <span class="kt">int</span><span class="p">[]</span> <span class="nx">generatedIds</span> <span class="p">=</span> <span class="p">[];</span>
        <span class="nx">foreach</span> <span class="k">var</span> <span class="nx">summary</span> <span class="nx">in</span> <span class="nx">result</span> <span class="p">{</span>
            <span class="nx">generatedIds</span><span class="p">.</span><span class="nx">push</span><span class="p">(&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nx">summary</span><span class="p">.</span><span class="nx">lastInsertId</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;\nInsert success, generated IDs are: &quot;</span><span class="p">,</span> <span class="nx">generatedIds</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error occurred: &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">function</span> <span class="nx">simulateBatchExecuteFailure</span><span class="p">(</span><span class="nx">mysql</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">mysqlClient</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Records with duplicate `registrationID` entry (registrationID = 1).</span>
    <span class="k">var</span> <span class="nx">insertRecords</span> <span class="p">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="nx">firstName</span><span class="p">:</span> <span class="s">&quot;Linda&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">:</span> <span class="s">&quot;Jones&quot;</span><span class="p">,</span> <span class="nx">registrationID</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                                    <span class="nx">creditLimit</span><span class="p">:</span> <span class="mf">10000.75</span><span class="p">,</span> <span class="nx">country</span><span class="p">:</span> <span class="s">&quot;USA&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="nx">firstName</span><span class="p">:</span> <span class="s">&quot;Peter&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">:</span> <span class="s">&quot;Stuart&quot;</span><span class="p">,</span> <span class="nx">registrationID</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nx">creditLimit</span><span class="p">:</span> <span class="mf">5000.75</span><span class="p">,</span> <span class="nx">country</span><span class="p">:</span> <span class="s">&quot;USA&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="nx">firstName</span><span class="p">:</span> <span class="s">&quot;Camellia&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">:</span> <span class="s">&quot;Potter&quot;</span><span class="p">,</span> <span class="nx">registrationID</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                                    <span class="nx">creditLimit</span><span class="p">:</span> <span class="mf">2000.25</span><span class="p">,</span> <span class="nx">country</span><span class="p">:</span> <span class="s">&quot;USA&quot;</span><span class="p">}</span>
    <span class="p">];</span>

    <span class="c1">// Create a batch Parameterized Query.</span>
    <span class="nx">sql</span><span class="p">:</span><span class="nx">ParameterizedQuery</span><span class="p">[]</span> <span class="nx">insertQueries</span> <span class="p">=</span>
            <span class="nx">from</span> <span class="k">var</span> <span class="nx">data</span> <span class="nx">in</span> <span class="nx">insertRecords</span>
                <span class="nx">select</span>  <span class="s">`INSERT INTO Customers</span>
<span class="s">                    (firstName, lastName, registrationID, creditLimit, country)</span>
<span class="s">                    VALUES (${data.firstName}, ${data.lastName},</span>
<span class="s">                            ${data.registrationID}, ${data.creditLimit},</span>
<span class="s">                            ${data.country})`</span><span class="p">;</span>

    <span class="c1">// Transaction block can be used to rollback if any error occurred.</span>
    <span class="nx">transaction</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">mysqlClient</span><span class="o">-&gt;</span><span class="nx">batchExecute</span><span class="p">(</span><span class="nx">insertQueries</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">sql</span><span class="p">:</span><span class="nx">BatchExecuteError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="kt">message</span><span class="p">());</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="nx">executionResults</span><span class="p">);</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Rollback transaction.&quot;</span><span class="p">);</span>
            <span class="nx">rollback</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">error</span><span class="err">?</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">commit</span><span class="p">;</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error occurred while committing: &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Initialize the database.</span>
    <span class="nx">sql</span><span class="p">:</span><span class="nx">Error</span><span class="err">?</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">initializeDatabase</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="nx">is</span> <span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Initialize the MySQL client to be used for the rest of the DDL</span>
        <span class="c1">// and DML operations.</span>
        <span class="nx">mysql</span><span class="p">:</span><span class="nx">Client</span><span class="p">|</span><span class="nx">sql</span><span class="p">:</span><span class="nx">Error</span> <span class="nx">mysqlClient</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="nx">user</span> <span class="p">=</span> <span class="nx">dbUser</span><span class="p">,</span>
            <span class="nx">password</span> <span class="p">=</span> <span class="nx">dbPassword</span><span class="p">,</span> <span class="nx">database</span> <span class="p">=</span> <span class="nx">dbName</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">mysqlClient</span> <span class="nx">is</span> <span class="nx">mysql</span><span class="p">:</span><span class="nx">Client</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Initialize a table and insert sample data.</span>
            <span class="nx">sql</span><span class="p">:</span><span class="nx">Error</span><span class="err">?</span> <span class="nx">initResult</span> <span class="p">=</span> <span class="nx">initializeTable</span><span class="p">(</span><span class="nx">mysqlClient</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">initResult</span> <span class="nx">is</span> <span class="p">())</span> <span class="p">{</span>
                <span class="c1">// Insert a batch of records.</span>
                <span class="nx">insertRecords</span><span class="p">(</span><span class="nx">mysqlClient</span><span class="p">);</span>
                <span class="c1">// Simulate Failure Rollback.</span>
                <span class="nx">simulateBatchExecuteFailure</span><span class="p">(</span><span class="nx">mysqlClient</span><span class="p">);</span>
                <span class="c1">// Check the data.</span>
                <span class="nx">checkData</span><span class="p">(</span><span class="nx">mysqlClient</span><span class="p">);</span>

                <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;\nSample executed successfully!&quot;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Customer table initialization failed: &quot;</span><span class="p">,</span>
                                                            <span class="nx">initResult</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// Close the MySQL client.</span>
            <span class="nx">sql</span><span class="p">:</span><span class="nx">Error</span><span class="err">?</span> <span class="nx">e</span> <span class="p">=</span> <span class="nx">mysqlClient</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Table initialization failed!!&quot;</span><span class="p">,</span> <span class="nx">mysqlClient</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Database initialization failed!!&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">checkData</span><span class="p">(</span><span class="nx">mysql</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">mysqlClient</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">stream</span><span class="p">&lt;</span><span class="nx">record</span><span class="p">{},</span> <span class="nx">error</span><span class="p">&gt;</span> <span class="nx">resultStream</span> <span class="p">=</span>
        <span class="nx">mysqlClient</span><span class="o">-&gt;</span><span class="nx">query</span><span class="p">(</span><span class="s">&quot;Select * from Customers&quot;</span><span class="p">);</span>

     <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;\nData in Customers table:&quot;</span><span class="p">);</span>
     <span class="nx">error</span><span class="err">?</span> <span class="nx">e</span> <span class="p">=</span> <span class="nx">resultStream</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">record</span> <span class="p">{}</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
     <span class="p">});</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Select data from Customers table failed!&quot;</span><span class="p">);</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Batch Execute Operations</h2>
                            <p><p>This example demonstrates how to use the MySQL client to execute a batch of
 DDL/DML operations. Note that the MySQL database driver JAR should be defined in
 the <code>Ballerina.toml</code> file as a dependency.
 See <a href="https://ballerina.io/swan-lake/learn/api-docs/ballerina/#/ballerinax/mysql/latest/mysql/">MySQL module</a> for sample configuration.
 The MySQL connector uses database properties from MySQL version 8.0.x onwards. Therefore, it is
 recommended to use a MySQL driver version greater than 8.0.x.<br><br>
 For more information on the underlying module,
 see the <a href="https://ballerina.io/swan-lake/learn/api-docs/ballerina/#/ballerinax/mysql/latest/mysql/">MySQL module</a>.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="mysql-execute-operation.html">
                                        <span>< PREVIOUS</span>
                                        <p>DDL and DML Operations</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="mysql-call-stored-procedures.html">
                                        <span>NEXT ></span>
                                        <p>Call Stored Procedures</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="mysql-batch-execute-operation">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-distribution/tree/master/examples/mysql-batch-execute-operation/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                        
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/io;
import ballerina/sql;
import ballerinax/mysql;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>string dbUser = &quot;root&quot;;
string dbPassword = &quot;Test@123&quot;;
string dbName = &quot;MYSQL_BBE&quot;;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The username and password of the MySQL database. This is used in the below
 examples when initializing the MySQL connector. You need to change these
 based on your setup if you try locally.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function initializeDatabase() returns sql:Error? {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    mysql:Client mysqlClient = check new (user = dbUser, password = dbPassword);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Initialize the client without any database to create the database.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    sql:ExecutionResult result =
        check mysqlClient-&gt;execute(&quot;CREATE DATABASE IF NOT EXISTS &quot; + dbName);
    io:println(&quot;Database created. &quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create the database if it does not exist. If any error occurred,
 the error will be returned.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    check mysqlClient.close();
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Close the MySQL client.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function initializeTable(mysql:Client mysqlClient)
returns sql:Error? {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    sql:ExecutionResult result =
        check mysqlClient-&gt;execute(&quot;DROP TABLE IF EXISTS Customers&quot;);
    io:println(&quot;Drop table executed: &quot;, result);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Execute dropping the table. The <code>sql:ExecutionResult</code> is returned upon
 successful execution. An error will be returned in case of a failure.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    result = check mysqlClient-&gt;execute(
                    &quot;CREATE TABLE IF NOT EXISTS Customers ( &quot; +
                    &quot;customerId INTEGER NOT NULL AUTO_INCREMENT, &quot; +
                    &quot;firstName VARCHAR(300), lastName VARCHAR(300), &quot; +
                    &quot;registrationID INTEGER UNIQUE, creditLimit DOUBLE, &quot; +
                    &quot;country VARCHAR(300), PRIMARY KEY (customerId))&quot;);
    io:println(&quot;Create table executed: &quot;, result);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Similarly, to drop a table, the <code>create</code> table query is executed.
 Here, the <code>customerId</code> is an auto-generated column.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function insertRecords(mysql:Client mysqlClient) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    var insertRecords = [
        {firstName: &quot;Peter&quot;, lastName: &quot;Stuart&quot;, registrationID: 1,
                                    creditLimit: 5000.75, country: &quot;USA&quot;},
        {firstName: &quot;Stephanie&quot;, lastName: &quot;Mike&quot;, registrationID: 2,
                                    creditLimit: 8000.00, country: &quot;USA&quot;},
        {firstName: &quot;Bill&quot;, lastName: &quot;John&quot;, registrationID: 3,
                                    creditLimit: 3000.25, country: &quot;USA&quot;}
    ];
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Records to be inserted.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    sql:ParameterizedQuery[] insertQueries =
            from var data in insertRecords
                select  `INSERT INTO Customers
                    (firstName, lastName, registrationID, creditLimit, country)
                    VALUES (${data.firstName}, ${data.lastName},
                            ${data.registrationID}, ${data.creditLimit},
                            ${data.country})`;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create a batch Parameterized Query.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    sql:ExecutionResult[]|sql:Error result =
        mysqlClient-&gt;batchExecute(insertQueries);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Insert the records with the auto-generated ID.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    if (result is sql:ExecutionResult[]) {
        int[] generatedIds = [];
        foreach var summary in result {
            generatedIds.push(&lt;int&gt; summary.lastInsertId);
        }
        io:println(&quot;\nInsert success, generated IDs are: &quot;, generatedIds, &quot;\n&quot;);
    } else {
        io:println(&quot;Error occurred: &quot;, result);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function simulateBatchExecuteFailure(mysql:Client mysqlClient) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    var insertRecords = [
        {firstName: &quot;Linda&quot;, lastName: &quot;Jones&quot;, registrationID: 4,
                                    creditLimit: 10000.75, country: &quot;USA&quot;},
        {firstName: &quot;Peter&quot;, lastName: &quot;Stuart&quot;, registrationID: 1,
                                    creditLimit: 5000.75, country: &quot;USA&quot;},
        {firstName: &quot;Camellia&quot;, lastName: &quot;Potter&quot;, registrationID: 5,
                                    creditLimit: 2000.25, country: &quot;USA&quot;}
    ];
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Records with duplicate <code>registrationID</code> entry (registrationID = 1).</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    sql:ParameterizedQuery[] insertQueries =
            from var data in insertRecords
                select  `INSERT INTO Customers
                    (firstName, lastName, registrationID, creditLimit, country)
                    VALUES (${data.firstName}, ${data.lastName},
                            ${data.registrationID}, ${data.creditLimit},
                            ${data.country})`;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create a batch Parameterized Query.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    transaction {
        var result = mysqlClient-&gt;batchExecute(insertQueries);
        if (result is sql:BatchExecuteError) {
            io:println(result.message());
            io:println(result.detail()?.executionResults);
            io:println(&quot;Rollback transaction.&quot;);
            rollback;
        } else {
            error? err = commit;
            io:println(&quot;Error occurred while committing: &quot;, err);
        }
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Transaction block can be used to rollback if any error occurred.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    sql:Error? err = initializeDatabase();
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Initialize the database.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    if (err is ()) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mysql:Client|sql:Error mysqlClient = new (user = dbUser,
            password = dbPassword, database = dbName);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Initialize the MySQL client to be used for the rest of the DDL
 and DML operations.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        if (mysqlClient is mysql:Client) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            sql:Error? initResult = initializeTable(mysqlClient);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Initialize a table and insert sample data.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            if (initResult is ()) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                insertRecords(mysqlClient);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Insert a batch of records.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                simulateBatchExecuteFailure(mysqlClient);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Simulate Failure Rollback.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                checkData(mysqlClient);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Check the data.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                io:println(&quot;\nSample executed successfully!&quot;);
            } else {
                io:println(&quot;Customer table initialization failed: &quot;,
                                                            initResult);
            }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            sql:Error? e = mysqlClient.close();
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Close the MySQL client.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        } else {
            io:println(&quot;Table initialization failed!!&quot;, mysqlClient);
        }
    } else {
        io:println(&quot;Database initialization failed!!&quot;, err);
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function checkData(mysql:Client mysqlClient) {
     stream&lt;record{}, error&gt; resultStream =
        mysqlClient-&gt;query(&quot;Select * from Customers&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>     io:println(&quot;\nData in Customers table:&quot;);
     error? e = resultStream.forEach(function(record {} result) {
                 io:println(result.toString());
     });
     if (e is error) {
        io:println(&quot;Select data from Customers table failed!&quot;);
        io:println(e);
     }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run this sample, navigate to the directory that contains the
# `.bal` file and execute the `bal run` command below.
bal run mysql_batch_execute_operation.bal
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>ballerina/http] stopped HTTP/WS listener 192.168.1.18:43179
Database created.
Drop table executed: {&quot;affectedRowCount&quot;:0,&quot;lastInsertId&quot;:null}
Create table executed: {&quot;affectedRowCount&quot;:0,&quot;lastInsertId&quot;:null}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>Insert success, generated IDs are: [1,2,3]
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>Error while executing batch command starting with: &#39;INSERT INTO Customers
                    (firstName, lastName, registrationID, creditLimit, country)
                    VALUES ( ? ,  ? ,
                     ? ,  ? ,  ? )&#39;.Duplicate entry &#39;1&#39; for key &#39;registrationID&#39;.
[{&quot;affectedRowCount&quot;:1,&quot;lastInsertId&quot;:null},{&quot;affectedRowCount&quot;:-3,&quot;lastInsertId&quot;:null},{&quot;affectedRowCount&quot;:1,&quot;lastInsertId&quot;:null}]
Rollback transaction.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>Data in Customers table:
{&quot;customerId&quot;:1,&quot;firstName&quot;:&quot;Peter&quot;,&quot;lastName&quot;:&quot;Stuart&quot;,&quot;registrationID&quot;:1,&quot;creditLimit&quot;:5000.75,&quot;country&quot;:&quot;USA&quot;}
{&quot;customerId&quot;:2,&quot;firstName&quot;:&quot;Stephanie&quot;,&quot;lastName&quot;:&quot;Mike&quot;,&quot;registrationID&quot;:2,&quot;creditLimit&quot;:8000.0,&quot;country&quot;:&quot;USA&quot;}
{&quot;customerId&quot;:3,&quot;firstName&quot;:&quot;Bill&quot;,&quot;lastName&quot;:&quot;John&quot;,&quot;registrationID&quot;:3,&quot;creditLimit&quot;:3000.25,&quot;country&quot;:&quot;USA&quot;}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>Sample executed successfully!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                // hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
