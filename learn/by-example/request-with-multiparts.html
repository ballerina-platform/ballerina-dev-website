---
layout: ballerina-example-page
title: Request With Multiparts
description: Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.
permalink: /learn/by-example/request-with-multiparts
redirect_from:
  - /v1-2/learn/by-example/request-with-multiparts
  - /v1-2/learn/by-example/request-with-multiparts.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">mime</span><span class="p">;</span><span class="nx">http</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">clientEP</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;http://localhost:9090&quot;</span><span class="p">);</span><span class="nd">@http:ServiceConfig {</span>
    <span class="nx">basePath</span><span class="p">:</span> <span class="s">&quot;/multiparts&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">multipartDemoService</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9090</span><span class="p">)</span> <span class="p">{</span>    <span class="nd">@http:ResourceConfig {</span>
        <span class="nx">methods</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;POST&quot;</span><span class="p">],</span>
        <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/decode&quot;</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">multipartReceiver</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span>
                                        <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="k">var</span> <span class="nx">bodyParts</span> <span class="p">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">getBodyParts</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">bodyParts</span> <span class="nx">is</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span><span class="p">[])</span> <span class="p">{</span>
            <span class="nx">foreach</span> <span class="k">var</span> <span class="nx">part</span> <span class="nx">in</span> <span class="nx">bodyParts</span> <span class="p">{</span>
                <span class="nx">handleContent</span><span class="p">(</span><span class="nx">part</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">setPayload</span><span class="p">(&lt;</span><span class="err">@</span><span class="nx">untainted</span><span class="p">&gt;</span><span class="nx">bodyParts</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">bodyParts</span><span class="p">.</span><span class="nx">reason</span><span class="p">());</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">setPayload</span><span class="p">(</span><span class="s">&quot;Error in decoding multiparts!&quot;</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error sending response&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>    <span class="nd">@http:ResourceConfig {</span>
        <span class="nx">methods</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">],</span>
        <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/encode&quot;</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">multipartSender</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">jsonBodyPart</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="nx">jsonBodyPart</span><span class="p">.</span><span class="nx">setContentDisposition</span><span class="p">(</span>
                        <span class="nx">getContentDispositionForFormData</span><span class="p">(</span><span class="s">&quot;json part&quot;</span><span class="p">));</span>
        <span class="nx">jsonBodyPart</span><span class="p">.</span><span class="nx">setJson</span><span class="p">({</span><span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;wso2&quot;</span><span class="p">});</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">xmlFilePart</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="nx">xmlFilePart</span><span class="p">.</span><span class="nx">setContentDisposition</span><span class="p">(</span>
                       <span class="nx">getContentDispositionForFormData</span><span class="p">(</span><span class="s">&quot;xml file part&quot;</span><span class="p">));</span>
        <span class="nx">xmlFilePart</span><span class="p">.</span><span class="nx">setFileAsEntityBody</span><span class="p">(</span><span class="s">&quot;./files/test.xml&quot;</span><span class="p">,</span>
                                        <span class="nx">contentType</span> <span class="p">=</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">APPLICATION_XML</span><span class="p">);</span>
        <span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span><span class="p">[]</span> <span class="nx">bodyParts</span> <span class="p">=</span> <span class="p">[</span><span class="nx">jsonBodyPart</span><span class="p">,</span> <span class="nx">xmlFilePart</span><span class="p">];</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">request</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">setBodyParts</span><span class="p">(</span><span class="nx">bodyParts</span><span class="p">,</span> <span class="nx">contentType</span> <span class="p">=</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">MULTIPART_FORM_DATA</span><span class="p">);</span>
        <span class="k">var</span> <span class="nx">returnResponse</span> <span class="p">=</span> <span class="nx">clientEP</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s">&quot;/multiparts/decode&quot;</span><span class="p">,</span> <span class="nx">request</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">returnResponse</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">returnResponse</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error sending response&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">setPayload</span><span class="p">(</span><span class="s">&quot;Error occurred while sending multipart &quot;</span> <span class="o">+</span>
                                    <span class="s">&quot;request!&quot;</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span>
            <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error sending response&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">handleContent</span><span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">Entity</span> <span class="nx">bodyPart</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">mediaType</span> <span class="p">=</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">getMediaType</span><span class="p">(</span><span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getContentType</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mediaType</span> <span class="nx">is</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">MediaType</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">string</span> <span class="nx">baseType</span> <span class="p">=</span> <span class="nx">mediaType</span><span class="p">.</span><span class="nx">getBaseType</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">APPLICATION_XML</span> <span class="o">==</span> <span class="nx">baseType</span> <span class="o">||</span> <span class="nx">mime</span><span class="p">:</span><span class="nx">TEXT_XML</span> <span class="o">==</span> <span class="nx">baseType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getXml</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">xml</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">payload</span><span class="p">.</span><span class="nx">detail</span><span class="p">().</span><span class="kt">message</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">APPLICATION_JSON</span> <span class="o">==</span> <span class="nx">baseType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getJson</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">json</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">toJsonString</span><span class="p">());</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">payload</span><span class="p">.</span><span class="nx">detail</span><span class="p">().</span><span class="kt">message</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">TEXT_PLAIN</span> <span class="o">==</span> <span class="nx">baseType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">bodyPart</span><span class="p">.</span><span class="nx">getText</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">payload</span><span class="p">.</span><span class="nx">detail</span><span class="p">().</span><span class="kt">message</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="kd">function</span> <span class="nx">getContentDispositionForFormData</span><span class="p">(</span><span class="kt">string</span> <span class="nx">partName</span><span class="p">)</span>
                                    <span class="nx">returns</span> <span class="p">(</span><span class="nx">mime</span><span class="p">:</span><span class="nx">ContentDisposition</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mime</span><span class="p">:</span><span class="nx">ContentDisposition</span> <span class="nx">contentDisposition</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
    <span class="nx">contentDisposition</span><span class="p">.</span><span class="nx">name</span> <span class="p">=</span> <span class="nx">partName</span><span class="p">;</span>
    <span class="nx">contentDisposition</span><span class="p">.</span><span class="nx">disposition</span> <span class="p">=</span> <span class="s">&quot;form-data&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">contentDisposition</span><span class="p">;</span>
<span class="p">}</span><span class="err">#</span> <span class="nx">To</span> <span class="nx">start</span> <span class="nx">the</span> <span class="kd">service</span><span class="p">,</span> <span class="nx">navigate</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">directory</span> <span class="nx">that</span> <span class="nx">contains</span> <span class="nx">the</span>
<span class="err">#</span> <span class="s">`.bal`</span> <span class="nx">file</span> <span class="nx">and</span> <span class="nx">use</span> <span class="nx">the</span> <span class="s">`ballerina run`</span> <span class="nx">command</span> <span class="nx">below</span><span class="p">.</span>
<span class="nx">ballerina</span> <span class="nx">run</span> <span class="nx">request_with_multiparts</span><span class="p">.</span><span class="nx">bal</span>
<span class="p">[</span><span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">]</span> <span class="nx">started</span> <span class="nx">HTTP</span><span class="o">/</span><span class="nx">WS</span> <span class="nx">listener</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">9090</span><span class="err">#</span> <span class="nx">Start</span> <span class="nx">multipartDemoService</span>
<span class="err">#</span> <span class="nx">The</span> <span class="nx">cURL</span> <span class="nx">command</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">you</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">execute</span> <span class="nx">to</span> <span class="nx">decode</span> <span class="nx">a</span> <span class="nx">multipart</span> <span class="nx">request</span>
<span class="nx">curl</span> <span class="o">-</span><span class="nx">F</span> <span class="s">&quot;part1={\&quot;name\&quot;:\&quot;ballerina\&quot;};type=application/json&quot;</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:9090/multiparts/decode -H &quot;Content-Type: multipart/mixed&quot; -H &#39;Expect:&#39;</span>
<span class="o">--</span><span class="nx">ac4875939cf6b158</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="p">:</span> <span class="nx">application</span><span class="o">/</span><span class="kt">json</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">disposition</span><span class="p">:</span> <span class="nx">form</span><span class="o">-</span><span class="nx">data</span><span class="p">;</span><span class="nx">name</span><span class="p">=</span><span class="s">&quot;part1&quot;</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">id</span><span class="p">:</span> <span class="mi">0</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;ballerina&quot;</span><span class="p">}</span>
<span class="o">--</span><span class="nx">ac4875939cf6b158</span><span class="o">--</span><span class="err">#</span> <span class="nx">The</span> <span class="nx">cURL</span> <span class="nx">command</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">you</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">execute</span> <span class="nx">to</span> <span class="nx">encode</span> <span class="nx">the</span> <span class="nx">parts</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">body</span> <span class="nx">and</span> <span class="nx">send</span> <span class="nx">a</span> <span class="nx">multipart</span> <span class="nx">request</span> <span class="nx">via</span> <span class="nx">the</span> <span class="nx">Ballerina</span> <span class="kd">service</span>
<span class="nx">curl</span> <span class="o">-</span><span class="nx">v</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:9090/multiparts/encode</span>
<span class="p">&lt;</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="nx">OK</span>
<span class="p">&lt;</span> <span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="p">:</span> <span class="nx">multipart</span><span class="o">/</span><span class="nx">form</span><span class="o">-</span><span class="nx">data</span><span class="p">;</span> <span class="nx">boundary</span><span class="p">=</span><span class="mi">3</span><span class="nx">bbfa10811dcdee6</span>
<span class="p">&lt;</span> <span class="nx">date</span><span class="p">:</span> <span class="nx">Thu</span><span class="p">,</span> <span class="mi">14</span> <span class="nx">Jun</span> <span class="mi">2018</span> <span class="mi">15</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span> <span class="o">+</span><span class="mo">0530</span>
<span class="p">&lt;</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">ballerina</span><span class="o">/</span><span class="mf">0.982.1</span><span class="o">-</span><span class="nx">SNAPSHOT</span>
<span class="p">&lt;</span> <span class="nx">content</span><span class="o">-</span><span class="nx">length</span><span class="p">:</span> <span class="mi">398</span>
<span class="p">&lt;</span>
<span class="o">--</span><span class="mi">3</span><span class="nx">bbfa10811dcdee6</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="p">:</span> <span class="nx">application</span><span class="o">/</span><span class="kt">json</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">disposition</span><span class="p">:</span> <span class="nx">form</span><span class="o">-</span><span class="nx">data</span><span class="p">;</span><span class="nx">name</span><span class="p">=</span><span class="s">&quot;json part&quot;</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">id</span><span class="p">:</span> <span class="mi">0</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;wso2&quot;</span><span class="p">}</span>
<span class="o">--</span><span class="mi">3</span><span class="nx">bbfa10811dcdee6</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="p">:</span> <span class="nx">application</span><span class="o">/</span><span class="kt">xml</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">disposition</span><span class="p">:</span> <span class="nx">form</span><span class="o">-</span><span class="nx">data</span><span class="p">;</span><span class="nx">name</span><span class="p">=</span><span class="s">&quot;xml file part&quot;</span>
<span class="nx">content</span><span class="o">-</span><span class="nx">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">&lt;</span><span class="nx">ballerinalang</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">version</span><span class="p">&gt;</span><span class="mf">0.963</span><span class="p">&lt;</span><span class="o">/</span><span class="nx">version</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">test</span><span class="p">&gt;</span><span class="nx">test</span> <span class="kt">xml</span> <span class="nx">file</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">used</span> <span class="k">as</span> <span class="nx">a</span> <span class="nx">file</span> <span class="nx">part</span><span class="p">&lt;</span><span class="o">/</span><span class="nx">test</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="o">/</span><span class="nx">ballerinalang</span><span class="p">&gt;</span>
<span class="o">--</span><span class="mi">3</span><span class="nx">bbfa10811dcdee6</span><span class="o">--</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Request With Multiparts</h2>
                            <p><p>Ballerina supports encoding and decoding multipart content in http requests along with nested parts.
 When you request multiparts from the HTTP inbound request, you get an array of body parts (an array of entities).
 You can loop through this array and handle the received body parts according to your requirement.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="mutual-ssl.html">
                                        <span>< PREVIOUS</span>
                                        <p>Mutual SSL</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="response-with-multiparts.html">
                                        <span>NEXT ></span>
                                        <p>Response With Multiparts</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="request-with-multiparts">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-distribution/tree/master/examples/request-with-multiparts/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/log;
import ballerina/mime;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>http:Client clientEP = new (&quot;http://localhost:9090&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@http:ServiceConfig {
    basePath: &quot;/multiparts&quot;
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service multipartDemoService on new http:Listener(9090) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Binds the listener to the service.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    @http:ResourceConfig {
        methods: [&quot;POST&quot;],
        path: &quot;/decode&quot;
    }
    resource function multipartReceiver(http:Caller caller, http:Request
                                        request) {
        http:Response response = new;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        var bodyParts = request.getBodyParts();
        if (bodyParts is mime:Entity[]) {
            foreach var part in bodyParts {
                handleContent(part);
            }
            response.setPayload(&lt;@untainted&gt;bodyParts);
        } else {
            log:printError(&lt;string&gt;bodyParts.reason());
            response.setPayload(&quot;Error in decoding multiparts!&quot;);
            response.statusCode = 500;
        }
        var result = caller-&gt;respond(response);
        if (result is error) {
            log:printError(&quot;Error sending response&quot;, result);
        }
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Extracts bodyparts from the request.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    @http:ResourceConfig {
        methods: [&quot;GET&quot;],
        path: &quot;/encode&quot;
    }
    resource function multipartSender(http:Caller caller, http:Request req) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity jsonBodyPart = new;
        jsonBodyPart.setContentDisposition(
                        getContentDispositionForFormData(&quot;json part&quot;));
        jsonBodyPart.setJson({&quot;name&quot;: &quot;wso2&quot;});
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create a json body part.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity xmlFilePart = new;
        xmlFilePart.setContentDisposition(
                       getContentDispositionForFormData(&quot;xml file part&quot;));
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create an <code>xml</code> body part as a file upload.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        xmlFilePart.setFileAsEntityBody(&quot;./files/test.xml&quot;,
                                        contentType = mime:APPLICATION_XML);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This file path is relative to where the ballerina is running.
 If your file is located outside, please
 give the absolute file path instead.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        mime:Entity[] bodyParts = [jsonBodyPart, xmlFilePart];
        http:Request request = new;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create an array to hold all the body parts.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        request.setBodyParts(bodyParts, contentType = mime:MULTIPART_FORM_DATA);
        var returnResponse = clientEP-&gt;post(&quot;/multiparts/decode&quot;, request);
        if (returnResponse is http:Response) {
            var result = caller-&gt;respond(returnResponse);
            if (result is error) {
                log:printError(&quot;Error sending response&quot;, result);
            }
        } else {
            http:Response response = new;
            response.setPayload(&quot;Error occurred while sending multipart &quot; +
                                    &quot;request!&quot;);
            response.statusCode = 500;
            var result = caller-&gt;respond(response);
            if (result is error) {
                log:printError(&quot;Error sending response&quot;, result);
            }
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Set the body parts to the request.
 Here the content-type is set as multipart form data.
 This also works with any other multipart media type.
 eg:- <code>multipart/mixed</code>, <code>multipart/related</code> etc.
 You need to pass the content type that suit your requirement.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>function handleContent(mime:Entity bodyPart) {
    var mediaType = mime:getMediaType(bodyPart.getContentType());
    if (mediaType is mime:MediaType) {
        string baseType = mediaType.getBaseType();
        if (mime:APPLICATION_XML == baseType || mime:TEXT_XML == baseType) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The content logic that handles the body parts vary based on your requirement.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            var payload = bodyPart.getXml();
            if (payload is xml) {
                log:printInfo(payload.toString());
            } else {
                log:printError(&lt;string&gt;payload.detail().message);
            }
        } else if (mime:APPLICATION_JSON == baseType) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Extracts <code>xml</code> data from the body part.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            var payload = bodyPart.getJson();
            if (payload is json) {
                log:printInfo(payload.toJsonString());
            } else {
                log:printError(&lt;string&gt;payload.detail().message);
            }
        } else if (mime:TEXT_PLAIN == baseType) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Extracts <code>json</code> data from the body part.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            var payload = bodyPart.getText();
            if (payload is string) {
                log:printInfo(payload);
            } else {
                log:printError(&lt;string&gt;payload.detail().message);
            }
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Extracts text data from the body part.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>function getContentDispositionForFormData(string partName)
                                    returns (mime:ContentDisposition) {
    mime:ContentDisposition contentDisposition = new;
    contentDisposition.name = partName;
    contentDisposition.disposition = &quot;form-data&quot;;
    return contentDisposition;
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file and use the `ballerina run` command below.
ballerina run request_with_multiparts.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:9090
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Start multipartDemoService
# The cURL command, which you need to execute to decode a multipart request
curl -F &quot;part1={\&quot;name\&quot;:\&quot;ballerina\&quot;};type=application/json&quot; http://localhost:9090/multiparts/decode -H &quot;Content-Type: multipart/mixed&quot; -H &#39;Expect:&#39;
--ac4875939cf6b158
content-type: application/json
content-disposition: form-data;name=&quot;part1&quot;
content-id: 0
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>{&quot;name&quot;:&quot;ballerina&quot;}
--ac4875939cf6b158--
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># The cURL command, which you need to execute to encode the parts of the body and send a multipart request via the Ballerina service
curl -v http://localhost:9090/multiparts/encode
&lt; HTTP/1.1 200 OK
&lt; content-type: multipart/form-data; boundary=3bbfa10811dcdee6
&lt; date: Thu, 14 Jun 2018 15:22:21 +0530
&lt; server: ballerina/0.982.1-SNAPSHOT
&lt; content-length: 398
&lt;
--3bbfa10811dcdee6
content-type: application/json
content-disposition: form-data;name=&quot;json part&quot;
content-id: 0
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>{&quot;name&quot;:&quot;wso2&quot;}
--3bbfa10811dcdee6
content-type: application/xml
content-disposition: form-data;name=&quot;xml file part&quot;
content-id: 1
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>&lt;ballerinalang&gt;
    &lt;version&gt;0.963&lt;/version&gt;
    &lt;test&gt;test xml file to be used as a file part&lt;/test&gt;
&lt;/ballerinalang&gt;
--3bbfa10811dcdee6--
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
