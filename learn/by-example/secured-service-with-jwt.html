<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta property="og:url" content="https://ballerina.io" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Ballerina - Cloud Native Programming Language - Ballerina by Example: Secured Service with JWT" />
    <meta property="og:description" content="Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below. " />
    <meta property="og:image" content="/img/ballerina-sm.jpg" />
    <link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="../../img/favicon.ico" type="image/x-icon">
    <title>Ballerina by Example: Secured Service with JWT</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-92163714-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-92163714-2');
    </script>

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PSL2TX4');
    </script>
    <!-- End Google Tag Manager -->

    <!-- Hotjar Tracking Code for https://ballerinalang.org/ -->
    <script>
        (function(h, o, t, j, a, r) {
            h.hj = h.hj || function() {
                (h.hj.q = h.hj.q || []).push(arguments)
            };
            h._hjSettings = {
                hjid: 442732,
                hjsv: 5
            };
            a = o.getElementsByTagName('head')[0];
            r = o.createElement('script');
            r.async = 1;
            r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
            a.appendChild(r);
        })(window, document, '//static.hotjar.com/c/hotjar-', '.js?sv=');
    </script>

    <!--copy to clipboard lib-->
    <script src="/js/clipboard.js-2.0.0/clipboard.min.js"></script>

    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
        var base_url = "";
    </script>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.typekit.net/son4ymv.css">

    <script type="text/javascript" src="/js/highlight.pack.js"></script>

    <script src="/js/ballerina-common.js"></script>
    <link rel=stylesheet href="/css/ballerina-io.css">
    <link rel=stylesheet href="/css/ballerina-io-bbe.css">
    <script src="/search/require.js"></script>
</head>

<body class="cBallerina-io">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSL2TX4"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="row cBallerina-io-Nav" id="iMainNavigation">

    </div>
 
    <div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">jwt</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="nx">jwt</span><span class="p">:</span><span class="nx">InboundJwtAuthProvider</span> <span class="nx">jwtAuthProvider</span> <span class="p">=</span> <span class="nx">new</span><span class="p">({</span>
    <span class="nx">issuer</span><span class="p">:</span> <span class="s">&quot;ballerina&quot;</span><span class="p">,</span>
    <span class="nx">audience</span><span class="p">:</span> <span class="s">&quot;ballerina.io&quot;</span><span class="p">,</span>
    <span class="nx">trustStoreConfig</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">certificateAlias</span><span class="p">:</span> <span class="s">&quot;ballerina&quot;</span><span class="p">,</span>
        <span class="nx">trustStore</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;${ballerina.home}/bre/security/ballerinaTruststore.p12&quot;</span><span class="p">,</span>
            <span class="nx">password</span><span class="p">:</span> <span class="s">&quot;ballerina&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="nx">http</span><span class="p">:</span><span class="nx">BearerAuthHandler</span> <span class="nx">jwtAuthHandler</span> <span class="p">=</span> <span class="nx">new</span><span class="p">(</span><span class="nx">jwtAuthProvider</span><span class="p">);</span>
<span class="nx">listener</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span> <span class="nx">ep</span> <span class="p">=</span> <span class="nx">new</span><span class="p">(</span><span class="mi">9090</span><span class="p">,</span> <span class="nx">config</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">auth</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">authHandlers</span><span class="p">:</span> <span class="p">[</span><span class="nx">jwtAuthHandler</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">secureSocket</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">keyStore</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;${ballerina.home}/bre/security/ballerinaKeystore.p12&quot;</span><span class="p">,</span>
            <span class="nx">password</span><span class="p">:</span> <span class="s">&quot;ballerina&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span><span class="nd">@http:ServiceConfig {</span>
    <span class="nx">basePath</span><span class="p">:</span> <span class="s">&quot;/hello&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">echo</span> <span class="nx">on</span> <span class="nx">ep</span> <span class="p">{</span>
    <span class="nd">@http:ResourceConfig {</span>
        <span class="nx">methods</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">],</span>
        <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/sayHello&quot;</span><span class="p">,</span>
        <span class="nx">auth</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">scopes</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;hello&quot;</span><span class="p">],</span>
            <span class="nx">enabled</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">error</span><span class="err">?</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="s">&quot;Hello, World!!!&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error in responding to caller&quot;</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">


                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Secured Service with JWT</h2>
                            <p><p>A service can be secured using JWT and optionally, by enforcing
 authorization. The JWT auth provider verifies the signature of the JWT
 token sent in the Authorization header. For this, Ballerina should trust the
 JWT issuer (the certificate of the JWT issuer must be present in the Ballerina
 certificate truststore).
 Ballerina uses the concept of scopes for authorization. A resource
 declared in a service can be bound to one/more scope(s). In the config
 auth provider, scopes are mapped to users.
 In the authorization phase, the scopes of the resource are compared against
 the scopes mapped to the user for at least one match between the two sets.
 The scope can be included in the JWT using the <code>scope</code> attribute,
 or the scopes for a user can be set in a Ballerina configuration file
 (e.g., sample-users.toml).</p>

<pre><code>  [&quot;b7a.users&quot;]

  [&quot;b7a.users.tom&quot;]
  scopes=&quot;scope2,scope3&quot;

  [&quot;b7a.users.dick&quot;]
  scopes=&quot;scope1&quot;
</code></pre>

<p>Tom is assigned &ldquo;scope2&rdquo; and &ldquo;scope3&rdquo;, while Dick is assigned &ldquo;scope1&rdquo;.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="udp-socket-client.html">
                                        <span>< PREVIOUS</span>
                                        <p>Basic UDP Client Socket</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="secured-service-with-basic-auth.html">
                                        <span>NEXT ></span>
                                        <p>Secured Service with Basic Auth</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="secured-service-with-jwt">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBreadcrums">
                                    <ul>
                                        <li><a href="/">Home</a></li>
                                        <li>»</li>
                                        <li><a href="/learn">Learn</a></li>
                                        <li>»</li>
                                        <li><a href="/learn/by-example">By Example</a></li>
                                        <li>»</li>
                                        <li>Secured Service with JWT</li>
                                    </ul>
                                </div>
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-lang/ballerina/tree/master/examples/secured-service-with-jwt/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/http;
import ballerina/jwt;
import ballerina/log;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>jwt:InboundJwtAuthProvider jwtAuthProvider = new({
    issuer: &quot;ballerina&quot;,
    audience: &quot;ballerina.io&quot;,
    trustStoreConfig: {
        certificateAlias: &quot;ballerina&quot;,
        trustStore: {
            path: &quot;${ballerina.home}/bre/security/ballerinaTruststore.p12&quot;,
            password: &quot;ballerina&quot;
        }
    }
});
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates an inbound JWT authentication provider with the relevant
 configurations.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>http:BearerAuthHandler jwtAuthHandler = new(jwtAuthProvider);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates a Bearer Auth handler with the created JWT Auth provider.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>listener http:Listener ep = new(9090, config = {
    auth: {
        authHandlers: [jwtAuthHandler]
    },
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The endpoint used here is the <code>http:Listener</code>. The JWT authentication
 handler is set to this endpoint using the <code>authHandlers</code> attribute.
 It is optional to override the authentication and authorization at the
 service and resource levels.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    secureSocket: {
        keyStore: {
            path: &quot;${ballerina.home}/bre/security/ballerinaKeystore.p12&quot;,
            password: &quot;ballerina&quot;
        }
    }
});
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The secure hello world sample uses HTTPS.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>@http:ServiceConfig {
    basePath: &quot;/hello&quot;
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>service echo on ep {
    @http:ResourceConfig {
        methods: [&quot;GET&quot;],
        path: &quot;/sayHello&quot;,
        auth: {
            scopes: [&quot;hello&quot;],
            enabled: true
        }
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Auth configuration comprises of two parts -
 authentication &amp; authorization.
 Authentication can be disabled by setting the <code>enabled: false</code> flag.
 Authorization is based on scopes. A scope maps to one or more groups.
 For a user to access a resource, the user should be in the same groups as
 the scope.
 To specify one or more scope of a resource, the annotation attribute
 <code>scopes</code> can be used.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>    resource function hello(http:Caller caller, http:Request req) {
        error? result = caller-&gt;respond(&quot;Hello, World!!!&quot;);
        if (result is error) {
            log:printError(&quot;Error in responding to caller&quot;, err = result);
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The authentication and authorization settings can be overridden at
 the resource level.
 The hello resource would inherit the <code>enabled: true</code> flag from the
 service level, which is set automatically.
 The scope of the resource is defined as &ldquo;hello&rdquo;.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file and use the `ballerina run` command.
$ ballerina run secured_service_with_jwt.bal
[ballerina/http] started HTTPS/WSS listener 0.0.0.0:9090
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>$ curl -vk -H &quot;Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.\
eyJzdWIiOiJiYWxsZXJpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksIm\
lhdCI6MTUyNDU3NTAxOSwianRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQi\
LCJhdWQiOlsiYmFsbGVyaW5hIiwiYmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdLCJzY2\
9wZSI6ImhlbGxvIn0.bNoqz9_DzgeKSK6ru3DnKL7NiNbY32ksXPYrh6Jp0_O3ST7WfXMs9WVk\
x6Q2TiYukMAGrnMUFrJnrJvZwC3glAmRBrl4BYCbQ0c5mCbgM9qhhCjC1tBA50rjtLAtRW-JTR\
pCKS0B9_EmlVKfvXPKDLIpM5hnfhOin1R3lJCPspJ2ey_Ho6fDhsKE3DZgssvgPgI9PBItnkip\
Q3CqqXWhV-RFBkVBEGPDYXTUVGbXhdNOBSwKw5ZoVJrCUiNG5XD0K4sgN9udVTi3EMKNMnVQaq\
399k6RYPAy3vIhByS6QZtRjOG8X93WJw-9GLiHvcabuid80lnrs2-mAEcstgiHVw&quot; \
https://localhost:9090/hello/sayHello
Hello, World!!!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Invoke the service using &ldquo;cURL&rdquo;.
 Note that it is required to provide the correct bearer authentication header
 with the cURL command.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="iBallerinaFooter" class="row cBallerina-io-White-row">
    </div>
    <script>
        $(document).ready(function() {

            hljs.initHighlightingOnLoad();

            $(".switch").click(function() {
                $(".cCodeRight").toggleClass('cShow');
                $(".cCodeLeft").toggleClass('cHide');
            });

            // register "copy to clipboard" event to elements with "copy" class
            var clipboard = new ClipboardJS('.copy', {
                text: function(trigger) {
                    return $('.FullCode').find('pre').text();
                }
            });

            // Register events show hide tooltip on click event
            clipboard.on('success', function(e) {
                setTooltip(e.trigger, 'Copied!');
                hideTooltip(e.trigger);
            });

            clipboard.on('error', function(e) {
                setTooltip(e.trigger, 'Failed!');
                hideTooltip(e.trigger);
            });

            $('.copy').tooltip({
                trigger: 'click',
                placement: 'bottom'
            });
            $("a.copy").unbind("click");
        });

        function setTooltip(btn, message) {
            $(btn).attr('data-original-title', message)
                .tooltip('show');
        }

        function hideTooltip(btn) {
            setTimeout(function() {
                $(btn).tooltip('hide').removeAttr('data-original-title');
            }, 1000);
        }
    </script>

    <script src="/search/search.js"></script>
</body>

</html>
