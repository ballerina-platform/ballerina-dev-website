---
layout: ballerina-example-page
title: Secured Service with OAuth2
description: Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.
permalink: /learn/by-example/secured-service-with-oauth2
redirect_from:
  - /v-/learn/by-example/secured-service-with-oauth2
  - /v-/learn/by-example/secured-service-with-oauth2.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">config</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">oauth2</span><span class="p">;</span>
<span class="nx">oauth2</span><span class="p">:</span><span class="nx">InboundOAuth2Provider</span> <span class="nx">oauth2Provider</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">({</span>
    <span class="nx">url</span><span class="p">:</span> <span class="s">&quot;https://localhost:9095/oauth2/token/introspect&quot;</span>
<span class="p">});</span>
<span class="nx">http</span><span class="p">:</span><span class="nx">BearerAuthHandler</span> <span class="nx">oauth2Handler</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="nx">oauth2Provider</span><span class="p">);</span>
<span class="nx">listener</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span> <span class="nx">ep</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="mi">9090</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">auth</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">authHandlers</span><span class="p">:</span> <span class="p">[</span><span class="nx">oauth2Handler</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">secureSocket</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">keyStore</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">:</span> <span class="nx">config</span><span class="p">:</span><span class="nx">getAsString</span><span class="p">(</span><span class="s">&quot;b7a.home&quot;</span><span class="p">)</span> <span class="o">+</span>
                  <span class="s">&quot;/bre/security/ballerinaTruststore.p12&quot;</span><span class="p">,</span>
            <span class="nx">password</span><span class="p">:</span> <span class="s">&quot;ballerina&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span><span class="kd">service</span> <span class="nx">hello</span> <span class="nx">on</span> <span class="nx">ep</span> <span class="p">{</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">sayHello</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">error</span><span class="err">?</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="s">&quot;Hello, World!!!&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error in responding to caller&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Secured Service with OAuth2</h2>
                            <p><p>A service can be secured using OAuth2 and optionally by enforcing
 authorization. The OAuth2 auth provider verifies the token against the
 configured introspection server. The result returned from the introspection
 server is used for token expiration, authorization etc.
 Ballerina uses the concept of scopes for authorization. A resource declared
 in a service can be bound to one/more scope(s). The scopes are included in
 the introspection response and the scopes of the resource are compared
 against those for at least one match between the two sets.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="secured-service-with-jwt-auth.html">
                                        <span>< PREVIOUS</span>
                                        <p>Secured Service with JWT Auth</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="secured-service-with-ldap.html">
                                        <span>NEXT ></span>
                                        <p>Secured Service with LDAP</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="secured-service-with-oauth2">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-lang/ballerina/tree/master/examples/secured-service-with-oauth2/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/http;
import ballerina/config;
import ballerina/log;
import ballerina/oauth2;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>oauth2:InboundOAuth2Provider oauth2Provider = new ({
    url: &quot;https://localhost:9095/oauth2/token/introspect&quot;
});
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates an inbound OAuth2 authentication provider with the relevant
 configurations of the introspection server.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>http:BearerAuthHandler oauth2Handler = new (oauth2Provider);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Creates a Bearer Auth handler with the created OAuth2 provider.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>listener http:Listener ep = new (9090, {
    auth: {
        authHandlers: [oauth2Handler]
    },
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The endpoint used here is the <code>http:Listener</code>. The OAuth2 handler is
 set to this endpoint using the <code>authHandlers</code> attribute.
 It is optional to override the authentication and authorization at the
 service and resource levels.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    secureSocket: {
        keyStore: {
            path: config:getAsString(&quot;b7a.home&quot;) +
                  &quot;/bre/security/ballerinaTruststore.p12&quot;,
            password: &quot;ballerina&quot;
        }
    }
});
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The secure hello world sample uses HTTPS.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>service hello on ep {
    resource function sayHello(http:Caller caller, http:Request req) {
        error? result = caller-&gt;respond(&quot;Hello, World!!!&quot;);
        if (result is error) {
            log:printError(&quot;Error in responding to caller&quot;, result);
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run the service, execute the below command by passing Ballerina home path
# as a system property.
$ ballerina run secured_service_with_oauth2.bal --b7a.home=&lt;ballerina_home_path&gt;
[ballerina/http] started HTTPS/WSS listener 0.0.0.0:9090
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session>$ curl -k -H &quot;Authorization: Bearer YWRtaW46MTIz&quot; \
https://localhost:9090/hello/sayHello
Hello, World!!!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Start the introspection server on 9095 with the <code>/oauth2/token/introspect</code>
 resource path and invoke the service using cURL. Note that it is required
 to provide the correct bearer authentication header with the cURL command.
 It will get validated against the introspection server.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
