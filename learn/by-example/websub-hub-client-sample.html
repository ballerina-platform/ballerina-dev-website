---
layout: ballerina-example-page
title: Hub Client Sample
description: Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.
permalink: /learn/by-example/websub-hub-client-sample
redirect_from:
  - /v-/learn/by-example/websub-hub-client-sample
  - /v-/learn/by-example/websub-hub-client-sample.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Starting up the Ballerina Hub Service&quot;</span><span class="p">);</span>
    <span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span> <span class="nx">webSubHub</span><span class="p">;</span>
    <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">startHub</span><span class="p">(</span><span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9191</span><span class="p">),</span> <span class="s">&quot;/websub&quot;</span><span class="p">,</span> <span class="s">&quot;/hub&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">webSubHub</span> <span class="p">=</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">HubStartedUpError</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">webSubHub</span> <span class="p">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">startedUpHub</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Hub start error:&quot;</span> <span class="o">+</span> <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">result</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nx">registrationResponse</span> <span class="p">=</span> <span class="nx">webSubHub</span><span class="p">.</span><span class="nx">registerTopic</span><span class="p">(</span>
                                            <span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">registrationResponse</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error occurred registering topic: &quot;</span> <span class="o">+</span>
                                <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">registrationResponse</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Topic registration successful!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="k">var</span> <span class="nx">publishResponse</span> <span class="p">=</span> <span class="nx">webSubHub</span><span class="p">.</span><span class="nx">publishUpdate</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">,</span>
                            <span class="p">{</span><span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="s">&quot;publish&quot;</span><span class="p">,</span> <span class="s">&quot;mode&quot;</span><span class="p">:</span> <span class="s">&quot;internal-hub&quot;</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">publishResponse</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error notifying hub: &quot;</span> <span class="o">+</span>
                                    <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">publishResponse</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Update notification successful!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="nx">publishResponse</span> <span class="p">=</span> <span class="nx">webSubHub</span><span class="p">.</span><span class="nx">publishUpdate</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">,</span>
                            <span class="p">{</span><span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="s">&quot;publish&quot;</span><span class="p">,</span> <span class="s">&quot;mode&quot;</span><span class="p">:</span> <span class="s">&quot;internal-hub&quot;</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">publishResponse</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error notifying hub: &quot;</span> <span class="o">+</span>
                                    <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">publishResponse</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Update notification successful!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span>
<span class="nx">listener</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Listener</span> <span class="nx">websubEP</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="mi">8181</span><span class="p">);</span>
<span class="nd">@websub:SubscriberServiceConfig {</span>
    <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/websub&quot;</span><span class="p">,</span>
    <span class="nx">target</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;http://localhost:9191/websub/hub&quot;</span><span class="p">,</span> <span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">],</span>
    <span class="nx">secret</span><span class="p">:</span> <span class="s">&quot;Kslk30SNF2AChs2&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">websubSubscriber</span> <span class="nx">on</span> <span class="nx">websubEP</span> <span class="p">{</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onNotification</span><span class="p">(</span><span class="nx">websub</span><span class="p">:</span><span class="nx">Notification</span> <span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">notification</span><span class="p">.</span><span class="nx">getTextPayload</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;WebSub Notification Received: &quot;</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error retrieving payload as string&quot;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span><span class="nx">websub</span><span class="p">:</span><span class="nx">SubscriptionClient</span> <span class="nx">websubHubClientEP</span> <span class="p">=</span>
                            <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;http://localhost:9191/websub/hub&quot;</span><span class="p">);</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">websub</span><span class="p">:</span><span class="nx">SubscriptionChangeRequest</span> <span class="nx">subscriptionRequest</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">topic</span><span class="p">:</span> <span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">,</span>
        <span class="nx">callback</span><span class="p">:</span> <span class="s">&quot;http://localhost:8181/websub&quot;</span><span class="p">,</span>
        <span class="nx">secret</span><span class="p">:</span> <span class="s">&quot;Kslk30SNF2AChs2&quot;</span>
    <span class="p">};</span>    <span class="k">var</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">websubHubClientEP</span><span class="o">-&gt;</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">subscriptionRequest</span><span class="p">);</span>    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">SubscriptionChangeResponse</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Subscription Request successful at Hub [&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">hub</span> <span class="o">+</span>
                    <span class="s">&quot;] for Topic [&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">topic</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">error</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">response</span><span class="p">;</span>
        <span class="kt">string</span> <span class="nx">errCause</span> <span class="p">=</span> <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">err</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">;</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error occurred with Subscription Request: &quot;</span> <span class="o">+</span> <span class="nx">errCause</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="nx">websub</span><span class="p">:</span><span class="nx">SubscriptionChangeRequest</span> <span class="nx">unsubscriptionRequest</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">topic</span><span class="p">:</span> <span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">,</span>
        <span class="nx">callback</span><span class="p">:</span> <span class="s">&quot;http://localhost:8181/websub&quot;</span>
    <span class="p">};</span>    <span class="nx">response</span> <span class="p">=</span> <span class="nx">websubHubClientEP</span><span class="o">-&gt;</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">unsubscriptionRequest</span><span class="p">);</span>    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">SubscriptionChangeResponse</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Unsubscription Request successful at Hub [&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">hub</span> <span class="o">+</span>
                    <span class="s">&quot;] for Topic [&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">topic</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">error</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">response</span><span class="p">;</span>
        <span class="kt">string</span> <span class="nx">errCause</span> <span class="p">=</span> <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">err</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">;</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error occurred with Unsubscription Request: &quot;</span> <span class="o">+</span> <span class="nx">errCause</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Hub Client Sample</h2>
                            <p><p>Ballerina provides the capability to easily introduce publishers and subscribers that are WebSub-compliant.
 Ballerina WebSub subscribers can specify the topic they wish to subscribe to and the hub they wish to subscribe at,
 to receive notifications. If specified, the subscription process would be initiated at the startup.
 The subscription/unsubscription process could also be initiated via the Ballerina WebSub Hub Client Endpoint.</p>

<p>This example demonstrates the usage of the WebSub Hub Client Endpoint to subscribe and unsubscribe to updates for
 a particular topic at the hub. Also, it demonstrates auto intent verification in which intent verification for subscription or
 unsubscription requests would happen automatically (against the annotated topic) if the onIntentVerification request
 is not included.</p>

<p>The Hub Client Endpoint can be used by subscribers to subscribe/unsubscribe at a Hub, and by publishers to
 register topics and publish updates for topics at the Hub.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="websub-remote-hub-sample.html">
                                        <span>< PREVIOUS</span>
                                        <p>Remote Hub Sample</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="websub-service-integration-sample.html">
                                        <span>NEXT ></span>
                                        <p>Service Integration Sample</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="websub-hub-client-sample">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-lang/ballerina/tree/master/examples/websub-hub-client-sample/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/http;
import ballerina/io;
import ballerina/runtime;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Ballerina WebSub Publisher brings up the internal Ballerina Hub,
 registers a topic at the hub, and publishes updates to the topic.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    io:println(&quot;Starting up the Ballerina Hub Service&quot;);
    websub:Hub webSubHub;
    var result = websub:startHub(new http:Listener(9191), &quot;/websub&quot;, &quot;/hub&quot;);
    if (result is websub:Hub) {
        webSubHub = result;
    } else if (result is websub:HubStartedUpError) {
        webSubHub = result.startedUpHub;
    } else {
        io:println(&quot;Hub start error:&quot; + &lt;string&gt;result.detail()?.message);
        return;
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Starts the internal Ballerina Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    var registrationResponse = webSubHub.registerTopic(
                                            &quot;http://websubpubtopic.com&quot;);
    if (registrationResponse is error) {
        io:println(&quot;Error occurred registering topic: &quot; +
                                &lt;string&gt;registrationResponse.detail()?.message);
    } else {
        io:println(&quot;Topic registration successful!&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Registers a topic at the hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(5000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Makes the publisher wait until the subscriber subscribes at the hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    var publishResponse = webSubHub.publishUpdate(&quot;http://websubpubtopic.com&quot;,
                            {&quot;action&quot;: &quot;publish&quot;, &quot;mode&quot;: &quot;internal-hub&quot;});
    if (publishResponse is error) {
        io:println(&quot;Error notifying hub: &quot; +
                                    &lt;string&gt;publishResponse.detail()?.message);
    } else {
        io:println(&quot;Update notification successful!&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Publishes directly to the internal Ballerina Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(5000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Makes the publisher wait until the subscriber unsubscribes at the hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    publishResponse = webSubHub.publishUpdate(&quot;http://websubpubtopic.com&quot;,
                            {&quot;action&quot;: &quot;publish&quot;, &quot;mode&quot;: &quot;internal-hub&quot;});
    if (publishResponse is error) {
        io:println(&quot;Error notifying hub: &quot; +
                                    &lt;string&gt;publishResponse.detail()?.message);
    } else {
        io:println(&quot;Update notification successful!&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Publishes directly to the internal Ballerina Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(2000);
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Makes the publisher wait until subscribers are notified.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># This sample requires running the subscriber client main program after the
# Publisher starts up the hub and registers the topic, and the subscriber
# service (representing the callback) is started.
# To run this sample, navigate to the directory that contains the
# `.bal` file, and execute the `ballerina run` command.
$ ballerina run publisher.bal
Starting up the Ballerina Hub Service
[ballerina/websub] Ballerina WebSub Hub started up.
[ballerina/websub] Publish URL: http://localhost:9191/websub/publish
[ballerina/websub] Subscription URL: http://localhost:9191/websub/hub
[ballerina/http] started HTTP/WS listener 0.0.0.0:9191
Topic registration successful!
2019-11-01 14:06:38,035 INFO  [ballerina/websub] - Subscription request received for topic[http://websubpubtopic.com] with callback[http://localhost:8181/websub]
2019-11-01 14:06:38,255 INFO  [ballerina/websub] - Sending intent verification request to callback[http://localhost:8181/websub] for topic[http://websubpubtopic.com]
2019-11-01 14:06:38,781 INFO  [ballerina/websub] - Intent verification successful for mode: [subscribe], for callback URL: [http://localhost:8181/websub]
Update notification successful!
2019-11-01 14:06:40,572 INFO  [ballerina/websub] - Subscription request received for topic[http://websubpubtopic.com] with callback[http://localhost:8181/websub]
2019-11-01 14:06:40,576 INFO  [ballerina/websub] - Sending intent verification request to callback[http://localhost:8181/websub] for topic[http://websubpubtopic.com]
2019-11-01 14:06:40,627 INFO  [ballerina/websub] - Intent verification successful for mode: [subscribe], for callback URL: [http://localhost:8181/websub]
Update notification successful!
2019-11-01 14:06:45,628 INFO  [ballerina/websub] - Subscription request received for topic[http://websubpubtopic.com] with callback[http://localhost:8181/websub]
2019-11-01 14:06:45,637 INFO  [ballerina/websub] - Sending intent verification request to callback[http://localhost:8181/websub] for topic[http://websubpubtopic.com]
2019-11-01 14:06:45,695 INFO  [ballerina/websub] - Intent verification successful for mode: [unsubscribe], for callback URL: [http://localhost:8181/websub]
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                                    <div class="bal-separator">
                                        <!-- This table is a temporary table to add spacing between output and next bal file-->
                                        <table class="cTopBorder-table">
                                            <tbody><tr>
                                                <td class="cCodeTD"></td>
                                                <td class="cDescTD"></td>
                                            </tr>
                                        </tbody></table>
                                    </div>
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/log;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Ballerina WebSub Subscriber service, which represents the callback registered at the Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>listener websub:Listener websubEP = new (8181);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The endpoint to which the subscriber service is bound.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>@websub:SubscriberServiceConfig {
    path: &quot;/websub&quot;,
    target: [&quot;http://localhost:9191/websub/hub&quot;, &quot;http://websubpubtopic.com&quot;],
    secret: &quot;Kslk30SNF2AChs2&quot;
}
service websubSubscriber on websubEP {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Annotations specifying the subscription parameters.
 The omission of <code>subscribeOnStartUp</code> as an annotation due to which a subscription request would not be sent
 automatically on the start up.
 Also, the exclusion of the onIntentVerification resource will result in auto intent-verification.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>    resource function onNotification(websub:Notification notification) {
        var payload = notification.getTextPayload();
        if (payload is string) {
            log:printInfo(&quot;WebSub Notification Received: &quot; + payload);
        } else {
            log:printError(&quot;Error retrieving payload as string&quot;, payload);
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This resource accepts content delivery requests.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># The update published after unsubscription is not received by the subscriber service.
# To start the service, navigate to the directory that contains the
# `.bal` file, and use the `ballerina run` command.
$ ballerina run subscriber_service.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:8181
2019-11-01 14:06:38,171 INFO  [ballerina/websub] - Subscription Request successfully sent to Hub[http://localhost:9191/websub/hub], for Topic[http://websubpubtopic.com], with Callback [http://localhost:8181/websub]
ballerina: Intent Verification agreed - Mode [subscribe], Topic [http://websubpubtopic.com], Lease Seconds [86400]
2019-11-01 14:06:40,196 INFO  [] - WebSub Notification Received: {&quot;action&quot;:&quot;publish&quot;, &quot;mode&quot;:&quot;internal-hub&quot;}
ballerina: Intent Verification agreed - Mode [subscribe], Topic [http://websubpubtopic.com], Lease Seconds [86400]
2019-11-01 14:06:45,052 INFO  [] - WebSub Notification Received: {&quot;action&quot;:&quot;publish&quot;, &quot;mode&quot;:&quot;internal-hub&quot;}
ballerina: Intent Verification agreed - Mode [unsubscribe], Topic [http://websubpubtopic.com]
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                                    <div class="bal-separator">
                                        <!-- This table is a temporary table to add spacing between output and next bal file-->
                                        <table class="cTopBorder-table">
                                            <tbody><tr>
                                                <td class="cCodeTD"></td>
                                                <td class="cDescTD"></td>
                                            </tr>
                                        </tbody></table>
                                    </div>
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/io;
import ballerina/runtime;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Ballerina main program, which demonstrates the usage of the Hub client endpoint to subscribe/unsubscribe to notifications.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>websub:SubscriptionClient websubHubClientEP =
                            new (&quot;http://localhost:9191/websub/hub&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    websub:SubscriptionChangeRequest subscriptionRequest = {
        topic: &quot;http://websubpubtopic.com&quot;,
        callback: &quot;http://localhost:8181/websub&quot;,
        secret: &quot;Kslk30SNF2AChs2&quot;
    };
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Sends the subscription request for the subscriber service.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    var response = websubHubClientEP-&gt;subscribe(subscriptionRequest);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    if (response is websub:SubscriptionChangeResponse) {
        io:println(&quot;Subscription Request successful at Hub [&quot; + response.hub +
                    &quot;] for Topic [&quot; + response.topic + &quot;]&quot;);
    } else {
        error err = response;
        string errCause = &lt;string&gt;err.detail()?.message;
        io:println(&quot;Error occurred with Subscription Request: &quot; + errCause);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(5000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Waits for the initial notification before unsubscribing.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    websub:SubscriptionChangeRequest unsubscriptionRequest = {
        topic: &quot;http://websubpubtopic.com&quot;,
        callback: &quot;http://localhost:8181/websub&quot;
    };
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Sends the unsubscription request to the subscriber service.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    response = websubHubClientEP-&gt;unsubscribe(unsubscriptionRequest);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>    if (response is websub:SubscriptionChangeResponse) {
        io:println(&quot;Unsubscription Request successful at Hub [&quot; + response.hub +
                    &quot;] for Topic [&quot; + response.topic + &quot;]&quot;);
    } else {
        error err = response;
        string errCause = &lt;string&gt;err.detail()?.message;
        io:println(&quot;Error occurred with Unsubscription Request: &quot; + errCause);
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run this sample, navigate to the directory that contains the
# `.bal` file, and execute the `ballerina run` command.
$ ballerina run subscription_change_client.bal
Subscription Request successful at Hub [http://localhost:9191/websub/hub] for Topic [http://websubpubtopic.com]
Unsubscription Request successful at Hub [http://localhost:9191/websub/hub] for Topic [http://websubpubtopic.com]
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
