---
layout: ballerina-example-page
title: Remote Hub Sample
description: Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.
permalink: /learn/by-example/websub-remote-hub-sample
redirect_from:
  - /v-/learn/by-example/websub-remote-hub-sample
  - /v-/learn/by-example/websub-remote-hub-sample.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Starting up the Ballerina Hub Service&quot;</span><span class="p">);</span>    <span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span> <span class="nx">webSubHub</span><span class="p">;</span>
    <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">startHub</span><span class="p">(</span><span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9191</span><span class="p">),</span> <span class="s">&quot;/websub&quot;</span><span class="p">,</span> <span class="s">&quot;/hub&quot;</span><span class="p">,</span>
        <span class="nx">hubConfiguration</span> <span class="p">=</span> <span class="p">{</span>
            <span class="nx">remotePublish</span><span class="p">:</span> <span class="p">{</span>
                <span class="nx">enabled</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">);</span>    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Hub</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">webSubHub</span> <span class="p">=</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">HubStartedUpError</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">webSubHub</span> <span class="p">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">startedUpHub</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Hub start error:&quot;</span> <span class="o">+</span> <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">result</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">);}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">io</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span>
<span class="nx">websub</span><span class="p">:</span><span class="nx">PublisherClient</span> <span class="nx">websubHubClientEP</span> <span class="p">=</span>
                    <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;http://localhost:9191/websub/publish&quot;</span><span class="p">);</span><span class="nx">public</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">registrationResponse</span> <span class="p">=</span>
                <span class="nx">websubHubClientEP</span><span class="o">-&gt;</span><span class="nx">registerTopic</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">registrationResponse</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error occurred registering topic: &quot;</span> <span class="o">+</span>
                                <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">registrationResponse</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Topic registration successful!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Publishing update to remote Hub&quot;</span><span class="p">);</span>
    <span class="k">var</span> <span class="nx">publishResponse</span> <span class="p">=</span>
        <span class="nx">websubHubClientEP</span><span class="o">-&gt;</span><span class="nx">publishUpdate</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">,</span>
                                <span class="p">{</span><span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="s">&quot;publish&quot;</span><span class="p">,</span> <span class="s">&quot;mode&quot;</span><span class="p">:</span> <span class="s">&quot;remote-hub&quot;</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">publishResponse</span> <span class="nx">is</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Error notifying hub: &quot;</span> <span class="o">+</span>
                                    <span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="nx">publishResponse</span><span class="p">.</span><span class="nx">detail</span><span class="p">()</span><span class="err">?</span><span class="p">.</span><span class="kt">message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">io</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;Update notification successful!&quot;</span><span class="p">);</span>
    <span class="p">}}</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">websub</span><span class="p">;</span>
<span class="nx">listener</span> <span class="nx">websub</span><span class="p">:</span><span class="nx">Listener</span> <span class="nx">websubEP</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="mi">8181</span><span class="p">);</span>
<span class="nd">@websub:SubscriberServiceConfig {</span>
    <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/websub&quot;</span><span class="p">,</span>
    <span class="nx">subscribeOnStartUp</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">target</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;http://localhost:9191/websub/hub&quot;</span><span class="p">,</span> <span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">],</span>
    <span class="nx">leaseSeconds</span><span class="p">:</span> <span class="mi">36000</span><span class="p">,</span>
    <span class="nx">secret</span><span class="p">:</span> <span class="s">&quot;Kslk30SNF2AChs2&quot;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="nx">websubSubscriber</span> <span class="nx">on</span> <span class="nx">websubEP</span> <span class="p">{</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onIntentVerification</span><span class="p">(</span><span class="nx">websub</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span>
                                   <span class="nx">websub</span><span class="p">:</span><span class="nx">IntentVerificationRequest</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">request</span><span class="p">.</span>
            <span class="nx">buildSubscriptionVerificationResponse</span><span class="p">(</span><span class="s">&quot;http://websubpubtopic.com&quot;</span><span class="p">);</span>        <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">==</span> <span class="mi">202</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;Intent verified for subscription request&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printWarn</span><span class="p">(</span><span class="s">&quot;Intent verification denied for subscription request&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(&lt;</span><span class="nd">@untainted&gt;response);        if (result is error) {</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error responding to intent verification request&quot;</span><span class="p">,</span>
                                                        <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">onNotification</span><span class="p">(</span><span class="nx">websub</span><span class="p">:</span><span class="nx">Notification</span> <span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">payload</span> <span class="p">=</span> <span class="nx">notification</span><span class="p">.</span><span class="nx">getTextPayload</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span> <span class="nx">is</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printInfo</span><span class="p">(</span><span class="s">&quot;WebSub Notification Received: &quot;</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error retrieving payload as string&quot;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Remote Hub Sample</h2>
                            <p><p>Ballerina provides the capability to easily introduce publishers and subscribers that are WebSub-compliant.
 Ballerina WebSub subscribers can specify the topic they wish to subscribe to and the hub they wish to subscribe at,
 to receive notifications. If specified, the subscription process can be initiated at the startup. Signature
 validation is performed by default for subscribers that receive authenticated content. Ballerina WebSub Subscriber
 Services could thus be registered as webhooks to receive event notifications.</p>

<p>Ballerina also comes with an in-built WebSub Hub service, which can be brought up by publishers that need to bring up
 a hub.</p>

<p>This example demonstrates a simple WebSub publisher and subscriber scenario, in which a Ballerina WebSub Hub
 that is brought up remotely is used by a Ballerina WebSub publisher to publish updates to a topic. A Ballerina
 WebSub Subscriber subscribes at this remote hub to get the topic updates.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="websub-internal-hub-sample.html">
                                        <span>< PREVIOUS</span>
                                        <p>Internal Hub Sample</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="websub-hub-client-sample.html">
                                        <span>NEXT ></span>
                                        <p>Hub Client Sample</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="websub-remote-hub-sample">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-lang/ballerina/tree/master/examples/websub-remote-hub-sample/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/http;
import ballerina/io;
import ballerina/runtime;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Main program, which brings up the Ballerina WebSub Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    io:println(&quot;Starting up the Ballerina Hub Service&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Starts the internal Ballerina Hub on port 9191 allowing remote publishers to register topics and publish
 updates of the topics.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    websub:Hub webSubHub;
    var result = websub:startHub(new http:Listener(9191), &quot;/websub&quot;, &quot;/hub&quot;,
        hubConfiguration = {
            remotePublish: {
                enabled: true
            }
        }
    );
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    if (result is websub:Hub) {
        webSubHub = result;
    } else if (result is websub:HubStartedUpError) {
        webSubHub = result.startedUpHub;
    } else {
        io:println(&quot;Hub start error:&quot; + &lt;string&gt;result.detail()?.message);
        return;
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(10000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Waits for the subscriber to subscribe at this hub and for the publisher to publish the notifications.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># This sample requires the Hub Service to start via the hub.bal file, prior to running the Publisher main program. The
# Subscriber Service needs to start after the publisher registers the topic at the hub.
# If the port is not specified, the hub service starts on the default port.
# To run this sample, navigate to the directory that contains the
# `.bal` file, and execute the `ballerina run` command.
$ ballerina run hub.bal
Starting up the Ballerina Hub Service
[ballerina/websub] Ballerina WebSub Hub started up.
[ballerina/websub] Publish URL: http://localhost:9191/websub/publish
[ballerina/websub] Subscription URL: http://localhost:9191/websub/hub
[ballerina/http] started HTTP/WS listener 0.0.0.0:9191
2019-11-01 14:36:36,782 INFO  [ballerina/websub] - Topic registration successful at Hub, for topic[http://websubpubtopic.com]
2019-11-01 14:36:42,764 INFO  [ballerina/websub] - Subscription request received for topic[http://websubpubtopic.com] with callback[http://localhost:8181/websub]
2019-11-01 14:36:42,807 INFO  [ballerina/websub] - Sending intent verification request to callback[http://localhost:8181/websub] for topic[http://websubpubtopic.com]
2019-11-01 14:36:43,116 INFO  [ballerina/websub] - Intent verification successful for mode: [subscribe], for callback URL: [http://localhost:8181/websub]
2019-11-01 14:36:46,952 INFO  [ballerina/websub] - Update notification done for Topic [http://websubpubtopic.com]
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                                    <div class="bal-separator">
                                        <!-- This table is a temporary table to add spacing between output and next bal file-->
                                        <table class="cTopBorder-table">
                                            <tbody><tr>
                                                <td class="cCodeTD"></td>
                                                <td class="cDescTD"></td>
                                            </tr>
                                        </tbody></table>
                                    </div>
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/io;
import ballerina/runtime;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The Ballerina WebSub Publisher, which registers a topic at the hub and publishes updates to the hub for the topic.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>websub:PublisherClient websubHubClientEP =
                    new (&quot;http://localhost:9191/websub/publish&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This is the remote WebSub Hub Endpoint to which registration and publish requests are sent.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>public function main() {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    var registrationResponse =
                websubHubClientEP-&gt;registerTopic(&quot;http://websubpubtopic.com&quot;);
    if (registrationResponse is error) {
        io:println(&quot;Error occurred registering topic: &quot; +
                                &lt;string&gt;registrationResponse.detail()?.message);
    } else {
        io:println(&quot;Topic registration successful!&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Registers a topic at the hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    runtime:sleep(5000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Makes the publisher wait until the subscriber subscribes at the hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    io:println(&quot;Publishing update to remote Hub&quot;);
    var publishResponse =
        websubHubClientEP-&gt;publishUpdate(&quot;http://websubpubtopic.com&quot;,
                                {&quot;action&quot;: &quot;publish&quot;, &quot;mode&quot;: &quot;remote-hub&quot;});
    if (publishResponse is error) {
        io:println(&quot;Error notifying hub: &quot; +
                                    &lt;string&gt;publishResponse.detail()?.message);
    } else {
        io:println(&quot;Update notification successful!&quot;);
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Publishes updates to the remote hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To run this sample, navigate to the directory that contains the
# `.bal` file, and execute the `ballerina run` command.
$ ballerina run publisher.bal
Topic registration successful!
Publishing update to remote Hub
Update notification successful!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                                    <div class="bal-separator">
                                        <!-- This table is a temporary table to add spacing between output and next bal file-->
                                        <table class="cTopBorder-table">
                                            <tbody><tr>
                                                <td class="cCodeTD"></td>
                                                <td class="cDescTD"></td>
                                            </tr>
                                        </tbody></table>
                                    </div>
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>import ballerina/http;
import ballerina/log;
import ballerina/websub;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Ballerina WebSub Subscriber service, which subscribes to notifications at a Hub.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>listener websub:Listener websubEP = new (8181);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The endpoint to which the subscriber service is bound.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>@websub:SubscriberServiceConfig {
    path: &quot;/websub&quot;,
    subscribeOnStartUp: true,
    target: [&quot;http://localhost:9191/websub/hub&quot;, &quot;http://websubpubtopic.com&quot;],
    leaseSeconds: 36000,
    secret: &quot;Kslk30SNF2AChs2&quot;
}
service websubSubscriber on websubEP {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Annotations specifying the subscription parameters.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>    resource function onIntentVerification(websub:Caller caller,
                                   websub:IntentVerificationRequest request) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Defines the resource that accepts the intent verification requests.
 If the resource is not specified, intent verification happens automatically. It verifies if the topic
 specified in the intent verification request matches the topic specified as the annotation.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        http:Response response = request.
            buildSubscriptionVerificationResponse(&quot;http://websubpubtopic.com&quot;);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Builds the response for the subscription intent verification request that was received.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        if (response.statusCode == 202) {
            log:printInfo(&quot;Intent verified for subscription request&quot;);
        } else {
            log:printWarn(&quot;Intent verification denied for subscription request&quot;);
        }
        var result = caller-&gt;respond(&lt;@untainted&gt;response);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=ballerina>        if (result is error) {
            log:printError(&quot;Error responding to intent verification request&quot;,
                                                        result);
        }
    }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code">
                                    <div class="highlight"><pre><code class=ballerina>    resource function onNotification(websub:Notification notification) {
        var payload = notification.getTextPayload();
        if (payload is string) {
            log:printInfo(&quot;WebSub Notification Received: &quot; + payload);
        } else {
            log:printError(&quot;Error retrieving payload as string&quot;, payload);
        }
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Defines the resource that accepts the content delivery requests.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the service, navigate to the directory that contains the
# `.bal` file, and use the `ballerina run` command.
$ ballerina run subscriber.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:8181
2019-11-01 14:36:42,797 INFO  [ballerina/websub] - Subscription Request successfully sent to Hub[http://localhost:9191/websub/hub], for Topic[http://websubpubtopic.com], with Callback [http://localhost:8181/websub]
2019-11-01 14:36:43,050 INFO  [] - Intent verified for subscription request
2019-11-01 14:36:47,098 INFO  [] - WebSub Notification Received: {&quot;action&quot;:&quot;publish&quot;, &quot;mode&quot;:&quot;remote-hub&quot;}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
