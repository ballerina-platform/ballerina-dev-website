<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="Envelope Wrapper wraps application data inside an envelope that is compliant with the messaging infrastructure."/><meta name="author" content="WSO2 LLC"/><meta name="keywords" content="ballerina, learn, documentation, docs, programming language"/><link rel="shortcut icon" href="/img/favicon.ico"/><title>EIP:  Envelope Wrapper - The Ballerina programming language</title><meta property="og:type" content="article"/><meta property="og:title" content="EIP:  Envelope Wrapper - The Ballerina programming language"/><meta property="og:description" content="Envelope Wrapper wraps application data inside an envelope that is compliant with the messaging infrastructure."/><meta property="og:title" content="EIP:  Envelope Wrapper - The Ballerina programming language"/><meta property="og:image" content="https://ballerina.io/images/ballerina-swan-lake-eip-sm-banner.png"/><meta property="og:description" itemProp="image" content="Envelope Wrapper wraps application data inside an envelope that is compliant with the messaging infrastructure."/><meta name="twitter:site" content="@ballerinalang"/><meta name="twitter:creator" content="@ballerinalang"/><meta name="twitter:title" content="EIP:  Envelope Wrapper - The Ballerina programming language"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:description" content="Envelope Wrapper wraps application data inside an envelope that is compliant with the messaging infrastructure."/><meta name="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-eip-sm-banner.png"/><meta property="twitter:text:description" content="Envelope Wrapper wraps application data inside an envelope that is compliant with the messaging infrastructure."/><meta property="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-eip-sm-banner.png"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.setAttributeNode(d.createAttribute('data-ot-ignore'));j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PSL2TX4');</script><script type="text/javascript" crossorigin="true" src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script><script src="https://cookie-cdn.cookiepro.com/scripttemplates/otSDKStub.js" type="text/javascript" charSet="UTF-8" data-domain-script="630ad396-5fd5-4745-92ae-2765dc8841ee" defer=""></script><meta name="next-head-count" content="25"/><meta charSet="utf-8"/><meta name="author" content="WSO2 LLC"/><meta http-equiv="X-Frame-Options" content="SAMEORIGIN"/><meta http-equiv="Content-Security-Policy" content="frame-ancestors &#x27;none&#x27;;"/><link rel="shortcut icon" href="/images/favicon.ico"/><link rel="stylesheet" href="/css/roboto.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><link rel="stylesheet" href="/css/ballerina-search-button.css"/><link rel="stylesheet" href="/css/ballerina-search-modal.css"/><link rel="stylesheet" href="/css/ballerina-search-variables.css"/><link rel="stylesheet" href="/css/ballerina-search-style.css"/><link rel="preload" href="/_next/static/css/9bb35c8110b0fa38.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9bb35c8110b0fa38.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b7d35c896f9865c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b7d35c896f9865c2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9ee6b616f8ba237c.js" defer=""></script><script src="/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/_next/static/chunks/main-0ea70f422df5d19e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba2391f08766dae9.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-07afe3a69e1ba759.js" defer=""></script><script src="/_next/static/chunks/7621-d6bcd83f463fef72.js" defer=""></script><script src="/_next/static/chunks/6084-4e54ad5efcb8d3b5.js" defer=""></script><script src="/_next/static/chunks/51-100af16a0950a491.js" defer=""></script><script src="/_next/static/chunks/pages/learn/enterprise-integration-patterns/%5Bpattern%5D-2b9678b6262b59dd.js" defer=""></script><script src="/_next/static/MZwqTLwZps0KDHWHUYjg7/_buildManifest.js" defer=""></script><script src="/_next/static/MZwqTLwZps0KDHWHUYjg7/_ssgManifest.js" defer=""></script><script src="/_next/static/MZwqTLwZps0KDHWHUYjg7/_middlewareManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSL2TX4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next" data-reactroot=""><div class="main-wrapper other vstack gap-0"><div class="wrap-page-content" style="padding-bottom:0"><div class="community-wrap-row row"><div class="col-sm-12"><div class="pageContentRow llanding pb-0 row"><div class="col-12"><div class="container"><div class="row"><div class="patternContent col-12"><div class="backToLanding" href="/learn/enterprise-integration-patterns/"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#3ad1ca" class="bi bi-box-arrow-left ms-0" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"></path><path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"></path></svg><p class="m-0 p-0">Back to EIP</p></div></div></div></div></div></div><div class="pageHeader pageContentRow llanding row"><div class="col-12"><div class="container"><h1> Envelope Wrapper</h1></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><div class="row"><div class="patternContent col-12"><table class="Patterns_table__b7PHn"><tr><td>Pattern</td><td>Envelope Wrapper wraps application data inside an envelope that is compliant with the messaging infrastructure.<!-- --> <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/EnvelopeWrapper.html" style="color:#20b6b0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a></td></tr><tr><td>How Ballerina helps</td><td><p>Ballerina provides a rich set of libraries to interact with various messaging protocols. Ballerina allows you to extract information from messages and create new messages, manipulating data in both the body and the header.</p></td></tr></table><div class="Patterns_tags__V1YUk"><span class="Patterns_tag__oMtq4 badge bg-primary">Envelope Wrapper</span><span class="Patterns_tag__oMtq4 badge bg-primary">Content Enricher</span><span class="Patterns_tag__oMtq4 badge bg-primary">Message Channel</span><span class="Patterns_tag__oMtq4 badge bg-primary">Message</span></div></div></div></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><div><div class="CodeView_code__h13cx"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="CodeView_copyToClipboard__sqFoK" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"></path></svg><div style="display:none"><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/http;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> RefundRequest</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> request_id;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> email;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> client_id;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> capture_id;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> PaypalRespose</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> status;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> message;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">final</span><span style="color:#24292E"> http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client paypalClient </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#032F62">"http://api-m.sandbox.paypal.com.balmock.io"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">final</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> encodedHeader </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {alg</span><span style="color:#D73A49">:</span><span style="color:#032F62"> "none"</span><span style="color:#24292E">}.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">().</span><span style="color:#6F42C1">toBytes</span><span style="color:#24292E">().</span><span style="color:#6F42C1">toBase64</span><span style="color:#24292E">();</span></span>
<span class="line"></span></code></pre></div><div class="CodeView_collapse__l9WX_">⋯</div><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D73A49">service</span><span style="color:#6F42C1"> /paypal</span><span style="color:#D73A49"> on</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> http:Listener(</span><span style="color:#005CC5">8080</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">    resource</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> post</span><span style="color:#6F42C1"> refund</span><span style="color:#24292E">(</span><span style="color:#E36209">RefundRequest</span><span style="color:#E36209"> refundReq</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> PaypalRespose</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">        // Generate PayPal-Auth-Assertion.</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E"> authAssertionValue </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> getAuthAssertionValue</span><span style="color:#24292E">(refundReq.client_id, refundReq.email);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Request request </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        request.</span><span style="color:#6F42C1">addHeader</span><span style="color:#24292E">(</span><span style="color:#032F62">"PayPal-Request-Id"</span><span style="color:#24292E">, refundReq.request_id);</span></span>
<span class="line"><span style="color:#24292E">        request.</span><span style="color:#6F42C1">addHeader</span><span style="color:#24292E">(</span><span style="color:#032F62">"PayPal-Auth-Assertion"</span><span style="color:#24292E">, </span><span style="color:#E36209">authAssertionValue</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> paypalClient</span><span style="color:#D73A49">->/</span><span style="color:#24292E">v2</span><span style="color:#D73A49">/</span><span style="color:#24292E">payments</span><span style="color:#D73A49">/</span><span style="color:#24292E">captures</span><span style="color:#D73A49">/</span><span style="color:#24292E">[refundReq.capture_id]</span><span style="color:#D73A49">/</span><span style="color:#24292E">refund.</span><span style="color:#6F42C1">post</span><span style="color:#24292E">(</span><span style="color:#E36209">request</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">isolated</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> getAuthAssertionValue</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#E36209"> client_id</span><span style="color:#24292E">, </span><span style="color:#005CC5">string</span><span style="color:#E36209"> email</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    map&#x3C;</span><span style="color:#005CC5">string</span><span style="color:#D73A49">></span><span style="color:#24292E"> payload </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        iss</span><span style="color:#D73A49">:</span><span style="color:#24292E"> client_id,</span></span>
<span class="line"><span style="color:#24292E">        payer_id</span><span style="color:#D73A49">:</span><span style="color:#24292E"> email</span></span>
<span class="line"><span style="color:#24292E">    };</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> encodedPayload </span><span style="color:#D73A49">=</span><span style="color:#24292E"> payload.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">().</span><span style="color:#6F42C1">toBytes</span><span style="color:#24292E">().</span><span style="color:#6F42C1">toBase64</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#005CC5"> string</span><span style="color:#032F62"> `${</span><span style="color:#24292E">encodedHeader</span><span style="color:#032F62">}.${</span><span style="color:#24292E">encodedPayload</span><span style="color:#032F62">}.`</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre></div></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tagline":"Wrap application data inside an envelope that is compliant with the messaging infrastructure","desc":"Envelope Wrapper wraps application data inside an envelope that is compliant with the messaging infrastructure.","category":"Message Transformation","index":36,"helps":"Ballerina provides a rich set of libraries to interact with various messaging protocols. Ballerina allows you to extract information from messages and create new messages, manipulating data in both the body and the header.","tags":["Envelope Wrapper","Content Enricher","Message Channel","Message"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/EnvelopeWrapper.html","content":[{"headerCode":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/http;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e RefundRequest\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e request_id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e email;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e client_id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e capture_id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e PaypalRespose\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e status;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efinal\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient paypalClient \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"http://api-m.sandbox.paypal.com.balmock.io\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efinal\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e encodedHeader \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {alg\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"none\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e}.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003etoString\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e().\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003etoBytes\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e().\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003etoBase64\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","mainCode":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eservice\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e /paypal\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e on\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e http:Listener(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e8080\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    resource\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e post\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e refund\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eRefundRequest\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e refundReq\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e PaypalRespose\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e        // Generate PayPal-Auth-Assertion.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e authAssertionValue \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getAuthAssertionValue\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(refundReq.client_id, refundReq.email);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eRequest request \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        request.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eaddHeader\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"PayPal-Request-Id\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, refundReq.request_id);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        request.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eaddHeader\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"PayPal-Auth-Assertion\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eauthAssertionValue\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e paypalClient\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003ev2\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003epayments\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003ecaptures\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[refundReq.capture_id]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003erefund.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eisolated\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getAuthAssertionValue\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e client_id\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e email\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    map\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e payload \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        iss\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e client_id,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        payer_id\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e email\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e encodedPayload \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e payload.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003etoString\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e().\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003etoBytes\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e().\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003etoBase64\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e `${\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eencodedHeader\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e}.${\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eencodedPayload\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e}.`\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","raw":"import ballerina/http;\n\ntype RefundRequest record {|\n    string request_id;\n    string email;\n    string client_id;\n    string capture_id;\n|};\n\ntype PaypalRespose record {|\n    string status;\n    string message;\n|};\n\nfinal http:Client paypalClient = check new (\"http://api-m.sandbox.paypal.com.balmock.io\");\nfinal string encodedHeader = {alg: \"none\"}.toString().toBytes().toBase64();\n\nservice /paypal on new http:Listener(8080) {\n    resource function post refund(RefundRequest refundReq) returns PaypalRespose|error {\n        // Generate PayPal-Auth-Assertion.\n        string authAssertionValue = getAuthAssertionValue(refundReq.client_id, refundReq.email);\n\n        http:Request request = new;\n        request.addHeader(\"PayPal-Request-Id\", refundReq.request_id);\n        request.addHeader(\"PayPal-Auth-Assertion\", authAssertionValue);\n        return paypalClient-\u003e/v2/payments/captures/[refundReq.capture_id]/refund.post(request);\n    }\n}\n\nisolated function getAuthAssertionValue(string client_id, string email) returns string {\n    map\u003cstring\u003e payload = {\n        iss: client_id,\n        payer_id: email\n    };\n    string encodedPayload = payload.toString().toBytes().toBase64();\n    return string `${encodedHeader}.${encodedPayload}.`;\n}\n","name":"envelope-wrapper.bal"}],"name":" Envelope Wrapper"},"__N_SSG":true},"page":"/learn/enterprise-integration-patterns/[pattern]","query":{"pattern":"envelope-wrapper"},"buildId":"MZwqTLwZps0KDHWHUYjg7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>