<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="Route the message to the next component according to the sequence of processing steps specified in a routing slip."/><meta name="author" content="WSO2 LLC"/><meta name="keywords" content="ballerina, learn, documentation, docs, programming language"/><link rel="shortcut icon" href="/img/favicon.ico"/><title>EIP:  Routing Slip - The Ballerina programming language</title><meta property="og:type" content="article"/><meta property="og:title" content="EIP:  Routing Slip - The Ballerina programming language"/><meta property="og:description" content="Route the message to the next component according to the sequence of processing steps specified in a routing slip."/><meta property="og:title" content="EIP:  Routing Slip - The Ballerina programming language"/><meta property="og:image" content="https://ballerina.io/images/ballerina-swan-lake-eip-sm-banner.png"/><meta property="og:description" itemProp="image" content="Route the message to the next component according to the sequence of processing steps specified in a routing slip."/><meta name="twitter:site" content="@ballerinalang"/><meta name="twitter:creator" content="@ballerinalang"/><meta name="twitter:title" content="EIP:  Routing Slip - The Ballerina programming language"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:description" content="Route the message to the next component according to the sequence of processing steps specified in a routing slip."/><meta name="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-eip-sm-banner.png"/><meta property="twitter:text:description" content="Route the message to the next component according to the sequence of processing steps specified in a routing slip."/><meta property="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-eip-sm-banner.png"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.setAttributeNode(d.createAttribute('data-ot-ignore'));j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PSL2TX4');</script><script type="text/javascript" crossorigin="true" src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script><script src="https://cookie-cdn.cookiepro.com/scripttemplates/otSDKStub.js" type="text/javascript" charSet="UTF-8" data-domain-script="630ad396-5fd5-4745-92ae-2765dc8841ee" defer=""></script><meta name="next-head-count" content="25"/><meta charSet="utf-8"/><meta name="author" content="WSO2 LLC"/><meta http-equiv="X-Frame-Options" content="SAMEORIGIN"/><meta http-equiv="Content-Security-Policy" content="frame-ancestors &#x27;none&#x27;;"/><link rel="shortcut icon" href="/images/favicon.ico"/><link rel="stylesheet" href="/css/roboto.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><link rel="stylesheet" href="/css/ballerina-search-button.css"/><link rel="stylesheet" href="/css/ballerina-search-modal.css"/><link rel="stylesheet" href="/css/ballerina-search-variables.css"/><link rel="stylesheet" href="/css/ballerina-search-style.css"/><link rel="preload" href="/_next/static/css/9bb35c8110b0fa38.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9bb35c8110b0fa38.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b7d35c896f9865c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b7d35c896f9865c2.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9ee6b616f8ba237c.js" defer=""></script><script src="/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/_next/static/chunks/main-0ea70f422df5d19e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba2391f08766dae9.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-07afe3a69e1ba759.js" defer=""></script><script src="/_next/static/chunks/7621-d6bcd83f463fef72.js" defer=""></script><script src="/_next/static/chunks/6084-4e54ad5efcb8d3b5.js" defer=""></script><script src="/_next/static/chunks/51-100af16a0950a491.js" defer=""></script><script src="/_next/static/chunks/pages/learn/enterprise-integration-patterns/%5Bpattern%5D-2b9678b6262b59dd.js" defer=""></script><script src="/_next/static/sC-ysTjDH3xHUbM6kTcpO/_buildManifest.js" defer=""></script><script src="/_next/static/sC-ysTjDH3xHUbM6kTcpO/_ssgManifest.js" defer=""></script><script src="/_next/static/sC-ysTjDH3xHUbM6kTcpO/_middlewareManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSL2TX4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next" data-reactroot=""><div class="main-wrapper other vstack gap-0"><div class="wrap-page-content" style="padding-bottom:0"><div class="community-wrap-row row"><div class="col-sm-12"><div class="pageContentRow llanding pb-0 row"><div class="col-12"><div class="container"><div class="row"><div class="patternContent col-12"><div class="backToLanding" href="/learn/enterprise-integration-patterns/"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#3ad1ca" class="bi bi-box-arrow-left ms-0" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"></path><path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"></path></svg><p class="m-0 p-0">Back to EIP</p></div></div></div></div></div></div><div class="pageHeader pageContentRow llanding row"><div class="col-12"><div class="container"><h1> Routing Slip</h1></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><div class="row"><div class="patternContent col-12"><table class="Patterns_table__b7PHn"><tr><td>Pattern</td><td>Route the message to the next component according to the sequence of processing steps specified in a routing slip.<!-- --> <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/RoutingTable.html" style="color:#20b6b0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a></td></tr><tr><td>How Ballerina helps</td><td><p>Ballerina excels in enabling the seamless integration of diverse services with inherent concurrent support, as well as in data binding, type enforcement, and native error-handling capabilities.</p></td></tr></table><div class="Patterns_tags__V1YUk"><span class="Patterns_tag__oMtq4 badge bg-primary">Routing Slip</span><span class="Patterns_tag__oMtq4 badge bg-primary">Message Channel</span><span class="Patterns_tag__oMtq4 badge bg-primary">Message Endpoint</span><span class="Patterns_tag__oMtq4 badge bg-primary">Message Router</span></div></div></div></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><div><div class="CodeView_code__h13cx"><h5 class="CodeView_title__lbjVq">routing-slip-main.bal</h5><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="CodeView_copyToClipboard__sqFoK" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"></path></svg><div style="display:none"><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/http;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> PaymentRequest</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> mobileNumber;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> customerName;</span></span>
<span class="line"><span style="color:#005CC5">    float</span><span style="color:#24292E"> totalAmount;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> storeCode;</span></span>
<span class="line"><span style="color:#D73A49">    record</span><span style="color:#24292E"> {}[] items;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> PaymentStatus</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> status;</span></span>
<span class="line"><span style="color:#D73A49">    record</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">        float</span><span style="color:#24292E"> totalPoints;</span></span>
<span class="line"><span style="color:#005CC5">        float</span><span style="color:#24292E"> redeemedAmount;</span></span>
<span class="line"><span style="color:#005CC5">        float</span><span style="color:#24292E"> totalAmount;</span></span>
<span class="line"><span style="color:#24292E">    } details;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Message</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#D73A49">    *</span><span style="color:#24292E">PaymentRequest;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> storeCode;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E">[] routingSlip </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Points</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">    float</span><span style="color:#24292E"> loyaltyPoints </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0.0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">    float</span><span style="color:#24292E"> mobilePoints </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0.0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">};</span></span>
<span class="line"></span></code></pre></div><div class="CodeView_collapse__l9WX_">⋯</div><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D73A49">service</span><span style="color:#6F42C1"> /api/v1</span><span style="color:#D73A49"> on</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> http:Listener(</span><span style="color:#005CC5">8080</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">    resource</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> post</span><span style="color:#6F42C1"> payments</span><span style="color:#24292E">(</span><span style="color:#E36209">PaymentRequest</span><span style="color:#E36209"> request</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> PaymentStatus</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E">[] routingSlip </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> lookupMessageSlip</span><span style="color:#24292E">(</span><span style="color:#E36209">request</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        Message message </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span><span style="color:#D73A49">...</span><span style="color:#24292E">request, routingSlip</span><span style="color:#D73A49">:</span><span style="color:#24292E"> routingSlip};</span></span>
<span class="line"><span style="color:#24292E">        Points points </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {};</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> message.routingSlip.</span><span style="color:#6F42C1">length</span><span style="color:#24292E">() </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client pointHandler </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#032F62">"http://localhost:8081/loyaltyPoints"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">            json</span><span style="color:#24292E"> payload </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">                storeCode</span><span style="color:#D73A49">:</span><span style="color:#24292E"> message.storeCode,</span></span>
<span class="line"><span style="color:#24292E">                mobileNumber</span><span style="color:#D73A49">:</span><span style="color:#24292E"> message.mobileNumber,</span></span>
<span class="line"><span style="color:#24292E">                routingSlip</span><span style="color:#D73A49">:</span><span style="color:#24292E"> message.routingSlip</span></span>
<span class="line"><span style="color:#24292E">            };</span></span>
<span class="line"><span style="color:#24292E">            points </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> pointHandler</span><span style="color:#D73A49">->/</span><span style="color:#24292E">points.</span><span style="color:#6F42C1">post</span><span style="color:#24292E">(</span><span style="color:#E36209">payload</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#6F42C1"> checkout</span><span style="color:#24292E">(</span><span style="color:#E36209">message</span><span style="color:#24292E">, </span><span style="color:#E36209">points</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> checkout</span><span style="color:#24292E">(</span><span style="color:#E36209">Message</span><span style="color:#E36209"> message</span><span style="color:#24292E">, </span><span style="color:#E36209">Points</span><span style="color:#E36209"> points</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> PaymentStatus {</span></span>
<span class="line"><span style="color:#005CC5">    float</span><span style="color:#24292E"> totalPoints </span><span style="color:#D73A49">=</span><span style="color:#24292E"> points.loyaltyPoints </span><span style="color:#D73A49">+</span><span style="color:#24292E"> points.mobilePoints;</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        status</span><span style="color:#D73A49">:</span><span style="color:#032F62"> "SUCCESS"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">        details</span><span style="color:#D73A49">:</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            totalPoints</span><span style="color:#D73A49">:</span><span style="color:#24292E"> totalPoints,</span></span>
<span class="line"><span style="color:#24292E">            redeemedAmount</span><span style="color:#D73A49">:</span><span style="color:#24292E"> totalPoints * </span><span style="color:#005CC5">50</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">            totalAmount</span><span style="color:#D73A49">:</span><span style="color:#24292E"> message.totalAmount - (</span><span style="color:#E36209">totalPoints</span><span style="color:#D73A49"> *</span><span style="color:#005CC5"> 50</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    };</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> lookupMessageSlip</span><span style="color:#24292E">(</span><span style="color:#E36209">PaymentRequest</span><span style="color:#E36209"> request</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> string</span><span style="color:#24292E">[]</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client openLoyalty </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#032F62">"http://openloyalty.com.balmock.io"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">    anydata</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> customer </span><span style="color:#D73A49">=</span><span style="color:#24292E"> openLoyalty</span><span style="color:#D73A49">->/</span><span style="color:#24292E">api</span><span style="color:#D73A49">/</span><span style="color:#24292E">[request.storeCode]</span><span style="color:#D73A49">/</span><span style="color:#24292E">member</span><span style="color:#D73A49">/</span><span style="color:#24292E">'check</span><span style="color:#D73A49">/</span><span style="color:#6F42C1">get</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E">[] routingSlip </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> customer </span><span style="color:#D73A49">is</span><span style="color:#005CC5"> anydata</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        routingSlip.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(</span><span style="color:#032F62">"CustomerLoyaltyPoints"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> isRegisteredToPointsService</span><span style="color:#24292E">(request.mobileNumber) {</span></span>
<span class="line"><span style="color:#24292E">        routingSlip.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(</span><span style="color:#032F62">"MobilePoints"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> routingSlip;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> isRegisteredToPointsService</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#E36209"> mobileNumber</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> boolean</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client openLoyalty </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#032F62">"http://mob.points.hub.com.balmock.io"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">    anydata</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> memberCheck </span><span style="color:#D73A49">=</span><span style="color:#24292E"> openLoyalty</span><span style="color:#D73A49">->/</span><span style="color:#24292E">api</span><span style="color:#D73A49">/</span><span style="color:#24292E">[mobileNumber]</span><span style="color:#D73A49">/</span><span style="color:#24292E">member</span><span style="color:#D73A49">/</span><span style="color:#24292E">'check</span><span style="color:#D73A49">/</span><span style="color:#6F42C1">get</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> memberCheck </span><span style="color:#D73A49">is</span><span style="color:#D73A49"> error</span><span style="color:#D73A49"> ?</span><span style="color:#D73A49"> false</span><span style="color:#D73A49"> :</span><span style="color:#005CC5"> true</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre></div></div></div></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><div><div class="CodeView_code__h13cx"><h5 class="CodeView_title__lbjVq">loyalty-point-service.bal</h5><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="CodeView_copyToClipboard__sqFoK" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"></path></svg><div style="display:none"><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/http;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Request</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> storeCode;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> mobileNumber;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E">[] routingSlip;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Points</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    float</span><span style="color:#24292E"> loyaltyPoints </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0.0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">    float</span><span style="color:#24292E"> mobilePoints </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0.0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">    float</span><span style="color:#24292E"> crypto </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0.0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span></code></pre></div><div class="CodeView_collapse__l9WX_">⋯</div><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D73A49">service</span><span style="color:#6F42C1"> /loyaltyPoints</span><span style="color:#D73A49"> on</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> http:Listener(</span><span style="color:#005CC5">8081</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">    resource</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> post</span><span style="color:#6F42C1"> points</span><span style="color:#24292E">(</span><span style="color:#E36209">Request</span><span style="color:#E36209"> request</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> Points</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        Points totalPoints </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {};</span></span>
<span class="line"><span style="color:#D73A49">        foreach </span><span style="color:#005CC5">string</span><span style="color:#24292E"> process </span><span style="color:#D73A49">in</span><span style="color:#24292E"> request.routingSlip {</span></span>
<span class="line"><span style="color:#D73A49">            match</span><span style="color:#24292E"> process {</span></span>
<span class="line"><span style="color:#032F62">                "CustomerLoyaltyPoints"</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">                    totalPoints.loyaltyPoints </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> getShopLoyaltiPoints</span><span style="color:#24292E">(</span><span style="color:#E36209">request</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#032F62">                "MobilePoints"</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">                    totalPoints.mobilePoints </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> getMobilePoints</span><span style="color:#24292E">(</span><span style="color:#E36209">request</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#032F62">                "Crypto"</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">                    totalPoints.crypto </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> getCrypto</span><span style="color:#24292E">(</span><span style="color:#E36209">request</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> totalPoints;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> getShopLoyaltiPoints</span><span style="color:#24292E">(</span><span style="color:#E36209">Request</span><span style="color:#E36209"> request</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> float</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client openLoyalty </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#032F62">"http://openloyalty.customer.com.balmock.io"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">    record</span><span style="color:#24292E"> {</span><span style="color:#005CC5">float</span><span style="color:#24292E"> loyaltyPoints;} points </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> openLoyalty</span><span style="color:#D73A49">->/</span><span style="color:#24292E">api</span><span style="color:#D73A49">/</span><span style="color:#24292E">[request.storeCode]</span><span style="color:#D73A49">/</span><span style="color:#24292E">redemption</span><span style="color:#D73A49">/</span><span style="color:#24292E">[request.mobileNumber].</span><span style="color:#6F42C1">get</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> points.loyaltyPoints;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> getMobilePoints</span><span style="color:#24292E">(</span><span style="color:#E36209">Request</span><span style="color:#E36209"> request</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> float</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client mobPoints </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#032F62">"http://mob.points.com.balmock.io"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">    record</span><span style="color:#24292E"> {</span><span style="color:#005CC5">float</span><span style="color:#24292E"> mobilePoints;} points </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> mobPoints</span><span style="color:#D73A49">->/</span><span style="color:#24292E">api</span><span style="color:#D73A49">/</span><span style="color:#24292E">[request.mobileNumber]</span><span style="color:#D73A49">/</span><span style="color:#24292E">redemption.</span><span style="color:#6F42C1">get</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> points.mobilePoints;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> getCrypto</span><span style="color:#24292E">(</span><span style="color:#E36209">Request</span><span style="color:#E36209"> request</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> float</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    http</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client crypto </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#032F62">"http://crypto.com.balmock.io"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">    record</span><span style="color:#24292E"> {</span><span style="color:#005CC5">float</span><span style="color:#24292E"> crypto;} points </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> crypto</span><span style="color:#D73A49">->/</span><span style="color:#24292E">api</span><span style="color:#D73A49">/</span><span style="color:#24292E">[request.mobileNumber].</span><span style="color:#6F42C1">get</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> points.crypto;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre></div></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tagline":"Route message according to an order.","desc":"Route the message to the next component according to the sequence of processing steps specified in a routing slip.","category":"Message Routing","index":33,"helps":"Ballerina excels in enabling the seamless integration of diverse services with inherent concurrent support, as well as in data binding, type enforcement, and native error-handling capabilities.","tags":["Routing Slip","Message Channel","Message Endpoint","Message Router"],"link":"https://www.enterpriseintegrationpatterns.com/patterns/messaging/RoutingTable.html","files":["routing-slip-main.bal","loyalty-point-service.bal"],"content":[{"headerCode":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/http;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e PaymentRequest\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mobileNumber;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e customerName;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e totalAmount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e storeCode;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {}[] items;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e PaymentStatus\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e status;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e totalPoints;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e redeemedAmount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e totalAmount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    } details;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e Message\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    *\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003ePaymentRequest;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e storeCode;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] routingSlip \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e [];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e Points\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e loyaltyPoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 0.0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mobilePoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 0.0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","mainCode":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eservice\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e /api/v1\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e on\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e http:Listener(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e8080\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    resource\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e post\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e payments\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ePaymentRequest\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e PaymentStatus\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] routingSlip \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e lookupMessageSlip\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        Message message \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e...\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003erequest, routingSlip\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e routingSlip};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        Points points \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.routingSlip.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient pointHandler \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"http://localhost:8081/loyaltyPoints\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e            json\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e payload \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                storeCode\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.storeCode,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                mobileNumber\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.mobileNumber,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                routingSlip\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.routingSlip\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            points \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e pointHandler\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003epoints.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003epayload\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e checkout\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003emessage\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003epoints\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e checkout\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eMessage\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e message\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ePoints\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e points\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e PaymentStatus {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e totalPoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e points.loyaltyPoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e points.mobilePoints;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        status\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"SUCCESS\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        details\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            totalPoints\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e totalPoints,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            redeemedAmount\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e totalPoints * \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e50\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            totalAmount\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.totalAmount - (\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003etotalPoints\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e *\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 50\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e lookupMessageSlip\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ePaymentRequest\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient openLoyalty \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"http://openloyalty.com.balmock.io\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    anydata\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e customer \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e openLoyalty\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eapi\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[request.storeCode]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003emember\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e'check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] routingSlip \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e [];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e customer \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e anydata\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        routingSlip.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epush\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"CustomerLoyaltyPoints\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e isRegisteredToPointsService\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(request.mobileNumber) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        routingSlip.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epush\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"MobilePoints\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e routingSlip;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e isRegisteredToPointsService\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e mobileNumber\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e boolean\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient openLoyalty \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"http://mob.points.hub.com.balmock.io\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    anydata\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e memberCheck \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e openLoyalty\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eapi\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[mobileNumber]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003emember\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e'check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e memberCheck \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e false\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e :\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e true\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","raw":"import ballerina/http;\n\ntype PaymentRequest record {|\n    string mobileNumber;\n    string customerName;\n    float totalAmount;\n    string storeCode;\n    record {}[] items;\n|};\n\ntype PaymentStatus record {|\n    string status;\n    record {\n        float totalPoints;\n        float redeemedAmount;\n        float totalAmount;\n    } details;\n|};\n\ntype Message record {|\n    *PaymentRequest;\n    string storeCode;\n    string[] routingSlip = [];\n|};\n\ntype Points record {\n    float loyaltyPoints = 0.0;\n    float mobilePoints = 0.0;\n};\n\nservice /api/v1 on new http:Listener(8080) {\n    resource function post payments(PaymentRequest request) returns PaymentStatus|error {\n        string[] routingSlip = check lookupMessageSlip(request);\n        Message message = {...request, routingSlip: routingSlip};\n        Points points = {};\n        if message.routingSlip.length() \u003e 0 {\n            http:Client pointHandler = check new (\"http://localhost:8081/loyaltyPoints\");\n            json payload = {\n                storeCode: message.storeCode,\n                mobileNumber: message.mobileNumber,\n                routingSlip: message.routingSlip\n            };\n            points = check pointHandler-\u003e/points.post(payload);\n        }\n        return checkout(message, points);\n    }\n}\n\nfunction checkout(Message message, Points points) returns PaymentStatus {\n    float totalPoints = points.loyaltyPoints + points.mobilePoints;\n    return {\n        status: \"SUCCESS\",\n        details: {\n            totalPoints: totalPoints,\n            redeemedAmount: totalPoints * 50,\n            totalAmount: message.totalAmount - (totalPoints * 50)\n        }\n    };\n}\n\nfunction lookupMessageSlip(PaymentRequest request) returns string[]|error {\n    http:Client openLoyalty = check new (\"http://openloyalty.com.balmock.io\");\n    anydata|error customer = openLoyalty-\u003e/api/[request.storeCode]/member/'check/get();\n    string[] routingSlip = [];\n    if customer is anydata {\n        routingSlip.push(\"CustomerLoyaltyPoints\");\n    }\n    if check isRegisteredToPointsService(request.mobileNumber) {\n        routingSlip.push(\"MobilePoints\");\n    }\n    return routingSlip;\n}\n\nfunction isRegisteredToPointsService(string mobileNumber) returns boolean|error {\n    http:Client openLoyalty = check new (\"http://mob.points.hub.com.balmock.io\");\n    anydata|error memberCheck = openLoyalty-\u003e/api/[mobileNumber]/member/'check/get();\n    return memberCheck is error ? false : true;\n}\n","name":"routing-slip-main.bal"},{"headerCode":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/http;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e Request\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e storeCode;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mobileNumber;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] routingSlip;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e Points\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e loyaltyPoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 0.0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mobilePoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 0.0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    float\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e crypto \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 0.0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","mainCode":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eservice\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e /loyaltyPoints\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e on\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e http:Listener(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e8081\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    resource\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e post\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e points\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eRequest\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Points\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        Points totalPoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        foreach \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e process \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e request.routingSlip {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            match\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e process {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#032F62\"\u003e                \"CustomerLoyaltyPoints\"\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                    totalPoints.loyaltyPoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getShopLoyaltiPoints\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#032F62\"\u003e                \"MobilePoints\"\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                    totalPoints.mobilePoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getMobilePoints\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#032F62\"\u003e                \"Crypto\"\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                    totalPoints.crypto \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getCrypto\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e totalPoints;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getShopLoyaltiPoints\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eRequest\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e float\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient openLoyalty \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"http://openloyalty.customer.com.balmock.io\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e loyaltyPoints;} points \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e openLoyalty\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eapi\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[request.storeCode]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eredemption\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[request.mobileNumber].\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e points.loyaltyPoints;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getMobilePoints\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eRequest\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e float\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient mobPoints \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"http://mob.points.com.balmock.io\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mobilePoints;} points \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mobPoints\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eapi\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[request.mobileNumber]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eredemption.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e points.mobilePoints;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getCrypto\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eRequest\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e float\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    http\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient crypto \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"http://crypto.com.balmock.io\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e crypto;} points \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e crypto\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eapi\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[request.mobileNumber].\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e points.crypto;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e","raw":"import ballerina/http;\n\ntype Request record {|\n    string storeCode;\n    string mobileNumber;\n    string[] routingSlip;\n|};\n\ntype Points record {|\n    float loyaltyPoints = 0.0;\n    float mobilePoints = 0.0;\n    float crypto = 0.0;\n|};\n\nservice /loyaltyPoints on new http:Listener(8081) {\n    resource function post points(Request request) returns Points|error {\n        Points totalPoints = {};\n        foreach string process in request.routingSlip {\n            match process {\n                \"CustomerLoyaltyPoints\" =\u003e {\n                    totalPoints.loyaltyPoints = check getShopLoyaltiPoints(request);\n                }\n                \"MobilePoints\" =\u003e {\n                    totalPoints.mobilePoints = check getMobilePoints(request);\n                }\n                \"Crypto\" =\u003e {\n                    totalPoints.crypto = check getCrypto(request);\n                }\n            }\n        }\n        return totalPoints;\n    }\n}\n\nfunction getShopLoyaltiPoints(Request request) returns float|error {\n    http:Client openLoyalty = check new (\"http://openloyalty.customer.com.balmock.io\");\n    record {float loyaltyPoints;} points = check openLoyalty-\u003e/api/[request.storeCode]/redemption/[request.mobileNumber].get();\n    return points.loyaltyPoints;\n}\n\nfunction getMobilePoints(Request request) returns float|error {\n    http:Client mobPoints = check new (\"http://mob.points.com.balmock.io\");\n    record {float mobilePoints;} points = check mobPoints-\u003e/api/[request.mobileNumber]/redemption.get();\n    return points.mobilePoints;\n}\n\nfunction getCrypto(Request request) returns float|error {\n    http:Client crypto = check new (\"http://crypto.com.balmock.io\");\n    record {float crypto;} points = check crypto-\u003e/api/[request.mobileNumber].get();\n    return points.crypto;\n}\n","name":"loyalty-point-service.bal"}],"name":" Routing Slip"},"__N_SSG":true},"page":"/learn/enterprise-integration-patterns/[pattern]","query":{"pattern":"routing-slip"},"buildId":"sC-ysTjDH3xHUbM6kTcpO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>