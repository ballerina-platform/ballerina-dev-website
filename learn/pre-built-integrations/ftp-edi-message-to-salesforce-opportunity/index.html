<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="Read EDI files from a given FTP location and create a Salesforce Opportunity"/><meta name="author" content="WSO2 LLC"/><meta name="keywords" content="ballerina, learn, documentation, docs, programming language"/><link rel="shortcut icon" href="/img/favicon.ico"/><title>FTP EDI message to Salesforce Opportunity - The Ballerina programming language</title><meta property="og:type" content="article"/><meta property="og:title" content="FTP EDI message to Salesforce Opportunity - The Ballerina programming language"/><meta property="og:description" content="Read EDI files from a given FTP location and create a Salesforce Opportunity"/><meta property="og:title" content="FTP EDI message to Salesforce Opportunity - The Ballerina programming language"/><meta property="og:image" content="https://ballerina.io/images/ballerina-swan-lake-pre-built-integrations-sm-banner.png"/><meta property="og:description" itemProp="image" content="Read EDI files from a given FTP location and create a Salesforce Opportunity"/><meta name="twitter:site" content="@ballerinalang"/><meta name="twitter:creator" content="@ballerinalang"/><meta name="twitter:title" content="FTP EDI message to Salesforce Opportunity - The Ballerina programming language"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:description" content="Read EDI files from a given FTP location and create a Salesforce Opportunity"/><meta name="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-pre-built-integrations-sm-banner.png"/><meta property="twitter:text:description" content="Read EDI files from a given FTP location and create a Salesforce Opportunity"/><meta property="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-pre-built-integrations-sm-banner.png"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.setAttributeNode(d.createAttribute('data-ot-ignore'));j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PSL2TX4');</script><script type="text/javascript" crossorigin="true" src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script><script src="https://cookie-cdn.cookiepro.com/scripttemplates/otSDKStub.js" type="text/javascript" charSet="UTF-8" data-domain-script="630ad396-5fd5-4745-92ae-2765dc8841ee" defer=""></script><meta name="next-head-count" content="25"/><meta charSet="utf-8"/><meta name="author" content="WSO2 LLC"/><meta http-equiv="X-Frame-Options" content="SAMEORIGIN"/><meta http-equiv="Content-Security-Policy" content="frame-ancestors &#x27;none&#x27;;"/><link rel="shortcut icon" href="/images/favicon.ico"/><link rel="stylesheet" href="/css/roboto.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><link rel="stylesheet" href="/css/ballerina-search-button.css"/><link rel="stylesheet" href="/css/ballerina-search-modal.css"/><link rel="stylesheet" href="/css/ballerina-search-variables.css"/><link rel="stylesheet" href="/css/ballerina-search-style.css"/><link rel="preload" href="/_next/static/css/a065b6d8130f9c90.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a065b6d8130f9c90.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a0536ea4046d7fff.js" defer=""></script><script src="/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/_next/static/chunks/main-0ea70f422df5d19e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba2391f08766dae9.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-07afe3a69e1ba759.js" defer=""></script><script src="/_next/static/chunks/7621-d6bcd83f463fef72.js" defer=""></script><script src="/_next/static/chunks/8130-4f833ffdbe1dba0f.js" defer=""></script><script src="/_next/static/chunks/6242-7c6681de385c0d0b.js" defer=""></script><script src="/_next/static/chunks/1726-d958e891b50f9478.js" defer=""></script><script src="/_next/static/chunks/1205-52fd92c16c512500.js" defer=""></script><script src="/_next/static/chunks/pages/learn/integration/pre-built-integrations/ftp-edi-message-to-salesforce-opportunity-18763e41304dac14.js" defer=""></script><script src="/_next/static/-qAIOSe9lKRLgNxhpgGY8/_buildManifest.js" defer=""></script><script src="/_next/static/-qAIOSe9lKRLgNxhpgGY8/_ssgManifest.js" defer=""></script><script src="/_next/static/-qAIOSe9lKRLgNxhpgGY8/_middlewareManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSL2TX4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next" data-reactroot=""><div class="main-wrapper other vstack gap-0"><div class="wrap-page-content" style="padding-bottom:0"><div class="community-wrap-row row"><div class="col-sm-12"><div class="pageContentRow llanding pb-0 row"><div class="col-12"><div class="container"><div class="row"><div class="patternContent col-12"><div class="backToLanding" href="/learn/pre-built-integrations/"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#3ad1ca" class="bi bi-box-arrow-left ms-0" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"></path><path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"></path></svg><p class="m-0 p-0">Back to pre-built integrations</p></div></div></div></div></div></div><div class="pageHeader pageContentRow llanding row"><div class="col-12"><div class="container"><h1>FTP EDI message to Salesforce Opportunity</h1></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><div class="row"><div style="font-size:18px" class="col-lg-6 col-12"><p>Interactions between businesses, such as sending purchase orders and invoices, usually occur over EDI-based B2B channels. On the other hand, sales and customer details related to such transactions are maintained in Salesforce. Therefore, it&#x27;s critical to bridge Salesforce with B2B channels in order to automate the sales processes. For example, it is possible to update the status and details of opportunities in Salesforce based on the exchange of EDI messages like `EDIFACT REQOTE` (Request for quotation), `EDIFACT QUOTES` (Quotation response), `EDIFACT ORDERS` (Purchase order), etc. Such integrations will eliminate the delays and inconsistencies in updating Salesforce and provide up-to-date information for sales staff and decision makers.</p><p>The code sample below reads `EDIFACT REQOTE` EDI files from a given FTP location and creates a Salesforce Opportunity.</p></div><div class="text-center mdContent col-lg-6 col-12"><img src="/images/pre-built/flow_diagrams/ftp-edi-message-to-salesforce-opportunity.png" alt="Flow Diagram"/></div></div></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><ul class="mb-3 preBuilt nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><button type="button" id="react-aria1757827008-2-tab-code" role="tab" data-rr-ui-event-key="code" aria-controls="react-aria1757827008-2-tabpane-code" aria-selected="true" class="nav-link active">Code</button></li><li class="nav-item" role="presentation"><button type="button" id="react-aria1757827008-2-tab-diagram" role="tab" data-rr-ui-event-key="diagram" aria-controls="react-aria1757827008-2-tabpane-diagram" aria-selected="false" tabindex="-1" class="nav-link">Diagram</button></li></ul><div class="tab-content"><div role="tabpanel" id="react-aria1757827008-2-tabpane-code" aria-labelledby="react-aria1757827008-2-tab-code" class="fade tab-pane active show"><div style="background:#eeeeee;padding:10px;border-radius:5px;margin-top:20px;background-color:#eeeeee !important"><div style="display:flex;justify-content:end"><a href="https://github.com/ballerina-guides/integration-samples/tree/main/ftp-edi-message-to-salesforce-opportunity" target="_blank" rel="noreferrer" title="Open on GitHub" style="margin-top:-5px"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" style="color:black;margin-right:10px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"></path></svg></div><div class="highlight"><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/file;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/ftp;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/io;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerinax/edifact.d03a.retail.mREQOTE;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerinax/salesforce </span><span style="color:#D73A49">as</span><span style="color:#24292E"> sf;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#24292E"> ftp</span><span style="color:#D73A49">:</span><span style="color:#24292E">ClientConfiguration ftpConfig </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> ftpNewQuotesPath </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> ftpProcessedQuotesPath </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#24292E"> sf</span><span style="color:#D73A49">:</span><span style="color:#24292E">ConnectionConfig salesforceConfig </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> salesforcePriceBookId </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> main</span><span style="color:#24292E">() </span><span style="color:#D73A49">returns</span><span style="color:#D73A49"> error?</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    sf</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client salesforce </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> (</span><span style="color:#E36209">salesforceConfig</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    ftp</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client fileServer </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> ftp</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">Client</span><span style="color:#24292E">(</span><span style="color:#E36209">ftpConfig</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Get new quotes from the FTP new quotes directory, and iterate through them.</span></span>
<span class="line"><span style="color:#24292E">    ftp</span><span style="color:#D73A49">:</span><span style="color:#24292E">FileInfo[] quoteList </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> fileServer</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">list</span><span style="color:#24292E">(</span><span style="color:#E36209">ftpNewQuotesPath</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">    foreach </span><span style="color:#24292E">ftp</span><span style="color:#D73A49">:</span><span style="color:#24292E">FileInfo quoteFile </span><span style="color:#D73A49">in</span><span style="color:#24292E"> quoteList {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#D73A49"> !</span><span style="color:#24292E">quoteFile.name.</span><span style="color:#6F42C1">endsWith</span><span style="color:#24292E">(</span><span style="color:#032F62">".edi"</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">            continue</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // Fetch the EDI file containing the quote from the FTP server.</span></span>
<span class="line"><span style="color:#D73A49">        stream&#x3C;</span><span style="color:#005CC5">byte</span><span style="color:#24292E">[] </span><span style="color:#D73A49">&#x26;</span><span style="color:#D73A49"> readonly</span><span style="color:#24292E">, io</span><span style="color:#D73A49">:</span><span style="color:#24292E">Error?</span><span style="color:#D73A49">></span><span style="color:#24292E"> fileStream </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> fileServer</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">get</span><span style="color:#24292E">(quoteFile.path);</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E"> quoteText </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> streamToString</span><span style="color:#24292E">(</span><span style="color:#E36209">fileStream</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // Parse the EDI file and transform in to Ballerina record containing only the required data.</span></span>
<span class="line"><span style="color:#24292E">        mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">EDI_REQOTE_Request_for_quote_message quote </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">fromEdiString</span><span style="color:#24292E">(</span><span style="color:#E36209">quoteText</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        QuoteRequest quoteRequest </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> transformQuoteRequest</span><span style="color:#24292E">(</span><span style="color:#E36209">quote</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // Get the corresponding account Id and oppurtunity Id from Salesforce.</span></span>
<span class="line"><span style="color:#6A737D">        // Create a new Opportunity if an Opportunity with the given name does not exist. </span></span>
<span class="line"><span style="color:#D73A49">        stream&#x3C;</span><span style="color:#24292E">Id, </span><span style="color:#D73A49">error?></span><span style="color:#24292E"> accQuery </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> salesforce</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">query</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#005CC5">            string</span><span style="color:#032F62"> `SELECT Id FROM Account WHERE Name = '${</span><span style="color:#24292E">quoteRequest</span><span style="color:#032F62">.</span><span style="color:#24292E">accountName</span><span style="color:#032F62">}'`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span><span style="color:#24292E">Id value;</span><span style="color:#D73A49">|</span><span style="color:#24292E">}</span><span style="color:#D73A49">?</span><span style="color:#24292E"> account </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> accQuery.</span><span style="color:#6F42C1">next</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">        check</span><span style="color:#24292E"> accQuery.</span><span style="color:#6F42C1">close</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> account </span><span style="color:#D73A49">is</span><span style="color:#24292E"> () {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#032F62">"Account not found. Account name: "</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> quoteRequest.accountName);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        Opportunity opp </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            Name</span><span style="color:#D73A49">:</span><span style="color:#24292E"> quoteRequest.oppName,</span></span>
<span class="line"><span style="color:#24292E">            AccountId</span><span style="color:#D73A49">:</span><span style="color:#24292E"> account.value.Id,</span></span>
<span class="line"><span style="color:#24292E">            Pricebook2Id</span><span style="color:#D73A49">:</span><span style="color:#24292E"> salesforcePriceBookId</span></span>
<span class="line"><span style="color:#24292E">        };</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E"> oppId </span><span style="color:#D73A49">=</span><span style="color:#032F62"> ""</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">        stream&#x3C;</span><span style="color:#24292E">Id, </span><span style="color:#D73A49">error?></span><span style="color:#24292E"> oppQuery </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> salesforce</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">query</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#005CC5">            string</span><span style="color:#032F62"> `SELECT Id FROM Opportunity WHERE Name = '${</span><span style="color:#24292E">quoteRequest</span><span style="color:#032F62">.</span><span style="color:#24292E">oppName</span><span style="color:#032F62">}'`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span><span style="color:#24292E">Id value;</span><span style="color:#D73A49">|</span><span style="color:#24292E">}</span><span style="color:#D73A49">?</span><span style="color:#24292E"> existingOpp </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> oppQuery.</span><span style="color:#6F42C1">next</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">        check</span><span style="color:#24292E"> oppQuery.</span><span style="color:#6F42C1">close</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> existingOpp </span><span style="color:#D73A49">is</span><span style="color:#24292E"> () {</span></span>
<span class="line"><span style="color:#24292E">            sf</span><span style="color:#D73A49">:</span><span style="color:#24292E">CreationResponse oppResult </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> salesforce</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">create</span><span style="color:#24292E">(</span><span style="color:#032F62">"Opportunity"</span><span style="color:#24292E">, </span><span style="color:#E36209">opp</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            oppId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> oppResult.id;</span></span>
<span class="line"><span style="color:#24292E">        } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            oppId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> existingOpp.value.Id;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // Create Opportunity line items for each item in the quote.</span></span>
<span class="line"><span style="color:#D73A49">        foreach </span><span style="color:#24292E">ItemData item </span><span style="color:#D73A49">in</span><span style="color:#24292E"> quoteRequest.itemData {</span></span>
<span class="line"><span style="color:#D73A49">            stream&#x3C;</span><span style="color:#24292E">PriceBookEntry, </span><span style="color:#D73A49">error?></span><span style="color:#24292E"> query </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> salesforce</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">query</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#005CC5">              string</span><span style="color:#032F62"> `SELECT UnitPrice FROM PricebookEntry WHERE Pricebook2Id = '01s6C000000UN4PQAW' AND Product2Id = '${</span><span style="color:#24292E">item</span><span style="color:#032F62">.</span><span style="color:#24292E">itemId</span><span style="color:#032F62">}'`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">            record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span><span style="color:#24292E">PriceBookEntry value;</span><span style="color:#D73A49">|</span><span style="color:#24292E">}</span><span style="color:#D73A49">?</span><span style="color:#24292E"> unionResult </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> query.</span><span style="color:#6F42C1">next</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">            check</span><span style="color:#24292E"> query.</span><span style="color:#6F42C1">close</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> unionResult </span><span style="color:#D73A49">is</span><span style="color:#24292E"> () {</span></span>
<span class="line"><span style="color:#D73A49">                return</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#032F62"> `Pricebook entry not found. Opportunity name: ${</span><span style="color:#24292E">quoteRequest</span><span style="color:#032F62">.</span><span style="color:#24292E">oppName</span><span style="color:#032F62">}, Item ID: ${</span><span style="color:#24292E">item</span><span style="color:#032F62">.</span><span style="color:#24292E">itemId</span><span style="color:#032F62">}`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            OpportunityProduct oppProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">                OpportunityId</span><span style="color:#D73A49">:</span><span style="color:#24292E"> oppId,</span></span>
<span class="line"><span style="color:#24292E">                Product2Id</span><span style="color:#D73A49">:</span><span style="color:#24292E"> item.itemId,</span></span>
<span class="line"><span style="color:#24292E">                Quantity</span><span style="color:#D73A49">:</span><span style="color:#24292E"> item.quantity,</span></span>
<span class="line"><span style="color:#24292E">                UnitPrice</span><span style="color:#D73A49">:</span><span style="color:#24292E"> unionResult.value.UnitPrice</span></span>
<span class="line"><span style="color:#24292E">            };</span></span>
<span class="line"><span style="color:#24292E">            _ </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> salesforce</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">create</span><span style="color:#24292E">(</span><span style="color:#032F62">"OpportunityLineItem"</span><span style="color:#24292E">, </span><span style="color:#E36209">oppProduct</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // Move the processed quote to the processed quotes FTP directory.</span></span>
<span class="line"><span style="color:#D73A49">        check</span><span style="color:#24292E"> fileServer</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">put</span><span style="color:#24292E">(</span><span style="color:#D73A49">check</span><span style="color:#E36209"> file</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">joinPath</span><span style="color:#24292E">(</span><span style="color:#E36209">ftpProcessedQuotesPath</span><span style="color:#24292E">, quoteFile.name), quoteText.</span><span style="color:#6F42C1">toBytes</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#D73A49">        check</span><span style="color:#24292E"> fileServer</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">delete</span><span style="color:#24292E">(quoteFile.path);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> transformQuoteRequest</span><span style="color:#24292E">(</span><span style="color:#E36209">mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">EDI_REQOTE_Request_for_quote_message quote) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> QuoteRequest</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    QuoteRequest quoteRequest </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {accountName</span><span style="color:#D73A49">:</span><span style="color:#032F62"> ""</span><span style="color:#24292E">, oppName</span><span style="color:#D73A49">:</span><span style="color:#032F62"> ""</span><span style="color:#24292E">};</span></span>
<span class="line"><span style="color:#24292E">    mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">Segment_group_1_GType[] segmentGroup1 </span><span style="color:#D73A49">=</span><span style="color:#24292E"> quote.Segment_group_1;</span></span>
<span class="line"><span style="color:#D73A49">    foreach </span><span style="color:#24292E">mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">Segment_group_1_GType ref </span><span style="color:#D73A49">in</span><span style="color:#24292E"> segmentGroup1 {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> ref.REFERENCE.REFERENCE.Reference_code_qualifier </span><span style="color:#D73A49">==</span><span style="color:#032F62"> "AES"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">            string</span><span style="color:#24292E">? oppId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ref.REFERENCE.REFERENCE.Reference_identifier;</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> oppId </span><span style="color:#D73A49">is</span><span style="color:#24292E"> () {</span></span>
<span class="line"><span style="color:#D73A49">                return</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#032F62">"Opportunity ID is not given"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            quoteRequest.oppName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> oppId;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">Segment_group_11_GType[] segmentGroup11 </span><span style="color:#D73A49">=</span><span style="color:#24292E"> quote.Segment_group_11;</span></span>
<span class="line"><span style="color:#D73A49">    foreach </span><span style="color:#24292E">mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">Segment_group_11_GType party </span><span style="color:#D73A49">in</span><span style="color:#24292E"> segmentGroup11 {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> party.NAME_AND_ADDRESS.Party_function_code_qualifier </span><span style="color:#D73A49">==</span><span style="color:#032F62"> "BY"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">            string</span><span style="color:#24292E">? prospectId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> party.NAME_AND_ADDRESS?.PARTY_IDENTIFICATION_DETAILS?.Party_identifier;</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> prospectId </span><span style="color:#D73A49">is</span><span style="color:#24292E"> () {</span></span>
<span class="line"><span style="color:#D73A49">                return</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#032F62">"Prospect identifier not available in quote."</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            quoteRequest.accountName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> prospectId;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">Segment_group_27_GType[] items </span><span style="color:#D73A49">=</span><span style="color:#24292E"> quote.Segment_group_27;</span></span>
<span class="line"><span style="color:#D73A49">    foreach </span><span style="color:#24292E">mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">Segment_group_27_GType item </span><span style="color:#D73A49">in</span><span style="color:#24292E"> items {</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E">? itemId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> item.LINE_ITEM.Line_item_identifier;</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> itemId </span><span style="color:#D73A49">is</span><span style="color:#24292E"> () {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#032F62">"Item ID is not given"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        ItemData itemData </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {itemId};</span></span>
<span class="line"><span style="color:#24292E">        mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">QUANTITY_Type[] quantities </span><span style="color:#D73A49">=</span><span style="color:#24292E"> item.QUANTITY;</span></span>
<span class="line"><span style="color:#D73A49">        foreach </span><span style="color:#24292E">mREQOTE</span><span style="color:#D73A49">:</span><span style="color:#24292E">QUANTITY_Type quantity </span><span style="color:#D73A49">in</span><span style="color:#24292E"> quantities {</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> quantity.QUANTITY_DETAILS.Quantity_type_code_qualifier </span><span style="color:#D73A49">==</span><span style="color:#032F62"> "21"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">                int</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> amount </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> int</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">fromString</span><span style="color:#24292E">(quantity.QUANTITY_DETAILS.Quantity);</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> amount </span><span style="color:#D73A49">is</span><span style="color:#D73A49"> error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">                    return</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#032F62">"Quantity must be a valid number."</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">                itemData.quantity </span><span style="color:#D73A49">=</span><span style="color:#24292E"> amount;</span></span>
<span class="line"><span style="color:#D73A49">                break</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        quoteRequest.itemData.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(</span><span style="color:#E36209">itemData</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> quoteRequest;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> streamToString</span><span style="color:#24292E">(</span><span style="color:#D73A49">stream&#x3C;</span><span style="color:#005CC5">byte</span><span style="color:#24292E">[] </span><span style="color:#D73A49">&#x26;</span><span style="color:#D73A49"> readonly</span><span style="color:#24292E">, </span><span style="color:#E36209">io</span><span style="color:#D73A49">:</span><span style="color:#24292E">Error?</span><span style="color:#D73A49">></span><span style="color:#E36209"> inStream</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> string</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">    byte</span><span style="color:#24292E">[] content </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#D73A49">    check</span><span style="color:#24292E"> inStream.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#D73A49">function</span><span style="color:#24292E"> (</span><span style="color:#005CC5">byte</span><span style="color:#24292E">[] </span><span style="color:#D73A49">&#x26;</span><span style="color:#D73A49"> readonly</span><span style="color:#E36209"> chunk</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        content.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(...</span><span style="color:#E36209">chunk</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#005CC5"> string</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">fromBytes</span><span style="color:#24292E">(</span><span style="color:#E36209">content</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div><div role="tabpanel" id="react-aria1757827008-2-tabpane-diagram" aria-labelledby="react-aria1757827008-2-tab-diagram" class="fade tab-pane"><div class="text-center mdContent col-lg-6 col-12"><img src="/images/pre-built/sequence-diagrams/ftp-edi-message-to-salesforce-opportunity.png" alt="Sequence Diagram"/></div></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"samples":{"code":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/file;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/ftp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/io;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerinax/edifact.d03a.retail.mREQOTE;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerinax/salesforce \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eas\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e sf;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ftp\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClientConfiguration ftpConfig \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ftpNewQuotesPath \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ftpProcessedQuotesPath \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e sf\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eConnectionConfig salesforceConfig \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforcePriceBookId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003epublic\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e main\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    sf\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient salesforce \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003esalesforceConfig\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    ftp\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient fileServer \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ftp\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eClient\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eftpConfig\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e    // Get new quotes from the FTP new quotes directory, and iterate through them.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    ftp\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eFileInfo[] quoteList \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e fileServer\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003elist\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eftpNewQuotesPath\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eftp\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eFileInfo quoteFile \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quoteList {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e !\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003equoteFile.name.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eendsWith\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\".edi\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            continue\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e        // Fetch the EDI file containing the quote from the FTP server.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        stream\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003ebyte\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e readonly\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, io\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eError?\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e fileStream \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e fileServer\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(quoteFile.path);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quoteText \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e streamToString\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003efileStream\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e        // Parse the EDI file and transform in to Ballerina record containing only the required data.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        mREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eEDI_REQOTE_Request_for_quote_message quote \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003efromEdiString\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003equoteText\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        QuoteRequest quoteRequest \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e transformQuoteRequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003equote\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e        // Get the corresponding account Id and oppurtunity Id from Salesforce.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e        // Create a new Opportunity if an Opportunity with the given name does not exist. \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        stream\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eId, \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eerror?\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e accQuery \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforce\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003equery\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e            string\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e `SELECT Id FROM Account WHERE Name = '${\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003equoteRequest\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eaccountName\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e}'`\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eId value;\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e account \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e accQuery.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003enext\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e accQuery.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eclose\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e account \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Account not found. Account name: \"\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e +\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quoteRequest.accountName);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        Opportunity opp \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            Name\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quoteRequest.oppName,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            AccountId\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e account.value.Id,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            Pricebook2Id\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforcePriceBookId\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        stream\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eId, \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eerror?\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppQuery \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforce\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003equery\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e            string\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e `SELECT Id FROM Opportunity WHERE Name = '${\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003equoteRequest\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eoppName\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e}'`\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eId value;\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e existingOpp \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppQuery.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003enext\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppQuery.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eclose\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e existingOpp \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            sf\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eCreationResponse oppResult \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforce\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003ecreate\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Opportunity\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eopp\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            oppId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppResult.id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        } \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eelse\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            oppId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e existingOpp.value.Id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e        // Create Opportunity line items for each item in the quote.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eItemData item \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quoteRequest.itemData {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            stream\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003ePriceBookEntry, \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eerror?\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e query \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforce\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003equery\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e              string\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e `SELECT UnitPrice FROM PricebookEntry WHERE Pricebook2Id = '01s6C000000UN4PQAW' AND Product2Id = '${\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eitem\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eitemId\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e}'`\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003ePriceBookEntry value;\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e unionResult \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e query.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003enext\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e query.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eclose\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e unionResult \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e `Pricebook entry not found. Opportunity name: ${\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003equoteRequest\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eoppName\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e}, Item ID: ${\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eitem\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eitemId\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e}`\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            OpportunityProduct oppProduct \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                OpportunityId\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppId,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                Product2Id\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e item.itemId,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                Quantity\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e item.quantity,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                UnitPrice\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e unionResult.value.UnitPrice\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            _ \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforce\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003ecreate\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"OpportunityLineItem\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eoppProduct\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6A737D\"\u003e        // Move the processed quote to the processed quotes FTP directory.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e fileServer\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003echeck\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e file\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003ejoinPath\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eftpProcessedQuotesPath\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, quoteFile.name), quoteText.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003etoBytes\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e fileServer\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003edelete\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(quoteFile.path);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e transformQuoteRequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003emREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eEDI_REQOTE_Request_for_quote_message quote) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e QuoteRequest\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    QuoteRequest quoteRequest \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {accountName\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, oppName\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    mREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eSegment_group_1_GType[] segmentGroup1 \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quote.Segment_group_1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003emREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eSegment_group_1_GType ref \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e segmentGroup1 {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ref.REFERENCE.REFERENCE.Reference_code_qualifier \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"AES\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e            string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e? oppId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ref.REFERENCE.REFERENCE.Reference_identifier;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Opportunity ID is not given\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            quoteRequest.oppName \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e oppId;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    mREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eSegment_group_11_GType[] segmentGroup11 \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quote.Segment_group_11;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003emREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eSegment_group_11_GType party \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e segmentGroup11 {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e party.NAME_AND_ADDRESS.Party_function_code_qualifier \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"BY\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e            string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e? prospectId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e party.NAME_AND_ADDRESS?.PARTY_IDENTIFICATION_DETAILS?.Party_identifier;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e prospectId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Prospect identifier not available in quote.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            quoteRequest.accountName \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e prospectId;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    mREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eSegment_group_27_GType[] items \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quote.Segment_group_27;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003emREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eSegment_group_27_GType item \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e items {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e? itemId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e item.LINE_ITEM.Line_item_identifier;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e itemId \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Item ID is not given\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        ItemData itemData \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {itemId};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        mREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eQUANTITY_Type[] quantities \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e item.QUANTITY;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003emREQOTE\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eQUANTITY_Type quantity \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quantities {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quantity.QUANTITY_DETAILS.Quantity_type_code_qualifier \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"21\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e                int\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e amount \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e int\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003efromString\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(quantity.QUANTITY_DETAILS.Quantity);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e amount \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                    return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Quantity must be a valid number.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                itemData.quantity \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                break\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        quoteRequest.itemData.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epush\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eitemData\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e quoteRequest;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e streamToString\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003estream\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003ebyte\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e readonly\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eio\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eError?\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e inStream\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    byte\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] content \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e [];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e inStream.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eforEach\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003ebyte\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e readonly\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e chunk\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        content.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epush\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(...\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003echunk\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003efromBytes\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003econtent\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"},"content":"\nimport ballerina/file;\nimport ballerina/ftp;\nimport ballerina/io;\n\nimport ballerinax/edifact.d03a.retail.mREQOTE;\nimport ballerinax/salesforce as sf;\n\nconfigurable ftp:ClientConfiguration ftpConfig = ?;\nconfigurable string ftpNewQuotesPath = ?;\nconfigurable string ftpProcessedQuotesPath = ?;\nconfigurable sf:ConnectionConfig salesforceConfig = ?;\nconfigurable string salesforcePriceBookId = ?;\n\npublic function main() returns error? {\n    sf:Client salesforce = check new (salesforceConfig);\n    ftp:Client fileServer = check new ftp:Client(ftpConfig);\n\n    // Get new quotes from the FTP new quotes directory, and iterate through them.\n    ftp:FileInfo[] quoteList = check fileServer-\u003elist(ftpNewQuotesPath);\n    foreach ftp:FileInfo quoteFile in quoteList {\n        if !quoteFile.name.endsWith(\".edi\") {\n            continue;\n        }\n\n        // Fetch the EDI file containing the quote from the FTP server.\n        stream\u003cbyte[] \u0026 readonly, io:Error?\u003e fileStream = check fileServer-\u003eget(quoteFile.path);\n        string quoteText = check streamToString(fileStream);\n\n        // Parse the EDI file and transform in to Ballerina record containing only the required data.\n        mREQOTE:EDI_REQOTE_Request_for_quote_message quote = check mREQOTE:fromEdiString(quoteText);\n        QuoteRequest quoteRequest = check transformQuoteRequest(quote);\n\n        // Get the corresponding account Id and oppurtunity Id from Salesforce.\n        // Create a new Opportunity if an Opportunity with the given name does not exist. \n        stream\u003cId, error?\u003e accQuery = check salesforce-\u003equery(\n            string `SELECT Id FROM Account WHERE Name = '${quoteRequest.accountName}'`);\n        record {|Id value;|}? account = check accQuery.next();\n        check accQuery.close();\n        if account is () {\n            return error(\"Account not found. Account name: \" + quoteRequest.accountName);\n        }\n        Opportunity opp = {\n            Name: quoteRequest.oppName,\n            AccountId: account.value.Id,\n            Pricebook2Id: salesforcePriceBookId\n        };\n        string oppId = \"\";\n        stream\u003cId, error?\u003e oppQuery = check salesforce-\u003equery(\n            string `SELECT Id FROM Opportunity WHERE Name = '${quoteRequest.oppName}'`);\n        record {|Id value;|}? existingOpp = check oppQuery.next();\n        check oppQuery.close();\n        if existingOpp is () {\n            sf:CreationResponse oppResult = check salesforce-\u003ecreate(\"Opportunity\", opp);\n            oppId = oppResult.id;\n        } else {\n            oppId = existingOpp.value.Id;\n        }\n\n        // Create Opportunity line items for each item in the quote.\n        foreach ItemData item in quoteRequest.itemData {\n            stream\u003cPriceBookEntry, error?\u003e query = check salesforce-\u003equery(\n              string `SELECT UnitPrice FROM PricebookEntry WHERE Pricebook2Id = '01s6C000000UN4PQAW' AND Product2Id = '${item.itemId}'`);\n            record {|PriceBookEntry value;|}? unionResult = check query.next();\n            check query.close();\n            if unionResult is () {\n                return error(string `Pricebook entry not found. Opportunity name: ${quoteRequest.oppName}, Item ID: ${item.itemId}`);\n            }\n            OpportunityProduct oppProduct = {\n                OpportunityId: oppId,\n                Product2Id: item.itemId,\n                Quantity: item.quantity,\n                UnitPrice: unionResult.value.UnitPrice\n            };\n            _ = check salesforce-\u003ecreate(\"OpportunityLineItem\", oppProduct);\n        }\n\n        // Move the processed quote to the processed quotes FTP directory.\n        check fileServer-\u003eput(check file:joinPath(ftpProcessedQuotesPath, quoteFile.name), quoteText.toBytes());\n        check fileServer-\u003edelete(quoteFile.path);\n    }\n}\n\nfunction transformQuoteRequest(mREQOTE:EDI_REQOTE_Request_for_quote_message quote) returns QuoteRequest|error {\n    QuoteRequest quoteRequest = {accountName: \"\", oppName: \"\"};\n    mREQOTE:Segment_group_1_GType[] segmentGroup1 = quote.Segment_group_1;\n    foreach mREQOTE:Segment_group_1_GType ref in segmentGroup1 {\n        if ref.REFERENCE.REFERENCE.Reference_code_qualifier == \"AES\" {\n            string? oppId = ref.REFERENCE.REFERENCE.Reference_identifier;\n            if oppId is () {\n                return error(\"Opportunity ID is not given\");\n            }\n            quoteRequest.oppName = oppId;\n        }\n    }\n    mREQOTE:Segment_group_11_GType[] segmentGroup11 = quote.Segment_group_11;\n    foreach mREQOTE:Segment_group_11_GType party in segmentGroup11 {\n        if party.NAME_AND_ADDRESS.Party_function_code_qualifier == \"BY\" {\n            string? prospectId = party.NAME_AND_ADDRESS?.PARTY_IDENTIFICATION_DETAILS?.Party_identifier;\n            if prospectId is () {\n                return error(\"Prospect identifier not available in quote.\");\n            }\n            quoteRequest.accountName = prospectId;\n        }\n    }\n    mREQOTE:Segment_group_27_GType[] items = quote.Segment_group_27;\n    foreach mREQOTE:Segment_group_27_GType item in items {\n        string? itemId = item.LINE_ITEM.Line_item_identifier;\n        if itemId is () {\n            return error(\"Item ID is not given\");\n        }\n        ItemData itemData = {itemId};\n        mREQOTE:QUANTITY_Type[] quantities = item.QUANTITY;\n        foreach mREQOTE:QUANTITY_Type quantity in quantities {\n            if quantity.QUANTITY_DETAILS.Quantity_type_code_qualifier == \"21\" {\n                int|error amount = int:fromString(quantity.QUANTITY_DETAILS.Quantity);\n                if amount is error {\n                    return error(\"Quantity must be a valid number.\");\n                }\n                itemData.quantity = amount;\n                break;\n            }\n        }\n        quoteRequest.itemData.push(itemData);\n    }\n    return quoteRequest;\n}\n\nfunction streamToString(stream\u003cbyte[] \u0026 readonly, io:Error?\u003e inStream) returns string|error {\n    byte[] content = [];\n    check inStream.forEach(function (byte[] \u0026 readonly chunk) {\n        content.push(...chunk);\n    });\n    return string:fromBytes(content);\n}\n    \n"},"__N_SSG":true},"page":"/learn/integration/pre-built-integrations/ftp-edi-message-to-salesforce-opportunity","query":{},"buildId":"-qAIOSe9lKRLgNxhpgGY8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>