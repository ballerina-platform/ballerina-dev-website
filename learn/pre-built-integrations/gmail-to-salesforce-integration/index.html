<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="Create a lead for each new marketing email in Gmail"/><meta name="author" content="WSO2 LLC"/><meta name="keywords" content="ballerina, learn, documentation, docs, programming language"/><link rel="shortcut icon" href="/img/favicon.ico"/><title>Gmail to Salesforce integration - The Ballerina programming language</title><meta property="og:type" content="article"/><meta property="og:title" content="Gmail to Salesforce integration - The Ballerina programming language"/><meta property="og:description" content="Create a lead for each new marketing email in Gmail"/><meta property="og:title" content="Gmail to Salesforce integration - The Ballerina programming language"/><meta property="og:image" content="https://ballerina.io/images/ballerina-swan-lake-pre-built-integrations-sm-banner.png"/><meta property="og:description" itemProp="image" content="Create a lead for each new marketing email in Gmail"/><meta name="twitter:site" content="@ballerinalang"/><meta name="twitter:creator" content="@ballerinalang"/><meta name="twitter:title" content="Gmail to Salesforce integration - The Ballerina programming language"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:description" content="Create a lead for each new marketing email in Gmail"/><meta name="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-pre-built-integrations-sm-banner.png"/><meta property="twitter:text:description" content="Create a lead for each new marketing email in Gmail"/><meta property="twitter:image" content="https://ballerina.io/images/ballerina-swan-lake-pre-built-integrations-sm-banner.png"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.setAttributeNode(d.createAttribute('data-ot-ignore'));j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PSL2TX4');</script><script type="text/javascript" crossorigin="true" src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script><script src="https://cookie-cdn.cookiepro.com/scripttemplates/otSDKStub.js" type="text/javascript" charSet="UTF-8" data-domain-script="630ad396-5fd5-4745-92ae-2765dc8841ee" defer=""></script><meta name="next-head-count" content="25"/><meta charSet="utf-8"/><meta name="author" content="WSO2 LLC"/><meta http-equiv="X-Frame-Options" content="SAMEORIGIN"/><meta http-equiv="Content-Security-Policy" content="frame-ancestors &#x27;none&#x27;;"/><link rel="shortcut icon" href="/images/favicon.ico"/><link rel="stylesheet" href="/css/roboto.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><link rel="stylesheet" href="/css/ballerina-search-button.css"/><link rel="stylesheet" href="/css/ballerina-search-modal.css"/><link rel="stylesheet" href="/css/ballerina-search-variables.css"/><link rel="stylesheet" href="/css/ballerina-search-style.css"/><link rel="preload" href="/_next/static/css/a065b6d8130f9c90.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a065b6d8130f9c90.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a0536ea4046d7fff.js" defer=""></script><script src="/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/_next/static/chunks/main-0ea70f422df5d19e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba2391f08766dae9.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-07afe3a69e1ba759.js" defer=""></script><script src="/_next/static/chunks/7621-d6bcd83f463fef72.js" defer=""></script><script src="/_next/static/chunks/8130-4f833ffdbe1dba0f.js" defer=""></script><script src="/_next/static/chunks/6242-7c6681de385c0d0b.js" defer=""></script><script src="/_next/static/chunks/1726-d958e891b50f9478.js" defer=""></script><script src="/_next/static/chunks/5338-dccc879a3d3558fe.js" defer=""></script><script src="/_next/static/chunks/pages/learn/integration/pre-built-integrations/gmail-to-salesforce-integration-71f6338bca94016c.js" defer=""></script><script src="/_next/static/23ZwTRpyIgwinO4PkUAnm/_buildManifest.js" defer=""></script><script src="/_next/static/23ZwTRpyIgwinO4PkUAnm/_ssgManifest.js" defer=""></script><script src="/_next/static/23ZwTRpyIgwinO4PkUAnm/_middlewareManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSL2TX4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next" data-reactroot=""><div class="main-wrapper other vstack gap-0"><div class="wrap-page-content" style="padding-bottom:0"><div class="community-wrap-row row"><div class="col-sm-12"><div class="pageContentRow llanding pb-0 row"><div class="col-12"><div class="container"><div class="row"><div class="patternContent col-12"><div class="backToLanding" href="/learn/pre-built-integrations/"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#3ad1ca" class="bi bi-box-arrow-left ms-0" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"></path><path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"></path></svg><p class="m-0 p-0">Back to pre-built integrations</p></div></div></div></div></div></div><div class="pageHeader pageContentRow llanding row"><div class="col-12"><div class="container"><h1>Gmail to Salesforce integration</h1></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><div class="row"><div style="font-size:18px" class="col-lg-6 col-12"><p>In today&#x27;s fast-paced business landscape, effective customer relationship management (CRM) has become a linchpin of success. Salesforce, a leading CRM platform, empowers organizations to streamline their sales, marketing, and customer support efforts, providing invaluable insights into customer interactions. However, to truly harness the full potential of Salesforce, seamless integration with essential communication tools like email clients is imperative.</p><p>The example below demonstrates how to integrate Gmail and Salesforce to create new leads in Salesforce for each new marketing email.</p></div><div class="text-center mdContent col-lg-6 col-12"><img src="/images/pre-built/flow_diagrams/gmail-to-salesforce-integration.png" alt="Flow Diagram"/></div></div></div></div></div><div class="pageContentRow llanding row"><div class="col-12"><div class="container"><ul class="mb-3 preBuilt nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><button type="button" id="react-aria3831785849-1-tab-code" role="tab" data-rr-ui-event-key="code" aria-controls="react-aria3831785849-1-tabpane-code" aria-selected="true" class="nav-link active">Code</button></li><li class="nav-item" role="presentation"><button type="button" id="react-aria3831785849-1-tab-diagram" role="tab" data-rr-ui-event-key="diagram" aria-controls="react-aria3831785849-1-tabpane-diagram" aria-selected="false" tabindex="-1" class="nav-link">Diagram</button></li></ul><div class="tab-content"><div role="tabpanel" id="react-aria3831785849-1-tabpane-code" aria-labelledby="react-aria3831785849-1-tab-code" class="fade tab-pane active show"><div style="background:#eeeeee;padding:10px;border-radius:5px;margin-top:20px;background-color:#eeeeee !important"><div style="display:flex;justify-content:end"><a href="https://github.com/ballerina-guides/integration-samples/tree/main/gmail-to-salesforce-lead" target="_blank" rel="noreferrer" title="Open on GitHub" style="margin-top:-5px"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" style="color:black;margin-right:10px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"></path></svg></div><div class="highlight"><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/lang.runtime;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/log;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerina/mime;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerinax/googleapis.gmail;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerinax/openai.chat;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ballerinax/salesforce </span><span style="color:#D73A49">as</span><span style="color:#24292E"> sf;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Email</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> 'from;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> subject;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> body;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Name</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> firstName__c;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> lastName__c;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Lead</span><span style="color:#D73A49"> record</span><span style="color:#24292E"> {</span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#D73A49">    *</span><span style="color:#24292E">Name;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> email__c;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> phoneNumber__c;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> company__c;</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E"> designation__c;</span></span>
<span class="line"><span style="color:#D73A49">|</span><span style="color:#24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> gmailAccessToken </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> openAIKey </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> salesforceBaseUrl </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">configurable</span><span style="color:#005CC5"> string</span><span style="color:#24292E"> salesforceAccessToken </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> ?</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">const </span><span style="color:#005CC5">LABEL</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Lead"</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">final</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client gmail </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> ({auth</span><span style="color:#D73A49">:</span><span style="color:#24292E"> {token: gmailAccessToken}});</span></span>
<span class="line"><span style="color:#D73A49">final</span><span style="color:#24292E"> chat</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client openAiChat </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> ({auth</span><span style="color:#D73A49">:</span><span style="color:#24292E"> {token: openAIKey}});</span></span>
<span class="line"><span style="color:#D73A49">final</span><span style="color:#24292E"> sf</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client salesforce </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> ({baseUrl</span><span style="color:#D73A49">:</span><span style="color:#24292E"> salesforceBaseUrl, auth</span><span style="color:#D73A49">:</span><span style="color:#24292E"> {token: salesforceAccessToken}});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> main</span><span style="color:#24292E">() </span><span style="color:#D73A49">returns</span><span style="color:#D73A49"> error?</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    while</span><span style="color:#D73A49"> true</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        Email[] emails </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> getEmails</span><span style="color:#24292E">(</span><span style="color:#E36209">LABEL</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        Lead[] leads </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> from</span><span style="color:#24292E"> Email email </span><span style="color:#D73A49">in</span><span style="color:#24292E"> emails</span></span>
<span class="line"><span style="color:#D73A49">                       let</span><span style="color:#24292E"> Lead</span><span style="color:#D73A49">?</span><span style="color:#24292E"> lead </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> generateLead</span><span style="color:#24292E">(</span><span style="color:#E36209">email</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">                       where</span><span style="color:#24292E"> lead </span><span style="color:#D73A49">is</span><span style="color:#24292E"> Lead</span></span>
<span class="line"><span style="color:#D73A49">                       select</span><span style="color:#24292E"> lead;</span></span>
<span class="line"><span style="color:#6F42C1">        addLeadsToSalesforce</span><span style="color:#24292E">(</span><span style="color:#E36209">leads</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        runtime</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">sleep</span><span style="color:#24292E">(</span><span style="color:#005CC5">600</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> getEmails</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#E36209"> label</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> Email[]</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">    string</span><span style="color:#24292E">[] labelIdsToMatch </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> getLabelIds</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#24292E">, [label]);</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> labelIdsToMatch.</span><span style="color:#6F42C1">length</span><span style="color:#24292E">() </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> 0</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#032F62">"Unable to find any labels to match."</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread[] matchingMailThreads </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#6F42C1"> getMatchingMailThreads</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#24292E">, </span><span style="color:#E36209">labelIdsToMatch</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#6F42C1">    removeLabels</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#24292E">, </span><span style="color:#E36209">matchingMailThreads</span><span style="color:#24292E">, </span><span style="color:#E36209">labelIdsToMatch</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message[] matchingEmails </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> getMatchingEmails</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#24292E">, </span><span style="color:#E36209">matchingMailThreads</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#D73A49"> from</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message message </span><span style="color:#D73A49">in</span><span style="color:#24292E"> matchingEmails</span></span>
<span class="line"><span style="color:#D73A49">           let</span><span style="color:#24292E"> Email</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> email </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> parseEmail</span><span style="color:#24292E">(</span><span style="color:#E36209">message</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">           where</span><span style="color:#24292E"> email </span><span style="color:#D73A49">is</span><span style="color:#24292E"> Email</span></span>
<span class="line"><span style="color:#D73A49">           select</span><span style="color:#24292E"> email;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> getLabelIds</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client gmail, </span><span style="color:#005CC5">string</span><span style="color:#24292E">[] </span><span style="color:#E36209">labelsToMatch</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#005CC5"> string</span><span style="color:#24292E">[]</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">LabelList labelList </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">listLabels</span><span style="color:#24292E">(</span><span style="color:#032F62">"me"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#D73A49"> from</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Label {name, id} </span><span style="color:#D73A49">in</span><span style="color:#24292E"> labelList.labels</span></span>
<span class="line"><span style="color:#D73A49">           where</span><span style="color:#24292E"> labelsToMatch.</span><span style="color:#6F42C1">indexOf</span><span style="color:#24292E">(</span><span style="color:#E36209">name</span><span style="color:#24292E">) </span><span style="color:#D73A49">!=</span><span style="color:#24292E"> ()</span></span>
<span class="line"><span style="color:#D73A49">           select</span><span style="color:#24292E"> id;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> getMatchingMailThreads</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client gmail, </span><span style="color:#005CC5">string</span><span style="color:#24292E">[] </span><span style="color:#E36209">labelIdsToMatch</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread[]</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MsgSearchFilter searchFilter </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        includeSpamTrash</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> false</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">        labelIds</span><span style="color:#D73A49">:</span><span style="color:#24292E"> labelIdsToMatch</span></span>
<span class="line"><span style="color:#24292E">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#D73A49"> from</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread mailThread </span><span style="color:#D73A49">in</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> gmail-</span><span style="color:#D73A49">></span><span style="color:#6F42C1">listThreads</span><span style="color:#24292E">(</span><span style="color:#E36209">filter</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> searchFilter)</span></span>
<span class="line"><span style="color:#D73A49">           select</span><span style="color:#24292E"> mailThread;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> removeLabels</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client gmail, </span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread[] mailThreads, </span><span style="color:#005CC5">string</span><span style="color:#24292E">[] </span><span style="color:#E36209">labelIds</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">    foreach </span><span style="color:#24292E">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread mailThread </span><span style="color:#D73A49">in</span><span style="color:#24292E"> mailThreads {</span></span>
<span class="line"><span style="color:#24292E">        gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> removeLabelResponse </span><span style="color:#D73A49">=</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">modifyThread</span><span style="color:#24292E">(mailThread.id, [], </span><span style="color:#E36209">labelIds</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> removeLabelResponse </span><span style="color:#D73A49">is</span><span style="color:#D73A49"> error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            log</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">printError</span><span style="color:#24292E">(</span><span style="color:#032F62">"An error occured in removing the labels from the thread."</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#E36209">                removeLabelResponse</span><span style="color:#24292E">, removeLabelResponse.</span><span style="color:#6F42C1">stackTrace</span><span style="color:#24292E">(), </span><span style="color:#E36209">threadId</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> mailThread.id, </span><span style="color:#E36209">labelIds</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> labelIds);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> getMatchingEmails</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Client gmail, </span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread[] mailThreads) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message[] {</span></span>
<span class="line"><span style="color:#24292E">    gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message[] messages </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    foreach </span><span style="color:#24292E">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread mailThread </span><span style="color:#D73A49">in</span><span style="color:#24292E"> mailThreads {</span></span>
<span class="line"><span style="color:#24292E">        gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MailThread</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> response </span><span style="color:#D73A49">=</span><span style="color:#24292E"> gmail</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">readThread</span><span style="color:#24292E">(mailThread.id);</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> response </span><span style="color:#D73A49">is</span><span style="color:#D73A49"> error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            log</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">printError</span><span style="color:#24292E">(</span><span style="color:#032F62">"An error occured while reading the email."</span><span style="color:#24292E">, </span></span>
<span class="line"><span style="color:#E36209">                response</span><span style="color:#24292E">, response.</span><span style="color:#6F42C1">stackTrace</span><span style="color:#24292E">(), </span><span style="color:#E36209">threadId</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> mailThread.id);</span></span>
<span class="line"><span style="color:#D73A49">            continue</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#D73A49"> !</span><span style="color:#24292E">(response.messages </span><span style="color:#D73A49">is</span><span style="color:#E36209"> gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message[]) </span><span style="color:#D73A49">||</span><span style="color:#24292E"> (</span><span style="color:#D73A49">&#x3C;</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message[]</span><span style="color:#D73A49">></span><span style="color:#24292E">response.messages).</span><span style="color:#6F42C1">length</span><span style="color:#24292E">() </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 1</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            log</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">printError</span><span style="color:#24292E">(</span><span style="color:#032F62">"Unable to find any messages in the thread."</span><span style="color:#24292E">, </span><span style="color:#E36209">threadId</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> mailThread.id);</span></span>
<span class="line"><span style="color:#D73A49">            continue</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        messages.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">((</span><span style="color:#D73A49">&#x3C;</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message[]</span><span style="color:#D73A49">></span><span style="color:#24292E">response.messages)[</span><span style="color:#005CC5">0</span><span style="color:#24292E">]);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> messages;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> parseEmail</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">Message message) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> Email</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    do</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MessageBodyPart bodyPart </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> message.emailBodyInText.</span><span style="color:#6F42C1">ensureType</span><span style="color:#24292E">(</span><span style="color:#E36209">gmail</span><span style="color:#D73A49">:</span><span style="color:#24292E">MessageBodyPart);</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E"> bodyPartText </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> bodyPart.data.</span><span style="color:#6F42C1">ensureType</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E"> body </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> mime</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">base64Decode</span><span style="color:#24292E">(</span><span style="color:#E36209">bodyPartText</span><span style="color:#24292E">).</span><span style="color:#6F42C1">ensureType</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            'from</span><span style="color:#D73A49">:</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> message.headerFrom.</span><span style="color:#6F42C1">ensureType</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#24292E">),</span></span>
<span class="line"><span style="color:#24292E">            subject</span><span style="color:#D73A49">:</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> message.headerSubject.</span><span style="color:#6F42C1">ensureType</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#24292E">),</span></span>
<span class="line"><span style="color:#24292E">            body</span><span style="color:#D73A49">:</span><span style="color:#24292E"> body</span></span>
<span class="line"><span style="color:#24292E">        };</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">on</span><span style="color:#D73A49"> fail</span><span style="color:#D73A49"> error</span><span style="color:#24292E"> e {</span></span>
<span class="line"><span style="color:#24292E">        log</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">printError</span><span style="color:#24292E">(</span><span style="color:#032F62">"An error occured while parsing the email."</span><span style="color:#24292E">, </span><span style="color:#E36209">e</span><span style="color:#24292E">, e.</span><span style="color:#6F42C1">stackTrace</span><span style="color:#24292E">(), </span><span style="color:#E36209">message</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> message);</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> e;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> generateLead</span><span style="color:#24292E">(</span><span style="color:#E36209">Email</span><span style="color:#E36209"> email</span><span style="color:#24292E">) </span><span style="color:#D73A49">returns</span><span style="color:#24292E"> Lead</span><span style="color:#D73A49">?</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    chat</span><span style="color:#D73A49">:</span><span style="color:#24292E">CreateChatCompletionRequest request </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        model</span><span style="color:#D73A49">:</span><span style="color:#032F62"> "gpt-3.5-turbo"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">        messages</span><span style="color:#D73A49">:</span><span style="color:#24292E"> [</span></span>
<span class="line"><span style="color:#24292E">            {</span></span>
<span class="line"><span style="color:#6F42C1">                role</span><span style="color:#24292E">: </span><span style="color:#032F62">"user"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#6F42C1">                content</span><span style="color:#24292E">: </span><span style="color:#005CC5">string</span><span style="color:#24292E"> `</span></span>
<span class="line"><span style="color:#24292E">            Extract the following details in JSON from the email.</span></span>
<span class="line"><span style="color:#24292E">                {</span></span>
<span class="line"><span style="color:#6F42C1">                    firstName__c</span><span style="color:#24292E">: </span><span style="color:#005CC5">string</span><span style="color:#24292E">, </span><span style="color:#6A737D">// Mandatory</span></span>
<span class="line"><span style="color:#6F42C1">                    lastName__c</span><span style="color:#24292E">: </span><span style="color:#005CC5">string</span><span style="color:#24292E">, </span><span style="color:#6A737D">// Mandatory</span></span>
<span class="line"><span style="color:#6F42C1">                    email__c</span><span style="color:#24292E">: </span><span style="color:#005CC5">string</span><span style="color:#6A737D"> // Mandatory</span></span>
<span class="line"><span style="color:#6F42C1">                    phoneNumber__c</span><span style="color:#24292E">: </span><span style="color:#005CC5">string</span><span style="color:#24292E">, </span><span style="color:#6A737D">// With country code. Use N/A if unable to find</span></span>
<span class="line"><span style="color:#6F42C1">                    company__c</span><span style="color:#24292E">: </span><span style="color:#005CC5">string</span><span style="color:#24292E">, </span><span style="color:#6A737D">// Mandatory</span></span>
<span class="line"><span style="color:#6F42C1">                    designation__c</span><span style="color:#24292E">: </span><span style="color:#005CC5">string</span><span style="color:#6A737D"> // Not mandatory. Use N/A if unable to find</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">            Here is the </span><span style="color:#6F42C1">email</span><span style="color:#24292E">:    </span></span>
<span class="line"><span style="color:#24292E">            {</span></span>
<span class="line"><span style="color:#6F42C1">                from</span><span style="color:#24292E">: ${email.'from},</span></span>
<span class="line"><span style="color:#6F42C1">                subject</span><span style="color:#24292E">: ${email.subject},</span></span>
<span class="line"><span style="color:#6F42C1">                body</span><span style="color:#24292E">: ${email.body}</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        `</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        ]</span></span>
<span class="line"><span style="color:#24292E">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    do</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        chat</span><span style="color:#D73A49">:</span><span style="color:#24292E">CreateChatCompletionResponse response </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> openAiChat</span><span style="color:#D73A49">->/</span><span style="color:#24292E">chat</span><span style="color:#D73A49">/</span><span style="color:#24292E">completions.</span><span style="color:#6F42C1">post</span><span style="color:#24292E">(</span><span style="color:#E36209">request</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> response.choices.</span><span style="color:#6F42C1">length</span><span style="color:#24292E">() </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 1</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">            check</span><span style="color:#D73A49"> error</span><span style="color:#24292E">(</span><span style="color:#032F62">"Unable to find any choices in the response."</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#005CC5">        string</span><span style="color:#24292E"> content </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> response.choices[</span><span style="color:#005CC5">0</span><span style="color:#24292E">].message?.content.</span><span style="color:#6F42C1">ensureType</span><span style="color:#24292E">(</span><span style="color:#005CC5">string</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#D73A49"> check</span><span style="color:#24292E"> content.</span><span style="color:#6F42C1">fromJsonStringWithType</span><span style="color:#24292E">(</span><span style="color:#E36209">Lead</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">on</span><span style="color:#D73A49"> fail</span><span style="color:#D73A49"> error</span><span style="color:#24292E"> e {</span></span>
<span class="line"><span style="color:#24292E">        log</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">printError</span><span style="color:#24292E">(</span><span style="color:#032F62">"An error occured while generating the lead."</span><span style="color:#24292E">, </span><span style="color:#E36209">e</span><span style="color:#24292E">, e.</span><span style="color:#6F42C1">stackTrace</span><span style="color:#24292E">(), </span><span style="color:#E36209">email</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> email);</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> addLeadsToSalesforce</span><span style="color:#24292E">(</span><span style="color:#E36209">Lead</span><span style="color:#24292E">[] </span><span style="color:#E36209">leads</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">    from</span><span style="color:#24292E"> Lead lead </span><span style="color:#D73A49">in</span><span style="color:#24292E"> leads</span></span>
<span class="line"><span style="color:#D73A49">    do</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        sf</span><span style="color:#D73A49">:</span><span style="color:#24292E">CreationResponse</span><span style="color:#D73A49">|error</span><span style="color:#24292E"> createResponse </span><span style="color:#D73A49">=</span><span style="color:#24292E"> salesforce</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">create</span><span style="color:#24292E">(</span><span style="color:#032F62">"EmailLead__c"</span><span style="color:#24292E">, </span><span style="color:#E36209">lead</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> createResponse </span><span style="color:#D73A49">is</span><span style="color:#D73A49"> error</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            log</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">printError</span><span style="color:#24292E">(</span><span style="color:#032F62">"An error occured while creating a Lead object on salesforce."</span><span style="color:#24292E">, </span></span>
<span class="line"><span style="color:#E36209">                createResponse</span><span style="color:#24292E">, createResponse.</span><span style="color:#6F42C1">stackTrace</span><span style="color:#24292E">(), </span><span style="color:#E36209">lead</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> lead);</span></span>
<span class="line"><span style="color:#24292E">        } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            log</span><span style="color:#D73A49">:</span><span style="color:#6F42C1">printInfo</span><span style="color:#24292E">(</span><span style="color:#032F62">"Lead successfully created."</span><span style="color:#24292E">, </span><span style="color:#E36209">lead</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> lead);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    };</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div><div role="tabpanel" id="react-aria3831785849-1-tabpane-diagram" aria-labelledby="react-aria3831785849-1-tab-diagram" class="fade tab-pane"><div class="text-center mdContent col-lg-6 col-12"><img src="/images/pre-built/sequence-diagrams/gmail-to-salesforce-integration.png" alt="Sequence Diagram"/></div></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"samples":{"code":"\u003cpre class=\"shiki github-light\" style=\"background-color:#fff;color:#24292e\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/lang.runtime;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/log;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerina/mime;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerinax/googleapis.gmail;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerinax/openai.chat;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ballerinax/salesforce \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eas\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e sf;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e Email\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e 'from;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e subject;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e body;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e Name\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e firstName__c;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e lastName__c;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e Lead\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e record\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    *\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eName;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e email__c;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e phoneNumber__c;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e company__c;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e designation__c;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmailAccessToken \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e openAIKey \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforceBaseUrl \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econfigurable\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforceAccessToken \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003econst \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003eLABEL\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"Lead\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efinal\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient gmail \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ({auth\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {token: gmailAccessToken}});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efinal\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e chat\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient openAiChat \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ({auth\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {token: openAIKey}});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efinal\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e sf\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient salesforce \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ({baseUrl\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforceBaseUrl, auth\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {token: salesforceAccessToken}});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003epublic\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e main\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    while\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e true\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        Email[] emails \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getEmails\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eLABEL\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        Lead[] leads \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e from\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Email email \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e emails\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                       let\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Lead\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e lead \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e generateLead\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eemail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                       where\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e lead \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Lead\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e                       select\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e lead;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e        addLeadsToSalesforce\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eleads\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        runtime\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003esleep\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e600\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getEmails\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e label\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Email[]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e    string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] labelIdsToMatch \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getLabelIds\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, [label]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e labelIdsToMatch.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Unable to find any labels to match.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread[] matchingMailThreads \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getMatchingMailThreads\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elabelIdsToMatch\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e    removeLabels\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ematchingMailThreads\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elabelIdsToMatch\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage[] matchingEmails \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getMatchingEmails\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ematchingMailThreads\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e from\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage message \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e matchingEmails\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e           let\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Email\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e parseEmail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003emessage\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e           where\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Email\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e           select\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e email;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getLabelIds\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient gmail, \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elabelsToMatch\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eLabelList labelList \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003elistLabels\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"me\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e from\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eLabel {name, id} \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e labelList.labels\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e           where\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e labelsToMatch.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eindexOf\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e ()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e           select\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getMatchingMailThreads\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient gmail, \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elabelIdsToMatch\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread[]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMsgSearchFilter searchFilter \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        includeSpamTrash\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e false\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        labelIds\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e labelIdsToMatch\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e from\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread mailThread \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail-\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003elistThreads\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003efilter\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e searchFilter)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e           select\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mailThread;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e removeLabels\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient gmail, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread[] mailThreads, \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elabelIds\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread mailThread \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mailThreads {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e removeLabelResponse \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003emodifyThread\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(mailThread.id, [], \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elabelIds\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e removeLabelResponse \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            log\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eprintError\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"An error occured in removing the labels from the thread.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E36209\"\u003e                removeLabelResponse\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, removeLabelResponse.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003estackTrace\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(), \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ethreadId\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mailThread.id, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elabelIds\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e labelIds);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e getMatchingEmails\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eClient gmail, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread[] mailThreads) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage[] {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage[] messages \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e [];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    foreach \u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread mailThread \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mailThreads {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMailThread\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e response \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003ereadThread\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(mailThread.id);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e response \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            log\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eprintError\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"An error occured while reading the email.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E36209\"\u003e                response\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, response.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003estackTrace\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(), \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ethreadId\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mailThread.id);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            continue\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e !\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(response.messages \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage[]) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage[]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eresponse.messages).\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            log\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eprintError\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Unable to find any messages in the thread.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ethreadId\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mailThread.id);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            continue\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        messages.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epush\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e((\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage[]\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eresponse.messages)[\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e messages;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e parseEmail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessage message) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Email\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    do\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        gmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessageBodyPart bodyPart \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.emailBodyInText.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eensureType\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003egmail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eMessageBodyPart);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e bodyPartText \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e bodyPart.data.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eensureType\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e body \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e mime\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003ebase64Decode\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ebodyPartText\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e).\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eensureType\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            'from\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.headerFrom.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eensureType\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            subject\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message.headerSubject.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eensureType\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            body\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e body\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    } \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eon\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e fail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        log\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eprintError\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"An error occured while parsing the email.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ee\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, e.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003estackTrace\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(), \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003emessage\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e message);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e generateLead\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eEmail\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003e email\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ereturns\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Lead\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    chat\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eCreateChatCompletionRequest request \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        model\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e \"gpt-3.5-turbo\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        messages\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                role\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"user\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                content\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            Extract the following details in JSON from the email.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                    firstName__c\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#6A737D\"\u003e// Mandatory\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                    lastName__c\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#6A737D\"\u003e// Mandatory\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                    email__c\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#6A737D\"\u003e // Mandatory\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                    phoneNumber__c\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#6A737D\"\u003e// With country code. Use N/A if unable to find\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                    company__c\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#6A737D\"\u003e// Mandatory\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                    designation__c\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#6A737D\"\u003e // Not mandatory. Use N/A if unable to find\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e                }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            Here is the \u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eemail\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e:    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                from\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: ${email.'from},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                subject\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: ${email.subject},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#6F42C1\"\u003e                body\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e: ${email.body}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    do\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        chat\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eCreateChatCompletionResponse response \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e openAiChat\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003echat\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003ecompletions.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e response.choices.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e            check\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Unable to find any choices in the response.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#005CC5\"\u003e        string\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e content \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e response.choices[\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e].message?.content.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eensureType\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#005CC5\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e check\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e content.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003efromJsonStringWithType\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eLead\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    } \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eon\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e fail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        log\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eprintError\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"An error occured while generating the lead.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003ee\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, e.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003estackTrace\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(), \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eemail\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e email);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003e addLeadsToSalesforce\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eLead\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e[] \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003eleads\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    from\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e Lead lead \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e leads\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e    do\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        sf\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003eCreationResponse\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e|error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e createResponse \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e salesforce\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003ecreate\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"EmailLead__c\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elead\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#D73A49\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e createResponse \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eis\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e error\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            log\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eprintError\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"An error occured while creating a Lead object on salesforce.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E36209\"\u003e                createResponse\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, createResponse.\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003estackTrace\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(), \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elead\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e lead);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        } \u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003eelse\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e            log\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#6F42C1\"\u003eprintInfo\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#032F62\"\u003e\"Lead successfully created.\"\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#E36209\"\u003elead\u003c/span\u003e\u003cspan style=\"color:#D73A49\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#24292E\"\u003e lead);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"},"content":"\nimport ballerina/lang.runtime;\nimport ballerina/log;\nimport ballerina/mime;\nimport ballerinax/googleapis.gmail;\nimport ballerinax/openai.chat;\nimport ballerinax/salesforce as sf;\n\ntype Email record {|\n    string 'from;\n    string subject;\n    string body;\n|};\n\ntype Name record {|\n    string firstName__c;\n    string lastName__c;\n|};\n\ntype Lead record {|\n    *Name;\n    string email__c;\n    string phoneNumber__c;\n    string company__c;\n    string designation__c;\n|};\n\nconfigurable string gmailAccessToken = ?;\nconfigurable string openAIKey = ?;\nconfigurable string salesforceBaseUrl = ?;\nconfigurable string salesforceAccessToken = ?;\n\nconst LABEL = \"Lead\";\n\nfinal gmail:Client gmail = check new ({auth: {token: gmailAccessToken}});\nfinal chat:Client openAiChat = check new ({auth: {token: openAIKey}});\nfinal sf:Client salesforce = check new ({baseUrl: salesforceBaseUrl, auth: {token: salesforceAccessToken}});\n\npublic function main() returns error? {\n    while true {\n        Email[] emails = check getEmails(LABEL);\n        Lead[] leads = from Email email in emails\n                       let Lead? lead = generateLead(email)\n                       where lead is Lead\n                       select lead;\n        addLeadsToSalesforce(leads);\n        runtime:sleep(600);\n    }\n}\n\nfunction getEmails(string label) returns Email[]|error {\n    string[] labelIdsToMatch = check getLabelIds(gmail, [label]);\n    if labelIdsToMatch.length() == 0 {\n        return error(\"Unable to find any labels to match.\");\n    }\n\n    gmail:MailThread[] matchingMailThreads = check getMatchingMailThreads(gmail, labelIdsToMatch);\n    removeLabels(gmail, matchingMailThreads, labelIdsToMatch);\n    gmail:Message[] matchingEmails = getMatchingEmails(gmail, matchingMailThreads);\n\n    return from gmail:Message message in matchingEmails\n           let Email|error email = parseEmail(message)\n           where email is Email\n           select email;\n}\n\nfunction getLabelIds(gmail:Client gmail, string[] labelsToMatch) returns string[]|error {\n    gmail:LabelList labelList = check gmail-\u003elistLabels(\"me\");\n    return from gmail:Label {name, id} in labelList.labels\n           where labelsToMatch.indexOf(name) != ()\n           select id;\n}\n\nfunction getMatchingMailThreads(gmail:Client gmail, string[] labelIdsToMatch) returns gmail:MailThread[]|error {\n    gmail:MsgSearchFilter searchFilter = {\n        includeSpamTrash: false,\n        labelIds: labelIdsToMatch\n    };\n\n    return from gmail:MailThread mailThread in check gmail-\u003elistThreads(filter = searchFilter)\n           select mailThread;\n}\n\nfunction removeLabels(gmail:Client gmail, gmail:MailThread[] mailThreads, string[] labelIds) {\n    foreach gmail:MailThread mailThread in mailThreads {\n        gmail:MailThread|error removeLabelResponse = gmail-\u003emodifyThread(mailThread.id, [], labelIds);\n        if removeLabelResponse is error {\n            log:printError(\"An error occured in removing the labels from the thread.\",\n                removeLabelResponse, removeLabelResponse.stackTrace(), threadId = mailThread.id, labelIds = labelIds);\n        }\n    }\n}\n\nfunction getMatchingEmails(gmail:Client gmail, gmail:MailThread[] mailThreads) returns gmail:Message[] {\n    gmail:Message[] messages = [];\n\n    foreach gmail:MailThread mailThread in mailThreads {\n        gmail:MailThread|error response = gmail-\u003ereadThread(mailThread.id);\n        if response is error {\n            log:printError(\"An error occured while reading the email.\", \n                response, response.stackTrace(), threadId = mailThread.id);\n            continue;\n        }\n\n        if !(response.messages is gmail:Message[]) || (\u003cgmail:Message[]\u003eresponse.messages).length() \u003c 1 {\n            log:printError(\"Unable to find any messages in the thread.\", threadId = mailThread.id);\n            continue;\n        }\n\n        messages.push((\u003cgmail:Message[]\u003eresponse.messages)[0]);\n    }\n\n    return messages;\n}\n\nfunction parseEmail(gmail:Message message) returns Email|error {\n    do {\n        gmail:MessageBodyPart bodyPart = check message.emailBodyInText.ensureType(gmail:MessageBodyPart);\n        string bodyPartText = check bodyPart.data.ensureType(string);\n        string body = check mime:base64Decode(bodyPartText).ensureType(string);\n\n        return {\n            'from: check message.headerFrom.ensureType(string),\n            subject: check message.headerSubject.ensureType(string),\n            body: body\n        };\n    } on fail error e {\n        log:printError(\"An error occured while parsing the email.\", e, e.stackTrace(), message = message);\n        return e;\n    }\n}\n\nfunction generateLead(Email email) returns Lead? {\n    chat:CreateChatCompletionRequest request = {\n        model: \"gpt-3.5-turbo\",\n        messages: [\n            {\n                role: \"user\",\n                content: string `\n            Extract the following details in JSON from the email.\n                {\n                    firstName__c: string, // Mandatory\n                    lastName__c: string, // Mandatory\n                    email__c: string // Mandatory\n                    phoneNumber__c: string, // With country code. Use N/A if unable to find\n                    company__c: string, // Mandatory\n                    designation__c: string // Not mandatory. Use N/A if unable to find\n                }\n\n            Here is the email:    \n            {\n                from: ${email.'from},\n                subject: ${email.subject},\n                body: ${email.body}\n            }\n        `\n            }\n        ]\n    };\n\n    do {\n        chat:CreateChatCompletionResponse response = check openAiChat-\u003e/chat/completions.post(request);\n        if response.choices.length() \u003c 1 {\n            check error(\"Unable to find any choices in the response.\");\n        }\n        string content = check response.choices[0].message?.content.ensureType(string);\n        return check content.fromJsonStringWithType(Lead);\n    } on fail error e {\n        log:printError(\"An error occured while generating the lead.\", e, e.stackTrace(), email = email);\n        return;\n    }\n}\n\nfunction addLeadsToSalesforce(Lead[] leads) {\n    from Lead lead in leads\n    do {\n        sf:CreationResponse|error createResponse = salesforce-\u003ecreate(\"EmailLead__c\", lead);\n        if createResponse is error {\n            log:printError(\"An error occured while creating a Lead object on salesforce.\", \n                createResponse, createResponse.stackTrace(), lead = lead);\n        } else {\n            log:printInfo(\"Lead successfully created.\", lead = lead);\n        }\n    };\n}\n  \n"},"__N_SSG":true},"page":"/learn/integration/pre-built-integrations/gmail-to-salesforce-integration","query":{},"buildId":"23ZwTRpyIgwinO4PkUAnm","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>