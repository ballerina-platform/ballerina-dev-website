---
layout: ballerina-example-page
title: Circuit Breaker
description: Ballerina by Example is a hands-on introduction to Ballerina using annotated example programs. Check out the first example or browse the full list below.
permalink: /swan-lake/learn/by-example/http-circuit-breaker
redirect_from:
  - /vswan-lake/learn/by-example/http-circuit-breaker
  - /vswan-lake/learn/by-example/http-circuit-breaker.html
---
<div class="row cBallerina-io-Gray-row">
        <div class="container cBallerinaBySampleContainer">
            <div class="FullCode">
                <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">http</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="o">/</span><span class="nx">runtime</span><span class="p">;</span>

<span class="c1">// The circuit breaker looks for errors across a rolling time window.</span>
<span class="c1">// After the circuit is broken, it does not send requests to</span>
<span class="c1">// the backend until the `resetTime`.</span>
<span class="nx">http</span><span class="p">:</span><span class="nx">Client</span> <span class="nx">backendClientEP</span> <span class="p">=</span> <span class="nx">new</span> <span class="p">(</span><span class="s">&quot;http://localhost:8080&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="c1">// Configuration options that control the behavior of the circuit</span>
            <span class="c1">// breaker.</span>
            <span class="nx">circuitBreaker</span><span class="p">:</span> <span class="p">{</span>
                <span class="c1">// Failure calculation window. This is how long the circuit</span>
                <span class="c1">// breaker keeps the statistics for the operations.</span>
                <span class="nx">rollingWindow</span><span class="p">:</span> <span class="p">{</span>

                    <span class="c1">// Time period in milliseconds for which the failure</span>
                    <span class="c1">// threshold is calculated.</span>
                    <span class="nx">timeWindowInMillis</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>

                    <span class="c1">// The granularity (in milliseconds) at which the time</span>
                    <span class="c1">// window slides. The `RollingWindow` is divided into</span>
                    <span class="c1">// buckets and slides by these increments.</span>
                    <span class="nx">bucketSizeInMillis</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>

                    <span class="c1">// Minimum number of requests in the `RollingWindow` that</span>
                    <span class="c1">// will trip the circuit.</span>
                    <span class="nx">requestVolumeThreshold</span><span class="p">:</span> <span class="mi">0</span>

                <span class="p">},</span>
                <span class="c1">// The threshold for request failures.</span>
                <span class="c1">// When this threshold exceeds, the circuit trips. This is the</span>
                <span class="c1">// ratio between failures and total requests. The ratio is</span>
                <span class="c1">// calculated using the requests received within the given</span>
                <span class="c1">// rolling window.</span>
                <span class="nx">failureThreshold</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>

                <span class="c1">// The time period (in milliseconds) to wait before attempting to</span>
                <span class="c1">// make another request to the upstream service.</span>
                <span class="nx">resetTimeInMillis</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>

                <span class="c1">// HTTP response status codes that are considered as failures</span>
                <span class="nx">statusCodes</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>

            <span class="p">},</span>
            <span class="nx">timeoutInMillis</span><span class="p">:</span> <span class="mi">2000</span>
        <span class="p">}</span>
    <span class="p">);</span>

<span class="nd">@http:ServiceConfig {</span>
    <span class="nx">basePath</span><span class="p">:</span> <span class="s">&quot;/cb&quot;</span>
<span class="p">}</span>
<span class="c1">// Create an HTTP service bound to the endpoint (circuitBreakerEP).</span>
<span class="kd">service</span> <span class="nx">circuitbreaker</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">9090</span><span class="p">)</span> <span class="p">{</span>

    <span class="nd">@http:ResourceConfig {</span>
        <span class="nx">methods</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">],</span>
        <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/&quot;</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">invokeEndpoint</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">backendResponse</span> <span class="p">=</span> <span class="nx">backendClientEP</span><span class="o">-&gt;</span><span class="nx">forward</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">,</span> <span class="nx">request</span><span class="p">);</span>
        <span class="c1">// If the `backendResponse` is an `http:Response`, it is sent back to</span>
        <span class="c1">// the client. If `backendResponse` is an `http:ClientError`, an</span>
        <span class="c1">// internal server error is returned to the client.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">backendResponse</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">responseToCaller</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(&lt;</span><span class="err">@</span><span class="nx">untainted</span><span class="p">&gt;</span><span class="nx">backendResponse</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">responseToCaller</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">ListenerError</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error sending response&quot;</span><span class="p">,</span> <span class="nx">responseToCaller</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">response</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="nx">http</span><span class="p">:</span><span class="nx">STATUS_INTERNAL_SERVER_ERROR</span><span class="p">;</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">setPayload</span><span class="p">((&lt;</span><span class="err">@</span><span class="nx">untainted</span> <span class="nx">error</span><span class="p">&gt;</span><span class="nx">backendResponse</span><span class="p">).</span><span class="kt">message</span><span class="p">());</span>
            <span class="k">var</span> <span class="nx">responseToCaller</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">responseToCaller</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">ListenerError</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error sending response&quot;</span><span class="p">,</span> <span class="nx">responseToCaller</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nx">counter</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nd">@http:ServiceConfig {</span>
    <span class="nx">basePath</span><span class="p">:</span> <span class="s">&quot;/hello&quot;</span>
<span class="p">}</span>
<span class="c1">// This sample service is used to mock connection timeouts and service outages.</span>
<span class="c1">// This should run separately from the `circuitBreakerDemo` service.</span>
<span class="kd">service</span> <span class="nx">helloWorld</span> <span class="nx">on</span> <span class="nx">new</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Listener</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="p">{</span>

    <span class="nd">@http:ResourceConfig {</span>
        <span class="nx">methods</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">],</span>
        <span class="nx">path</span><span class="p">:</span> <span class="s">&quot;/&quot;</span>
    <span class="p">}</span>
    <span class="kd">resource</span> <span class="kd">function</span> <span class="nx">sayHello</span><span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="nx">Caller</span> <span class="nx">caller</span><span class="p">,</span> <span class="nx">http</span><span class="p">:</span><span class="nx">Request</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">counter</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Delay the response by 5000 milliseconds to</span>
            <span class="c1">// mimic the network level delays.</span>
            <span class="nx">runtime</span><span class="p">:</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>

            <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="s">&quot;Hello World!!!&quot;</span><span class="p">);</span>
            <span class="nx">handleRespondResult</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">counter</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">http</span><span class="p">:</span><span class="nx">Response</span> <span class="nx">res</span> <span class="p">=</span> <span class="nx">new</span><span class="p">;</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">setPayload</span><span class="p">(</span>
                <span class="s">&quot;Internal error occurred while processing the request.&quot;</span><span class="p">);</span>
            <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
            <span class="nx">handleRespondResult</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">result</span> <span class="p">=</span> <span class="nx">caller</span><span class="o">-&gt;</span><span class="nx">respond</span><span class="p">(</span><span class="s">&quot;Hello World!!!&quot;</span><span class="p">);</span>
            <span class="nx">handleRespondResult</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">counter</span> <span class="p">=</span> <span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">handleRespondResult</span><span class="p">(</span><span class="nx">error</span><span class="err">?</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="nx">is</span> <span class="nx">http</span><span class="p">:</span><span class="nx">ListenerError</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">:</span><span class="nx">printError</span><span class="p">(</span><span class="s">&quot;Error sending response from mock service&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>

            <div class="col-xs-12 col-sm-12 col-md-12">
                <table class="cTopInfoContainer cTopControlsContainer">
                    <tr>
                        <td class="cLeftTD">
                            <h2>Circuit Breaker</h2>
                            <p><p>The Circuit Breaker is used to gracefully handle network related errors, which occur when using the HTTP Client.<br/><br/>
 For more information on the underlying module,
 see the <a href="https://ballerina.io/swan-lake/learn/api-docs/ballerina/http/index.html">HTTP module</a>.</p>
</p>

                        </td>
                        <td class="cRightTD">
                            <div class="cTopButtonContainer">
                                
                                <div class="cButtonInfoContainer">
                                    <a class="prev" href="content-based-routing.html">
                                        <span>< PREVIOUS</span>
                                        <p>Content-Based Routing</p>
                                    </a>
                                </div>
                                 
                                <div class="cButtonInfoContainer">
                                    <a class="next" href="http-load-balancer.html">
                                        <span>NEXT ></span>
                                        <p>Load Balancing</p>
                                    </a>
                                </div>
                                
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="example" id="http-circuit-breaker">
                <div class="col-xs-12 col-sm-12 col-md-12 cBBETable-container cCodeLeft">
                    <table class="cTopControlsContainer">
                        <tr>
                            <td class="cLeftTD">
                                <div class="cBBE-links">
                                    <ul>
                                        <li>
                                            <a class="copy"><img src="/img/copy-icon.svg" /></a>
                                        </li>
                                        <li>
                                            <a target="_blank" href="https://github.com/ballerina-platform/ballerina-distribution/tree/master/examples/http-circuit-breaker/"><img src="/img/github-logo-green.svg" /></a>
                                        </li>
                                        
                                    </ul>
                                </div>
                            </td>
                            <td></td>
                        </tr>
                    </table>

                    <table class="cTopBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>

                    
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>import ballerina/http;
import ballerina/log;
import ballerina/runtime;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>http:Client backendClientEP = new (&quot;http://localhost:8080&quot;, {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The circuit breaker looks for errors across a rolling time window.
 After the circuit is broken, it does not send requests to
 the backend until the <code>resetTime</code>.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            circuitBreaker: {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Configuration options that control the behavior of the circuit
 breaker.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                rollingWindow: {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Failure calculation window. This is how long the circuit
 breaker keeps the statistics for the operations.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                    timeWindowInMillis: 10000,
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Time period in milliseconds for which the failure
 threshold is calculated.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                    bucketSizeInMillis: 2000,
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The granularity (in milliseconds) at which the time
 window slides. The <code>RollingWindow</code> is divided into
 buckets and slides by these increments.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                    requestVolumeThreshold: 0
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Minimum number of requests in the <code>RollingWindow</code> that
 will trip the circuit.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                },
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                failureThreshold: 0.2,
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The threshold for request failures.
 When this threshold exceeds, the circuit trips. This is the
 ratio between failures and total requests. The ratio is
 calculated using the requests received within the given
 rolling window.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                resetTimeInMillis: 10000,
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>The time period (in milliseconds) to wait before attempting to
 make another request to the upstream service.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>                statusCodes: [400, 404, 500]
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>HTTP response status codes that are considered as failures</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            },
            timeoutInMillis: 2000
        }
    );
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@http:ServiceConfig {
    basePath: &quot;/cb&quot;
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service circuitbreaker on new http:Listener(9090) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Create an HTTP service bound to the endpoint (circuitBreakerEP).</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    @http:ResourceConfig {
        methods: [&quot;GET&quot;],
        path: &quot;/&quot;
    }
    resource function invokeEndpoint(http:Caller caller, http:Request request) {
        var backendResponse = backendClientEP-&gt;forward(&quot;/hello&quot;, request);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>        if (backendResponse is http:Response) {
            var responseToCaller = caller-&gt;respond(&lt;@untainted&gt;backendResponse);
            if (responseToCaller is http:ListenerError) {
                log:printError(&quot;Error sending response&quot;, responseToCaller);
            }
        } else {
            http:Response response = new;
            response.statusCode = http:STATUS_INTERNAL_SERVER_ERROR;
            response.setPayload((&lt;@untainted error&gt;backendResponse).message());
            var responseToCaller = caller-&gt;respond(response);
            if (responseToCaller is http:ListenerError) {
                log:printError(&quot;Error sending response&quot;, responseToCaller);
            }
        }
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>If the <code>backendResponse</code> is an <code>http:Response</code>, it is sent back to
 the client. If <code>backendResponse</code> is an <code>http:ClientError</code>, an
 internal server error is returned to the client.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>int counter = 1;
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>@http:ServiceConfig {
    basePath: &quot;/hello&quot;
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>service helloWorld on new http:Listener(8080) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>This sample service is used to mock connection timeouts and service outages.
 This should run separately from the <code>circuitBreakerDemo</code> service.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>    @http:ResourceConfig {
        methods: [&quot;GET&quot;],
        path: &quot;/&quot;
    }
    resource function sayHello(http:Caller caller, http:Request req) {
        if (counter % 5 == 0) {
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR hover-enable">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            runtime:sleep(5000);
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                    <div class="cCodeDesription">
                                        <div>
                                            <p>Delay the response by 5000 milliseconds to
 mimic the network level delays.</p>

                                        </div>
                                    </div>
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code leading">
                                    <div class="highlight"><pre><code class=language-ballerina>            var result = caller-&gt;respond(&quot;Hello World!!!&quot;);
            handleRespondResult(result);
        } else if (counter % 5 == 3) {
            http:Response res = new;
            res.statusCode = 500;
            res.setPayload(
                &quot;Internal error occurred while processing the request.&quot;);
            var result = caller-&gt;respond(res);
            handleRespondResult(result);
        } else {
            var result = caller-&gt;respond(&quot;Hello World!!!&quot;);
            handleRespondResult(result);
        }
        counter = counter + 1;
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR">

                                <td class="code">
                                    <div class="highlight"><pre><code class=language-ballerina>function handleRespondResult(error? result) {
    if (result is http:ListenerError) {
        log:printError(&quot;Error sending response from mock service&quot;, result);
    }
}
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># To start the services, navigate to the directory that contains the
# `.bal` file and use the `ballerina run` command below.
ballerina run http_circuit_breaker.bal
[ballerina/http] started HTTP/WS listener 0.0.0.0:9090
[ballerina/http] started HTTP/WS listener 0.0.0.0:8080
2019-09-04 17:08:02,595 INFO  [ballerina/http/resiliency] - CircuitBreaker failure threshold exceeded. Circuit tripped from CLOSE to OPEN state.
2019-09-04 17:08:12,514 INFO  [ballerina/http/resiliency] - CircuitBreaker reset timeout reached. Circuit switched from OPEN to HALF_OPEN state.
2019-09-04 17:08:14,993 INFO  [ballerina/http/resiliency] - CircuitBreaker trial run  was successful. Circuit switched from HALF_OPEN to CLOSE state.
2019-09-04 17:08:20,003 ERROR [] - Error sending response from mock service : error {ballerina/http}GenericListenerError message=Connection between remote client and host is closed
2019-09-04 17:08:22,082 INFO  [ballerina/http/resiliency] - CircuitBreaker failure threshold exceeded. Circuit tripped from CLOSE to OPEN state.
2019-09-04 17:08:32,755 INFO  [ballerina/http/resiliency] - CircuitBreaker reset timeout reached. Circuit switched from OPEN to HALF_OPEN state.
2019-09-04 17:08:35,268 INFO  [ballerina/http/resiliency] - CircuitBreaker trial run  was successful. Circuit switched from HALF_OPEN to CLOSE state.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        
                            
                                
                            
                        

                    <div>

                        <table class="cBBE-body">
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># The first two requests complete without any errors.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; date: Mon, 21 Sep 2020 17:07:58 +0530
&lt; server: ballerina
&lt; content-length: 14
&lt;
* Connection #0 to host localhost left intact
Hello World!!!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; date: Mon, 21 Sep 2020 17:08:00 +0530
&lt; server: ballerina
&lt; content-length: 14
&lt;
* Connection #0 to host localhost left intact
Hello World!!!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># The third request responds with a `500 Internal Server Error` because the
# mock service sends a `500` http status code when responding to every third
# request.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 500 Internal Server Error
&lt; content-type: text/plain
&lt; date: Mon, 21 Sep 2020 17:08:00 +0530
&lt; server: ballerina
&lt; content-length: 53
&lt;
* Connection #0 to host localhost left intact
Internal error occurred while processing the request.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Subsequent requests fail immediately since the reset timeout period has not
# elapsed.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 500 Internal Server Error
&lt; content-type: text/plain
&lt; content-length: 99
&lt; server: ballerina
&lt; date: Mon, 21 Sep 2020 17:08:02 +0530
&lt;
* Connection #0 to host localhost left intact
Upstream service unavailable. Requests to upstream service will be suspended for 8340 milliseconds.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 500 Internal Server Error
&lt; content-type: text/plain
&lt; content-length: 99
&lt; server: ballerina
&lt; date: Mon, 21 Sep 2020 17:08:04 +0530
&lt;
* Connection #0 to host localhost left intact
Upstream service unavailable. Requests to upstream service will be suspended for 6079 milliseconds.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session>curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 500 Internal Server Error
&lt; content-type: text/plain
&lt; content-length: 99
&lt; server: ballerina
&lt; date: Mon, 21 Sep 2020 17:08:07 +0530
&lt;
* Connection #0 to host localhost left intact
Upstream service unavailable. Requests to upstream service will be suspended for 3475 milliseconds.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># The request sent immediately after the timeout period expires, is the trial
# request. It is sent to see if the backend service is back to normal.
# If this request is successful, the circuit is set to `close` and normal
# functionality resumes.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; date: Mon, 21 Sep 2020 17:08:12 +0530
&lt; server: ballerina
&lt; content-length: 14
&lt;
* Connection #0 to host localhost left intact
Hello World!!!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># The fifth request times out because the mock service times out when
# responding to every fifth request.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 500 Internal Server Error
&lt; content-type: text/plain
&lt; content-length: 57
&lt; server: ballerina
&lt; date: Mon, 21 Sep 2020 17:08:17 +0530
&lt;
* Connection #0 to host localhost left intact
Idle timeout triggered before initiating inbound response
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Subsequent requests fail immediately since the reset timeout period has not
# elapsed.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 500 Internal Server Error
&lt; content-type: text/plain
&lt; content-length: 99
&lt; server: ballerina
&lt; date: Mon, 21 Sep 2020 17:08:22 +0530
&lt;
* Connection #0 to host localhost left intact
Upstream service unavailable. Requests to upstream service will be suspended for 4917 milliseconds.
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code leading cOutput">
                                    <div class="highlight"><pre><code class=shell-session># The request sent immediately after the timeout period expires, is the trial
# request. It is sent to see if the backend service is back to normal.
# If this request is successful, the circuit is set to `close` and normal
# functionality resumes.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; date: Mon, 21 Sep 2020 17:08:32 +0530
&lt; server: ballerina
&lt; content-length: 14
&lt;
* Connection #0 to host localhost left intact
Hello World!!!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                            <tr class="cTR cOutputTr">

                                <td class="code cOutput">
                                    <div class="highlight"><pre><code class=shell-session># Since the immediate request after the timeout expired was successful, the
# requests sent after that complete normally.
curl -v http://localhost:9090/cb
*   Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 9090 (#0)
&gt; GET /cb HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; date: Mon, 21 Sep 2020 17:08:35 +0530
&lt; server: ballerina
&lt; content-length: 14
&lt;
* Connection #0 to host localhost left intact
Hello World!!!
</code></pre></div>

                                </td>
                                <td class="docs">
                                    
                                </td>
                            </tr>
                            
                        </table>
                    </div>
                    


                    <table class="cBottomBorder-table">
                        <tr>
                            <td class="cCodeTD"></td>
                            <td class="cDescTD"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <script>
            $(document).ready(function() {

                // hljs.initHighlightingOnLoad();

                $(".switch").click(function() {
                    $(".cCodeRight").toggleClass('cShow');
                    $(".cCodeLeft").toggleClass('cHide');
                });

                // register "copy to clipboard" event to elements with "copy" class
                var clipboard = new ClipboardJS('.copy', {
                    text: function(trigger) {
                        return $('.FullCode').find('pre').text();
                    }
                });

                // Register events show hide tooltip on click event
                clipboard.on('success', function(e) {
                    setTooltip(e.trigger, 'Copied!');
                    hideTooltip(e.trigger);
                });

                clipboard.on('error', function(e) {
                    setTooltip(e.trigger, 'Failed!');
                    hideTooltip(e.trigger);
                });

                $('.copy').tooltip({
                    trigger: 'click',
                    placement: 'bottom'
                });
                $("a.copy").unbind("click");
            });

            function setTooltip(btn, message) {
                $(btn).attr('data-original-title', message)
                    .tooltip('show');
            }

            function hideTooltip(btn) {
                setTimeout(function() {
                    $(btn).tooltip('hide').removeAttr('data-original-title');
                }, 1000);
            }
        </script>
